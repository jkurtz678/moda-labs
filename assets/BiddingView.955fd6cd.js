import{s as f}from"./util.d8537e07.js";import{g as $,_ as E,c as L}from"./bid.6988c499.js";import{h as q}from"./token-meta.9b03395e.js";import{i as V}from"./firebaseConfig.4d01e9b5.js";import{d as N,r as d,Q as U,q as A,E as C,c as T,h as g,a as D,l as s,t as w,j as h,i as n,w as r,e as I,f as c,o as _,z as R}from"./index.dc013b60.js";import"./types.67d14e22.js";import"./thumbnail-image.ce276e3c.js";const S={class:"container"},W={key:0},j={class:"top-bid"},z=s("h3",null,"Highest Bid",-1),F={class:"bid"},H={key:0},Q={style:{"font-weight":"bold","margin-right":"5px"}},G={style:{"font-weight":"bold"}},J={key:1},K={class:"bid-form"},O=s("h3",{style:{"padding-bottom":"15px"}},"Place a Bid",-1),le=N({__name:"BiddingView",setup(X){const u=I(),y=d(),a=d({token_meta_id:"",bidding_name:"",email:"",phone_number:"",amount:0,created_at:V.now(),updated_at:V.now()}),b=d([]),v=d(),B=U({bidding_name:[{required:!0,message:"Please enter your bidding name",trigger:"blur"}],email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email address",trigger:["blur","change"]}],phone_number:[{required:!0,message:"Please enter your phone number",trigger:"blur"},{pattern:/^\d{10}$/,message:"Please enter a valid 10-digit phone number",trigger:"blur"}],amount:[{required:!0,message:"Please enter a bid amount",trigger:"blur"},{validator:(t,e,o)=>{let i=0;m.value&&(i=m.value.entity.amount+1),e<=i?o(new Error(`Please enter a bid amount greater than $${i}`)):o()},trigger:"blur"},{pattern:/^\d+(\.\d+)?$/,message:"Please enter a valid number",trigger:"blur"}]}),k=d(),p=d(!1);A(async()=>{if(!u.params.token_meta_id||u.params.token_meta_id instanceof Array){f("Error invalid token meta id");return}k.value=C.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),console.log("route.params.token_meta_id",u.params.token_meta_id),await q(u.params.token_meta_id,t=>{v.value=t,a.value.token_meta_id=t.id}),await $(u.params.token_meta_id,t=>{b.value=t,k.value.close()})});const m=T(()=>b.value.length===0?null:b.value.reduce((t,e)=>t.entity.amount>e.entity.amount?t:e)),x=async t=>{if(!t){f("Error finding form element");return}!await t.validate(o=>o)||(p.value=!0,await L(a.value).then(()=>{p.value=!1,t.resetFields(),R({type:"success",message:"Successfully submitted bid!"})}).catch(o=>{p.value=!1,f(o)}))};return(t,e)=>{const o=c("el-input"),i=c("el-form-item"),P=c("el-button"),M=c("el-form");return _(),g("div",S,[v.value?(_(),D(E,{key:1,token_meta:v.value},null,8,["token_meta"])):(_(),g("div",W,"Loading")),s("div",j,[z,s("div",F,[m.value?(_(),g("div",H,[s("span",Q,w(m.value.entity.bidding_name),1),h("- "),s("span",G,"$"+w(m.value.entity.amount),1)])):(_(),g("div",J,"No bids"))])]),s("div",K,[O,n(M,{ref_key:"formRef",ref:y,model:a.value,rules:B,"label-width":"160px","label-position":"left"},{default:r(()=>[n(i,{label:"Email (private)",prop:"email"},{default:r(()=>[n(o,{modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.email=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),n(i,{label:"Phone (private)",prop:"phone_number"},{default:r(()=>[n(o,{modelValue:a.value.phone_number,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.phone_number=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),n(i,{label:"Bidding Name (public)",prop:"bidding_name"},{default:r(()=>[n(o,{modelValue:a.value.bidding_name,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.bidding_name=l)},null,8,["modelValue"])]),_:1}),n(i,{label:"Bid Amount (public)",prop:"amount",style:{"max-width":"350px"}},{default:r(()=>[n(o,{modelValue:a.value.amount,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.amount=l),modelModifiers:{number:!0}},{append:r(()=>[h("$")]),_:1},8,["modelValue"])]),_:1}),n(P,{loading:p.value,onClick:e[4]||(e[4]=l=>x(y.value)),class:"submit-button",color:"#000000"},{default:r(()=>[h(" SUBMIT ")]),_:1},8,["loading"])]),_:1},8,["model","rules"])])])}}});export{le as default};
