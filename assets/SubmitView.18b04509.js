import{c as N}from"./token-meta.17aea882.js";import{bS as O,bT as P,bU as z,b as x,d as G,t as f,S as B,bV as E,a as H,u as j,o as J,E as K,r as i,c as w,y as Q,f as t,h as a,w as l,z as y,e as R,T as $,P as v,G as W,V as X}from"./index.2e0b6610.js";const Y=O(),Z=async(p,b,e,c)=>{console.log("uploadFile - starting file upload for ",p);const V=P(Y,p);z(V,b).on("state_changed",u=>{console.log("snapshot",u.bytesTransferred,u.totalBytes),e(u.bytesTransferred/u.totalBytes)},u=>{console.log("uploadFile error - ",u),x({message:`Error uploading file to moda archive - ${u}`,type:"error",showClose:!0,duration:12e3})},c)};function g(p){x({message:p,type:"error",showClose:!0,duration:8e3})}const ee={style:{padding:"20px"}},oe=y("h1",{style:{"margin-bottom":"15px"}},"SUBMIT TO MODA ARCHIVES",-1),te=v("Ethereum"),ae=v("Off-chain"),le=y("div",{class:"el-upload__text"},[v(" Drop file here or "),y("em",null,"click to upload")],-1),se=y("div",null,"SUBMIT",-1),de=G({setup(p){const b=f();f();const e=B({name:"",artist:"",description:"",public_link:"",created_at:E.now(),updated_at:E.now(),media_id:"",media_type:"",account_id:"",blockchain:"ethereum",asset_contract_address:"",token_id:""}),c=f([]),V=B({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),_=f(!1),u=f("0%"),T=H(),S=j();J(async()=>{const d=window.localStorage.getItem("account_address"),o=window.localStorage.getItem("account_signature");if(d==null||o==null){T.push({name:"login"});return}const s=K.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await S.loadAccount(d,o),e.account_id=S.get_account.id}catch(r){g(`Error loading moda archive account - ${r}`)}finally{s.close()}});const U=(d,o)=>X.confirm(`Cancel the upload of ${d.name} ?`).then(()=>!0,()=>!1),q=()=>{},A=async d=>{var h;if(!d){g("Error finding form element");return}if(!await d.validate(m=>m))return;if(e.blockchain!="ethereum"&&(e.asset_contract_address="",e.token_id=""),((h=c==null?void 0:c.value)==null?void 0:h.length)!==1){g("Please add a file to upload");return}const s=c.value[0],r=m=>{u.value=`${Math.round(m*100)}%`},k=()=>{M(d,s)};_.value=!0,Z(`${s.uid||""}`,s.raw,r,k).catch(m=>{console.error(m),_.value=!1,g(`Error uploading file to moda archive - ${m}`)})},M=(d,o)=>{e.media_id=`${(o==null?void 0:o.uid)||""}`,e.media_type=`.${o.name.split(".").pop()||""}`,console.log("upload success, sending form: ",e),N(e).then(s=>{d.resetFields(),c.value=[],x({type:"success",message:"Successfully submitted token"})}).catch(s=>{g(`Error uploading metadata to moda archive - ${s}`)}).finally(()=>_.value=!1)};return(d,o)=>{const s=i("el-input"),r=i("el-form-item"),k=i("el-radio"),h=i("el-radio-group"),m=i("upload-filled"),C=i("el-icon"),I=i("el-upload"),D=i("Loading"),F=i("el-button"),L=i("el-form");return w(),Q("div",ee,[oe,t(L,{ref_key:"formRef",ref:b,model:a(e),rules:a(V),"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:l(()=>[t(r,{label:"Artwork title",style:{"max-width":"550px"},prop:"name"},{default:l(()=>[t(s,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=n=>a(e).name=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist name",style:{"max-width":"550px"},prop:"artist"},{default:l(()=>[t(s,{modelValue:a(e).artist,"onUpdate:modelValue":o[1]||(o[1]=n=>a(e).artist=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"Blockchain"},{default:l(()=>[t(h,{modelValue:a(e).blockchain,"onUpdate:modelValue":o[2]||(o[2]=n=>a(e).blockchain=n)},{default:l(()=>[t(k,{label:"ethereum"},{default:l(()=>[te]),_:1}),t(k,{label:"off_chain"},{default:l(()=>[ae]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(e).blockchain=="ethereum"?(w(),R(r,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:l(()=>[t(s,{modelValue:a(e).asset_contract_address,"onUpdate:modelValue":o[3]||(o[3]=n=>a(e).asset_contract_address=n)},null,8,["modelValue"])]),_:1})):$("",!0),a(e).blockchain=="ethereum"?(w(),R(r,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:l(()=>[t(s,{modelValue:a(e).token_id,"onUpdate:modelValue":o[4]||(o[4]=n=>a(e).token_id=n)},null,8,["modelValue"])]),_:1})):$("",!0),t(r,{label:"Description",prop:"description"},{default:l(()=>[t(s,{modelValue:a(e).description,"onUpdate:modelValue":o[5]||(o[5]=n=>a(e).description=n),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(r,{label:"Public Link",prop:"public_link"},{default:l(()=>[t(s,{modelValue:a(e).public_link,"onUpdate:modelValue":o[6]||(o[6]=n=>a(e).public_link=n)},null,8,["modelValue"])]),_:1}),t(r,null,{default:l(()=>[t(I,{class:"upload-demo","auto-upload":!1,action:"","on-remove":q,"before-remove":U,limit:1,drag:"","file-list":c.value},{default:l(()=>[t(C,{class:"el-icon--upload"},{default:l(()=>[t(m)]),_:1}),le]),_:1},8,["file-list"])]),_:1}),t(r,null,{default:l(()=>[t(F,{onClick:o[7]||(o[7]=n=>A(b.value)),loading:_.value},{loading:l(()=>[t(C,{class:"is-loading",style:{"margin-right":"4px"}},{default:l(()=>[t(D)]),_:1}),v(" "+W(u.value),1)]),default:l(()=>[se]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}});export{de as default};
