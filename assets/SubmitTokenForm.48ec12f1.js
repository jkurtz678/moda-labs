import{b as Q,c as W}from"./gallery-token.628d8fa1.js";import{d as H,u as K,e as X}from"./token-meta.e9d92a72.js";import{h as Y,r as Z,u as ee,i as B}from"./firebaseConfig.4d01e9b5.js";import{z as T,d as ae,r as f,O as le,q as te,c as oe,a as k,w as o,f as d,o as v,i as t,g as h,h as re,J as ne,F as se,j as q,t as R,l as $,_ as ue,A as ie,p as de,m as ce}from"./index.73941ac7.js";import{a as S,T as me}from"./types.c2052207.js";import{u as pe}from"./account.a1e77a10.js";import{u as _e}from"./token-meta.d8459a37.js";import{s as g}from"./util.a831a886.js";const fe=Y(),ve=async(m,p,w,a)=>{console.log("uploadFile - starting file upload for ",m);const c=Z(fe,m);ee(c,p).on("state_changed",n=>{console.log("snapshot",n.bytesTransferred,n.totalBytes),w(n.bytesTransferred/n.totalBytes)},n=>{console.log("uploadFile error - ",n),T({message:`Error uploading file to moda archive - ${n}`,type:"error",showClose:!0,duration:12e3})},a)};const ke=m=>(de("data-v-71df23a1"),m=m(),ce(),m),ge=ke(()=>$("div",{class:"el-upload__text"},[q(" Drop file here or "),$("em",null,"click to upload")],-1)),be=ae({__name:"SubmitTokenForm",props:{token_meta_id:{}},setup(m){const p=m,w=f();f();const a=f({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:B.now(),updated_at:B.now(),media_id:"",media_type:"",user_id:"",blockchain:S.OffChain,asset_contract_address:"",token_id:"",platform:me.Archive}),c=f([]),U=le({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),n=f(!1),x=f("0%"),V=f([]),F=pe(),M=_e(),C=f([]);te(()=>{p.token_meta_id?a.value={...M.all_token_metas[p.token_meta_id].entity}:Q().then(u=>{C.value=u})});const A=(u,e)=>ie.confirm(`Cancel the upload of ${u.name} ?`).then(()=>!0,()=>!1),b=oe({get:()=>a.value.blockchain===S.Ethereum,set:u=>{a.value.blockchain=u?S.Ethereum:S.OffChain}}),L=()=>{},D=async u=>{var s;if(!u){g("Error finding form element");return}if(!!await u.validate(r=>r)){if(a.value.user_id=F.get_account.id,a.value.blockchain!="ethereum"&&(a.value.asset_contract_address="",a.value.token_id=""),p.token_meta_id){P(p.token_meta_id);return}if(((s=c==null?void 0:c.value)==null?void 0:s.length)!==1){g("Please add a file to upload");return}await I(u)}},I=async u=>{const e=c.value[0];n.value=!0;const s=await H().catch(i=>{console.error(i),n.value=!1,g(`Error getting moda archive token meta document - ${i}`)});if(!s)return;const r=i=>{x.value=`${Math.round(i*100)}%`},y=()=>{N(u,e,s)},_=`${s.id}.${e.name.split(".").pop()}`;return ve(_,e.raw,r,y).catch(i=>{console.error(i),n.value=!1,g(`Error uploading file to moda archive - ${i}`)})},N=async(u,e,s)=>{var y;a.value.media_id=`${s.id}`,a.value.media_type=`.${e.name.split(".").pop()}`;let r;try{r=await X(s,a.value)}catch(_){g(`Error uploading metadata to moda archive - ${_}`),n.value=!1;return}if((y=V.value)!=null&&y.length){const _=V.value.map(i=>({gallery_id:i,token_meta_id:r.id}));await W(_).catch(i=>{g(`Error adding token to gallery - ${i}`),n.value=!1})}u.resetFields(),c.value=[],V.value=[],T({type:"success",message:"Successfully submitted artwork. Please wait a few moments for your artwork to appear."}),n.value=!1},P=u=>{n.value=!0,K(u,a.value).then(()=>{T({type:"success",message:"Successfully updated artwork"})}).catch(e=>{g(`Error updating token metadata - ${e}`)}).finally(()=>n.value=!1)};return(u,e)=>{const s=d("el-input"),r=d("el-form-item"),y=d("el-switch"),_=d("el-option"),i=d("el-select"),G=d("upload-filled"),E=d("el-icon"),O=d("el-upload"),j=d("Loading"),z=d("el-button"),J=d("el-form");return v(),k(J,{ref_key:"formRef",ref:w,model:a.value,rules:U,"label-position":"left","label-width":"180px",style:{margin:"0 auto"}},{default:o(()=>[t(r,{label:"Artwork Title",prop:"name"},{default:o(()=>[t(s,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.name=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist Name",prop:"artist"},{default:o(()=>[t(s,{modelValue:a.value.artist,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.artist=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"Plaque Description",prop:"description"},{default:o(()=>[t(s,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.description=l),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(r,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[t(s,{modelValue:a.value.public_link,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.public_link=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist Social Media Link",prop:"artist_social_link"},{default:o(()=>[t(s,{modelValue:a.value.artist_social_link,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.artist_social_link=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"Link to Blockchain"},{default:o(()=>[t(y,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),"active-text":b.value?"Enabled":"Disabled"},null,8,["modelValue","active-text"])]),_:1}),b.value?(v(),k(r,{key:0,label:"Blockchain",prop:"blockchain"},{default:o(()=>[t(i,{modelValue:a.value.blockchain,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.blockchain=l)},{default:o(()=>[t(_,{label:"Ethereum",value:"ethereum"})]),_:1},8,["modelValue"])]),_:1})):h("",!0),b.value?(v(),k(r,{key:1,label:"Contract Address",prop:"asset_contract_address"},{default:o(()=>[t(s,{modelValue:a.value.asset_contract_address,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.asset_contract_address=l)},null,8,["modelValue"])]),_:1})):h("",!0),b.value?(v(),k(r,{key:2,label:"Token ID",prop:"token_id"},{default:o(()=>[t(s,{modelValue:a.value.token_id,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.token_id=l)},null,8,["modelValue"])]),_:1})):h("",!0),p.token_meta_id?h("",!0):(v(),k(r,{key:3,label:"Share to Gallery(s)"},{default:o(()=>[t(i,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=l=>V.value=l),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(v(!0),re(se,null,ne(C.value,l=>(v(),k(_,{key:l.id,label:`${l.entity.name}`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),p.token_meta_id?h("",!0):(v(),k(r,{key:4},{default:o(()=>[t(O,{class:"upload-demo","auto-upload":!1,action:"","on-remove":L,"before-remove":A,limit:1,drag:"","file-list":c.value,"onUpdate:fileList":e[10]||(e[10]=l=>c.value=l)},{default:o(()=>[t(E,{class:"el-icon--upload"},{default:o(()=>[t(G)]),_:1}),ge]),_:1},8,["file-list"])]),_:1})),t(r,null,{default:o(()=>[t(z,{onClick:e[11]||(e[11]=l=>D(w.value)),loading:n.value,color:"#000000"},{loading:o(()=>[t(E,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[t(j)]),_:1}),q(" "+R(x.value),1)]),default:o(()=>[$("div",null,R(n.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});var xe=ue(be,[["__scopeId","data-v-71df23a1"]]);export{xe as S};
