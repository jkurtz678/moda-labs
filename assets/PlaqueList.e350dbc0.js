import{d as Z,r as y,c as E,z as G,h as x,j as t,w as n,u as I,f as _,o as c,i,t as C,k as u,_ as ee,x as z,a as R,b as Ce,A as qe,B as Fe,C as Oe,g as j,D as Re,G as Be,F as H,H as re,y as W,n as je,I as Je}from"./index.a7f95675.js";import{u as L,d as We}from"./plaque.067d7277.js";import{c as Ge}from"./token-meta.68ad47b5.js";import{u as te}from"./plaque.17686dab.js";import{u as ue,g as He}from"./account.2ac9b767.js";import{s as U,m as ke,a as xe}from"./util.0391cb77.js";import{T as we,O as Ke}from"./types.1a161a7e.js";import{u as be}from"./breakpoints.2cc6b77d.js";import{u as $e}from"./token-meta.f8ad0665.js";import{_ as Qe}from"./TokenSelectList.6c9003a3.js";import{i as h,h as Xe,r as Ye,j as Ze}from"./firebaseConfig.4d01e9b5.js";import{P as et}from"./PlaqueTokenItem.d13f3437.js";import{u as tt}from"./gallery.90e5942e.js";import"./thumbnail-image.8b5cbc01.js";import"./ArtworkFilters.ab4817a5.js";import"./gallery-token.81532f70.js";const lt={class:"dialog-container"},at={class:"dialog-footer"},nt=Z({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:{}},emits:["update:show_add_token_dialog"],setup(J,{emit:o}){const m=J,d=y([]),b=y(!1),P=o,{screen_type:V}=be(),$=te(),g=$e(),k=ue(),r=E({get(){return m.show_add_token_dialog},set(A){P("update:show_add_token_dialog",A)}});G(r,A=>{A&&(d.value=JSON.parse(JSON.stringify(S.value.entity.token_meta_id_list)))});const S=E(()=>$.plaque_map[m.plaque_id]),T=E(()=>g.sorted_all_token_metas),F=async()=>{b.value=!0;try{for(let[A,s]of d.value.entries()){const l=g.all_token_metas[s];if(!l)throw"Failed to find store token for token: "+s;if(l.entity.platform!=we.Opensea)continue;const q=JSON.parse(JSON.stringify(l));q.entity.user_id=k.get_account.id,q.entity.platform=we.OpenseaArchive;const w=await Ge(q.entity);d.value[A]=w.id}await L(m.plaque_id,{token_meta_id_list:d.value}),$.plaque_map[m.plaque_id].entity.token_meta_id_list=d.value}catch(A){U(`Error updating plaque tokens - ${A}`)}b.value=!1,r.value=!1},N=()=>{d.value=[]};return(A,s)=>{const l=_("el-button"),q=_("el-dialog");return c(),x("div",lt,[t(q,{center:"",modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=w=>r.value=w),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:I(V)=="xs",top:"2vh","destroy-on-close":""},{footer:n(()=>[i("div",at,[i("div",null,C(`Artwork in playlist: ${d.value.length}`),1),s[4]||(s[4]=i("div",{style:{"flex-grow":"1"}},null,-1)),t(l,{onClick:N},{default:n(()=>s[2]||(s[2]=[u("Clear")])),_:1}),t(l,{type:"info",onClick:F,loading:b.value},{default:n(()=>s[3]||(s[3]=[u("Save")])),_:1},8,["loading"])])]),default:n(()=>[t(Qe,{selected_token_meta_id_list:d.value,"onUpdate:selected_token_meta_id_list":s[0]||(s[0]=w=>d.value=w),token_meta_list:T.value,plaque_id:A.plaque_id},null,8,["selected_token_meta_id_list","token_meta_list","plaque_id"])]),_:1},8,["modelValue","fullscreen"])])}}});var ot=ee(nt,[["__scopeId","data-v-114b0920"]]);const it={class:"controller-buttons"},st=Z({__name:"PlaqueController",props:{plaque:{}},setup(J){const o=te(),m=J,d=y(!1),b=y(!1),P=y(!1),V=y(!1),$=E({get:()=>m.plaque.entity.orientation||"landscape",set:k=>{L(m.plaque.id,{orientation:k}).then(()=>{o.plaque_map[m.plaque.id].entity.orientation=k,z({type:"success",message:"Plaque orientation updated"})}).catch(r=>{U(`Error updating plaque orientation - ${r}`)})}}),g=k=>{const r={type:k,time_sent:h.now()};L(m.plaque.id,{command:r}).then(()=>{o.plaque_map[m.plaque.id].entity.command=r,z({type:"success",message:"Command sent to plaque"})}).catch(S=>{U(`Error sending command to plaque - ${S}`)}).finally(()=>{d.value=!1,b.value=!1,P.value=!1,V.value=!1})};return(k,r)=>{const S=_("el-button"),T=_("el-radio"),F=_("el-radio-group");return c(),x("div",null,[i("div",it,[t(S,{circle:"",text:"",loading:d.value,icon:"DArrowLeft",onClick:r[0]||(r[0]=N=>{d.value=!0,g("playlist_previous")})},null,8,["loading"]),t(S,{circle:"",text:"",loading:b.value,icon:"VideoPlay",onClick:r[1]||(r[1]=N=>{b.value=!0,g("play")})},null,8,["loading"]),t(S,{circle:"",text:"",icon:"VideoPause",loading:P.value,onClick:r[2]||(r[2]=N=>{P.value=!0,g("pause")})},null,8,["loading"]),t(S,{circle:"",text:"",icon:"DArrowRight",loading:V.value,onClick:r[3]||(r[3]=N=>{V.value=!0,g("playlist_next")})},null,8,["loading"])]),t(F,{modelValue:$.value,"onUpdate:modelValue":r[4]||(r[4]=N=>$.value=N),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:n(()=>[t(T,{label:"landscape",size:"small"},{default:n(()=>r[5]||(r[5]=[u("Landscape")])),_:1}),t(T,{label:"portrait",size:"small"},{default:n(()=>r[6]||(r[6]=[u("Portrait")])),_:1}),t(T,{label:"landscape_reversed",size:"small"},{default:n(()=>r[7]||(r[7]=[u("Landscape Reversed")])),_:1}),t(T,{label:"portrait_reversed",size:"small"},{default:n(()=>r[8]||(r[8]=[u("Portrait Reversed")])),_:1})]),_:1},8,["modelValue"])])}}});var rt=ee(st,[["__scopeId","data-v-100e65c8"]]);const ut={style:{display:"flex","align-items":"center",padding:"1em"}},dt={key:0},pt={class:"card-simple"},_t={style:{padding:"0.3em 1em"}},mt={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},ct={key:0,class:"card-detail"},yt={style:{padding:"0 1em"}},ft={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},vt={style:{display:"flex",padding:"1em"}},gt={key:0,style:{padding:"1em"}},qt={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},kt={key:0},wt={key:0},Ct={key:1},xt={style:{"font-size":"var(--el-font-size-extra-small)"}},bt={key:1},$t={style:{"margin-bottom":"1em"}},At={style:{"margin-top":".5em"}},St={key:0,style:{"margin-bottom":"1em"}},ht={style:{"margin-bottom":"1em"}},Pt={style:{"margin-bottom":"1em"}},Vt={style:{"margin-bottom":"1em"}},Nt={style:{"margin-top":"1em"}},zt={style:{display:"flex","justify-content":"end"}},Lt=Z({__name:"PlaqueCard",props:{plaque:{}},setup(J){const o=J,m=te();Ce();const d=y("simple"),b=y(!1),P=y(!1),V=y(""),$=y(!1),g=y(!1),k=y(!1),r=y(!1),S=y(!1),T=y(!1),F=y(!1),N=y(!1),A=y(!1);h.now();const s=async()=>{$.value=!0,await L(o.plaque.id,{name:o.plaque.entity.name}).catch(a=>{U(`Error updating plaque tokens - ${a}`)}),P.value=!1,$.value=!1},l=ue(),q=$e(),w=E(()=>D.value.length==0?null:D.value[0]),D=E(()=>{const a=q.all_token_metas;return o.plaque.entity.token_meta_id_list.map(p=>a[p])}),K=E(()=>xe(o.plaque)),le=E(()=>{const a=o.plaque.entity.last_check_in_time;return a?new Date(a.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):"N/A"}),ae=a=>new Date(a.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}),ne=()=>{W.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{L(o.plaque.id,{token_meta_id_list:[]}).then(()=>{m.plaque_map[o.plaque.id].entity.token_meta_id_list=[],z({type:"success",message:"Tokens cleared"})}).catch(a=>{z({message:`Error clearing tokens from plaque - ${a}`,type:"error",showClose:!0,duration:12e3})})})},oe=()=>{W.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{L(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{m.plaque_map[o.plaque.id].entity.user_id="",m.plaque_map[o.plaque.id].entity.token_meta_id_list=[],z({type:"success",message:"Plaque forgotten"})}).catch(a=>{z({message:`Error forgetting plaque - ${a}`,type:"error",showClose:!0,duration:12e3})})})};G(d,a=>{a=="settings"&&o.plaque.entity.user_id&&!V.value&&He(o.plaque.entity.user_id).then(e=>{V.value=e.entity.email}).catch(e=>{z({message:`Error loading user account - ${e}`,type:"error",showClose:!0,duration:12e3})})});const Q=E({get:()=>Boolean(o.plaque.entity.vpn_active),set:a=>{L(o.plaque.id,{vpn_active:a}).then(()=>{m.plaque_map[o.plaque.id].entity.vpn_active=a,z({type:"success",message:"VPN setting updated"})}).catch(e=>{U(`Error updating VPN setting- ${e}`)})}}),f=E(()=>{var p,B,O;const a=(O=(B=(p=o==null?void 0:o.plaque)==null?void 0:p.entity)==null?void 0:B.machine_data)==null?void 0:O.updated_at;return a?new Date(a.seconds*1e3+a.nanoseconds/1e6).toLocaleString():"N/A"}),Ae=()=>{const a={type:"upload_logs",time_sent:h.now()};g.value=!0,L(o.plaque.id,{command:a}).then(()=>{m.plaque_map[o.plaque.id].entity.command=a,z({type:"success",message:"Command sent to plaque"})}).catch(e=>{U(`Error sending command to plaque - ${e}`)}).finally(()=>{g.value=!1})},Se=()=>{W.confirm(`Are you sure you want to restart the plaque '${o.plaque.entity.name}'?`,"Restart plaque",{type:"warning"}).then(()=>{const a={type:"restart_machine",time_sent:h.now()};k.value=!0,L(o.plaque.id,{command:a}).then(()=>{m.plaque_map[o.plaque.id].entity.command=a,z({type:"success",message:"Command sent to plaque"})}).catch(e=>{U(`Error sending command to plaque - ${e}`)}).finally(()=>{k.value=!1})})},he=()=>{W.confirm(`Are you sure you want to restart the app on plaque '${o.plaque.entity.name}'?`,"Restart app",{type:"warning"}).then(()=>{const a={type:"restart_app",time_sent:h.now()};r.value=!0,L(o.plaque.id,{command:a}).then(()=>{m.plaque_map[o.plaque.id].entity.command=a,z({type:"success",message:"Command sent to plaque"})}).catch(e=>{U(`Error sending command to plaque - ${e}`)}).finally(()=>{r.value=!1})})},X=(a,e)=>L(a,{command:e}).then(()=>{m.plaque_map[a].entity.command=e,z({type:"success",message:"Command sent to plaque"})}).catch(p=>{U(`Error sending command to plaque - ${p}`)}),Pe=()=>{const a={type:"display_extend",time_sent:h.now()};T.value=!0,X(o.plaque.id,a).finally(()=>{T.value=!1})},Ve=()=>{const a={type:"display_mirror",time_sent:h.now()};F.value=!0,X(o.plaque.id,a).finally(()=>{F.value=!1})},Ne=async()=>{W.confirm("Are you sure you want to clear all media files on this plaque? The files will have to be redownloaded if you want to play them again.","Clear files",{type:"warning"}).then(async()=>{N.value=!0,await L(o.plaque.id,{token_meta_id_list:[]}).then(()=>{m.plaque_map[o.plaque.id].entity.token_meta_id_list=[]}).catch(a=>{U(`Error clearing media files - ${a}`)}),setTimeout(()=>{const a={type:"clear_media_files",time_sent:h.now()};X(o.plaque.id,a).finally(()=>{N.value=!1})},3e3)})},ze=async()=>{W.confirm("Are you sure you want to clear all wifi profiles on this plaque? The plaque will have to be reconnected to wifi before it can be controlled through this app.","Clear WiFi profiles",{type:"warning"}).then(async()=>{A.value=!0,await L(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{m.plaque_map[o.plaque.id].entity.user_id="",m.plaque_map[o.plaque.id].entity.token_meta_id_list=[]}).catch(a=>{U(`Error clearing media wifi profiles - ${a}`)}),setTimeout(()=>{const a={type:"clear_wifi_profiles",time_sent:h.now()};X(o.plaque.id,a).finally(()=>{A.value=!1})},5e3)})},Le=async a=>{const e=Xe(),p=`viewer-logs/${a}`,B=Ye(e,p);try{const O=await Ze(B);window.open(O,"_blank");return}catch(O){console.log(`downloadLogs - failed to download logs for ${a}`,O),U(`Error downloading logs - ${O}`)}return""};return(a,e)=>{const p=_("el-button"),B=_("el-tag"),O=_("el-tooltip"),de=_("el-col"),Ee=_("el-row"),Te=_("ArrowRight"),ie=_("el-icon"),se=_("el-collapse-transition"),pe=_("Close"),Y=_("el-table-column"),De=_("el-table"),Ue=_("el-dialog"),Ie=_("el-switch"),Me=_("el-card");return c(),R(Me,null,{default:n(()=>[i("div",ut,[P.value?qe((c(),x("input",{key:1,"onUpdate:modelValue":e[0]||(e[0]=v=>o.plaque.entity.name=v),class:"edit-name-input"},null,512)),[[Fe,o.plaque.entity.name]]):(c(),x("h1",dt,C(o.plaque.entity.name),1)),P.value?j("",!0):(c(),R(p,{key:2,icon:I(Oe),onClick:e[1]||(e[1]=v=>P.value=!0),class:"editIcon",circle:""},null,8,["icon"])),P.value?(c(),R(p,{key:3,icon:I(Re),loading:$.value,onClick:s,class:"editIcon",circle:"",type:$.value?"":"success",text:""},null,8,["icon","loading","type"])):j("",!0),e[14]||(e[14]=i("div",{style:{"flex-grow":"1"}},null,-1)),t(O,{class:"box-item",effect:"dark",content:`Last activity ${le.value}`,placement:"top"},{default:n(()=>[K.value?(c(),R(B,{key:0,class:"ml-2",type:"success"},{default:n(()=>e[12]||(e[12]=[u("online")])),_:1})):(c(),R(B,{key:1,class:"ml-2",type:"danger"},{default:n(()=>e[13]||(e[13]=[u("offline")])),_:1}))]),_:1},8,["content"])]),t(se,null,{default:n(()=>[qe(i("section",pt,[e[19]||(e[19]=i("hr",null,null,-1)),t(Ee,{style:{padding:"1em"}},{default:n(()=>[t(de,{span:12},{default:n(()=>{var v;return[e[15]||(e[15]=i("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),i("span",null,C(((v=w.value)==null?void 0:v.entity.name)||"N/A"),1)]}),_:1}),t(de,{span:12},{default:n(()=>{var v;return[e[16]||(e[16]=i("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),u(" "+C(((v=w.value)==null?void 0:v.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),i("div",_t,C(`Total artworks: ${a.plaque.entity.token_meta_id_list.length}`),1),i("div",mt,[t(p,{type:"info",onClick:e[2]||(e[2]=v=>b.value=!0)},{default:n(()=>e[17]||(e[17]=[u("Add Artwork")])),_:1}),t(p,{onClick:e[3]||(e[3]=v=>d.value="detail")},{default:n(()=>[e[18]||(e[18]=u(" Details")),t(ie,{class:"el-icon--right"},{default:n(()=>[t(Te)]),_:1})]),_:1})])],512),[[Be,d.value=="simple"]])]),_:1}),t(se,null,{default:n(()=>[d.value=="detail"?(c(),x("section",ct,[i("p",yt,C(`Total artworks: ${a.plaque.entity.token_meta_id_list.length}`),1),i("div",ft,[t(p,{onClick:e[4]||(e[4]=v=>d.value="settings")},{default:n(()=>e[20]||(e[20]=[u("Settings")])),_:1}),t(p,{onClick:ne},{default:n(()=>e[21]||(e[21]=[u("Clear Artwork")])),_:1})]),e[27]||(e[27]=i("hr",null,null,-1)),D.value.length==0?(c(),x(H,{key:0},[e[22]||(e[22]=i("div",{style:{padding:"1em"}},"No artwork added",-1)),e[23]||(e[23]=i("hr",null,null,-1))],64)):j("",!0),(c(!0),x(H,null,re(D.value,v=>(c(),R(et,{token_meta:v},null,8,["token_meta"]))),256)),i("div",vt,[t(p,{type:"info",onClick:e[5]||(e[5]=v=>b.value=!0)},{default:n(()=>e[24]||(e[24]=[u("Add Artwork")])),_:1}),e[26]||(e[26]=i("div",{style:{"flex-grow":"1"}},null,-1)),t(p,{onClick:e[6]||(e[6]=v=>d.value="simple")},{default:n(()=>[e[25]||(e[25]=u("Close")),t(ie,{class:"el-icon--right"},{default:n(()=>[t(pe)]),_:1})]),_:1})])])):j("",!0)]),_:1}),t(se,null,{default:n(()=>{var v,_e,me,ce,ye,fe,ve,ge;return[d.value=="settings"?(c(),x("section",gt,[t(rt,{plaque:o.plaque},null,8,["plaque"]),i("div",qt,[a.plaque.entity.user_id?(c(),x("div",kt,[e[28]||(e[28]=i("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),V.value?(c(),x("div",wt,C(V.value),1)):(c(),x("div",Ct,"Loading...")),i("div",xt,C(a.plaque.entity.user_id),1)])):(c(),x("div",bt,"No associated user")),a.plaque.entity.user_id?(c(),R(p,{key:2,type:"danger",plain:"",onClick:oe},{default:n(()=>e[29]||(e[29]=[u("Forget Display")])),_:1})):j("",!0)]),i("div",$t,[e[32]||(e[32]=i("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),i("div",null,"Machine name: "+C((_e=(v=a.plaque.entity.machine_data)==null?void 0:v.machine_name)!=null?_e:"N/A"),1),i("div",null,"Version: "+C((ce=(me=a.plaque.entity.machine_data)==null?void 0:me.version)!=null?ce:"N/A"),1),i("div",null,"Local IP: "+C((fe=(ye=a.plaque.entity.machine_data)==null?void 0:ye.local_ip)!=null?fe:"N/A"),1),i("div",null,"Public IP: "+C((ge=(ve=a.plaque.entity.machine_data)==null?void 0:ve.public_ip)!=null?ge:"N/A"),1),i("div",null,"Updated At: "+C(f.value),1),i("div",null,"Free Space: "+C(a.plaque.entity.free_space?I(ke)(a.plaque.entity.free_space):"N/A"),1),i("div",At,[t(p,{type:"danger",plain:"",onClick:he,loading:r.value},{default:n(()=>e[30]||(e[30]=[u("Restart App")])),_:1},8,["loading"]),t(p,{type:"danger",plain:"",onClick:Se,loading:k.value},{default:n(()=>e[31]||(e[31]=[u("Restart Machine")])),_:1},8,["loading"])])]),I(l).is_user_admin?(c(),x("div",St,[e[40]||(e[40]=i("div",{class:"caption"},"Admin only commands",-1)),i("div",ht,[t(p,{plain:"",onClick:Ae,loading:g.value},{default:n(()=>e[33]||(e[33]=[u("Upload Logs To Cloud")])),_:1},8,["loading"]),t(p,{plain:"",onClick:e[7]||(e[7]=M=>S.value=!0)},{default:n(()=>e[34]||(e[34]=[u("View Logs")])),_:1})]),i("div",Pt,[t(p,{plain:"",onClick:Pe,loading:T.value},{default:n(()=>e[35]||(e[35]=[u("Extend Display")])),_:1},8,["loading"]),t(p,{plain:"",onClick:Ve,loading:F.value},{default:n(()=>e[36]||(e[36]=[u("Mirror Display")])),_:1},8,["loading"])]),i("div",Vt,[t(p,{type:"danger",plain:"",onClick:Ne,loading:N.value},{default:n(()=>e[37]||(e[37]=[u(" Clear Media Files")])),_:1},8,["loading"]),t(p,{type:"danger",plain:"",onClick:ze,loading:A.value},{default:n(()=>e[38]||(e[38]=[u(" Clear WiFi Profiles")])),_:1},8,["loading"])]),t(Ue,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=M=>S.value=M),title:"Uploaded Logs",width:"75%"},{default:n(()=>[t(De,{data:a.plaque.entity.uploaded_log_files},{default:n(()=>[t(Y,{prop:"file_name",label:"File Name",width:"400"}),t(Y,{prop:"upload_time",label:"Time Uploaded"},{default:n(({row:M})=>[u(C(ae(M.upload_time)),1)]),_:1}),t(Y,{prop:"bytes",label:"Size"},{default:n(({row:M})=>[u(C(I(ke)(M.bytes)),1)]),_:1}),t(Y,{fixed:"right",label:"",width:"80"},{default:n(({row:M})=>[t(p,{icon:"Download",text:"",circle:"",onClick:Mt=>Le(M.file_name)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),i("div",Nt,[e[39]||(e[39]=i("div",{class:"caption"},"Enable Support VPN",-1)),t(Ie,{modelValue:Q.value,"onUpdate:modelValue":e[9]||(e[9]=M=>Q.value=M),"active-text":"Enabled","inactive-text":"Off"},null,8,["modelValue"])])])):j("",!0),i("div",zt,[t(p,{onClick:e[10]||(e[10]=M=>d.value="detail")},{default:n(()=>[e[41]||(e[41]=u("Close")),t(ie,{class:"el-icon--right"},{default:n(()=>[t(pe)]),_:1})]),_:1})])])):j("",!0)]}),_:1}),t(ot,{plaque_id:o.plaque.id,show_add_token_dialog:b.value,"onUpdate:show_add_token_dialog":e[11]||(e[11]=v=>b.value=v)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var Et=ee(Lt,[["__scopeId","data-v-95db3f7c"]]);const Tt={class:"add-button-container"},Dt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},Ut={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},It=Z({__name:"PlaqueList",setup(J){const o=y(!1),{screen_type:m}=be(),d=y(!1),b=Ce(),P=ue(),V=tt(),$=y(""),g=y(localStorage.getItem("plaque_list_filter_by_gallery")||"");G(g,s=>{localStorage.setItem("plaque_list_filter_by_gallery",s)});const k=y(localStorage.getItem("online_filter")==="true"||!1);G(k,s=>{if(s){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const r=y(localStorage.getItem("plaque_list_sort_order")||"name");G(r,s=>{localStorage.setItem("plaque_list_sort_order",s)});const S=te(),T=async()=>{o.value=!0,await We({name:"Test Plaque",user_id:P.get_account.id,token_meta_id_list:[],created_at:h.now(),updated_at:h.now(),orientation:Ke.Landscape,command:{type:"",time_sent:h.fromMillis(0)},last_check_in_time:h.fromMillis(0),vpn_active:!1,machine_data:{machine_name:"",version:"",local_ip:"",public_ip:"",updated_at:h.fromMillis(0)},free_space:0,local_media_list:[]}).catch(s=>z({message:`Error creating test plaque- ${s}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,d.value=!1},F=E(()=>JSON.parse(JSON.stringify(S.all_plaque_list)).sort((l,q)=>{const w=l.entity.name.toLowerCase(),D=q.entity.name.toLowerCase();return w<D?-1:w>D?1:0})),N=E(()=>{const s=new Set;return g.value&&V.gallery_plaque_list.forEach(l=>{l.entity.gallery_id==g.value&&s.add(l.entity.plaque_id)}),s}),A=E(()=>{let s=[...F.value];return s=s.filter(l=>l.entity.name||l.entity.user_id||l.entity.token_meta_id_list.length>0),g.value&&(s=s.filter(l=>N.value.has(l.id))),k.value&&(s=s.filter(l=>xe(l))),r.value=="name"?s=s.sort((l,q)=>l.entity.name.localeCompare(q.entity.name)):r.value=="last_check_in_time"&&(s=s.sort((l,q)=>l.entity.last_check_in_time==null&&q.entity.last_check_in_time==null?0:l.entity.last_check_in_time==null?1:q.entity.last_check_in_time==null?-1:q.entity.last_check_in_time.seconds-l.entity.last_check_in_time.seconds)),$.value?s.filter(l=>l.entity.name.toLowerCase().includes($.value.toLowerCase())):s});return(s,l)=>{const q=_("el-input"),w=_("el-button"),D=_("el-option"),K=_("el-select"),le=_("el-switch"),ae=_("el-popover"),ne=_("Plus"),oe=_("el-icon"),Q=_("el-dialog");return c(),x(H,null,[i("div",{class:"subheader",style:je([{display:"flex","align-items":"center"},I(m)=="xs"?"padding: 0px 8px 10px;":""])},[t(q,{modelValue:$.value,"onUpdate:modelValue":l[0]||(l[0]=f=>$.value=f),"prefix-icon":I(Je),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),t(ae,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:n(()=>[t(w,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:n(()=>l[8]||(l[8]=[u("Filters")])),_:1})]),default:n(()=>[l[9]||(l[9]=i("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),t(K,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=f=>g.value=f),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:n(()=>[t(D,{label:"All plaques",value:""}),(c(!0),x(H,null,re(I(V).gallery_list,f=>(c(),R(D,{key:f.id,label:`${f.entity.name}`,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[10]||(l[10]=i("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),t(le,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=f=>k.value=f),style:{"margin-bottom":"1em"}},null,8,["modelValue"]),l[11]||(l[11]=i("div",{class:"caption"},"Sort order",-1)),t(K,{modelValue:r.value,"onUpdate:modelValue":l[3]||(l[3]=f=>r.value=f),placeholder:"Sort by",class:"filter-select"},{default:n(()=>[t(D,{label:"Sort by name",value:"name"}),t(D,{label:"Sort by last activity",value:"last_check_in_time"})]),_:1},8,["modelValue"])]),_:1}),t(w,{icon:"Camera",type:"info",onClick:l[4]||(l[4]=f=>I(b).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:n(()=>l[12]||(l[12]=[u("Scan")])),_:1})],4),l[16]||(l[16]=i("div",{style:{"padding-bottom":"90px"}},null,-1)),(c(!0),x(H,null,re(A.value,f=>(c(),R(Et,{plaque:f,key:f.id},null,8,["plaque"]))),128)),i("div",Tt,[i("div",Dt,[i("div",{class:"add-button",onClick:l[5]||(l[5]=f=>d.value=!0)},[t(oe,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:n(()=>[t(ne)]),_:1}),l[13]||(l[13]=i("div",{style:{"font-size":"17px"}},"Add plaque",-1))])])]),t(Q,{modelValue:d.value,"onUpdate:modelValue":l[7]||(l[7]=f=>d.value=f),title:"Add plaque",width:I(m)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:n(()=>[i("div",Ut,[t(w,{onClick:l[6]||(l[6]=f=>{I(b).push("qr-scan"),d.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:n(()=>l[14]||(l[14]=[u("Scan Plaque QR Code")])),_:1}),t(w,{icon:"plus",onClick:T,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:n(()=>l[15]||(l[15]=[u("Add test plaque ")])),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var ll=ee(It,[["__scopeId","data-v-b9e41b2a"]]);export{ll as default};
