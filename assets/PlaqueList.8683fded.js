import{_ as M,d as G,r as h,c as N,z as J,b as d,o as c,h as x,i as e,w as l,k as t,t as V,j as m,f,A as ee,p as te,l as le,x as E,u as ve,e as L,B as ce,C as we,D as xe,g as B,G as Ce,H as $e,F,I as Y,J as pe,K as be}from"./index.ed21ae95.js";import{u as U,c as Ae}from"./plaque.093acf64.js";import{c as Pe}from"./token-meta.2d60a689.js";import{u as H}from"./plaque.339537e9.js";import{u as fe,g as Se}from"./account.2231a9e0.js";import{s as R,a as ye}from"./util.e9cbbcd3.js";import{T as me}from"./types.6a5ef88e.js";import{u as ge}from"./breakpoints.30eadaee.js";import{u as qe}from"./token-meta.c0545ef0.js";import{_ as Ve}from"./TokenSelectList.bf5a6ee7.js";import{n as Z}from"./firebaseConfig.d7a6b5a9.js";import{_ as Ne}from"./PlaqueTokenItem.dfdc330e.js";import{u as ze}from"./gallery.97def235.js";import"./thumbnail-image.09374589.js";import"./gallery.82c2a091.js";const Ie=i=>(te("data-v-cc2989e6"),i=i(),le(),i),Le={class:"dialog-container"},Ee={class:"dialog-footer"},Te=Ie(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),De=G({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(i,{emit:a}){const A=i,_=h([]),g=h(!1),{screen_type:C}=ge(),P=H(),$=qe(),S=fe(),y=N({get(){return A.show_add_token_dialog},set(q){a("update:show_add_token_dialog",q)}});J(y,q=>{q&&(_.value=JSON.parse(JSON.stringify(r.value.entity.token_meta_id_list)))});const r=N(()=>P.plaque_map[A.plaque_id]),w=N(()=>$.sorted_all_token_metas),I=async()=>{g.value=!0;try{for(let[q,u]of _.value.entries()){const n=$.all_token_metas[u];if(!n)throw"Failed to find store token for token: "+u;if(n.entity.platform!=me.Opensea)continue;const b=JSON.parse(JSON.stringify(n));b.entity.user_id=S.get_account.id,b.entity.platform=me.OpenseaArchive;const o=await Pe(b.entity);_.value[q]=o.id}await U(A.plaque_id,{token_meta_id_list:_.value}),P.plaque_map[A.plaque_id].entity.token_meta_id_list=_.value}catch(q){R(`Error updating plaque tokens - ${q}`)}g.value=!1,y.value=!1},T=()=>{_.value=[]};return(q,u)=>{const n=d("el-button"),b=d("el-dialog");return c(),x("div",Le,[e(b,{center:"",modelValue:f(y),"onUpdate:modelValue":u[1]||(u[1]=o=>ee(y)?y.value=o:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:f(C)=="xs",top:"2vh"},{footer:l(()=>[t("div",Ee,[t("div",null,V(`Artwork in playlist: ${_.value.length}`),1),Te,e(n,{onClick:T},{default:l(()=>[m("Clear")]),_:1}),e(n,{type:"info",onClick:I,loading:g.value},{default:l(()=>[m("Save")]),_:1},8,["loading"])])]),default:l(()=>[e(Ve,{selected_token_meta_id_list:_.value,"onUpdate:selected_token_meta_id_list":u[0]||(u[0]=o=>_.value=o),token_meta_list:f(w)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Ue=M(De,[["__scopeId","data-v-cc2989e6"]]);const Oe={class:"controller-buttons"},Be=G({__name:"PlaqueController",props:{plaque:null},setup(i){const a=i,A=H(),_=h(!1),g=h(!1),C=h(!1),P=h(!1),$=N({get:()=>a.plaque.entity.orientation||"landscape",set:y=>{U(a.plaque.id,{orientation:y}).then(()=>{A.plaque_map[a.plaque.id].entity.orientation=y,E({type:"success",message:"Plaque orientation updated"})}).catch(r=>{R(`Error updating plaque orientation - ${r}`)})}}),S=y=>{const r={type:y,time_sent:Z.now()};U(a.plaque.id,{command:r}).then(()=>{A.plaque_map[a.plaque.id].entity.command=r,E({type:"success",message:"Command sent to plaque"})}).catch(w=>{R(`Error sending command to plaque - ${w}`)}).finally(()=>{_.value=!1,g.value=!1,C.value=!1,P.value=!1})};return(y,r)=>{const w=d("el-button"),I=d("el-radio"),T=d("el-radio-group");return c(),x("div",null,[t("div",Oe,[e(w,{circle:"",text:"",loading:_.value,icon:"DArrowLeft",onClick:r[0]||(r[0]=q=>{_.value=!0,S("playlist_previous")})},null,8,["loading"]),e(w,{circle:"",text:"",loading:g.value,icon:"VideoPlay",onClick:r[1]||(r[1]=q=>{g.value=!0,S("play")})},null,8,["loading"]),e(w,{circle:"",text:"",icon:"VideoPause",loading:C.value,onClick:r[2]||(r[2]=q=>{C.value=!0,S("pause")})},null,8,["loading"]),e(w,{circle:"",text:"",icon:"DArrowRight",loading:P.value,onClick:r[3]||(r[3]=q=>{P.value=!0,S("playlist_next")})},null,8,["loading"])]),e(T,{modelValue:f($),"onUpdate:modelValue":r[4]||(r[4]=q=>ee($)?$.value=q:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:l(()=>[e(I,{label:"landscape",size:"small"},{default:l(()=>[m("Landscape")]),_:1}),e(I,{label:"portrait",size:"small"},{default:l(()=>[m("Portrait")]),_:1}),e(I,{label:"landscape_reversed",size:"small"},{default:l(()=>[m("Landscape Reversed")]),_:1}),e(I,{label:"portrait_reversed",size:"small"},{default:l(()=>[m("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Fe=M(Be,[["__scopeId","data-v-100e65c8"]]);const z=i=>(te("data-v-8786a792"),i=i(),le(),i),Re={style:{display:"flex","align-items":"center",padding:"1em"}},je={key:0},Je=z(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),Me={class:"card-simple"},Ge=z(()=>t("hr",null,null,-1)),He=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Ke=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Qe={style:{padding:"0.3em 1em"}},We={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Xe={key:0,class:"card-detail"},Ye={style:{padding:"0 1em"}},Ze={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},et=z(()=>t("hr",null,null,-1)),tt=z(()=>t("div",{style:{padding:"1em"}},"No artwork added",-1)),lt=z(()=>t("hr",null,null,-1)),at={style:{display:"flex",padding:"1em"}},nt=z(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),ot={key:0,style:{padding:"1em"}},st={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},it={key:0},ut=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),rt={key:0},dt={key:1},_t={style:{"font-size":"var(--el-font-size-extra-small)"}},ct={key:1},pt={style:{"margin-bottom":"1em"}},mt=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),vt=z(()=>t("div",{class:"caption"},"Enable Support VPN",-1)),ft={style:{display:"flex","justify-content":"end"}},yt=G({__name:"PlaqueCard",props:{plaque:null},setup(i){const a=i,A=H();ve();const _=h("simple"),g=h(!1),C=h(!1),P=h(""),$=h(!1),S=async()=>{$.value=!0,await U(a.plaque.id,{name:a.plaque.entity.name}).catch(o=>{R(`Error updating plaque tokens - ${o}`)}),C.value=!1,$.value=!1},y=qe(),r=N(()=>w.value.length==0?null:w.value[0]),w=N(()=>{const o=y.archive_token_meta_map;return a.plaque.entity.token_meta_id_list.map(k=>o[k])}),I=N(()=>ye(a.plaque)),T=N(()=>{const o=a.plaque.entity.last_check_in_time;return o?new Date(o.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):"N/A"}),q=()=>{pe.confirm(`Are you sure you want to clear tokens for plaque '${a.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{U(a.plaque.id,{token_meta_id_list:[]}).then(()=>{A.plaque_map[a.plaque.id].entity.token_meta_id_list=[],E({type:"success",message:"Tokens cleared"})}).catch(o=>{E({message:`Error clearing tokens from plaque - ${o}`,type:"error",showClose:!0,duration:12e3})})})},u=()=>{pe.confirm(`Are you sure you want to forget the plaque named '${a.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{U(a.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{A.plaque_map[a.plaque.id].entity.user_id="",A.plaque_map[a.plaque.id].entity.token_meta_id_list=[],E({type:"success",message:"Plaque forgotten"})}).catch(o=>{E({message:`Error forgetting plaque - ${o}`,type:"error",showClose:!0,duration:12e3})})})};J(_,o=>{o=="settings"&&a.plaque.entity.user_id&&!P.value&&Se(a.plaque.entity.user_id).then(s=>{P.value=s.entity.email}).catch(s=>{E({message:`Error loading user account - ${s}`,type:"error",showClose:!0,duration:12e3})})});const n=N({get:()=>Boolean(a.plaque.entity.vpn_active),set:o=>{U(a.plaque.id,{vpn_active:o}).then(()=>{A.plaque_map[a.plaque.id].entity.vpn_active=o,E({type:"success",message:"VPN setting updated"})}).catch(s=>{R(`Error updating VPN setting- ${s}`)})}}),b=N(()=>{var k,D,O;const o=(O=(D=(k=a==null?void 0:a.plaque)==null?void 0:k.entity)==null?void 0:D.machine_data)==null?void 0:O.updated_at;return o?new Date(o.seconds*1e3+o.nanoseconds/1e6).toLocaleString():"N/A"});return(o,s)=>{const k=d("el-button"),D=d("el-tag"),O=d("el-tooltip"),j=d("el-col"),Q=d("el-row"),W=d("ArrowRight"),p=d("el-icon"),X=d("el-collapse-transition"),ae=d("Close"),ke=d("el-switch"),he=d("el-card");return c(),L(he,null,{default:l(()=>[t("div",Re,[C.value?ce((c(),x("input",{key:1,"onUpdate:modelValue":s[0]||(s[0]=v=>a.plaque.entity.name=v),class:"edit-name-input"},null,512)),[[we,a.plaque.entity.name]]):(c(),x("h1",je,V(a.plaque.entity.name),1)),C.value?B("",!0):(c(),L(k,{key:2,icon:f(xe),onClick:s[1]||(s[1]=v=>C.value=!0),class:"editIcon",circle:""},null,8,["icon"])),C.value?(c(),L(k,{key:3,icon:f(Ce),loading:$.value,onClick:S,class:"editIcon",circle:"",type:$.value?"":"success",text:""},null,8,["icon","loading","type"])):B("",!0),Je,e(O,{class:"box-item",effect:"dark",content:`Last activity ${f(T)}`,placement:"top"},{default:l(()=>[f(I)?(c(),L(D,{key:0,class:"ml-2",type:"success"},{default:l(()=>[m("online")]),_:1})):(c(),L(D,{key:1,class:"ml-2",type:"danger"},{default:l(()=>[m("offline")]),_:1}))]),_:1},8,["content"])]),e(X,null,{default:l(()=>[ce(t("section",Me,[Ge,e(Q,{style:{padding:"1em"}},{default:l(()=>[e(j,{span:12},{default:l(()=>{var v;return[He,t("span",null,V(((v=f(r))==null?void 0:v.entity.name)||"N/A"),1)]}),_:1}),e(j,{span:12},{default:l(()=>{var v;return[Ke,m(" "+V(((v=f(r))==null?void 0:v.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),t("div",Qe,V(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),t("div",We,[e(k,{type:"info",onClick:s[2]||(s[2]=v=>g.value=!0)},{default:l(()=>[m("Add Artwork")]),_:1}),e(k,{onClick:s[3]||(s[3]=v=>_.value="detail")},{default:l(()=>[m(" Details"),e(p,{class:"el-icon--right"},{default:l(()=>[e(W)]),_:1})]),_:1})])],512),[[$e,_.value=="simple"]])]),_:1}),e(X,null,{default:l(()=>[_.value=="detail"?(c(),x("section",Xe,[t("p",Ye,V(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),t("div",Ze,[e(k,{onClick:s[4]||(s[4]=v=>_.value="settings")},{default:l(()=>[m("Settings")]),_:1}),e(k,{onClick:q},{default:l(()=>[m("Clear Artwork")]),_:1})]),et,f(w).length==0?(c(),x(F,{key:0},[tt,lt],64)):B("",!0),(c(!0),x(F,null,Y(f(w),v=>(c(),L(Ne,{token_meta:v},null,8,["token_meta"]))),256)),t("div",at,[e(k,{type:"info",onClick:s[5]||(s[5]=v=>g.value=!0)},{default:l(()=>[m("Add Artwork")]),_:1}),nt,e(k,{onClick:s[6]||(s[6]=v=>_.value="simple")},{default:l(()=>[m("Close"),e(p,{class:"el-icon--right"},{default:l(()=>[e(ae)]),_:1})]),_:1})])])):B("",!0)]),_:1}),e(X,null,{default:l(()=>{var v,ne,oe,se,ie,ue,re,de;return[_.value=="settings"?(c(),x("section",ot,[e(Fe,{plaque:a.plaque},null,8,["plaque"]),t("div",st,[i.plaque.entity.user_id?(c(),x("div",it,[ut,P.value?(c(),x("div",rt,V(P.value),1)):(c(),x("div",dt,"Loading...")),t("div",_t,V(i.plaque.entity.user_id),1)])):(c(),x("div",ct,"No associated user")),i.plaque.entity.user_id?(c(),L(k,{key:2,type:"danger",plain:"",onClick:u},{default:l(()=>[m("Forget Display")]),_:1})):B("",!0)]),t("div",pt,[mt,t("div",null,"Machine name: "+V((ne=(v=i.plaque.entity.machine_data)==null?void 0:v.machine_name)!=null?ne:"N/A"),1),t("div",null,"Version: "+V((se=(oe=i.plaque.entity.machine_data)==null?void 0:oe.version)!=null?se:"N/A"),1),t("div",null,"Local IP: "+V((ue=(ie=i.plaque.entity.machine_data)==null?void 0:ie.local_ip)!=null?ue:"N/A"),1),t("div",null,"Public IP: "+V((de=(re=i.plaque.entity.machine_data)==null?void 0:re.public_ip)!=null?de:"N/A"),1),t("div",null,"Updated At: "+V(f(b)),1)]),t("div",null,[vt,e(ke,{modelValue:f(n),"onUpdate:modelValue":s[7]||(s[7]=_e=>ee(n)?n.value=_e:null),"active-text":"Enabled","inactive-text":"Off"},null,8,["modelValue"])]),t("div",ft,[e(k,{onClick:s[8]||(s[8]=_e=>_.value="detail")},{default:l(()=>[m("Close"),e(p,{class:"el-icon--right"},{default:l(()=>[e(ae)]),_:1})]),_:1})])])):B("",!0)]}),_:1}),e(Ue,{plaque_id:a.plaque.id,show_add_token_dialog:g.value,"onUpdate:show_add_token_dialog":s[9]||(s[9]=v=>g.value=v)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var gt=M(yt,[["__scopeId","data-v-8786a792"]]);const K=i=>(te("data-v-3a6778c1"),i=i(),le(),i),qt={class:"subheader",style:{display:"flex","align-items":"center"}},kt=K(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),ht=K(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),wt=K(()=>t("div",{style:{"padding-bottom":"40px"}},null,-1)),xt={class:"add-button-container"},Ct={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},$t=K(()=>t("div",{style:{"font-size":"17px"}},"Add plaque",-1)),bt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},At=G({__name:"PlaqueList",setup(i){const a=h(!1),{width:A,screen_type:_}=ge(),g=h(!1),C=ve(),P=fe(),$=ze(),S=h(""),y=h(localStorage.getItem("plaque_list_filter_by_gallery")||""),r=h(localStorage.getItem("online_filter")==="true"||!1);J(y,u=>{localStorage.setItem("plaque_list_filter_by_gallery",u)}),J(r,u=>{if(u){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const w=H(),I=async()=>{a.value=!0,await Ae({name:"Test Plaque",user_id:P.get_account.id,token_meta_id_list:[],created_at:Z.now(),updated_at:Z.now()}).catch(u=>E({message:`Error creating test plaque- ${u}`,type:"error",showClose:!0,duration:12e3})),a.value=!1,g.value=!1},T=N(()=>JSON.parse(JSON.stringify(w.all_plaque_list)).sort((n,b)=>{const o=n.entity.name.toLowerCase(),s=b.entity.name.toLowerCase();return o<s?-1:o>s?1:0})),q=N(()=>{let u=[...T.value];return u=u.filter(n=>n.entity.name||n.entity.user_id||n.entity.token_meta_id_list.length>0),y.value&&(u=u.filter(n=>{var b;return(b=$.gallery_list.find(o=>o.id==y.value))==null?void 0:b.entity.plaque_id_list.includes(n.id)})),r.value&&(u=u.filter(n=>ye(n))),S.value?u.filter(n=>n.entity.name.toLowerCase().includes(S.value.toLowerCase())):u});return(u,n)=>{const b=d("el-input"),o=d("el-button"),s=d("el-option"),k=d("el-select"),D=d("el-switch"),O=d("el-popover"),j=d("Plus"),Q=d("el-icon"),W=d("el-dialog");return c(),x(F,null,[t("div",qt,[e(b,{modelValue:S.value,"onUpdate:modelValue":n[0]||(n[0]=p=>S.value=p),"prefix-icon":f(be),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),e(O,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:l(()=>[e(o,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:l(()=>[m("Filters")]),_:1})]),default:l(()=>[kt,e(k,{modelValue:y.value,"onUpdate:modelValue":n[1]||(n[1]=p=>y.value=p),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:l(()=>[e(s,{label:"All plaques",value:""}),(c(!0),x(F,null,Y(f($).gallery_list,p=>(c(),L(s,{key:p.id,label:`${p.entity.name}`,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),ht,e(D,{modelValue:r.value,"onUpdate:modelValue":n[2]||(n[2]=p=>r.value=p)},null,8,["modelValue"])]),_:1}),e(o,{icon:"Camera",type:"info",onClick:n[3]||(n[3]=p=>f(C).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:l(()=>[m("Scan")]),_:1})]),wt,(c(!0),x(F,null,Y(f(q),p=>(c(),L(gt,{plaque:p,key:p.id},null,8,["plaque"]))),128)),t("div",xt,[t("div",Ct,[t("div",{class:"add-button",onClick:n[4]||(n[4]=p=>g.value=!0)},[e(Q,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:l(()=>[e(j)]),_:1}),$t])])]),e(W,{modelValue:g.value,"onUpdate:modelValue":n[6]||(n[6]=p=>g.value=p),title:"Add plaque",width:f(_)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:l(()=>[t("div",bt,[e(o,{onClick:n[5]||(n[5]=p=>{f(C).push("qr-scan"),g.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:l(()=>[m("Scan Plaque QR Code")]),_:1}),e(o,{icon:"plus",onClick:I,loading:a.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:l(()=>[m("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var jt=M(At,[["__scopeId","data-v-3a6778c1"]]);export{jt as default};
