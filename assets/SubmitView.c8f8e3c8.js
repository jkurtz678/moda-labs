import{c as M}from"./token-meta.ccf2a48e.js";import{bS as $,bT as L,bU as A,d as F,t as f,M as x,bV as k,r as p,c as q,y as D,f as l,h as s,w as t,z as b,L as S,G as N,U as I}from"./index.d69aafa5.js";const E=$(),O=async(v,g,o,n)=>{console.log("uploadFile - starting file upload for ",v);const y=L(E,v);A(y,g).on("state_changed",r=>{console.log("snapshot",r.bytesTransferred,r.totalBytes),o(r.bytesTransferred/r.totalBytes)},r=>{console.log("uploadFile error - ",r)},()=>{console.log("SUCCESS CALLBACK"),n()})},P={style:{padding:"20px"}},z=b("h1",{style:{"margin-bottom":"15px"}},"SUBMIT TO MODA ARCHIVES",-1),G=b("div",{class:"el-upload__text"},[S(" Drop file here or "),b("em",null,"click to upload")],-1),H=b("div",null,"SUBMIT",-1),J=F({setup(v){const g=f();f();const o=x({name:"",artist:"",description:"",public_link:"",created_at:k.now(),updated_at:k.now(),media_id:"",media_type:""}),n=f([]),y=x({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}]}),m=f(!1),r=f("0%"),w=(i,e)=>I.confirm(`Cancel the upload of ${i.name} ?`).then(()=>!0,()=>!1),C=()=>{},h=async i=>{var _;if(!i){console.log("SubmitView.vue Submit - formRef is null");return}if(!await i.validate(d=>d))return;if(m.value=!0,((_=n==null?void 0:n.value)==null?void 0:_.length)!==1){console.log("file_list error",n.value);return}const a=n.value[0],u=d=>{console.log("Progress",d),r.value=`${Math.round(d*100)}%`},V=()=>{B(i,a)};O(`${a.uid||""}`,a.raw,u,V).catch(d=>{console.error(d)})},B=(i,e)=>{o.media_id=`${(e==null?void 0:e.uid)||""}`,o.media_type=`.${e.name.split(".").pop()||""}`,console.log("upload success, sending form: ",o),M(o).then(a=>{i.resetFields(),n.value=[],m.value=!1,alert("Successfully submitted token")}).catch(a=>{m.value=!1,alert(a)})};return(i,e)=>{const a=p("el-input"),u=p("el-form-item"),V=p("upload-filled"),_=p("el-icon"),d=p("el-upload"),R=p("Loading"),U=p("el-button"),T=p("el-form");return q(),D("div",P,[z,l(T,{ref_key:"formRef",ref:g,model:s(o),rules:s(y),"label-position":"left","label-width":"95px",style:{"max-width":"700px"}},{default:t(()=>[l(u,{label:"Name",style:{"max-width":"400px"},prop:"name"},{default:t(()=>[l(a,{modelValue:s(o).name,"onUpdate:modelValue":e[0]||(e[0]=c=>s(o).name=c)},null,8,["modelValue"])]),_:1}),l(u,{label:"Artist",style:{"max-width":"400px"},prop:"artist"},{default:t(()=>[l(a,{modelValue:s(o).artist,"onUpdate:modelValue":e[1]||(e[1]=c=>s(o).artist=c)},null,8,["modelValue"])]),_:1}),l(u,{label:"Description",prop:"description"},{default:t(()=>[l(a,{modelValue:s(o).description,"onUpdate:modelValue":e[2]||(e[2]=c=>s(o).description=c),type:"textarea",rows:"4"},null,8,["modelValue"])]),_:1}),l(u,{label:"Public Link",prop:"public_link"},{default:t(()=>[l(a,{modelValue:s(o).public_link,"onUpdate:modelValue":e[3]||(e[3]=c=>s(o).public_link=c)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(d,{class:"upload-demo","auto-upload":!1,action:"","on-remove":C,"before-remove":w,limit:1,drag:"","file-list":n.value},{default:t(()=>[l(_,{class:"el-icon--upload"},{default:t(()=>[l(V)]),_:1}),G]),_:1},8,["file-list"])]),_:1}),l(u,null,{default:t(()=>[l(U,{onClick:e[4]||(e[4]=c=>h(g.value)),loading:m.value},{loading:t(()=>[l(_,{class:"is-loading",style:{"margin-right":"4px"}},{default:t(()=>[l(R)]),_:1}),S(" "+N(r.value),1)]),default:t(()=>[H]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}});export{J as default};
