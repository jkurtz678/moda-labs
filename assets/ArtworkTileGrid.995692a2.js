import{d as Q,P as te,Q as ne,r as C,o as _,h,F as P,I as j,M as q,f as u,S as oe,j as G,t as L,T as le,U as ae,m as X,z as O,_ as Z,u as ee,L as re,c as R,b as I,k as y,n as U,i as c,w as k,V as z,e as N,g as K,J as ie,x as Y,K as se,p as ce,l as ue}from"./index.f1d32f39.js";import{u as de}from"./thumbnail-image.7c3ab1d0.js";import{c as me,d as _e}from"./types.6a5ef88e.js";import{s as pe}from"./util.d745826e.js";import{u as fe}from"./account.9199e501.js";import{f as ve}from"./token-meta.e73e8480.js";import{u as ye}from"./token-meta.7b3c11f7.js";import{u as ke}from"./gallery.c2da35df.js";import{u as he}from"./breakpoints.9c93407c.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.82c2a091.js";const ge={columnWidth:400,gap:0,keyMapper:(a,r,T,g)=>g,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:a,columnWidth:r,emit:T,gap:g,items:i,maxColumns:f,minColumns:d,nextTick:w,onBeforeUnmount:x,onMounted:b,rtl:B,scrollContainer:p,ssrColumns:S,vue:E,wall:$,watch:V}){function D(l,t,v,F){const W=s(v);return F+t+W<=l?D(l,t,v+1,F+t+W):v}function s(l){const t=Array.isArray(r.value)?r.value:[r.value];return t[l%t.length]}function e(){const l=D($.value.getBoundingClientRect().width,g.value,0,-g.value),t=o(n(l));return t>0?t:1}function n(l){const t=f==null?void 0:f.value;return t&&l>t?t:l}function o(l){const t=d==null?void 0:d.value;return t&&l<t?t:l}function m(l){return[...new Array(l)].map(()=>[])}if(S.value>0){const l=m(S.value);i.value.forEach((t,v)=>l[v%S.value].push(v)),a.value=l}async function A(l){if(l>=i.value.length)return;await w();const t=[...$.value.children];B.value&&t.reverse();const v=t.reduce((F,W)=>W.getBoundingClientRect().height<F.getBoundingClientRect().height?W:F);a.value[+v.dataset.index].push(l),await A(l+1)}async function M(l=!1){if(a.value.length===e()&&!l){T(E===2?"redraw-skip":"redrawSkip");return}a.value=m(e());const t=p==null?void 0:p.value,v=t?t.scrollTop:window.scrollY;await A(0),t?t.scrollBy({top:v-t.scrollTop}):window.scrollTo({top:v}),T("redraw")}const H=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>M());return b(()=>{M(),H==null||H.observe($.value)}),x(()=>H==null?void 0:H.unobserve($.value)),V([i,B],()=>M(!0)),V([r,g,d,f],()=>M()),{getColumnWidthTarget:s}}const xe=["data-index"],be=Q({__name:"masonry-wall",props:te({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ge),emits:["redraw","redrawSkip"],setup(a,{emit:r}){const T=a,{columnWidth:g,items:i,gap:f,rtl:d,ssrColumns:w,scrollContainer:x,minColumns:b,maxColumns:B,keyMapper:p}=ne(T),S=C([]),E=C(),{getColumnWidthTarget:$}=we({columns:S,columnWidth:g,emit:r,gap:f,items:i,keyMapper:p,maxColumns:B,minColumns:b,nextTick:le,onBeforeUnmount:ae,onMounted:X,rtl:d,scrollContainer:x,ssrColumns:w,vue:3,wall:E,watch:O});return(V,D)=>(_(),h("div",{ref_key:"wall",ref:E,class:"masonry-wall",style:q({display:"flex",gap:`${u(f)}px`})},[(_(!0),h(P,null,j(S.value,(s,e)=>(_(),h("div",{key:e,class:"masonry-column","data-index":e,style:q({display:"flex","flex-basis":`${u($)(e)}px`,"flex-direction":"column","flex-grow":1,gap:`${u(f)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(_(!0),h(P,null,j(s,(n,o)=>(_(),h("div",{key:u(p)(u(i)[n],e,o,n),class:"masonry-item"},[oe(V.$slots,"default",{item:u(i)[n],column:e,row:o,index:n},()=>[G(L(u(i)[n]),1)])]))),128))],12,xe))),128))],4))}}),Ce=(()=>{const a=be;return a.install=r=>{r.component("MasonryWall",a)},a})();const Te=["src"],Se={class:"header"},Ee={class:"platform"},$e={style:{"font-size":"1.6em","font-weight":"bold"}},Ae={key:0},Me={key:1,style:{"font-weight":"bold"}},Be={key:3,style:{height:"32px"}},Ve={style:{"font-size":"0.9em","line-height":"1.3em"}},De=Q({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(a){const r=a,T=ee(),g=de(re(r,"token_meta")),i=C(!1),f=C(0),d=C(),w=C(),x=fe(),b=R(()=>me(r.token_meta.entity.platform)),B=async()=>{const s=await _e(r.token_meta);if(!s){pe("Error getting source file");return}window.open(s,"_blank")},p=R(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),S=()=>{const s=T.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(s.href)},E=()=>{window.open(r.token_meta.entity.public_link,"_blank")},$=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function V(s){if(!d.value){console.log("animateDivHeight - error finding tile container");return}if(s&&f.value==0&&(f.value=d.value.offsetHeight),!w.value){console.log("animateDivHeight - error finding detail container");return}let e;s&&w.value.offsetHeight>f.value?e=w.value.offsetHeight:e=f.value;const n=300,o=10,m=d.value.offsetHeight,A=Math.ceil(e-m),M=Math.ceil(n/o),H=A/M;let l=0;const t=setInterval(()=>{if(l>=M){d.value.style.height=e+"px",clearInterval(t);return}l++;const v=m+H*l;d.value.style.height=v+"px"},o)}const D=()=>{ie.prompt(`Are you sure you want to delete ${r.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:s})=>{if(s)return ve(r.token_meta.id)}).then(()=>{Y({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(s=>{Y({message:`Error deleting artwork - ${s}`,type:"error",showClose:!0,duration:12e3})})};return(s,e)=>{const n=I("el-button"),o=I("el-tooltip");return _(),h("div",{ref_key:"tile_container",ref:d,class:"custom-card",onClick:e[1]||(e[1]=()=>{i.value=!i.value,V(i.value)}),style:q(i.value?"":`height: ${u(p)}px !important`)},[y("img",{class:U(i.value?"absolute":""),src:u(g)},null,10,Te),y("div",{class:U([i.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),y("div",{class:U(["transition absolute",i.value?"hide-blur":"show-blur"])},[y("div",Se,L(`${a.token_meta.entity.name} | ${a.token_meta.entity.artist}`),1),y("div",Ee,L(u(b)),1)],2),y("div",{ref_key:"detail_container",ref:w,class:U(["detail-container transition",i.value?"show-blur":"hide-blur absolute-no-b"])},[y("div",$e,L(a.token_meta.entity.name),1),a.token_meta.entity.artist_social_link?(_(),h("div",Ae,[c(n,{link:"",style:{"font-weight":"bold",display:"block"},onClick:z($,["stop"])},{default:k(()=>[G(L(a.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(_(),h("div",Me,L(a.token_meta.entity.artist),1)),i.value?(_(),h(P,{key:2},[c(o,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:k(()=>[c(n,{icon:"Edit",text:"",circle:"",onClick:e[0]||(e[0]=z(m=>u(T).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),c(o,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:k(()=>[c(n,{icon:"Download",text:"",circle:"",onClick:z(B,["stop"])},null,8,["onClick"])]),_:1}),c(o,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:k(()=>[c(n,{icon:"Tickets",text:"",circle:"",onClick:z(S,["stop"])},null,8,["onClick"])]),_:1}),a.token_meta.entity.public_link?(_(),N(o,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:k(()=>[c(n,{icon:"Link",text:"",circle:"",onClick:z(E,["stop"])},null,8,["onClick"])]),_:1})):K("",!0),u(x).is_user_admin?(_(),N(o,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:k(()=>[c(n,{icon:"Delete",text:"",circle:"",onClick:z(D,["stop"])},null,8,["onClick"])]),_:1})):K("",!0)],64)):(_(),h("div",Be)),y("div",Ve,L(a.token_meta.entity.description),1)],2)],4)}}});var He=Z(De,[["__scopeId","data-v-bc2a1e7c"]]);const J=a=>(ce("data-v-57f8ef75"),a=a(),ue(),a),Ie={class:"subheader",style:{display:"flex","align-items":"center"}},Le=J(()=>y("div",{class:"caption"},"Filter by gallery",-1)),Re=J(()=>y("div",{class:"caption"},"Sort order",-1)),ze=J(()=>y("div",{style:{"padding-bottom":"40px"}},null,-1)),Fe={key:1,style:{padding:"1em"}},We=Q({__name:"ArtworkTileGrid",setup(a){const r=ee(),T=ye(),g=ke(),i=C(""),f=C(null),d=C(localStorage.getItem("token_list_sort_order")||"name"),w=30,x=C(w),b=C(localStorage.getItem("artwork_grid_filter_by_gallery")||"");O(b,e=>{localStorage.setItem("artwork_grid_filter_by_gallery",e)}),O(i,e=>{x.value=w});const B=250,p=10,{screen_type:S}=he(),E=R(()=>{switch(S.value){case"xs":return 340-p*2;case"sm":return 650-p*2;case"md":return 960-p*2;case"lg":return 1200-p*2;case"xl":return 1700-p*2}return 0}),$=R(()=>{let e=Math.floor(E.value/(B+p));return e>5&&(e=5),(E.value-(e-1)*p)/e}),V=R(()=>T.sorted_all_token_metas.filter(e=>Boolean(e.entity.aspect_ratio))),D=R(()=>{let e=V.value.filter(n=>{var o,m;return((o=n.entity.artist)==null?void 0:o.toLowerCase().includes(i.value.toLowerCase()))||((m=n.entity.name)==null?void 0:m.toLowerCase().includes(i.value.toLowerCase()))});return b.value&&(e=e.filter(n=>{var o;return(o=g.gallery_list.find(m=>m.id==b.value))==null?void 0:o.entity.token_meta_id_list.includes(n.id)})),d.value==="name"?e=e.sort((n,o)=>n.entity.name.localeCompare(o.entity.name)):d.value==="created_at"&&(e=e.sort((n,o)=>n.entity.created_at==null&&o.entity.created_at==null?0:n.entity.created_at==null?1:o.entity.created_at==null?-1:o.entity.created_at.seconds-n.entity.created_at.seconds)),e}),s=R(()=>{const e=D.value,n=0,o=n+x.value;return e.slice(n,o)});return X(()=>{const e=document.getElementById("masonry-container");if(!e){console.log("ArtworkTileGrid error, masonary_wall element not found");return}e.addEventListener("scroll",()=>{const n=e.scrollTop,o=e.scrollHeight,m=e.clientHeight;n/(o-m)*100>90&&x.value<D.value.length&&(x.value=x.value+20)})}),(e,n)=>{const o=I("el-input"),m=I("el-button"),A=I("el-option"),M=I("el-select"),H=I("el-popover"),l=I("RouterView");return _(),h(P,null,[y("div",Ie,[c(o,{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=t=>i.value=t),"prefix-icon":u(se),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),c(H,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:k(()=>[c(m,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:k(()=>[G("Filters")]),_:1})]),default:k(()=>[Le,c(M,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=t=>b.value=t),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:k(()=>[c(A,{label:"All plaques",value:""}),(_(!0),h(P,null,j(u(g).gallery_list,t=>(_(),N(A,{key:t.id,label:`${t.entity.name}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Re,c(M,{modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=t=>d.value=t),placeholder:"Sort by"},{default:k(()=>[c(A,{label:"Sort by name",value:"name"}),c(A,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),c(m,{icon:"Plus",type:"info",onClick:n[3]||(n[3]=t=>u(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:k(()=>[G("Artwork")]),_:1})]),ze,y("div",{id:"masonry-container",ref_key:"masonryContainer",ref:f,style:{"overflow-y":"auto",height:"100%",padding:"10px"}},[u(s).length>0?(_(),N(u(Ce),{key:0,id:"masonary-wall","scroll-container":f.value,items:u(s),"column-width":B,gap:p,style:q(`width: ${u(E)}px; margin: auto`),"max-columns":5},{default:k(({item:t})=>[c(He,{token_meta:t,column_width:u($)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(_(),h("div",Fe,"No artwork found"))],512),c(l)],64)}}});var Xe=Z(We,[["__scopeId","data-v-57f8ef75"]]);export{Xe as default};
