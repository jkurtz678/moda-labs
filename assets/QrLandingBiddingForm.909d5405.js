import{s as x}from"./util.1286dcf9.js";import{P as p}from"./types.4ea69ea7.js";import{g as H,c as M}from"./bid.4e894adf.js";import{i as h}from"./firebaseConfig.4d01e9b5.js";import{d as q,r as v,c as b,O as A,m as F,E as R,h as V,i as s,t as c,k as y,j as u,w as m,e as I,b as Q,f as k,o as B,u as U,x as j}from"./index.a21b016f.js";const O={key:0},W={class:"bid"},z={style:{"margin-right":"5px"}},G={key:1},J={class:"bid-form"},K={style:{display:"flex"}},ae=q({__name:"QrLandingBiddingForm",props:{token_meta:{}},setup(S){const _=S,g=I(),T=Q(),E=v(),o=v({token_meta_id:"",bidding_name:"",email:"",phone_number:"",amount:0,amount_unit:p.USD,created_at:h.now(),updated_at:h.now()}),w=v([]),C=b(()=>{var t,e,n,l,r,d;switch((e=(t=_.token_meta)==null?void 0:t.entity)==null?void 0:e.price_unit){case p.USD:return`$${(l=(n=_.token_meta)==null?void 0:n.entity)==null?void 0:l.price}`;case p.ETH:return`${(d=(r=_.token_meta)==null?void 0:r.entity)==null?void 0:d.price} ETH`;default:return""}}),D=b(()=>{var t,e,n,l;if(!a.value)return"";switch(a.value.entity.amount_unit){case p.USD:return`$${(e=(t=a==null?void 0:a.value)==null?void 0:t.entity)==null?void 0:e.amount}`;case p.ETH:return`${(l=(n=a==null?void 0:a.value)==null?void 0:n.entity)==null?void 0:l.amount} ETH`;default:return""}}),P=b(()=>{var t;return a.value?(t=a.value)==null?void 0:t.entity.amount_unit:_.token_meta.entity.price_unit}),L=A({bidding_name:[{required:!0,message:"Please enter your bidding name",trigger:"blur"}],email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email address",trigger:["blur","change"]}],phone_number:[{required:!0,message:"Please enter your phone number",trigger:"blur"},{pattern:/^\d{10}$/,message:"Please enter a valid 10-digit phone number",trigger:"blur"}],amount:[{required:!0,message:"Please enter a bid amount",trigger:"blur"},{validator:(t,e,n)=>{var d,i;console.log("value",e);const l=parseFloat(e);if(isNaN(l)){n(new Error("Please enter a valid number"));return}let r=0;a.value?a.value.entity.amount_unit==p.USD?r=a.value.entity.amount+20:r=a.value.entity.amount+.01:r=((i=(d=_.token_meta)==null?void 0:d.entity)==null?void 0:i.price)||0,console.log("minimum_amount",r,l),l<r?n(new Error(`Please enter a bid amount equal or greater than ${r}`)):n()},trigger:"blur"},{pattern:/^\d+(\.\d+)?$/,message:"Please enter a valid number",trigger:"blur"}]}),$=v(),f=v(!1);F(async()=>{if(!g.params.token_meta_id||g.params.token_meta_id instanceof Array){x("Error invalid token meta id");return}$.value=R.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),console.log("route.params.token_meta_id",g.params.token_meta_id),await H(g.params.token_meta_id,t=>{console.log("bids",t),w.value=t,$.value.close()})});const a=b(()=>w.value.length===0?null:w.value.reduce((t,e)=>t.entity.amount>e.entity.amount?t:e)),N=async t=>{if(console.log("submit called"),!t){x("Error finding form element");return}!await t.validate(n=>n)||(f.value=!0,o.value.amount=parseFloat(o.value.amount),o.value.token_meta_id=_.token_meta.id,o.value.amount_unit=P.value||p.USD,await M(o.value).then(()=>{f.value=!1,t.resetFields(),j({type:"success",message:"Successfully submitted bid!"})}).catch(n=>{f.value=!1,x(n)}))};return(t,e)=>{const n=k("el-input"),l=k("el-form-item"),r=k("el-button"),d=k("el-form");return B(),V("div",null,[a.value?(B(),V("div",O,[e[7]||(e[7]=s("h3",{style:{"font-weight":"bold"}},"Highest Bid",-1)),s("div",W,[s("span",z,c(a.value.entity.bidding_name),1),e[6]||(e[6]=y("- ")),s("span",null,c(D.value),1)])])):(B(),V("div",G,[e[8]||(e[8]=s("h3",{style:{"font-weight":"bold"}},"Starting Bid",-1)),s("h2",null,c(C.value),1)])),s("div",J,[e[11]||(e[11]=s("h3",{style:{"padding-bottom":"15px","font-weight":"bold"}},"Place a Bid",-1)),u(d,{ref_key:"formRef",ref:E,model:o.value,rules:L,"label-width":"160px","label-position":"left"},{default:m(()=>[u(l,{label:"Email (private)",prop:"email"},{default:m(()=>[u(n,{modelValue:o.value.email,"onUpdate:modelValue":e[0]||(e[0]=i=>o.value.email=i),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),u(l,{label:"Phone (private)",prop:"phone_number"},{default:m(()=>[u(n,{modelValue:o.value.phone_number,"onUpdate:modelValue":e[1]||(e[1]=i=>o.value.phone_number=i),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),u(l,{label:"Bidding Name (public)",prop:"bidding_name"},{default:m(()=>[u(n,{modelValue:o.value.bidding_name,"onUpdate:modelValue":e[2]||(e[2]=i=>o.value.bidding_name=i)},null,8,["modelValue"])]),_:1}),u(l,{label:"Bid Amount (public)",prop:"amount",style:{"max-width":"350px"}},{default:m(()=>[u(n,{modelValue:o.value.amount,"onUpdate:modelValue":e[3]||(e[3]=i=>o.value.amount=i)},{append:m(()=>[y(c(P.value=="eth"?"ETH":"$"),1)]),_:1},8,["modelValue"])]),_:1}),s("div",K,[u(r,{loading:f.value,onClick:e[4]||(e[4]=i=>N(E.value)),class:"submit-button",color:"#000000",round:"",style:{"flex-grow":"1"}},{default:m(()=>e[9]||(e[9]=[y(" SUBMIT ")])),_:1},8,["loading"]),u(r,{onClick:e[5]||(e[5]=i=>U(T).push({name:"actions",params:{token_meta_id:U(g).params.token_meta_id}})),class:"submit-button",round:"",style:{"flex-grow":"1"}},{default:m(()=>e[10]||(e[10]=[y(" CANCEL ")])),_:1})])]),_:1},8,["model","rules"])])])}}});export{ae as default};
