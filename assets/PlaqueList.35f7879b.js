import{_ as Q,d as W,r as h,c as N,B as J,b as _,o as c,h as S,i as e,w as a,k as t,t as I,j as m,f,C as te,p as le,m as ae,z as T,u as fe,e as D,D as pe,G as Ce,H as $e,g as R,I as be,J as Se,F as G,K as ee,A as me,l as Pe,L as Ve}from"./index.2cd7cf19.js";import{u as U,d as Ae}from"./plaque.180c7ae7.js";import{c as ze}from"./token-meta.16ce217f.js";import{u as X}from"./plaque.3f1f44f8.js";import{u as ye,g as Ie}from"./account.d74ef345.js";import{s as j,a as ge}from"./util.2b7acca7.js";import{T as ve,O as Ne}from"./types.3cc10997.js";import{u as ke}from"./breakpoints.309ebc01.js";import{u as qe}from"./token-meta.de96c5fc.js";import{_ as Le}from"./TokenSelectList.80068ab3.js";import{n as F}from"./firebaseConfig.4bdd3a5f.js";import{P as Te}from"./PlaqueTokenItem.7d27d055.js";import{u as Ee}from"./gallery.65e9a5f9.js";import"./thumbnail-image.1989b298.js";import"./ArtworkFilters.2ab48c71.js";import"./gallery-token.25579f23.js";const De=u=>(le("data-v-381e6960"),u=u(),ae(),u),Ue={class:"dialog-container"},Oe={class:"dialog-footer"},Be=De(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),Fe=W({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(u,{emit:n}){const x=u,i=h([]),b=h(!1),{screen_type:V}=ke(),P=X(),C=qe(),$=ye(),g=N({get(){return x.show_add_token_dialog},set(k){n("update:show_add_token_dialog",k)}});J(g,k=>{k&&(i.value=JSON.parse(JSON.stringify(d.value.entity.token_meta_id_list)))});const d=N(()=>P.plaque_map[x.plaque_id]),A=N(()=>C.sorted_all_token_metas),z=async()=>{b.value=!0;try{for(let[k,s]of i.value.entries()){const l=C.all_token_metas[s];if(!l)throw"Failed to find store token for token: "+s;if(l.entity.platform!=ve.Opensea)continue;const p=JSON.parse(JSON.stringify(l));p.entity.user_id=$.get_account.id,p.entity.platform=ve.OpenseaArchive;const w=await ze(p.entity);i.value[k]=w.id}await U(x.plaque_id,{token_meta_id_list:i.value}),P.plaque_map[x.plaque_id].entity.token_meta_id_list=i.value}catch(k){j(`Error updating plaque tokens - ${k}`)}b.value=!1,g.value=!1},O=()=>{i.value=[]};return(k,s)=>{const l=_("el-button"),p=_("el-dialog");return c(),S("div",Ue,[e(p,{center:"",modelValue:f(g),"onUpdate:modelValue":s[1]||(s[1]=w=>te(g)?g.value=w:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:f(V)=="xs",top:"2vh","destroy-on-close":""},{footer:a(()=>[t("div",Oe,[t("div",null,I(`Artwork in playlist: ${i.value.length}`),1),Be,e(l,{onClick:O},{default:a(()=>[m("Clear")]),_:1}),e(l,{type:"info",onClick:z,loading:b.value},{default:a(()=>[m("Save")]),_:1},8,["loading"])])]),default:a(()=>[e(Le,{selected_token_meta_id_list:i.value,"onUpdate:selected_token_meta_id_list":s[0]||(s[0]=w=>i.value=w),token_meta_list:f(A)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Me=Q(Fe,[["__scopeId","data-v-381e6960"]]);const Re={class:"controller-buttons"},je=W({__name:"PlaqueController",props:{plaque:null},setup(u){const n=u,x=X(),i=h(!1),b=h(!1),V=h(!1),P=h(!1),C=N({get:()=>n.plaque.entity.orientation||"landscape",set:g=>{U(n.plaque.id,{orientation:g}).then(()=>{x.plaque_map[n.plaque.id].entity.orientation=g,T({type:"success",message:"Plaque orientation updated"})}).catch(d=>{j(`Error updating plaque orientation - ${d}`)})}}),$=g=>{const d={type:g,time_sent:F.now()};U(n.plaque.id,{command:d}).then(()=>{x.plaque_map[n.plaque.id].entity.command=d,T({type:"success",message:"Command sent to plaque"})}).catch(A=>{j(`Error sending command to plaque - ${A}`)}).finally(()=>{i.value=!1,b.value=!1,V.value=!1,P.value=!1})};return(g,d)=>{const A=_("el-button"),z=_("el-radio"),O=_("el-radio-group");return c(),S("div",null,[t("div",Re,[e(A,{circle:"",text:"",loading:i.value,icon:"DArrowLeft",onClick:d[0]||(d[0]=k=>{i.value=!0,$("playlist_previous")})},null,8,["loading"]),e(A,{circle:"",text:"",loading:b.value,icon:"VideoPlay",onClick:d[1]||(d[1]=k=>{b.value=!0,$("play")})},null,8,["loading"]),e(A,{circle:"",text:"",icon:"VideoPause",loading:V.value,onClick:d[2]||(d[2]=k=>{V.value=!0,$("pause")})},null,8,["loading"]),e(A,{circle:"",text:"",icon:"DArrowRight",loading:P.value,onClick:d[3]||(d[3]=k=>{P.value=!0,$("playlist_next")})},null,8,["loading"])]),e(O,{modelValue:f(C),"onUpdate:modelValue":d[4]||(d[4]=k=>te(C)?C.value=k:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:a(()=>[e(z,{label:"landscape",size:"small"},{default:a(()=>[m("Landscape")]),_:1}),e(z,{label:"portrait",size:"small"},{default:a(()=>[m("Portrait")]),_:1}),e(z,{label:"landscape_reversed",size:"small"},{default:a(()=>[m("Landscape Reversed")]),_:1}),e(z,{label:"portrait_reversed",size:"small"},{default:a(()=>[m("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Je=Q(je,[["__scopeId","data-v-100e65c8"]]);const L=u=>(le("data-v-4c8598a0"),u=u(),ae(),u),Ge={style:{display:"flex","align-items":"center",padding:"1em"}},He={key:0},Ke=L(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),Qe={class:"card-simple"},We=L(()=>t("hr",null,null,-1)),Xe=L(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Ye=L(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Ze={style:{padding:"0.3em 1em"}},et={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},tt={key:0,class:"card-detail"},lt={style:{padding:"0 1em"}},at={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},nt=L(()=>t("hr",null,null,-1)),ot=L(()=>t("div",{style:{padding:"1em"}},"No artwork added",-1)),st=L(()=>t("hr",null,null,-1)),it={style:{display:"flex",padding:"1em"}},ut=L(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),rt={key:0,style:{padding:"1em"}},dt={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},_t={key:0},ct=L(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),pt={key:0},mt={key:1},vt={style:{"font-size":"var(--el-font-size-extra-small)"}},ft={key:1},yt={style:{"margin-bottom":"1em"}},gt=L(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),kt={style:{"margin-bottom":"1em"}},qt=L(()=>t("div",{class:"caption"},"Enable Support VPN",-1)),ht={style:{display:"flex","justify-content":"end"}},wt=W({__name:"PlaqueCard",props:{plaque:null},setup(u){const n=u,x=X();fe();const i=h("simple"),b=h(!1),V=h(!1),P=h(""),C=h(!1),$=h(!1),g=async()=>{C.value=!0,await U(n.plaque.id,{name:n.plaque.entity.name}).catch(r=>{j(`Error updating plaque tokens - ${r}`)}),V.value=!1,C.value=!1},d=qe(),A=N(()=>z.value.length==0?null:z.value[0]),z=N(()=>{const r=d.archive_token_meta_map;return n.plaque.entity.token_meta_id_list.map(q=>r[q])}),O=N(()=>ge(n.plaque)),k=N(()=>{const r=n.plaque.entity.last_check_in_time;return r?new Date(r.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):"N/A"}),s=()=>{me.confirm(`Are you sure you want to clear tokens for plaque '${n.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{U(n.plaque.id,{token_meta_id_list:[]}).then(()=>{x.plaque_map[n.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Tokens cleared"})}).catch(r=>{T({message:`Error clearing tokens from plaque - ${r}`,type:"error",showClose:!0,duration:12e3})})})},l=()=>{me.confirm(`Are you sure you want to forget the plaque named '${n.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{U(n.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{x.plaque_map[n.plaque.id].entity.user_id="",x.plaque_map[n.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Plaque forgotten"})}).catch(r=>{T({message:`Error forgetting plaque - ${r}`,type:"error",showClose:!0,duration:12e3})})})};J(i,r=>{r=="settings"&&n.plaque.entity.user_id&&!P.value&&Ie(n.plaque.entity.user_id).then(o=>{P.value=o.entity.email}).catch(o=>{T({message:`Error loading user account - ${o}`,type:"error",showClose:!0,duration:12e3})})});const p=N({get:()=>Boolean(n.plaque.entity.vpn_active),set:r=>{U(n.plaque.id,{vpn_active:r}).then(()=>{x.plaque_map[n.plaque.id].entity.vpn_active=r,T({type:"success",message:"VPN setting updated"})}).catch(o=>{j(`Error updating VPN setting- ${o}`)})}}),w=N(()=>{var q,B,M;const r=(M=(B=(q=n==null?void 0:n.plaque)==null?void 0:q.entity)==null?void 0:B.machine_data)==null?void 0:M.updated_at;return r?new Date(r.seconds*1e3+r.nanoseconds/1e6).toLocaleString():"N/A"}),E=()=>{const r={type:"upload_logs",time_sent:F.now()};$.value=!0,U(n.plaque.id,{command:r}).then(()=>{x.plaque_map[n.plaque.id].entity.command=r,T({type:"success",message:"Command sent to plaque"})}).catch(o=>{j(`Error sending command to plaque - ${o}`)}).finally(()=>{$.value=!1})};return(r,o)=>{const q=_("el-button"),B=_("el-tag"),M=_("el-tooltip"),K=_("el-col"),v=_("el-row"),he=_("ArrowRight"),Y=_("el-icon"),Z=_("el-collapse-transition"),ne=_("Close"),we=_("el-switch"),xe=_("el-card");return c(),D(xe,null,{default:a(()=>[t("div",Ge,[V.value?pe((c(),S("input",{key:1,"onUpdate:modelValue":o[0]||(o[0]=y=>n.plaque.entity.name=y),class:"edit-name-input"},null,512)),[[Ce,n.plaque.entity.name]]):(c(),S("h1",He,I(n.plaque.entity.name),1)),V.value?R("",!0):(c(),D(q,{key:2,icon:f($e),onClick:o[1]||(o[1]=y=>V.value=!0),class:"editIcon",circle:""},null,8,["icon"])),V.value?(c(),D(q,{key:3,icon:f(be),loading:C.value,onClick:g,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):R("",!0),Ke,e(M,{class:"box-item",effect:"dark",content:`Last activity ${f(k)}`,placement:"top"},{default:a(()=>[f(O)?(c(),D(B,{key:0,class:"ml-2",type:"success"},{default:a(()=>[m("online")]),_:1})):(c(),D(B,{key:1,class:"ml-2",type:"danger"},{default:a(()=>[m("offline")]),_:1}))]),_:1},8,["content"])]),e(Z,null,{default:a(()=>[pe(t("section",Qe,[We,e(v,{style:{padding:"1em"}},{default:a(()=>[e(K,{span:12},{default:a(()=>{var y;return[Xe,t("span",null,I(((y=f(A))==null?void 0:y.entity.name)||"N/A"),1)]}),_:1}),e(K,{span:12},{default:a(()=>{var y;return[Ye,m(" "+I(((y=f(A))==null?void 0:y.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),t("div",Ze,I(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),t("div",et,[e(q,{type:"info",onClick:o[2]||(o[2]=y=>b.value=!0)},{default:a(()=>[m("Add Artwork")]),_:1}),e(q,{onClick:o[3]||(o[3]=y=>i.value="detail")},{default:a(()=>[m(" Details"),e(Y,{class:"el-icon--right"},{default:a(()=>[e(he)]),_:1})]),_:1})])],512),[[Se,i.value=="simple"]])]),_:1}),e(Z,null,{default:a(()=>[i.value=="detail"?(c(),S("section",tt,[t("p",lt,I(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),t("div",at,[e(q,{onClick:o[4]||(o[4]=y=>i.value="settings")},{default:a(()=>[m("Settings")]),_:1}),e(q,{onClick:s},{default:a(()=>[m("Clear Artwork")]),_:1})]),nt,f(z).length==0?(c(),S(G,{key:0},[ot,st],64)):R("",!0),(c(!0),S(G,null,ee(f(z),y=>(c(),D(Te,{token_meta:y},null,8,["token_meta"]))),256)),t("div",it,[e(q,{type:"info",onClick:o[5]||(o[5]=y=>b.value=!0)},{default:a(()=>[m("Add Artwork")]),_:1}),ut,e(q,{onClick:o[6]||(o[6]=y=>i.value="simple")},{default:a(()=>[m("Close"),e(Y,{class:"el-icon--right"},{default:a(()=>[e(ne)]),_:1})]),_:1})])])):R("",!0)]),_:1}),e(Z,null,{default:a(()=>{var y,oe,se,ie,ue,re,de,_e;return[i.value=="settings"?(c(),S("section",rt,[e(Je,{plaque:n.plaque},null,8,["plaque"]),t("div",dt,[u.plaque.entity.user_id?(c(),S("div",_t,[ct,P.value?(c(),S("div",pt,I(P.value),1)):(c(),S("div",mt,"Loading...")),t("div",vt,I(u.plaque.entity.user_id),1)])):(c(),S("div",ft,"No associated user")),u.plaque.entity.user_id?(c(),D(q,{key:2,type:"danger",plain:"",onClick:l},{default:a(()=>[m("Forget Display")]),_:1})):R("",!0)]),t("div",yt,[gt,t("div",null,"Machine name: "+I((oe=(y=u.plaque.entity.machine_data)==null?void 0:y.machine_name)!=null?oe:"N/A"),1),t("div",null,"Version: "+I((ie=(se=u.plaque.entity.machine_data)==null?void 0:se.version)!=null?ie:"N/A"),1),t("div",null,"Local IP: "+I((re=(ue=u.plaque.entity.machine_data)==null?void 0:ue.local_ip)!=null?re:"N/A"),1),t("div",null,"Public IP: "+I((_e=(de=u.plaque.entity.machine_data)==null?void 0:de.public_ip)!=null?_e:"N/A"),1),t("div",null,"Updated At: "+I(f(w)),1)]),t("div",kt,[qt,e(we,{modelValue:f(p),"onUpdate:modelValue":o[7]||(o[7]=ce=>te(p)?p.value=ce:null),"active-text":"Enabled","inactive-text":"Off"},null,8,["modelValue"])]),t("div",null,[e(q,{plain:"",onClick:E,loading:$.value},{default:a(()=>[m("Download Logs")]),_:1},8,["loading"])]),t("div",ht,[e(q,{onClick:o[8]||(o[8]=ce=>i.value="detail")},{default:a(()=>[m("Close"),e(Y,{class:"el-icon--right"},{default:a(()=>[e(ne)]),_:1})]),_:1})])])):R("",!0)]}),_:1}),e(Me,{plaque_id:n.plaque.id,show_add_token_dialog:b.value,"onUpdate:show_add_token_dialog":o[9]||(o[9]=y=>b.value=y)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var xt=Q(wt,[["__scopeId","data-v-4c8598a0"]]);const H=u=>(le("data-v-517aa68d"),u=u(),ae(),u),Ct=H(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),$t=H(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),bt=H(()=>t("div",{class:"caption"},"Sort order",-1)),St=H(()=>t("div",{style:{"padding-bottom":"90px"}},null,-1)),Pt={class:"add-button-container"},Vt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},At=H(()=>t("div",{style:{"font-size":"17px"}},"Add plaque",-1)),zt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},It=W({__name:"PlaqueList",setup(u){const n=h(!1),{screen_type:x}=ke(),i=h(!1),b=fe(),V=ye(),P=Ee(),C=h(""),$=h(localStorage.getItem("plaque_list_filter_by_gallery")||"");J($,s=>{localStorage.setItem("plaque_list_filter_by_gallery",s)});const g=h(localStorage.getItem("online_filter")==="true"||!1);J(g,s=>{if(s){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const d=h(localStorage.getItem("plaque_list_sort_order")||"name");J(d,s=>{localStorage.setItem("plaque_list_sort_order",s)});const A=X(),z=async()=>{n.value=!0,await Ae({name:"Test Plaque",user_id:V.get_account.id,token_meta_id_list:[],created_at:F.now(),updated_at:F.now(),orientation:Ne.Landscape,command:{type:"",time_sent:F.fromMillis(0)},last_check_in_time:F.fromMillis(0),vpn_active:!1,machine_data:{machine_name:"",version:"",local_ip:"",public_ip:"",updated_at:F.fromMillis(0)}}).catch(s=>T({message:`Error creating test plaque- ${s}`,type:"error",showClose:!0,duration:12e3})),n.value=!1,i.value=!1},O=N(()=>JSON.parse(JSON.stringify(A.all_plaque_list)).sort((l,p)=>{const w=l.entity.name.toLowerCase(),E=p.entity.name.toLowerCase();return w<E?-1:w>E?1:0})),k=N(()=>{let s=[...O.value];return s=s.filter(l=>l.entity.name||l.entity.user_id||l.entity.token_meta_id_list.length>0),$.value&&(s=s.filter(l=>{var p;return(p=P.gallery_list.find(w=>w.id==$.value))==null?void 0:p.entity.plaque_id_list.includes(l.id)})),g.value&&(s=s.filter(l=>ge(l))),d.value=="name"?s=s.sort((l,p)=>l.entity.name.localeCompare(p.entity.name)):d.value=="last_check_in_time"&&(s=s.sort((l,p)=>l.entity.last_check_in_time==null&&p.entity.last_check_in_time==null?0:l.entity.last_check_in_time==null?1:p.entity.last_check_in_time==null?-1:p.entity.last_check_in_time.seconds-l.entity.last_check_in_time.seconds)),C.value?s.filter(l=>l.entity.name.toLowerCase().includes(C.value.toLowerCase())):s});return(s,l)=>{const p=_("el-input"),w=_("el-button"),E=_("el-option"),r=_("el-select"),o=_("el-switch"),q=_("el-popover"),B=_("Plus"),M=_("el-icon"),K=_("el-dialog");return c(),S(G,null,[t("div",{class:"subheader",style:Pe([{display:"flex","align-items":"center"},f(x)=="xs"?"padding: 0px 8px 10px;":""])},[e(p,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=v=>C.value=v),"prefix-icon":f(Ve),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),e(q,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:a(()=>[e(w,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:a(()=>[m("Filters")]),_:1})]),default:a(()=>[Ct,e(r,{modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=v=>$.value=v),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:a(()=>[e(E,{label:"All plaques",value:""}),(c(!0),S(G,null,ee(f(P).gallery_list,v=>(c(),D(E,{key:v.id,label:`${v.entity.name}`,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),$t,e(o,{modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=v=>g.value=v),style:{"margin-bottom":"1em"}},null,8,["modelValue"]),bt,e(r,{modelValue:d.value,"onUpdate:modelValue":l[3]||(l[3]=v=>d.value=v),placeholder:"Sort by",class:"filter-select"},{default:a(()=>[e(E,{label:"Sort by name",value:"name"}),e(E,{label:"Sort by last activity",value:"last_check_in_time"})]),_:1},8,["modelValue"])]),_:1}),e(w,{icon:"Camera",type:"info",onClick:l[4]||(l[4]=v=>f(b).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:a(()=>[m("Scan")]),_:1})],4),St,(c(!0),S(G,null,ee(f(k),v=>(c(),D(xt,{plaque:v,key:v.id},null,8,["plaque"]))),128)),t("div",Pt,[t("div",Vt,[t("div",{class:"add-button",onClick:l[5]||(l[5]=v=>i.value=!0)},[e(M,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:a(()=>[e(B)]),_:1}),At])])]),e(K,{modelValue:i.value,"onUpdate:modelValue":l[7]||(l[7]=v=>i.value=v),title:"Add plaque",width:f(x)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:a(()=>[t("div",zt,[e(w,{onClick:l[6]||(l[6]=v=>{f(b).push("qr-scan"),i.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:a(()=>[m("Scan Plaque QR Code")]),_:1}),e(w,{icon:"plus",onClick:z,loading:n.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:a(()=>[m("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Qt=Q(It,[["__scopeId","data-v-517aa68d"]]);export{Qt as default};
