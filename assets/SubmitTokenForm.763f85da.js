import{b as K,c as Q}from"./gallery-token.25579f23.js";import{d as W,u as H,e as J}from"./token-meta.16ce217f.js";import{g as X,d as Y,u as Z,n as R}from"./firebaseConfig.4bdd3a5f.js";import{z as x,d as ee,r as _,P as ae,q as le,b as d,o as v,e as g,w as o,i as t,j as w,g as h,h as te,F as oe,K as ne,t as q,k as T,A as re}from"./index.2cd7cf19.js";import{b as se,T as ue}from"./types.3cc10997.js";import{u as ie}from"./account.d74ef345.js";import{u as de}from"./token-meta.de96c5fc.js";import{s as k}from"./util.2b7acca7.js";const me=X(),ce=async(y,c,V,a)=>{console.log("uploadFile - starting file upload for ",y);const m=Y(me,y);Z(m,c).on("state_changed",n=>{console.log("snapshot",n.bytesTransferred,n.totalBytes),V(n.bytesTransferred/n.totalBytes)},n=>{console.log("uploadFile error - ",n),x({message:`Error uploading file to moda archive - ${n}`,type:"error",showClose:!0,duration:12e3})},a)};const _e=T("div",{class:"el-upload__text"},[w(" Drop file here or "),T("em",null,"click to upload")],-1),he=ee({__name:"SubmitTokenForm",props:{token_meta_id:null},setup(y){const c=y,V=_();_();const a=_({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:R.now(),updated_at:R.now(),media_id:"",media_type:"",user_id:"",blockchain:se.OffChain,asset_contract_address:"",token_id:"",platform:ue.Archive}),m=_([]),$=ae({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),n=_(!1),U=_("0%"),b=_([]),B=ie(),M=de(),A=_([]);le(()=>{c.token_meta_id?a.value={...M.all_token_metas[c.token_meta_id].entity}:K().then(u=>{A.value=u})});const S=(u,e)=>re.confirm(`Cancel the upload of ${u.name} ?`).then(()=>!0,()=>!1),E=()=>{},F=async u=>{var s;if(!u){k("Error finding form element");return}if(!!await u.validate(r=>r)){if(a.value.user_id=B.get_account.id,a.value.blockchain!="ethereum"&&(a.value.asset_contract_address="",a.value.token_id=""),c.token_meta_id){D(c.token_meta_id);return}if(((s=m==null?void 0:m.value)==null?void 0:s.length)!==1){k("Please add a file to upload");return}await L(u)}},L=async u=>{const e=m.value[0];n.value=!0;const s=await W().catch(i=>{console.error(i),n.value=!1,k(`Error getting moda archive token meta document - ${i}`)});if(!s)return;const r=i=>{U.value=`${Math.round(i*100)}%`},p=()=>{N(u,e,s)},f=`${s.id}.${e.name.split(".").pop()}`;return ce(f,e.raw,r,p).catch(i=>{console.error(i),n.value=!1,k(`Error uploading file to moda archive - ${i}`)})},N=async(u,e,s)=>{var p;a.value.media_id=`${s.id}`,a.value.media_type=`.${e.name.split(".").pop()}`;let r;try{r=await J(s,a.value)}catch(f){k(`Error uploading metadata to moda archive - ${f}`),n.value=!1;return}if((p=b.value)!=null&&p.length){const f=b.value.map(i=>({gallery_id:i,token_meta_id:r.id}));await Q(f).catch(i=>{k(`Error adding token to gallery - ${i}`),n.value=!1})}u.resetFields(),m.value=[],b.value=[],x({type:"success",message:"Successfully submitted token"}),n.value=!1},D=u=>{n.value=!0,H(u,a.value).then(()=>{x({type:"success",message:"Successfully updated token"})}).catch(e=>{k(`Error updating token metadata - ${e}`)}).finally(()=>n.value=!1)};return(u,e)=>{const s=d("el-input"),r=d("el-form-item"),p=d("el-radio"),f=d("el-radio-group"),i=d("el-option"),P=d("el-select"),G=d("upload-filled"),C=d("el-icon"),I=d("el-upload"),O=d("Loading"),j=d("el-button"),z=d("el-form");return v(),g(z,{ref_key:"formRef",ref:V,model:a.value,rules:$,"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:o(()=>[t(r,{label:"Artwork Title",style:{"max-width":"550px"},prop:"name"},{default:o(()=>[t(s,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.name=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist Name",style:{"max-width":"550px"},prop:"artist"},{default:o(()=>[t(s,{modelValue:a.value.artist,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.artist=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist Social Media Link",style:{"max-width":"550px"},prop:"artist_social_link"},{default:o(()=>[t(s,{modelValue:a.value.artist_social_link,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.artist_social_link=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"Link to Blockchain"},{default:o(()=>[t(f,{modelValue:a.value.blockchain,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.blockchain=l)},{default:o(()=>[t(p,{label:"off_chain"},{default:o(()=>[w("Off-chain")]),_:1}),t(p,{label:"ethereum"},{default:o(()=>[w("Ethereum")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.blockchain=="ethereum"?(v(),g(r,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:o(()=>[t(s,{modelValue:a.value.asset_contract_address,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.asset_contract_address=l)},null,8,["modelValue"])]),_:1})):h("",!0),a.value.blockchain=="ethereum"?(v(),g(r,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:o(()=>[t(s,{modelValue:a.value.token_id,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.token_id=l)},null,8,["modelValue"])]),_:1})):h("",!0),t(r,{label:"Plaque Description",prop:"description"},{default:o(()=>[t(s,{modelValue:a.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.description=l),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(r,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[t(s,{modelValue:a.value.public_link,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.public_link=l)},null,8,["modelValue"])]),_:1}),c.token_meta_id?h("",!0):(v(),g(r,{key:2,label:"Add to Gallery"},{default:o(()=>[t(P,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=l=>b.value=l),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(v(!0),te(oe,null,ne(A.value,l=>(v(),g(i,{key:l.id,label:`${l.entity.name}`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),c.token_meta_id?h("",!0):(v(),g(r,{key:3},{default:o(()=>[t(I,{class:"upload-demo","auto-upload":!1,action:"","on-remove":E,"before-remove":S,limit:1,drag:"","file-list":m.value,"onUpdate:fileList":e[9]||(e[9]=l=>m.value=l)},{default:o(()=>[t(C,{class:"el-icon--upload"},{default:o(()=>[t(G)]),_:1}),_e]),_:1},8,["file-list"])]),_:1})),t(r,null,{default:o(()=>[t(j,{onClick:e[10]||(e[10]=l=>F(V.value)),loading:n.value,color:"#000000"},{loading:o(()=>[t(C,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[t(O)]),_:1}),w(" "+q(U.value),1)]),default:o(()=>[T("div",null,q(n.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});export{he as _};
