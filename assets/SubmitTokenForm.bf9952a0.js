import{b as J,c as Q}from"./gallery-token.f0159eba.js";import{d as W,u as H,e as K}from"./token-meta.6133e320.js";import{h as X,r as Y,u as Z,i as R}from"./firebaseConfig.4d01e9b5.js";import{z as x,d as ee,r as p,O as ae,q as te,a as g,w as o,f as d,o as v,i as l,j as w,g as h,h as le,J as oe,F as re,t as q,l as T,A as ne}from"./index.ae856d64.js";import{a as se,T as ue}from"./types.294958f7.js";import{u as ie}from"./account.17e5277f.js";import{u as de}from"./token-meta.b9cdedc0.js";import{s as k}from"./util.c2a7c8d0.js";const me=X(),ce=async(y,c,V,a)=>{console.log("uploadFile - starting file upload for ",y);const m=Y(me,y);Z(m,c).on("state_changed",r=>{console.log("snapshot",r.bytesTransferred,r.totalBytes),V(r.bytesTransferred/r.totalBytes)},r=>{console.log("uploadFile error - ",r),x({message:`Error uploading file to moda archive - ${r}`,type:"error",showClose:!0,duration:12e3})},a)};const pe=T("div",{class:"el-upload__text"},[w(" Drop file here or "),T("em",null,"click to upload")],-1),he=ee({__name:"SubmitTokenForm",props:{token_meta_id:{}},setup(y){const c=y,V=p();p();const a=p({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:R.now(),updated_at:R.now(),media_id:"",media_type:"",user_id:"",blockchain:se.OffChain,asset_contract_address:"",token_id:"",platform:ue.Archive}),m=p([]),$=ae({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),r=p(!1),U=p("0%"),b=p([]),B=ie(),M=de(),A=p([]);te(()=>{c.token_meta_id?a.value={...M.all_token_metas[c.token_meta_id].entity}:J().then(u=>{A.value=u})});const S=(u,e)=>ne.confirm(`Cancel the upload of ${u.name} ?`).then(()=>!0,()=>!1),E=()=>{},F=async u=>{var s;if(!u){k("Error finding form element");return}if(!!await u.validate(n=>n)){if(a.value.user_id=B.get_account.id,a.value.blockchain!="ethereum"&&(a.value.asset_contract_address="",a.value.token_id=""),c.token_meta_id){D(c.token_meta_id);return}if(((s=m==null?void 0:m.value)==null?void 0:s.length)!==1){k("Please add a file to upload");return}await L(u)}},L=async u=>{const e=m.value[0];r.value=!0;const s=await W().catch(i=>{console.error(i),r.value=!1,k(`Error getting moda archive token meta document - ${i}`)});if(!s)return;const n=i=>{U.value=`${Math.round(i*100)}%`},_=()=>{N(u,e,s)},f=`${s.id}.${e.name.split(".").pop()}`;return ce(f,e.raw,n,_).catch(i=>{console.error(i),r.value=!1,k(`Error uploading file to moda archive - ${i}`)})},N=async(u,e,s)=>{var _;a.value.media_id=`${s.id}`,a.value.media_type=`.${e.name.split(".").pop()}`;let n;try{n=await K(s,a.value)}catch(f){k(`Error uploading metadata to moda archive - ${f}`),r.value=!1;return}if((_=b.value)!=null&&_.length){const f=b.value.map(i=>({gallery_id:i,token_meta_id:n.id}));await Q(f).catch(i=>{k(`Error adding token to gallery - ${i}`),r.value=!1})}u.resetFields(),m.value=[],b.value=[],x({type:"success",message:"Successfully submitted artwork. Please wait a few moments for your artwork to appear."}),r.value=!1},D=u=>{r.value=!0,H(u,a.value).then(()=>{x({type:"success",message:"Successfully updated artwork"})}).catch(e=>{k(`Error updating token metadata - ${e}`)}).finally(()=>r.value=!1)};return(u,e)=>{const s=d("el-input"),n=d("el-form-item"),_=d("el-radio"),f=d("el-radio-group"),i=d("el-option"),P=d("el-select"),G=d("upload-filled"),C=d("el-icon"),O=d("el-upload"),I=d("Loading"),j=d("el-button"),z=d("el-form");return v(),g(z,{ref_key:"formRef",ref:V,model:a.value,rules:$,"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:o(()=>[l(n,{label:"Artwork Title",style:{"max-width":"550px"},prop:"name"},{default:o(()=>[l(s,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.name=t)},null,8,["modelValue"])]),_:1}),l(n,{label:"Artist Name",style:{"max-width":"550px"},prop:"artist"},{default:o(()=>[l(s,{modelValue:a.value.artist,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.artist=t)},null,8,["modelValue"])]),_:1}),l(n,{label:"Artist Social Media Link",style:{"max-width":"550px"},prop:"artist_social_link"},{default:o(()=>[l(s,{modelValue:a.value.artist_social_link,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.artist_social_link=t)},null,8,["modelValue"])]),_:1}),l(n,{label:"Link to Blockchain"},{default:o(()=>[l(f,{modelValue:a.value.blockchain,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.blockchain=t)},{default:o(()=>[l(_,{label:"off_chain"},{default:o(()=>[w("Off-chain")]),_:1}),l(_,{label:"ethereum"},{default:o(()=>[w("Ethereum")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.blockchain=="ethereum"?(v(),g(n,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:o(()=>[l(s,{modelValue:a.value.asset_contract_address,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.asset_contract_address=t)},null,8,["modelValue"])]),_:1})):h("",!0),a.value.blockchain=="ethereum"?(v(),g(n,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:o(()=>[l(s,{modelValue:a.value.token_id,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.token_id=t)},null,8,["modelValue"])]),_:1})):h("",!0),l(n,{label:"Plaque Description",prop:"description"},{default:o(()=>[l(s,{modelValue:a.value.description,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.description=t),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),l(n,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[l(s,{modelValue:a.value.public_link,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.public_link=t)},null,8,["modelValue"])]),_:1}),c.token_meta_id?h("",!0):(v(),g(n,{key:2,label:"Add to Gallery"},{default:o(()=>[l(P,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=t=>b.value=t),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(v(!0),le(re,null,oe(A.value,t=>(v(),g(i,{key:t.id,label:`${t.entity.name}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),c.token_meta_id?h("",!0):(v(),g(n,{key:3},{default:o(()=>[l(O,{class:"upload-demo","auto-upload":!1,action:"","on-remove":E,"before-remove":S,limit:1,drag:"","file-list":m.value,"onUpdate:fileList":e[9]||(e[9]=t=>m.value=t)},{default:o(()=>[l(C,{class:"el-icon--upload"},{default:o(()=>[l(G)]),_:1}),pe]),_:1},8,["file-list"])]),_:1})),l(n,null,{default:o(()=>[l(j,{onClick:e[10]||(e[10]=t=>F(V.value)),loading:r.value,color:"#000000"},{loading:o(()=>[l(C,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[l(I)]),_:1}),w(" "+q(U.value),1)]),default:o(()=>[T("div",null,q(r.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});export{he as _};
