import{_ as K,d as Q,r as w,c as P,z as R,b as d,o as c,h as x,i as e,w as a,k as t,t as A,j as v,f as y,A as ee,p as te,l as le,x as T,u as ve,e as L,B as ce,C as we,D as xe,g as B,G as Ce,H as $e,F as j,I as Z,J as pe,K as be}from"./index.4c011e10.js";import{u as D,c as Se}from"./plaque.d8f28723.js";import{c as Ve}from"./token-meta.7f5c0ba8.js";import{u as W}from"./plaque.001e4c4f.js";import{u as fe,g as Ae}from"./account.1f4d413a.js";import{s as J,a as ye}from"./util.c94501bb.js";import{T as me,O as Pe}from"./types.d2ec9214.js";import{u as ge}from"./breakpoints.1ab22dc9.js";import{u as ke}from"./token-meta.719b556f.js";import{_ as Ne}from"./TokenSelectList.4b61b17a.js";import{n as F}from"./firebaseConfig.d7a6b5a9.js";import{_ as ze}from"./PlaqueTokenItem.b7418acd.js";import{u as Ie}from"./gallery.75b89c69.js";import"./thumbnail-image.3589b9f5.js";import"./gallery.d53d87c7.js";const Le=r=>(te("data-v-cc2989e6"),r=r(),le(),r),Te={class:"dialog-container"},Ee={class:"dialog-footer"},Ue=Le(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),De=Q({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(r,{emit:s}){const b=r,_=w([]),q=w(!1),{screen_type:C}=ge(),S=W(),$=ke(),V=fe(),g=P({get(){return b.show_add_token_dialog},set(h){s("update:show_add_token_dialog",h)}});R(g,h=>{h&&(_.value=JSON.parse(JSON.stringify(u.value.entity.token_meta_id_list)))});const u=P(()=>S.plaque_map[b.plaque_id]),k=P(()=>$.sorted_all_token_metas),I=async()=>{q.value=!0;try{for(let[h,N]of _.value.entries()){const i=$.all_token_metas[N];if(!i)throw"Failed to find store token for token: "+N;if(i.entity.platform!=me.Opensea)continue;const l=JSON.parse(JSON.stringify(i));l.entity.user_id=V.get_account.id,l.entity.platform=me.OpenseaArchive;const n=await Ve(l.entity);_.value[h]=n.id}await D(b.plaque_id,{token_meta_id_list:_.value}),S.plaque_map[b.plaque_id].entity.token_meta_id_list=_.value}catch(h){J(`Error updating plaque tokens - ${h}`)}q.value=!1,g.value=!1},U=()=>{_.value=[]};return(h,N)=>{const i=d("el-button"),l=d("el-dialog");return c(),x("div",Te,[e(l,{center:"",modelValue:y(g),"onUpdate:modelValue":N[1]||(N[1]=n=>ee(g)?g.value=n:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:y(C)=="xs",top:"2vh"},{footer:a(()=>[t("div",Ee,[t("div",null,A(`Artwork in playlist: ${_.value.length}`),1),Ue,e(i,{onClick:U},{default:a(()=>[v("Clear")]),_:1}),e(i,{type:"info",onClick:I,loading:q.value},{default:a(()=>[v("Save")]),_:1},8,["loading"])])]),default:a(()=>[e(Ne,{selected_token_meta_id_list:_.value,"onUpdate:selected_token_meta_id_list":N[0]||(N[0]=n=>_.value=n),token_meta_list:y(k)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Oe=K(De,[["__scopeId","data-v-cc2989e6"]]);const Be={class:"controller-buttons"},Fe=Q({__name:"PlaqueController",props:{plaque:null},setup(r){const s=r,b=W(),_=w(!1),q=w(!1),C=w(!1),S=w(!1),$=P({get:()=>s.plaque.entity.orientation||"landscape",set:g=>{D(s.plaque.id,{orientation:g}).then(()=>{b.plaque_map[s.plaque.id].entity.orientation=g,T({type:"success",message:"Plaque orientation updated"})}).catch(u=>{J(`Error updating plaque orientation - ${u}`)})}}),V=g=>{const u={type:g,time_sent:F.now()};D(s.plaque.id,{command:u}).then(()=>{b.plaque_map[s.plaque.id].entity.command=u,T({type:"success",message:"Command sent to plaque"})}).catch(k=>{J(`Error sending command to plaque - ${k}`)}).finally(()=>{_.value=!1,q.value=!1,C.value=!1,S.value=!1})};return(g,u)=>{const k=d("el-button"),I=d("el-radio"),U=d("el-radio-group");return c(),x("div",null,[t("div",Be,[e(k,{circle:"",text:"",loading:_.value,icon:"DArrowLeft",onClick:u[0]||(u[0]=h=>{_.value=!0,V("playlist_previous")})},null,8,["loading"]),e(k,{circle:"",text:"",loading:q.value,icon:"VideoPlay",onClick:u[1]||(u[1]=h=>{q.value=!0,V("play")})},null,8,["loading"]),e(k,{circle:"",text:"",icon:"VideoPause",loading:C.value,onClick:u[2]||(u[2]=h=>{C.value=!0,V("pause")})},null,8,["loading"]),e(k,{circle:"",text:"",icon:"DArrowRight",loading:S.value,onClick:u[3]||(u[3]=h=>{S.value=!0,V("playlist_next")})},null,8,["loading"])]),e(U,{modelValue:y($),"onUpdate:modelValue":u[4]||(u[4]=h=>ee($)?$.value=h:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:a(()=>[e(I,{label:"landscape",size:"small"},{default:a(()=>[v("Landscape")]),_:1}),e(I,{label:"portrait",size:"small"},{default:a(()=>[v("Portrait")]),_:1}),e(I,{label:"landscape_reversed",size:"small"},{default:a(()=>[v("Landscape Reversed")]),_:1}),e(I,{label:"portrait_reversed",size:"small"},{default:a(()=>[v("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Me=K(Fe,[["__scopeId","data-v-100e65c8"]]);const z=r=>(te("data-v-8786a792"),r=r(),le(),r),Re={style:{display:"flex","align-items":"center",padding:"1em"}},je={key:0},Je=z(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),Ge={class:"card-simple"},He=z(()=>t("hr",null,null,-1)),Ke=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Qe=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),We={style:{padding:"0.3em 1em"}},Xe={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Ye={key:0,class:"card-detail"},Ze={style:{padding:"0 1em"}},et={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},tt=z(()=>t("hr",null,null,-1)),lt=z(()=>t("div",{style:{padding:"1em"}},"No artwork added",-1)),at=z(()=>t("hr",null,null,-1)),nt={style:{display:"flex",padding:"1em"}},ot=z(()=>t("div",{style:{"flex-grow":"1"}},null,-1)),st={key:0,style:{padding:"1em"}},it={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},rt={key:0},ut=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),dt={key:0},_t={key:1},ct={style:{"font-size":"var(--el-font-size-extra-small)"}},pt={key:1},mt={style:{"margin-bottom":"1em"}},vt=z(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),ft=z(()=>t("div",{class:"caption"},"Enable Support VPN",-1)),yt={style:{display:"flex","justify-content":"end"}},gt=Q({__name:"PlaqueCard",props:{plaque:null},setup(r){const s=r,b=W();ve();const _=w("simple"),q=w(!1),C=w(!1),S=w(""),$=w(!1),V=async()=>{$.value=!0,await D(s.plaque.id,{name:s.plaque.entity.name}).catch(n=>{J(`Error updating plaque tokens - ${n}`)}),C.value=!1,$.value=!1},g=ke(),u=P(()=>k.value.length==0?null:k.value[0]),k=P(()=>{const n=g.archive_token_meta_map;return s.plaque.entity.token_meta_id_list.map(p=>n[p])}),I=P(()=>ye(s.plaque)),U=P(()=>{const n=s.plaque.entity.last_check_in_time;return n?new Date(n.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):"N/A"}),h=()=>{pe.confirm(`Are you sure you want to clear tokens for plaque '${s.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{D(s.plaque.id,{token_meta_id_list:[]}).then(()=>{b.plaque_map[s.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Tokens cleared"})}).catch(n=>{T({message:`Error clearing tokens from plaque - ${n}`,type:"error",showClose:!0,duration:12e3})})})},N=()=>{pe.confirm(`Are you sure you want to forget the plaque named '${s.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{D(s.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{b.plaque_map[s.plaque.id].entity.user_id="",b.plaque_map[s.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Plaque forgotten"})}).catch(n=>{T({message:`Error forgetting plaque - ${n}`,type:"error",showClose:!0,duration:12e3})})})};R(_,n=>{n=="settings"&&s.plaque.entity.user_id&&!S.value&&Ae(s.plaque.entity.user_id).then(o=>{S.value=o.entity.email}).catch(o=>{T({message:`Error loading user account - ${o}`,type:"error",showClose:!0,duration:12e3})})});const i=P({get:()=>Boolean(s.plaque.entity.vpn_active),set:n=>{D(s.plaque.id,{vpn_active:n}).then(()=>{b.plaque_map[s.plaque.id].entity.vpn_active=n,T({type:"success",message:"VPN setting updated"})}).catch(o=>{J(`Error updating VPN setting- ${o}`)})}}),l=P(()=>{var p,E,O;const n=(O=(E=(p=s==null?void 0:s.plaque)==null?void 0:p.entity)==null?void 0:E.machine_data)==null?void 0:O.updated_at;return n?new Date(n.seconds*1e3+n.nanoseconds/1e6).toLocaleString():"N/A"});return(n,o)=>{const p=d("el-button"),E=d("el-tag"),O=d("el-tooltip"),H=d("el-col"),X=d("el-row"),Y=d("ArrowRight"),M=d("el-icon"),m=d("el-collapse-transition"),ae=d("Close"),qe=d("el-switch"),he=d("el-card");return c(),L(he,null,{default:a(()=>[t("div",Re,[C.value?ce((c(),x("input",{key:1,"onUpdate:modelValue":o[0]||(o[0]=f=>s.plaque.entity.name=f),class:"edit-name-input"},null,512)),[[we,s.plaque.entity.name]]):(c(),x("h1",je,A(s.plaque.entity.name),1)),C.value?B("",!0):(c(),L(p,{key:2,icon:y(xe),onClick:o[1]||(o[1]=f=>C.value=!0),class:"editIcon",circle:""},null,8,["icon"])),C.value?(c(),L(p,{key:3,icon:y(Ce),loading:$.value,onClick:V,class:"editIcon",circle:"",type:$.value?"":"success",text:""},null,8,["icon","loading","type"])):B("",!0),Je,e(O,{class:"box-item",effect:"dark",content:`Last activity ${y(U)}`,placement:"top"},{default:a(()=>[y(I)?(c(),L(E,{key:0,class:"ml-2",type:"success"},{default:a(()=>[v("online")]),_:1})):(c(),L(E,{key:1,class:"ml-2",type:"danger"},{default:a(()=>[v("offline")]),_:1}))]),_:1},8,["content"])]),e(m,null,{default:a(()=>[ce(t("section",Ge,[He,e(X,{style:{padding:"1em"}},{default:a(()=>[e(H,{span:12},{default:a(()=>{var f;return[Ke,t("span",null,A(((f=y(u))==null?void 0:f.entity.name)||"N/A"),1)]}),_:1}),e(H,{span:12},{default:a(()=>{var f;return[Qe,v(" "+A(((f=y(u))==null?void 0:f.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),t("div",We,A(`Total artworks: ${r.plaque.entity.token_meta_id_list.length}`),1),t("div",Xe,[e(p,{type:"info",onClick:o[2]||(o[2]=f=>q.value=!0)},{default:a(()=>[v("Add Artwork")]),_:1}),e(p,{onClick:o[3]||(o[3]=f=>_.value="detail")},{default:a(()=>[v(" Details"),e(M,{class:"el-icon--right"},{default:a(()=>[e(Y)]),_:1})]),_:1})])],512),[[$e,_.value=="simple"]])]),_:1}),e(m,null,{default:a(()=>[_.value=="detail"?(c(),x("section",Ye,[t("p",Ze,A(`Total artworks: ${r.plaque.entity.token_meta_id_list.length}`),1),t("div",et,[e(p,{onClick:o[4]||(o[4]=f=>_.value="settings")},{default:a(()=>[v("Settings")]),_:1}),e(p,{onClick:h},{default:a(()=>[v("Clear Artwork")]),_:1})]),tt,y(k).length==0?(c(),x(j,{key:0},[lt,at],64)):B("",!0),(c(!0),x(j,null,Z(y(k),f=>(c(),L(ze,{token_meta:f},null,8,["token_meta"]))),256)),t("div",nt,[e(p,{type:"info",onClick:o[5]||(o[5]=f=>q.value=!0)},{default:a(()=>[v("Add Artwork")]),_:1}),ot,e(p,{onClick:o[6]||(o[6]=f=>_.value="simple")},{default:a(()=>[v("Close"),e(M,{class:"el-icon--right"},{default:a(()=>[e(ae)]),_:1})]),_:1})])])):B("",!0)]),_:1}),e(m,null,{default:a(()=>{var f,ne,oe,se,ie,re,ue,de;return[_.value=="settings"?(c(),x("section",st,[e(Me,{plaque:s.plaque},null,8,["plaque"]),t("div",it,[r.plaque.entity.user_id?(c(),x("div",rt,[ut,S.value?(c(),x("div",dt,A(S.value),1)):(c(),x("div",_t,"Loading...")),t("div",ct,A(r.plaque.entity.user_id),1)])):(c(),x("div",pt,"No associated user")),r.plaque.entity.user_id?(c(),L(p,{key:2,type:"danger",plain:"",onClick:N},{default:a(()=>[v("Forget Display")]),_:1})):B("",!0)]),t("div",mt,[vt,t("div",null,"Machine name: "+A((ne=(f=r.plaque.entity.machine_data)==null?void 0:f.machine_name)!=null?ne:"N/A"),1),t("div",null,"Version: "+A((se=(oe=r.plaque.entity.machine_data)==null?void 0:oe.version)!=null?se:"N/A"),1),t("div",null,"Local IP: "+A((re=(ie=r.plaque.entity.machine_data)==null?void 0:ie.local_ip)!=null?re:"N/A"),1),t("div",null,"Public IP: "+A((de=(ue=r.plaque.entity.machine_data)==null?void 0:ue.public_ip)!=null?de:"N/A"),1),t("div",null,"Updated At: "+A(y(l)),1)]),t("div",null,[ft,e(qe,{modelValue:y(i),"onUpdate:modelValue":o[7]||(o[7]=_e=>ee(i)?i.value=_e:null),"active-text":"Enabled","inactive-text":"Off"},null,8,["modelValue"])]),t("div",yt,[e(p,{onClick:o[8]||(o[8]=_e=>_.value="detail")},{default:a(()=>[v("Close"),e(M,{class:"el-icon--right"},{default:a(()=>[e(ae)]),_:1})]),_:1})])])):B("",!0)]}),_:1}),e(Oe,{plaque_id:s.plaque.id,show_add_token_dialog:q.value,"onUpdate:show_add_token_dialog":o[9]||(o[9]=f=>q.value=f)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var kt=K(gt,[["__scopeId","data-v-8786a792"]]);const G=r=>(te("data-v-94757a74"),r=r(),le(),r),qt={class:"subheader",style:{display:"flex","align-items":"center"}},ht=G(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),wt=G(()=>t("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),xt=G(()=>t("div",{class:"caption"},"Sort order",-1)),Ct=G(()=>t("div",{style:{"padding-bottom":"40px"}},null,-1)),$t={class:"add-button-container"},bt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},St=G(()=>t("div",{style:{"font-size":"17px"}},"Add plaque",-1)),Vt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},At=Q({__name:"PlaqueList",setup(r){const s=w(!1),{width:b,screen_type:_}=ge(),q=w(!1),C=ve(),S=fe(),$=Ie(),V=w(""),g=w(localStorage.getItem("plaque_list_filter_by_gallery")||"");R(g,i=>{localStorage.setItem("plaque_list_filter_by_gallery",i)});const u=w(localStorage.getItem("online_filter")==="true"||!1);R(u,i=>{if(i){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const k=w(localStorage.getItem("plaque_list_sort_order")||"name");R(k,i=>{localStorage.setItem("plaque_list_sort_order",i)});const I=W(),U=async()=>{s.value=!0,await Se({name:"Test Plaque",user_id:S.get_account.id,token_meta_id_list:[],created_at:F.now(),updated_at:F.now(),orientation:Pe.Landscape,command:{type:"",time_sent:F.fromMillis(0)},last_check_in_time:F.fromMillis(0),vpn_active:!1,machine_data:{machine_name:"",version:"",local_ip:"",public_ip:"",updated_at:F.fromMillis(0)}}).catch(i=>T({message:`Error creating test plaque- ${i}`,type:"error",showClose:!0,duration:12e3})),s.value=!1,q.value=!1},h=P(()=>JSON.parse(JSON.stringify(I.all_plaque_list)).sort((l,n)=>{const o=l.entity.name.toLowerCase(),p=n.entity.name.toLowerCase();return o<p?-1:o>p?1:0})),N=P(()=>{let i=[...h.value];return i=i.filter(l=>l.entity.name||l.entity.user_id||l.entity.token_meta_id_list.length>0),g.value&&(i=i.filter(l=>{var n;return(n=$.gallery_list.find(o=>o.id==g.value))==null?void 0:n.entity.plaque_id_list.includes(l.id)})),u.value&&(i=i.filter(l=>ye(l))),k.value=="name"?i=i.sort((l,n)=>l.entity.name.localeCompare(n.entity.name)):k.value=="last_check_in_time"&&(i=i.sort((l,n)=>l.entity.last_check_in_time==null&&n.entity.last_check_in_time==null?0:l.entity.last_check_in_time==null?1:n.entity.last_check_in_time==null?-1:n.entity.last_check_in_time.seconds-l.entity.last_check_in_time.seconds)),V.value?i.filter(l=>l.entity.name.toLowerCase().includes(V.value.toLowerCase())):i});return(i,l)=>{const n=d("el-input"),o=d("el-button"),p=d("el-option"),E=d("el-select"),O=d("el-switch"),H=d("el-popover"),X=d("Plus"),Y=d("el-icon"),M=d("el-dialog");return c(),x(j,null,[t("div",qt,[e(n,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=m=>V.value=m),"prefix-icon":y(be),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),e(H,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:a(()=>[e(o,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:a(()=>[v("Filters")]),_:1})]),default:a(()=>[ht,e(E,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=m=>g.value=m),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:a(()=>[e(p,{label:"All plaques",value:""}),(c(!0),x(j,null,Z(y($).gallery_list,m=>(c(),L(p,{key:m.id,label:`${m.entity.name}`,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),wt,e(O,{modelValue:u.value,"onUpdate:modelValue":l[2]||(l[2]=m=>u.value=m),style:{"margin-bottom":"1em"}},null,8,["modelValue"]),xt,e(E,{modelValue:k.value,"onUpdate:modelValue":l[3]||(l[3]=m=>k.value=m),placeholder:"Sort by",class:"filter-select"},{default:a(()=>[e(p,{label:"Sort by name",value:"name"}),e(p,{label:"Sort by last activity",value:"last_check_in_time"})]),_:1},8,["modelValue"])]),_:1}),e(o,{icon:"Camera",type:"info",onClick:l[4]||(l[4]=m=>y(C).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:a(()=>[v("Scan")]),_:1})]),Ct,(c(!0),x(j,null,Z(y(N),m=>(c(),L(kt,{plaque:m,key:m.id},null,8,["plaque"]))),128)),t("div",$t,[t("div",bt,[t("div",{class:"add-button",onClick:l[5]||(l[5]=m=>q.value=!0)},[e(Y,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:a(()=>[e(X)]),_:1}),St])])]),e(M,{modelValue:q.value,"onUpdate:modelValue":l[7]||(l[7]=m=>q.value=m),title:"Add plaque",width:y(_)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:a(()=>[t("div",Vt,[e(o,{onClick:l[6]||(l[6]=m=>{y(C).push("qr-scan"),q.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:a(()=>[v("Scan Plaque QR Code")]),_:1}),e(o,{icon:"plus",onClick:U,loading:s.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:a(()=>[v("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Jt=K(At,[["__scopeId","data-v-94757a74"]]);export{Jt as default};
