import{c as I}from"./token-meta.25680619.js";import{k as L,r as P,l as j,j as B,B as O,T as G,u as J,s as b}from"./account.011f6697.js";import{p as R,d as z,k as p,J as $,r as d,o as V,f as x,w as t,h as o,g as C,j as k,t as T,i as w,I as H}from"./index.88ec2767.js";const K=L(),Q=async(v,_,e,u)=>{console.log("uploadFile - starting file upload for ",v);const h=P(K,v);j(h,_).on("state_changed",n=>{console.log("snapshot",n.bytesTransferred,n.totalBytes),e(n.bytesTransferred/n.totalBytes)},n=>{console.log("uploadFile error - ",n),R({message:`Error uploading file to moda archive - ${n}`,type:"error",showClose:!0,duration:12e3})},u)};const W=k("Ethereum"),X=k("Off-chain"),Y=w("div",{class:"el-upload__text"},[k(" Drop file here or "),w("em",null,"click to upload")],-1),le=z({__name:"SubmitTokenForm",setup(v){const _=p();p();const e=$({name:"",artist:"",description:"",public_link:"",created_at:B.now(),updated_at:B.now(),media_id:"",media_type:"",wallet_address:"",blockchain:O.Ethereum,asset_contract_address:"",token_id:"",platform:G.Archive}),u=p([]),h=$({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),m=p(!1),n=p("0%"),U=J(),q=(c,l)=>H.confirm(`Cancel the upload of ${c.name} ?`).then(()=>!0,()=>!1),S=()=>{},A=async c=>{var g;if(!c){b("Error finding form element");return}if(!await c.validate(i=>i))return;if(e.wallet_address=U.get_account.entity.wallet_address,e.blockchain!="ethereum"&&(e.asset_contract_address="",e.token_id=""),((g=u==null?void 0:u.value)==null?void 0:g.length)!==1){b("Please add a file to upload");return}const a=u.value[0],r=i=>{n.value=`${Math.round(i*100)}%`},f=()=>{E(c,a)};m.value=!0;const y=`${a.uid}.${a.name.split(".").pop()}`;Q(y,a.raw,r,f).catch(i=>{console.error(i),m.value=!1,b(`Error uploading file to moda archive - ${i}`)})},E=(c,l)=>{e.media_id=`${l.uid}`,e.media_type=`.${l.name.split(".").pop()}`,console.log("upload success, sending form: ",e),I(e).then(a=>{c.resetFields(),u.value=[],R({type:"success",message:"Successfully submitted token"})}).catch(a=>{b(`Error uploading metadata to moda archive - ${a}`)}).finally(()=>m.value=!1)};return(c,l)=>{const a=d("el-input"),r=d("el-form-item"),f=d("el-radio"),y=d("el-radio-group"),g=d("upload-filled"),i=d("el-icon"),F=d("el-upload"),D=d("Loading"),M=d("el-button"),N=d("el-form");return V(),x(N,{ref_key:"formRef",ref:_,model:e,rules:h,"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:t(()=>[o(r,{label:"Artwork title",style:{"max-width":"550px"},prop:"name"},{default:t(()=>[o(a,{modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=s=>e.name=s)},null,8,["modelValue"])]),_:1}),o(r,{label:"Artist name",style:{"max-width":"550px"},prop:"artist"},{default:t(()=>[o(a,{modelValue:e.artist,"onUpdate:modelValue":l[1]||(l[1]=s=>e.artist=s)},null,8,["modelValue"])]),_:1}),o(r,{label:"Blockchain"},{default:t(()=>[o(y,{modelValue:e.blockchain,"onUpdate:modelValue":l[2]||(l[2]=s=>e.blockchain=s)},{default:t(()=>[o(f,{label:"ethereum"},{default:t(()=>[W]),_:1}),o(f,{label:"off_chain"},{default:t(()=>[X]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.blockchain=="ethereum"?(V(),x(r,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:t(()=>[o(a,{modelValue:e.asset_contract_address,"onUpdate:modelValue":l[3]||(l[3]=s=>e.asset_contract_address=s)},null,8,["modelValue"])]),_:1})):C("",!0),e.blockchain=="ethereum"?(V(),x(r,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:t(()=>[o(a,{modelValue:e.token_id,"onUpdate:modelValue":l[4]||(l[4]=s=>e.token_id=s)},null,8,["modelValue"])]),_:1})):C("",!0),o(r,{label:"Description",prop:"description"},{default:t(()=>[o(a,{modelValue:e.description,"onUpdate:modelValue":l[5]||(l[5]=s=>e.description=s),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),o(r,{label:"Public Link",prop:"public_link"},{default:t(()=>[o(a,{modelValue:e.public_link,"onUpdate:modelValue":l[6]||(l[6]=s=>e.public_link=s)},null,8,["modelValue"])]),_:1}),o(r,null,{default:t(()=>[o(F,{class:"upload-demo","auto-upload":!1,action:"","on-remove":S,"before-remove":q,limit:1,drag:"","file-list":u.value},{default:t(()=>[o(i,{class:"el-icon--upload"},{default:t(()=>[o(g)]),_:1}),Y]),_:1},8,["file-list"])]),_:1}),o(r,null,{default:t(()=>[o(M,{onClick:l[7]||(l[7]=s=>A(_.value)),loading:m.value},{loading:t(()=>[o(i,{class:"is-loading",style:{"margin-right":"4px"}},{default:t(()=>[o(D)]),_:1}),k(" "+T(n.value),1)]),default:t(()=>[w("div",null,T(m.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});export{le as _};
