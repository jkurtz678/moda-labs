import{c as F}from"./token-meta.7df024e4.js";import{bS as N,bT as O,bU as P,d as z,t as _,S as C,bV as B,a as G,u as H,o as K,E as j,b as h,r as u,c as w,y as J,f as t,h as l,w as a,z as k,e as R,T as U,P as v,G as Q,V as W}from"./index.832a58bc.js";const X=N(),Y=async(y,g,o,i)=>{console.log("uploadFile - starting file upload for ",y);const V=O(X,y);P(V,g).on("state_changed",c=>{console.log("snapshot",c.bytesTransferred,c.totalBytes),o(c.bytesTransferred/c.totalBytes)},c=>{console.log("uploadFile error - ",c)},()=>{console.log("SUCCESS CALLBACK"),i()})};const Z={style:{padding:"20px"}},ee=k("h1",{style:{"margin-bottom":"15px"}},"SUBMIT TO MODA ARCHIVES",-1),oe=v("Ethereum"),te=v("Off-chain"),le=k("div",{class:"el-upload__text"},[v(" Drop file here or "),k("em",null,"click to upload")],-1),ae=k("div",null,"SUBMIT",-1),re=z({setup(y){const g=_();_();const o=C({name:"",artist:"",description:"",public_link:"",created_at:B.now(),updated_at:B.now(),media_id:"",media_type:"",account_id:"",blockchain:"ethereum",asset_contract_address:"",token_id:""}),i=_([]),V=C({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),p=_(!1),c=_("0%"),A=G(),x=H();K(async()=>{const d=window.localStorage.getItem("account_address"),e=window.localStorage.getItem("account_signature");if(d==null||e==null){A.push({name:"login"});return}const s=j.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await x.loadAccount(d,e),o.account_id=x.get_account.id}catch(r){h({message:`Error loading moda archive account - ${r}`,type:"error",showClose:!0,duration:12e3})}finally{s.close()}});const T=(d,e)=>W.confirm(`Cancel the upload of ${d.name} ?`).then(()=>!0,()=>!1),$=()=>{},q=async d=>{var b;if(!d){console.log("SubmitView.vue Submit - formRef is null");return}if(!await d.validate(m=>m))return;if(p.value=!0,((b=i==null?void 0:i.value)==null?void 0:b.length)!==1){console.log("file_list error",i.value);return}const s=i.value[0],r=m=>{console.log("Progress",m),c.value=`${Math.round(m*100)}%`},f=()=>{E(d,s)};Y(`${s.uid||""}`,s.raw,r,f).catch(m=>{console.error(m)})},E=(d,e)=>{o.media_id=`${(e==null?void 0:e.uid)||""}`,o.media_type=`.${e.name.split(".").pop()||""}`,console.log("upload success, sending form: ",o),F(o).then(s=>{d.resetFields(),i.value=[],p.value=!1,h({type:"success",message:"Successfully submitted token"})}).catch(s=>{p.value=!1,h({message:`Error uploading to moda archive - ${s}`,type:"error",showClose:!0,duration:12e3})})};return(d,e)=>{const s=u("el-input"),r=u("el-form-item"),f=u("el-radio"),b=u("el-radio-group"),m=u("upload-filled"),S=u("el-icon"),M=u("el-upload"),L=u("Loading"),I=u("el-button"),D=u("el-form");return w(),J("div",Z,[ee,t(D,{ref_key:"formRef",ref:g,model:l(o),rules:l(V),"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:a(()=>[t(r,{label:"Artwork title",style:{"max-width":"550px"},prop:"name"},{default:a(()=>[t(s,{modelValue:l(o).name,"onUpdate:modelValue":e[0]||(e[0]=n=>l(o).name=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist name",style:{"max-width":"550px"},prop:"artist"},{default:a(()=>[t(s,{modelValue:l(o).artist,"onUpdate:modelValue":e[1]||(e[1]=n=>l(o).artist=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"Blockchain"},{default:a(()=>[t(b,{modelValue:l(o).blockchain,"onUpdate:modelValue":e[2]||(e[2]=n=>l(o).blockchain=n)},{default:a(()=>[t(f,{label:"ethereum"},{default:a(()=>[oe]),_:1}),t(f,{label:"off_chain"},{default:a(()=>[te]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(o).blockchain=="ethereum"?(w(),R(r,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:a(()=>[t(s,{modelValue:l(o).asset_contract_address,"onUpdate:modelValue":e[3]||(e[3]=n=>l(o).asset_contract_address=n)},null,8,["modelValue"])]),_:1})):U("",!0),l(o).blockchain=="ethereum"?(w(),R(r,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:a(()=>[t(s,{modelValue:l(o).token_id,"onUpdate:modelValue":e[4]||(e[4]=n=>l(o).token_id=n)},null,8,["modelValue"])]),_:1})):U("",!0),t(r,{label:"Description",prop:"description"},{default:a(()=>[t(s,{modelValue:l(o).description,"onUpdate:modelValue":e[5]||(e[5]=n=>l(o).description=n),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(r,{label:"Public Link",prop:"public_link"},{default:a(()=>[t(s,{modelValue:l(o).public_link,"onUpdate:modelValue":e[6]||(e[6]=n=>l(o).public_link=n)},null,8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(M,{class:"upload-demo","auto-upload":!1,action:"","on-remove":$,"before-remove":T,limit:1,drag:"","file-list":i.value},{default:a(()=>[t(S,{class:"el-icon--upload"},{default:a(()=>[t(m)]),_:1}),le]),_:1},8,["file-list"])]),_:1}),t(r,null,{default:a(()=>[t(I,{onClick:e[7]||(e[7]=n=>q(g.value)),loading:p.value},{loading:a(()=>[t(S,{class:"is-loading",style:{"margin-right":"4px"}},{default:a(()=>[t(L)]),_:1}),v(" "+Q(c.value),1)]),default:a(()=>[ae]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}});export{re as default};
