import{u as X,g as Y,a as Z}from"./account.d272c1e7.js";import{u as ee}from"./token-meta.8a5be8d1.js";import{u as le,a as te,s as ae}from"./gallery.20e01a76.js";import{h as D}from"./firebaseConfig.bef60b65.js";import{_ as oe,d as se,r as u,K as ne,c as b,l as re,e as N,i as t,w as o,f as d,u as ie,a as ue,b as _,o as U,k as r,j as B,N as q,h as de,t as x,q as I,B as _e,C as ce}from"./index.824ac28a.js";import{s as c}from"./util.2fec33bc.js";import{u as me}from"./breakpoints.5692341f.js";import{u as pe}from"./plaque.dafcc6a0.js";import"./types.01590581.js";import"./plaque.8894ab7b.js";const p=f=>(_e("data-v-0d317216"),f=f(),ce(),f),fe={class:"gallery-dialog"},ve=p(()=>r("div",null,"Gallery Name",-1)),ye=p(()=>r("div",{class:"header"},"Users",-1)),ge={key:0},he={style:{display:"flex","align-items":"center",padding:"1em 0em","max-width":"350px"}},ke=p(()=>r("div",{class:"header"},"Plaque",-1)),we=p(()=>r("div",{class:"header"},"Artwork",-1)),be={class:"dialog-footer"},qe=p(()=>r("div",{style:{"flex-grow":"1"}},null,-1)),xe=se({__name:"GalleryDetailDialog",setup(f){const S=u(!0),a=u({name:"",user_id_list:[],plaque_id_list:[],token_meta_id_list:[],created_at:D.now(),updated_at:D.now()}),C=u(),P=ne({name:[{required:!0,message:"Required",trigger:"blur"}]}),h=u(!1),v=u(""),y=ie(),g=ue(),E=u(),V=u(),G=X(),$=pe(),R=le(),A=ee(),{screen_type:T}=me(),m=u([]),j=b(()=>a.value.user_id_list.map(l=>m.value.find(e=>e.id==l))),M=b(()=>Object.values($.plaque_map)),z=b(()=>Object.values(A.all_token_metas));re(async()=>{if(g.params.gallery_id){const l=R.gallery_list.find(e=>e.id===g.params.gallery_id);if(!l){c("Gallery not found"),y.push({name:"gallery-list"});return}a.value=l.entity,console.log("gallery.value",a.value),await Y(a.value.user_id_list).then(e=>{console.log("accounts"),e.forEach(s=>{m.value.push(s)})}).catch(e=>{c(e)}),a.value.plaque_id_list.forEach(e=>{E.value.toggleRowSelection($.plaque_map[e],!0)}),a.value.token_meta_id_list.forEach(e=>{V.value.toggleRowSelection(A.all_token_metas[e],!0)})}else m.value.push(G.get_account),a.value.user_id_list=[G.get_account.id]});const O=l=>{a.value.plaque_id_list=l.map(e=>e.id)},K=l=>{a.value.token_meta_id_list=l.map(e=>e.id)},L=async l=>{if(!l){c("Error finding form element");return}if(!!await l.validate(s=>s)){if(h.value=!0,g.params.gallery_id){await te(g.params.gallery_id,a.value).then(()=>{I.success("Gallery updated"),y.push({name:"gallery-list"})}).catch(s=>{c(s)}).finally(()=>{h.value=!1});return}ae(a.value).then(()=>{I({message:"Gallery saved",type:"success"}),y.push({name:"gallery-list"})}).catch(s=>{c(`Error saving gallery: ${s}`)}).finally(()=>{h.value=!1})}},F=async()=>{if(m.value.find(l=>l.entity.email===v.value)){c("User already added");return}await Z(v.value).then(l=>{l&&(m.value.push(l),a.value.user_id_list.push(l.id))}).catch(l=>{console.log(l),c("Invalid email")})},H=l=>{a.value.user_id_list.splice(l,1),m.value.splice(l,1)};return(l,e)=>{const s=_("el-input"),J=_("el-form-item"),i=_("el-table-column"),k=_("el-button"),w=_("el-row"),Q=_("el-form"),W=_("el-dialog");return U(),N("div",fe,[t(W,{modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=n=>S.value=n),title:"Edit Gallery",onClose:e[4]||(e[4]=n=>d(y).push({name:"gallery-list"})),top:"2vh",width:"75%",fullscreen:d(T)=="xs"},{footer:o(()=>[r("div",be,[qe,t(k,{color:"#000000",onClick:e[2]||(e[2]=n=>L(C.value))},{default:o(()=>[B("Save")]),_:1})])]),default:o(()=>[t(Q,{ref_key:"form_ref",ref:C,model:a.value,rules:P},{default:o(()=>[t(J,{prop:"name",style:{"max-width":"280px","margin-bottom":"2em"}},{default:o(()=>[ve,t(s,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.name=n),placeholder:"Name"},null,8,["modelValue"])]),_:1}),t(w,{style:{display:"block","margin-bottom":"2em"}},{default:o(()=>[ye,t(d(q),{data:d(j),style:{width:"100%"}},{default:o(()=>[t(i,{prop:"entity.email",label:"Email"}),t(i,{fixed:"right",label:"",width:"50"},{default:o(n=>[n.$index?(U(),N("div",ge,[t(k,{link:"",type:"primary",size:"small",icon:"close",onClick:Se=>H(n.$index)},null,8,["onClick"])])):de("",!0)]),_:1})]),_:1},8,["data"]),r("div",null,x(`Users in gallery: ${a.value.user_id_list.length}`),1),r("div",he,[t(s,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n),placeholder:"Email"},null,8,["modelValue"]),t(k,{icon:"Plus",color:"#000000",size:"small",style:{"margin-left":"1em"},onClick:F},{default:o(()=>[B(" Add user ")]),_:1})])]),_:1}),t(w,{style:{"margin-bottom":"2em"}},{default:o(()=>[ke,t(d(q),{ref_key:"plaque_table_ref",ref:E,data:d(M),style:{width:"100%"},onSelectionChange:O},{default:o(()=>[t(i,{type:"selection"}),t(i,{prop:"entity.name",label:"Name"})]),_:1},8,["data"]),r("div",null,x(`Plaques in gallery: ${a.value.plaque_id_list.length}`),1)]),_:1}),t(w,null,{default:o(()=>[we,t(d(q),{ref_key:"token_meta_table_ref",ref:V,data:d(z),style:{width:"100%"},onSelectionChange:K},{default:o(()=>[t(i,{type:"selection"}),t(i,{prop:"entity.name",label:"Title"}),t(i,{prop:"entity.artist",label:"Artist"}),t(i,{prop:"entity.platform",label:"Platform"})]),_:1},8,["data"]),r("div",null,x(`Artwork in gallery: ${a.value.token_meta_id_list.length}`),1)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","fullscreen"])])}}});var Ie=oe(xe,[["__scopeId","data-v-0d317216"]]);export{Ie as default};
