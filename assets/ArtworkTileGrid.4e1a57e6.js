import{d as O,Q as ne,S as oe,r as A,o as d,h as g,F as U,K,l as L,f as s,T as le,j as N,t as S,U as ae,V as se,q as Y,B as J,_ as X,u as Z,M as ie,c as W,b as P,k as T,n as q,i as y,w as D,W as I,e as G,g as j,A as re,z as Q,L as ce,p as ue,m as de}from"./index.8bc644f9.js";import{a as me}from"./thumbnail-image.fcbb8ee8.js";import{c as pe,d as _e}from"./types.3cc10997.js";import{s as fe}from"./util.fdfdfe9a.js";import{u as ke}from"./account.790d6438.js";import{f as ve}from"./token-meta.16ce217f.js";import{u as ee}from"./gallery.4ab3f093.js";import{u as te}from"./breakpoints.e96a7158.js";import{u as he}from"./token-meta.4f908b57.js";import{A as ye}from"./ArtworkFilters.d94128ef.js";import"./firebaseConfig.4bdd3a5f.js";import"./gallery-token.25579f23.js";const ge={columnWidth:400,gap:0,keyMapper:(l,o,E,x)=>x,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:l,columnWidth:o,emit:E,gap:x,items:i,maxColumns:r,minColumns:p,nextTick:w,onBeforeUnmount:z,onMounted:v,rtl:$,scrollContainer:B,ssrColumns:M,vue:R,wall:C,watch:H}){function a(t,n,k,V){const F=c(k);return V+n+F<=t?a(t,n,k+1,V+n+F):k}function c(t){const n=Array.isArray(o.value)?o.value:[o.value];return n[t%n.length]}function _(){const t=a(C.value.getBoundingClientRect().width,x.value,0,-x.value),n=e(h(t));return n>0?n:1}function h(t){const n=r==null?void 0:r.value;return n&&t>n?n:t}function e(t){const n=p==null?void 0:p.value;return n&&t<n?n:t}function u(t){return[...new Array(t)].map(()=>[])}if(M.value>0){const t=u(M.value);i.value.forEach((n,k)=>t[k%M.value].push(k)),l.value=t}async function m(t){if(t>=i.value.length)return;await w();const n=[...C.value.children];$.value&&n.reverse();const k=n.reduce((V,F)=>F.getBoundingClientRect().height<V.getBoundingClientRect().height?F:V);l.value[+k.dataset.index].push(t),await m(t+1)}async function f(t=!1){if(l.value.length===_()&&!t){E(R===2?"redraw-skip":"redrawSkip");return}l.value=u(_());const n=B==null?void 0:B.value,k=n?n.scrollTop:window.scrollY;await m(0),n?n.scrollBy({top:k-n.scrollTop}):window.scrollTo({top:k}),E("redraw")}const b=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>f());return v(()=>{f(),b==null||b.observe(C.value)}),z(()=>b==null?void 0:b.unobserve(C.value)),H([i,$],()=>f(!0)),H([o,x,p,r],()=>f()),{getColumnWidthTarget:c}}const xe=["data-index"],Ce=O({__name:"masonry-wall",props:ne({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ge),emits:["redraw","redrawSkip"],setup(l,{emit:o}){const E=l,{columnWidth:x,items:i,gap:r,rtl:p,ssrColumns:w,scrollContainer:z,minColumns:v,maxColumns:$,keyMapper:B}=oe(E),M=A([]),R=A(),{getColumnWidthTarget:C}=we({columns:M,columnWidth:x,emit:o,gap:r,items:i,keyMapper:B,maxColumns:$,minColumns:v,nextTick:ae,onBeforeUnmount:se,onMounted:Y,rtl:p,scrollContainer:z,ssrColumns:w,vue:3,wall:R,watch:J});return(H,a)=>(d(),g("div",{ref_key:"wall",ref:R,class:"masonry-wall",style:L({display:"flex",gap:`${s(r)}px`})},[(d(!0),g(U,null,K(M.value,(c,_)=>(d(),g("div",{key:_,class:"masonry-column","data-index":_,style:L({display:"flex","flex-basis":`${s(C)(_)}px`,"flex-direction":"column","flex-grow":1,gap:`${s(r)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(d(!0),g(U,null,K(c,(h,e)=>(d(),g("div",{key:s(B)(s(i)[h],_,e,h),class:"masonry-item"},[le(H.$slots,"default",{item:s(i)[h],column:_,row:e,index:h},()=>[N(S(s(i)[h]),1)])]))),128))],12,xe))),128))],4))}}),be=(()=>{const l=Ce;return l.install=o=>{o.component("MasonryWall",l)},l})();const Te=["src"],Be={class:"header"},Ee={class:"platform"},Me={style:{"font-size":"1.6em","font-weight":"bold"}},Ae={key:1,style:{"font-weight":"bold"}},$e={key:2,style:{display:"flex","align-items":"center"}},Se={key:2,style:{"font-size":"0.8em","padding-left":"1em",color:"#606266"}},De={key:3,style:{height:"32px"}},ze={style:{"font-size":"0.9em","line-height":"1.3em"}},Re={style:{margin:"10px 0px"}},He=O({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(l){const o=l,E=Z(),x=me(ie(o,"token_meta")),i=A(!1),r=A(0),p=A(),w=A(),z=ke(),v=ee(),{screen_type:$}=te(),B=W(()=>pe(o.token_meta.entity.platform)),M=async()=>{const e=await _e(o.token_meta);if(!e){fe("Error getting source file");return}window.open(e,"_blank")},R=W(()=>o.token_meta.entity.aspect_ratio?o.column_width/o.token_meta.entity.aspect_ratio:o.column_width),C=W(()=>{var b,t;const e=(t=(b=o.token_meta)==null?void 0:b.entity)==null?void 0:t.media_size;if(!e)return"";const u=1e3,m=u*1e3,f=m*1e3;return e<u?`${e} B`:e<m?`${(e/u).toFixed(2)} KB`:e<f?`${(e/m).toFixed(2)} MB`:`${(e/f).toFixed(2)} GB`}),H=()=>{const e=E.resolve({name:"preview-plaque",params:{token_meta_id:o.token_meta.id}});window.open(e.href)},a=()=>{window.open(o.token_meta.entity.public_link,"_blank")},c=()=>{window.open(o.token_meta.entity.artist_social_link,"_blank")};function _(){if(!p.value){console.log("animateDivHeight - error finding tile container");return}if(!i.value&&r.value==0&&(r.value=p.value.offsetHeight),i.value=!i.value,!w.value){console.log("animateDivHeight - error finding detail container");return}let e;i.value&&w.value.offsetHeight>r.value?e=w.value.offsetHeight:e=r.value;const u=300,m=10,f=p.value.offsetHeight,b=Math.ceil(e-f),t=Math.ceil(u/m),n=b/t;let k=0;const V=setInterval(()=>{if(k>=t){p.value.style.height=e+"px",clearInterval(V);return}k++;const F=f+n*k;p.value.style.height=F+"px"},m)}const h=()=>{re.prompt(`Are you sure you want to delete ${o.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:e})=>{if(e)return ve(o.token_meta.id)}).then(()=>{Q({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(e=>{Q({message:`Error deleting artwork - ${e}`,type:"error",showClose:!0,duration:12e3})})};return(e,u)=>{const m=P("el-button"),f=P("el-tooltip");return d(),g("div",{ref_key:"tile_container",ref:p,class:"custom-card",onClick:_,style:L(`height: ${s(R)}px !important`)},[T("img",{class:q(i.value?"absolute":""),src:s(x)},null,10,Te),T("div",{class:q([i.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),T("div",{class:q(["transition absolute",i.value?"hide-blur":"show-blur"])},[T("div",Be,S(`${l.token_meta.entity.name} | ${l.token_meta.entity.artist}`),1),T("div",Ee,S(s(B)),1)],2),T("div",{ref_key:"detail_container",ref:w,class:q(["detail-container transition",i.value?"show-blur":"hide-blur"])},[T("div",Me,S(l.token_meta.entity.name),1),l.token_meta.entity.artist_social_link?(d(),g("div",{key:0,style:L(s($)=="xs"?"display: flex; justify-content: center;":"")},[y(m,{link:"",style:{"font-weight":"bold",display:"block"},disabled:!i.value,onClick:I(c,["stop"])},{default:D(()=>[N(S(l.token_meta.entity.artist),1)]),_:1},8,["disabled","onClick"])],4)):(d(),g("div",Ae,S(l.token_meta.entity.artist),1)),i.value?(d(),g("div",$e,[y(f,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:D(()=>[y(m,{icon:"Edit",text:"",circle:"",onClick:u[0]||(u[0]=I(b=>s(E).push({name:"edit-artwork",params:{token_meta_id:o.token_meta.id}}),["stop"]))})]),_:1}),y(f,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:D(()=>[y(m,{icon:"Download",text:"",circle:"",onClick:I(M,["stop"])},null,8,["onClick"])]),_:1}),y(f,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:D(()=>[y(m,{icon:"Tickets",text:"",circle:"",onClick:I(H,["stop"])},null,8,["onClick"])]),_:1}),l.token_meta.entity.public_link?(d(),G(f,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:D(()=>[y(m,{icon:"Link",text:"",circle:"",onClick:I(a,["stop"])},null,8,["onClick"])]),_:1})):j("",!0),s(z).is_user_admin?(d(),G(f,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:D(()=>[y(m,{icon:"Delete",text:"",circle:"",onClick:I(h,["stop"])},null,8,["onClick"])]),_:1})):j("",!0),s(C)?(d(),g("span",Se,S(s(C)),1)):j("",!0)])):(d(),g("div",De)),T("div",ze,S(l.token_meta.entity.description),1),T("div",Re,[(d(!0),g(U,null,K(s(v).token_id_to_gallery_map.get(o.token_meta.id),b=>(d(),G(m,{size:"small",round:"",plain:"",type:"primary",style:{margin:"3px 10px 3px 0px"}},{default:D(()=>[N(S(b.entity.name),1)]),_:2},1024))),256))])],2)],4)}}});var Ve=X(He,[["__scopeId","data-v-6af94bbb"]]);const Fe=l=>(ue("data-v-0fdc092a"),l=l(),de(),l),We=Fe(()=>T("div",{style:{"padding-bottom":"90px"}},null,-1)),Ie={key:1,style:{padding:"1em"}},Le=O({__name:"ArtworkTileGrid",setup(l){const o=Z(),E=he();ee();const x=A(null),i=30,r=A(i),p=A([]),w=A("");J(w,a=>{r.value=i});const z=250,v=10,{screen_type:$}=te(),B=W(()=>{switch($.value){case"xs":return 340-v*2;case"sm":return 650-v*2;case"md":return 960-v*2;case"lg":return 1200-v*2;case"xl":return 1700-v*2}return 0}),M=W(()=>{let a=Math.floor(B.value/(z+v));return a>5&&(a=5),(B.value-(a-1)*v)/a}),R=W(()=>E.sorted_all_token_metas.filter(a=>Boolean(a.entity.aspect_ratio))),C=W(()=>{const a=p.value,c=0,_=c+r.value;return a.slice(c,_)});Y(()=>{const a=document.getElementById("masonry-container");if(!a){console.log("ArtworkTileGrid error, masonary_wall element not found");return}a.addEventListener("scroll",()=>{const c=a.scrollTop,_=a.scrollHeight,h=a.clientHeight;c/(_-h)*100>90&&r.value<p.value.length&&(r.value=r.value+20)})});const H=a=>{console.log("updateFilteredTokens",a),p.value=a};return(a,c)=>{const _=P("el-input"),h=P("el-button"),e=P("RouterView");return d(),g(U,null,[T("div",{class:"subheader",style:L([{display:"flex","align-items":"center"},s($)=="xs"?"padding: 0px 8px 10px;":""])},[y(_,{modelValue:w.value,"onUpdate:modelValue":c[0]||(c[0]=u=>w.value=u),"prefix-icon":s(ce),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),y(ye,{all_tokens:s(R),search_filter:w.value,use_local_storage:!0,onUpdateFilteredTokens:c[1]||(c[1]=u=>H(u))},null,8,["all_tokens","search_filter"]),y(h,{icon:"Plus",type:"info",onClick:c[2]||(c[2]=u=>s(o).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:D(()=>[N("Artwork")]),_:1})],4),We,T("div",{id:"masonry-container",ref_key:"masonryContainer",ref:x,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[s(C).length>0?(d(),G(s(be),{key:0,id:"masonary-wall","scroll-container":x.value,items:s(C),"column-width":z,gap:v,style:L(`width: ${s(B)}px; margin: auto`),"max-columns":5},{default:D(({item:u})=>[y(Ve,{token_meta:u,column_width:s(M)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(d(),g("div",Ie,"No artwork found"))],512),y(e)],64)}}});var Ze=X(Le,[["__scopeId","data-v-0fdc092a"]]);export{Ze as default};
