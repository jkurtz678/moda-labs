import{p as m}from"./index.1b8b03fc.js";import{g as _,a as k,b as d,T as u}from"./types.6a5ef88e.js";import{g as h,a as p,b as f}from"./token-meta.2d60a689.js";import{u as y}from"./account.ac2769b1.js";const l="742ea11e1d864fe2b23ac7cfe66a43f7";async function w(e){const t=await fetch(`https://api.opensea.io/api/v1/assets/?owner=${e}`,{headers:{"X-API-KEY":l}}),s=await t.json();return c(t,s),s.assets}const g=async e=>{const t=[];let s="";for(;;){const a=await fetch(`https://api.opensea.io/api/v1/events?account_address=${e}&event_type=created&limit=50${s?"&cursor="+s:""}`,{headers:{"X-API-KEY":l}}),n=await a.json();if(c(a,n),n.asset_events&&t.push(...n.asset_events.map(o=>({...o.asset,creator:o.from_account}))),s=n.next,!s)break}return t},c=(e,t)=>{if(e.status>=400)throw t.detail?t.detail:e.status==429?"Error - opensea rejected request due to rate limiting":"Error loading opensea tokens"},O=m({id:"token-meta",state:()=>({archive_token_meta_list:[],opensea_minted_token_meta_list:[],opensea_wallet_token_meta_list:[],gallery_token_meta_list:[]}),getters:{archive_token_meta_map:e=>{const t={};return e.archive_token_meta_list.forEach(s=>{t[s.id]=s}),t},all_token_metas(e){const t={};return[...e.opensea_minted_token_meta_list,...e.opensea_wallet_token_meta_list].forEach(a=>{const n=v(a);t[n.id]=n}),e.archive_token_meta_list.forEach(a=>{t[_(a)]&&delete t[_(a)],t[a.id]=a}),e.gallery_token_meta_list.forEach(a=>{t[a.id]=a}),t},sorted_all_token_metas(e){return JSON.parse(JSON.stringify(Object.values(this.all_token_metas))).sort((s,a)=>{var i,r;const n=((i=s.entity.artist)==null?void 0:i.toLowerCase())+s.entity.name.toLowerCase(),o=((r=a.entity.artist)==null?void 0:r.toLowerCase())+a.entity.name.toLowerCase();return n<o?-1:n>o?1:0})}},actions:{async loadArchiveTokenMetas(e){if(y().is_user_admin){await h(s=>{this.archive_token_meta_list=s.filter(a=>a.entity.external_media_url||a.entity.media_id)});return}await p(e,s=>{this.archive_token_meta_list=s})},async loadOpenseaMintedTokenMetas(e){await g(e).then(t=>{this.opensea_minted_token_meta_list=t})},async loadOpenseaWalletTokenMetas(e){await w(e).then(t=>{this.opensea_wallet_token_meta_list=t})},async loadGalleryTokenMetas(e){const t=[];e.forEach(a=>{t.push(...a.entity.token_meta_id_list)});const s=[];for(let a=0;a<t.length;a+=10){const n=await f(t.slice(a,a+10));s.push(...n)}this.gallery_token_meta_list=s}}}),v=e=>{var t,s;return{id:k(e),entity:{name:e.name,artist:((s=(t=e.creator)==null?void 0:t.user)==null?void 0:s.username)||"N/A",description:e.description,public_link:e.permalink,blockchain:d.Ethereum,asset_contract_address:e.asset_contract.address,token_id:e.token_id,platform:u.Opensea,external_thumbnail_url:e.image_thumbnail_url,external_media_url:e.animation_url?e.animation_url:e.image_url}}};export{O as u};
