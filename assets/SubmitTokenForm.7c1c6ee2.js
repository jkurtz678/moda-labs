import{b as ee,c as le}from"./gallery-token.7f50acd9.js";import{d as ae,e as te,u as oe}from"./token-meta.3b6b8610.js";import{h as ue,r as re,u as ne,i as q}from"./firebaseConfig.4d01e9b5.js";import{x as h,d as se,r as f,O as ie,m as de,c as me,a as _,w as o,f as i,o as m,j as t,g as b,i as w,u as R,h as pe,H as _e,F as ce,k as E,t as N,_ as ve,y as fe}from"./index.2e5c883b.js";import{a as $,T as ke,P as C}from"./types.903c99bc.js";import{u as be}from"./account.253e5605.js";import{u as ge}from"./token-meta.c417fdfe.js";import{s as g}from"./util.a9a9b314.js";const Ve=ue(),ye=async(S,c,T,l)=>{console.log("uploadFile - starting file upload for ",S);const v=re(Ve,S);ne(v,c).on("state_changed",r=>{console.log("snapshot",r.bytesTransferred,r.totalBytes),T(r.bytesTransferred/r.totalBytes)},r=>{console.log("uploadFile error - ",r),h({message:`Error uploading file to moda archive - ${r}`,type:"error",showClose:!0,duration:12e3})},l)};const we={style:{display:"flex","align-items":"center"}},Ue=se({__name:"SubmitTokenForm",props:{token_meta_id:{}},setup(S){const c=S,T=f();f();const l=f({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:q.now(),updated_at:q.now(),media_id:"",media_type:"",browser_media_url:"",user_id:"",blockchain:$.OffChain,asset_contract_address:"",token_id:"",platform:ke.Archive,permission_to_sell:!1,price:0,price_unit:C.USD}),v=f([]),B=ie({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),r=f(!1),A=f("0%"),U=f([]),F=be(),I=ge(),L=f([]),V=f("file_upload");de(()=>{c.token_meta_id?(l.value={...I.all_token_metas[c.token_meta_id].entity},l.value.price_unit||(l.value.price_unit=C.USD),V.value=l.value.browser_media_url?"browser_link":"file_upload"):ee().then(s=>{L.value=s})});const O=(s,e)=>fe.confirm(`Cancel the upload of ${s.name} ?`).then(()=>!0,()=>!1),y=me({get:()=>l.value.blockchain===$.Ethereum,set:s=>{l.value.blockchain=s?$.Ethereum:$.OffChain}}),G=()=>{},H=async s=>{var u;if(!s){g("Error finding form element");return}if(!await s.validate(d=>d))return;if(l.value.user_id=F.get_account.id,l.value.blockchain!="ethereum"&&(l.value.asset_contract_address="",l.value.token_id=""),c.token_meta_id){Y(c.token_meta_id);return}r.value=!0;const n=await ae().catch(d=>{console.error(d),r.value=!1,g(`Error getting moda archive token meta document - ${d}`)});if(!n){r.value=!1;return}if(V.value==="browser_link"){M(s,n);return}if(((u=v==null?void 0:v.value)==null?void 0:u.length)!==1){g("Please add a file to upload"),r.value=!1;return}await W(s,n)},W=async(s,e)=>{const n=v.value[0];r.value=!0;const u=k=>{A.value=`${Math.round(k*100)}%`},d=()=>{l.value.media_id=`${e.id}`,l.value.media_type=`.${n.name.split(".").pop()}`,M(s,e)},p=`${e.id}.${n.name.split(".").pop()}`;return ye(p,n.raw,u,d).catch(k=>{console.error(k),r.value=!1,g(`Error uploading file to moda archive - ${k}`)})},M=async(s,e)=>{var u;let n;try{n=await te(e,l.value)}catch(d){g(`Error uploading metadata to moda archive - ${d}`),r.value=!1;return}if((u=U.value)!=null&&u.length){const d=U.value.map(p=>({gallery_id:p,token_meta_id:n.id}));await le(d).catch(p=>{g(`Error adding token to gallery - ${p}`),r.value=!1})}s.resetFields(),v.value=[],U.value=[],h({type:"success",message:"Successfully submitted artwork. Please wait a few moments for your artwork to appear."}),r.value=!1},Y=s=>{r.value=!0,oe(s,l.value).then(()=>{h({type:"success",message:"Successfully updated artwork"})}).catch(e=>{g(`Error updating token metadata - ${e}`)}).finally(()=>r.value=!1)};return(s,e)=>{const n=i("el-input"),u=i("el-form-item"),d=i("el-switch"),p=i("el-option"),k=i("el-select"),j=i("el-input-number"),D=i("el-radio"),z=i("el-radio-group"),Q=i("upload-filled"),P=i("el-icon"),J=i("el-upload"),K=i("Loading"),X=i("el-button"),Z=i("el-form");return m(),_(Z,{ref_key:"formRef",ref:T,model:l.value,rules:B,"label-position":"left","label-width":"180px",style:{margin:"0 auto"}},{default:o(()=>[t(u,{label:"Artwork Title",prop:"name"},{default:o(()=>[t(n,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.name=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"Artist Name",prop:"artist"},{default:o(()=>[t(n,{modelValue:l.value.artist,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.artist=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"Plaque Description",prop:"description"},{default:o(()=>[t(n,{modelValue:l.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.description=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(u,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[t(n,{modelValue:l.value.public_link,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.public_link=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"Artist Social Media Link",prop:"artist_social_link"},{default:o(()=>[t(n,{modelValue:l.value.artist_social_link,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.artist_social_link=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"Link to Blockchain"},{default:o(()=>[t(d,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=a=>y.value=a),"active-text":y.value?"Enabled":"Disabled"},null,8,["modelValue","active-text"])]),_:1}),y.value?(m(),_(u,{key:0,label:"Blockchain",prop:"blockchain"},{default:o(()=>[t(k,{modelValue:l.value.blockchain,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.blockchain=a)},{default:o(()=>[t(p,{label:"Ethereum",value:"ethereum"})]),_:1},8,["modelValue"])]),_:1})):b("",!0),y.value?(m(),_(u,{key:1,label:"Contract Address",prop:"asset_contract_address"},{default:o(()=>[t(n,{modelValue:l.value.asset_contract_address,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.asset_contract_address=a)},null,8,["modelValue"])]),_:1})):b("",!0),y.value?(m(),_(u,{key:2,label:"Token ID",prop:"token_id"},{default:o(()=>[t(n,{modelValue:l.value.token_id,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.token_id=a)},null,8,["modelValue"])]),_:1})):b("",!0),t(u,{label:"Are You Willing to Sell This Piece?",class:"sell-piece"},{default:o(()=>[t(d,{modelValue:l.value.permission_to_sell,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.permission_to_sell=a),"active-text":l.value.permission_to_sell?"Yes":"No"},null,8,["modelValue","active-text"])]),_:1}),l.value.permission_to_sell?(m(),_(u,{key:3,label:"Price",prop:"price"},{default:o(()=>[w("div",null,[w("div",we,[t(j,{modelValue:l.value.price,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.price=a),controls:!1,placeholder:"No Price",style:{"max-width":"133px"}},null,8,["modelValue"]),t(k,{modelValue:l.value.price_unit,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.price_unit=a),style:{"margin-left":"12px","max-width":"90px"}},{default:o(()=>[t(p,{label:"USD",value:R(C).USD},null,8,["value"]),t(p,{label:"ETH",value:R(C).ETH},null,8,["value"])]),_:1},8,["modelValue"])]),e[17]||(e[17]=w("div",{style:{"font-size":"11px"}},"GALLERY COMISSION RATE IS 33%",-1))])]),_:1})):b("",!0),c.token_meta_id?b("",!0):(m(),_(u,{key:4,label:"Share to Gallery(s)"},{default:o(()=>[t(k,{modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=a=>U.value=a),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(m(!0),pe(ce,null,_e(L.value,a=>(m(),_(p,{key:a.id,label:`${a.entity.name}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),t(u,null,{default:o(()=>{var a;return[((a=R(F).get_account.entity)==null?void 0:a.email)=="jkurtz678@gmail.com"?(m(),_(z,{key:0,modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=x=>V.value=x),disabled:c.token_meta_id},{default:o(()=>[t(D,{value:"file_upload"},{default:o(()=>e[18]||(e[18]=[E("Upload File")])),_:1}),t(D,{value:"browser_link"},{default:o(()=>e[19]||(e[19]=[E("Web Browser Link")])),_:1})]),_:1},8,["modelValue","disabled"])):b("",!0),V.value==="file_upload"&&!c.token_meta_id?(m(),_(J,{key:1,class:"upload-demo","auto-upload":!1,action:"","on-remove":G,"before-remove":O,limit:1,drag:"","file-list":v.value,"onUpdate:fileList":e[14]||(e[14]=x=>v.value=x)},{default:o(()=>[t(P,{class:"el-icon--upload"},{default:o(()=>[t(Q)]),_:1}),e[20]||(e[20]=w("div",{class:"el-upload__text"},[E(" Drop file here or "),w("em",null,"click to upload")],-1))]),_:1},8,["file-list"])):V.value=="browser_link"?(m(),_(n,{key:2,modelValue:l.value.browser_media_url,"onUpdate:modelValue":e[15]||(e[15]=x=>l.value.browser_media_url=x)},null,8,["modelValue"])):b("",!0)]}),_:1}),t(u,null,{default:o(()=>[t(X,{onClick:e[16]||(e[16]=a=>H(T.value)),loading:r.value,color:"#000000"},{loading:o(()=>[t(P,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[t(K)]),_:1}),E(" "+N(A.value),1)]),default:o(()=>[w("div",null,N(r.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});var Be=ve(Ue,[["__scopeId","data-v-44cacd81"]]);export{Be as S};
