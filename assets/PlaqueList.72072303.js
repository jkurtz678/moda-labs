import{_ as M,d as G,r as h,c as V,z as j,b as c,o as _,h as x,i as e,w as a,k as l,t as P,j as f,f as g,A as ce,p as Z,l as ee,x as L,u as pe,e as N,B as re,C as ke,D as qe,g as U,G as he,H as we,F as B,I as X,J as de,K as xe}from"./index.53a82732.js";import{u as F,c as Ce}from"./plaque.093acf64.js";import{c as be}from"./token-meta.2d60a689.js";import{u as H}from"./plaque.b2407d7c.js";import{u as me,g as $e}from"./account.0c809fe0.js";import{s as J,a as fe}from"./util.38c23d05.js";import{T as _e}from"./types.6a5ef88e.js";import{u as ve}from"./breakpoints.98e2eb0f.js";import{u as ye}from"./token-meta.2fff2867.js";import{_ as Ae}from"./TokenSelectList.11fcb49a.js";import{n as Y}from"./firebaseConfig.d7a6b5a9.js";import{_ as Pe}from"./PlaqueTokenItem.a03db4e0.js";import{u as Se}from"./gallery.7227dc8f.js";import"./thumbnail-image.0034c36b.js";import"./gallery.82c2a091.js";const Ve=i=>(Z("data-v-cc2989e6"),i=i(),ee(),i),ze={class:"dialog-container"},Ie={class:"dialog-footer"},Ne=Ve(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Le=G({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(i,{emit:o}){const S=i,d=h([]),k=h(!1),{screen_type:C}=ve(),$=H(),b=ye(),A=me(),y=V({get(){return S.show_add_token_dialog},set(q){o("update:show_add_token_dialog",q)}});j(y,q=>{q&&(d.value=JSON.parse(JSON.stringify(r.value.entity.token_meta_id_list)))});const r=V(()=>$.plaque_map[S.plaque_id]),w=V(()=>b.sorted_all_token_metas),z=async()=>{k.value=!0;try{for(let[q,u]of d.value.entries()){const n=b.all_token_metas[u];if(!n)throw"Failed to find store token for token: "+u;if(n.entity.platform!=_e.Opensea)continue;const s=JSON.parse(JSON.stringify(n));s.entity.user_id=A.get_account.id,s.entity.platform=_e.OpenseaArchive;const t=await be(s.entity);d.value[q]=t.id}await F(S.plaque_id,{token_meta_id_list:d.value}),$.plaque_map[S.plaque_id].entity.token_meta_id_list=d.value}catch(q){J(`Error updating plaque tokens - ${q}`)}k.value=!1,y.value=!1},T=()=>{d.value=[]};return(q,u)=>{const n=c("el-button"),s=c("el-dialog");return _(),x("div",ze,[e(s,{center:"",modelValue:g(y),"onUpdate:modelValue":u[1]||(u[1]=t=>ce(y)?y.value=t:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:g(C)=="xs",top:"2vh"},{footer:a(()=>[l("div",Ie,[l("div",null,P(`Artwork in playlist: ${d.value.length}`),1),Ne,e(n,{onClick:T},{default:a(()=>[f("Clear")]),_:1}),e(n,{type:"info",onClick:z,loading:k.value},{default:a(()=>[f("Save")]),_:1},8,["loading"])])]),default:a(()=>[e(Ae,{selected_token_meta_id_list:d.value,"onUpdate:selected_token_meta_id_list":u[0]||(u[0]=t=>d.value=t),token_meta_list:g(w)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Te=M(Le,[["__scopeId","data-v-cc2989e6"]]);const De={class:"controller-buttons"},Ee=G({__name:"PlaqueController",props:{plaque:null},setup(i){const o=i,S=H(),d=h(!1),k=h(!1),C=h(!1),$=h(!1),b=V({get:()=>o.plaque.entity.orientation||"landscape",set:y=>{F(o.plaque.id,{orientation:y}).then(()=>{S.plaque_map[o.plaque.id].entity.orientation=y,L({type:"success",message:"Plaque orientation updated"})}).catch(r=>{J(`Error updating plaque orientation - ${r}`)})}}),A=y=>{const r={type:y,time_sent:Y.now()};F(o.plaque.id,{command:r}).then(()=>{S.plaque_map[o.plaque.id].entity.command=r,L({type:"success",message:"Command sent to plaque"})}).catch(w=>{J(`Error sending command to plaque - ${w}`)}).finally(()=>{d.value=!1,k.value=!1,C.value=!1,$.value=!1})};return(y,r)=>{const w=c("el-button"),z=c("el-radio"),T=c("el-radio-group");return _(),x("div",null,[l("div",De,[e(w,{circle:"",text:"",loading:d.value,icon:"DArrowLeft",onClick:r[0]||(r[0]=q=>{d.value=!0,A("playlist_previous")})},null,8,["loading"]),e(w,{circle:"",text:"",loading:k.value,icon:"VideoPlay",onClick:r[1]||(r[1]=q=>{k.value=!0,A("play")})},null,8,["loading"]),e(w,{circle:"",text:"",icon:"VideoPause",loading:C.value,onClick:r[2]||(r[2]=q=>{C.value=!0,A("pause")})},null,8,["loading"]),e(w,{circle:"",text:"",icon:"DArrowRight",loading:$.value,onClick:r[3]||(r[3]=q=>{$.value=!0,A("playlist_next")})},null,8,["loading"])]),e(T,{modelValue:g(b),"onUpdate:modelValue":r[4]||(r[4]=q=>ce(b)?b.value=q:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:a(()=>[e(z,{label:"landscape",size:"small"},{default:a(()=>[f("Landscape")]),_:1}),e(z,{label:"portrait",size:"small"},{default:a(()=>[f("Portrait")]),_:1}),e(z,{label:"landscape_reversed",size:"small"},{default:a(()=>[f("Landscape Reversed")]),_:1}),e(z,{label:"portrait_reversed",size:"small"},{default:a(()=>[f("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Ue=M(Ee,[["__scopeId","data-v-100e65c8"]]);const I=i=>(Z("data-v-9eb0ebb8"),i=i(),ee(),i),Fe={style:{display:"flex","align-items":"center",padding:"1em"}},Oe={key:0},Be=I(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Re={class:"card-simple"},je=I(()=>l("hr",null,null,-1)),Je=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Me=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Ge={style:{padding:"0.3em 1em"}},He={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Ke={key:0,class:"card-detail"},Qe={style:{padding:"0 1em"}},We={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},Xe=I(()=>l("hr",null,null,-1)),Ye=I(()=>l("div",{style:{padding:"1em"}},"No artwork added",-1)),Ze=I(()=>l("hr",null,null,-1)),et={style:{display:"flex",padding:"1em"}},tt=I(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),lt={key:0,style:{padding:"1em"}},at={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},nt={key:0},ot=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),st={key:0},it={key:1},ut={style:{"font-size":"var(--el-font-size-extra-small)"}},rt={key:1},dt=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),_t={style:{display:"flex","justify-content":"end"}},ct=G({__name:"PlaqueCard",props:{plaque:null},setup(i){const o=i,S=H();pe();const d=h("simple"),k=h(!1),C=h(!1),$=h(""),b=h(!1),A=async()=>{b.value=!0,await F(o.plaque.id,{name:o.plaque.entity.name}).catch(s=>{J(`Error updating plaque tokens - ${s}`)}),C.value=!1,b.value=!1},y=ye(),r=V(()=>w.value.length==0?null:w.value[0]),w=V(()=>{const s=y.archive_token_meta_map;return o.plaque.entity.token_meta_id_list.map(p=>s[p])}),z=V(()=>fe(o.plaque)),T=V(()=>{const s=o.plaque.entity.last_check_in_time;return s?new Date(s.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):"N/A"}),q=()=>{de.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{F(o.plaque.id,{token_meta_id_list:[]}).then(()=>{S.plaque_map[o.plaque.id].entity.token_meta_id_list=[],L({type:"success",message:"Tokens cleared"})}).catch(s=>{L({message:`Error clearing tokens from plaque - ${s}`,type:"error",showClose:!0,duration:12e3})})})},u=()=>{de.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{F(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{S.plaque_map[o.plaque.id].entity.user_id="",S.plaque_map[o.plaque.id].entity.token_meta_id_list=[],L({type:"success",message:"Plaque forgotten"})}).catch(s=>{L({message:`Error forgetting plaque - ${s}`,type:"error",showClose:!0,duration:12e3})})})};j(d,s=>{s=="settings"&&o.plaque.entity.user_id&&!$.value&&$e(o.plaque.entity.user_id).then(t=>{$.value=t.entity.email}).catch(t=>{L({message:`Error loading user account - ${t}`,type:"error",showClose:!0,duration:12e3})})});const n=V(()=>{var p,D,E;const s=(E=(D=(p=o==null?void 0:o.plaque)==null?void 0:p.entity)==null?void 0:D.machine_data)==null?void 0:E.updated_at;return s?new Date(s.seconds*1e3+s.nanoseconds/1e6).toLocaleString():"N/A"});return(s,t)=>{const p=c("el-button"),D=c("el-tag"),E=c("el-tooltip"),R=c("el-col"),Q=c("el-row"),W=c("ArrowRight"),O=c("el-icon"),m=c("el-collapse-transition"),te=c("Close"),ge=c("el-card");return _(),N(ge,null,{default:a(()=>[l("div",Fe,[C.value?re((_(),x("input",{key:1,"onUpdate:modelValue":t[0]||(t[0]=v=>o.plaque.entity.name=v),class:"edit-name-input"},null,512)),[[ke,o.plaque.entity.name]]):(_(),x("h1",Oe,P(o.plaque.entity.name),1)),C.value?U("",!0):(_(),N(p,{key:2,icon:g(qe),onClick:t[1]||(t[1]=v=>C.value=!0),class:"editIcon",circle:""},null,8,["icon"])),C.value?(_(),N(p,{key:3,icon:g(he),loading:b.value,onClick:A,class:"editIcon",circle:"",type:b.value?"":"success",text:""},null,8,["icon","loading","type"])):U("",!0),Be,e(E,{class:"box-item",effect:"dark",content:`Last activity ${g(T)}`,placement:"top"},{default:a(()=>[g(z)?(_(),N(D,{key:0,class:"ml-2",type:"success"},{default:a(()=>[f("online")]),_:1})):(_(),N(D,{key:1,class:"ml-2",type:"danger"},{default:a(()=>[f("offline")]),_:1}))]),_:1},8,["content"])]),e(m,null,{default:a(()=>[re(l("section",Re,[je,e(Q,{style:{padding:"1em"}},{default:a(()=>[e(R,{span:12},{default:a(()=>{var v;return[Je,l("span",null,P(((v=g(r))==null?void 0:v.entity.name)||"N/A"),1)]}),_:1}),e(R,{span:12},{default:a(()=>{var v;return[Me,f(" "+P(((v=g(r))==null?void 0:v.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),l("div",Ge,P(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),l("div",He,[e(p,{type:"info",onClick:t[2]||(t[2]=v=>k.value=!0)},{default:a(()=>[f("Add Artwork")]),_:1}),e(p,{onClick:t[3]||(t[3]=v=>d.value="detail")},{default:a(()=>[f(" Details"),e(O,{class:"el-icon--right"},{default:a(()=>[e(W)]),_:1})]),_:1})])],512),[[we,d.value=="simple"]])]),_:1}),e(m,null,{default:a(()=>[d.value=="detail"?(_(),x("section",Ke,[l("p",Qe,P(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),l("div",We,[e(p,{onClick:t[4]||(t[4]=v=>d.value="settings")},{default:a(()=>[f("Settings")]),_:1}),e(p,{onClick:q},{default:a(()=>[f("Clear Artwork")]),_:1})]),Xe,g(w).length==0?(_(),x(B,{key:0},[Ye,Ze],64)):U("",!0),(_(!0),x(B,null,X(g(w),v=>(_(),N(Pe,{token_meta:v},null,8,["token_meta"]))),256)),l("div",et,[e(p,{type:"info",onClick:t[5]||(t[5]=v=>k.value=!0)},{default:a(()=>[f("Add Artwork")]),_:1}),tt,e(p,{onClick:t[6]||(t[6]=v=>d.value="simple")},{default:a(()=>[f("Close"),e(O,{class:"el-icon--right"},{default:a(()=>[e(te)]),_:1})]),_:1})])])):U("",!0)]),_:1}),e(m,null,{default:a(()=>{var v,le,ae,ne,oe,se,ie,ue;return[d.value=="settings"?(_(),x("section",lt,[e(Ue,{plaque:o.plaque},null,8,["plaque"]),l("div",at,[i.plaque.entity.user_id?(_(),x("div",nt,[ot,$.value?(_(),x("div",st,P($.value),1)):(_(),x("div",it,"Loading...")),l("div",ut,P(i.plaque.entity.user_id),1)])):(_(),x("div",rt,"No associated user")),i.plaque.entity.user_id?(_(),N(p,{key:2,type:"danger",plain:"",onClick:u},{default:a(()=>[f("Forget Display")]),_:1})):U("",!0)]),l("div",null,[dt,l("div",null,"Machine name: "+P((le=(v=i.plaque.entity.machine_data)==null?void 0:v.machine_name)!=null?le:"N/A"),1),l("div",null,"Version: "+P((ne=(ae=i.plaque.entity.machine_data)==null?void 0:ae.version)!=null?ne:"N/A"),1),l("div",null,"Local IP: "+P((se=(oe=i.plaque.entity.machine_data)==null?void 0:oe.local_ip)!=null?se:"N/A"),1),l("div",null,"Public IP: "+P((ue=(ie=i.plaque.entity.machine_data)==null?void 0:ie.public_ip)!=null?ue:"N/A"),1),l("div",null,"Updated At: "+P(g(n)),1)]),l("div",_t,[e(p,{onClick:t[7]||(t[7]=xt=>d.value="detail")},{default:a(()=>[f("Close"),e(O,{class:"el-icon--right"},{default:a(()=>[e(te)]),_:1})]),_:1})])])):U("",!0)]}),_:1}),e(Te,{plaque_id:o.plaque.id,show_add_token_dialog:k.value,"onUpdate:show_add_token_dialog":t[8]||(t[8]=v=>k.value=v)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var pt=M(ct,[["__scopeId","data-v-9eb0ebb8"]]);const K=i=>(Z("data-v-4cbbee76"),i=i(),ee(),i),mt={class:"subheader",style:{display:"flex","align-items":"center"}},ft=K(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),vt=K(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),yt=K(()=>l("div",{style:{"padding-bottom":"40px"}},null,-1)),gt={class:"add-button-container"},kt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},qt=K(()=>l("div",{style:{"font-size":"17px"}},"Add plaque",-1)),ht={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},wt=G({__name:"PlaqueList",setup(i){const o=h(!1),{width:S,screen_type:d}=ve(),k=h(!1),C=pe(),$=me(),b=Se(),A=h(""),y=h(localStorage.getItem("filter_by_gallery")||""),r=h(localStorage.getItem("online_filter")==="true"||!1);j(y,u=>{localStorage.setItem("filter_by_gallery",u)}),j(r,u=>{if(u){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const w=H(),z=async()=>{o.value=!0,await Ce({name:"Test Plaque",user_id:$.get_account.id,token_meta_id_list:[],created_at:Y.now(),updated_at:Y.now()}).catch(u=>L({message:`Error creating test plaque- ${u}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,k.value=!1},T=V(()=>JSON.parse(JSON.stringify(w.all_plaque_list)).sort((n,s)=>{const t=n.entity.name.toLowerCase(),p=s.entity.name.toLowerCase();return t<p?-1:t>p?1:0})),q=V(()=>{let u=[...T.value];return u=u.filter(n=>n.entity.name||n.entity.user_id||n.entity.token_meta_id_list.length>0),y.value&&(u=u.filter(n=>{var s;return(s=b.gallery_list.find(t=>t.id==y.value))==null?void 0:s.entity.plaque_id_list.includes(n.id)})),r.value&&(u=u.filter(n=>fe(n))),A.value?u.filter(n=>n.entity.name.toLowerCase().includes(A.value.toLowerCase())):u});return(u,n)=>{const s=c("el-input"),t=c("el-button"),p=c("el-option"),D=c("el-select"),E=c("el-switch"),R=c("el-popover"),Q=c("Plus"),W=c("el-icon"),O=c("el-dialog");return _(),x(B,null,[l("div",mt,[e(s,{modelValue:A.value,"onUpdate:modelValue":n[0]||(n[0]=m=>A.value=m),"prefix-icon":g(xe),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),e(R,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:a(()=>[e(t,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:a(()=>[f("Filters")]),_:1})]),default:a(()=>[ft,e(D,{modelValue:y.value,"onUpdate:modelValue":n[1]||(n[1]=m=>y.value=m),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:a(()=>[e(p,{label:"All plaques",value:""}),(_(!0),x(B,null,X(g(b).gallery_list,m=>(_(),N(p,{key:m.id,label:`${m.entity.name}`,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),vt,e(E,{modelValue:r.value,"onUpdate:modelValue":n[2]||(n[2]=m=>r.value=m)},null,8,["modelValue"])]),_:1}),e(t,{icon:"Camera",type:"info",onClick:n[3]||(n[3]=m=>g(C).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:a(()=>[f("Scan")]),_:1})]),yt,(_(!0),x(B,null,X(g(q),m=>(_(),N(pt,{plaque:m,key:m.id},null,8,["plaque"]))),128)),l("div",gt,[l("div",kt,[l("div",{class:"add-button",onClick:n[4]||(n[4]=m=>k.value=!0)},[e(W,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:a(()=>[e(Q)]),_:1}),qt])])]),e(O,{modelValue:k.value,"onUpdate:modelValue":n[6]||(n[6]=m=>k.value=m),title:"Add plaque",width:g(d)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:a(()=>[l("div",ht,[e(t,{onClick:n[5]||(n[5]=m=>{g(C).push("qr-scan"),k.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:a(()=>[f("Scan Plaque QR Code")]),_:1}),e(t,{icon:"plus",onClick:z,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:a(()=>[f("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Ft=M(wt,[["__scopeId","data-v-4cbbee76"]]);export{Ft as default};
