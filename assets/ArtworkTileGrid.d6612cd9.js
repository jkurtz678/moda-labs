import{d as K,P as oe,Q as ae,r as T,o as _,h as x,F as U,I as j,M as Q,f as m,S as ne,j as G,t as L,T as re,U as ie,m as Z,z as P,_ as ee,u as te,L as se,c as H,b as R,k as v,n as O,i as a,w as y,V as F,e as q,g as Y,J as ce,x as X,K as ue,p as de,l as me}from"./index.4c011e10.js";import{a as _e}from"./thumbnail-image.3589b9f5.js";import{c as pe,d as fe,T as J}from"./types.d2ec9214.js";import{s as ve}from"./util.c94501bb.js";import{u as ye}from"./account.1f4d413a.js";import{f as ge}from"./token-meta.7f5c0ba8.js";import{u as le}from"./gallery.75b89c69.js";import{u as he}from"./token-meta.719b556f.js";import{u as ke}from"./breakpoints.1ab22dc9.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.d53d87c7.js";const we={columnWidth:400,gap:0,keyMapper:(n,r,E,S)=>S,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function be({columns:n,columnWidth:r,emit:E,gap:S,items:s,maxColumns:g,minColumns:p,nextTick:h,onBeforeUnmount:M,onMounted:A,rtl:V,scrollContainer:C,ssrColumns:$,vue:k,wall:B,watch:I}){function z(l,o,b,d){const W=D(b);return d+o+W<=l?z(l,o,b+1,d+o+W):b}function D(l){const o=Array.isArray(r.value)?r.value:[r.value];return o[l%o.length]}function i(){const l=z(B.value.getBoundingClientRect().width,S.value,0,-S.value),o=t(w(l));return o>0?o:1}function w(l){const o=g==null?void 0:g.value;return o&&l>o?o:l}function t(l){const o=p==null?void 0:p.value;return o&&l<o?o:l}function e(l){return[...new Array(l)].map(()=>[])}if($.value>0){const l=e($.value);s.value.forEach((o,b)=>l[b%$.value].push(b)),n.value=l}async function c(l){if(l>=s.value.length)return;await h();const o=[...B.value.children];V.value&&o.reverse();const b=o.reduce((d,W)=>W.getBoundingClientRect().height<d.getBoundingClientRect().height?W:d);n.value[+b.dataset.index].push(l),await c(l+1)}async function f(l=!1){if(n.value.length===i()&&!l){E(k===2?"redraw-skip":"redrawSkip");return}n.value=e(i());const o=C==null?void 0:C.value,b=o?o.scrollTop:window.scrollY;await c(0),o?o.scrollBy({top:b-o.scrollTop}):window.scrollTo({top:b}),E("redraw")}const u=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>f());return A(()=>{f(),u==null||u.observe(B.value)}),M(()=>u==null?void 0:u.unobserve(B.value)),I([s,V],()=>f(!0)),I([r,S,p,g],()=>f()),{getColumnWidthTarget:D}}const xe=["data-index"],Ce=K({__name:"masonry-wall",props:oe({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},we),emits:["redraw","redrawSkip"],setup(n,{emit:r}){const E=n,{columnWidth:S,items:s,gap:g,rtl:p,ssrColumns:h,scrollContainer:M,minColumns:A,maxColumns:V,keyMapper:C}=ae(E),$=T([]),k=T(),{getColumnWidthTarget:B}=be({columns:$,columnWidth:S,emit:r,gap:g,items:s,keyMapper:C,maxColumns:V,minColumns:A,nextTick:re,onBeforeUnmount:ie,onMounted:Z,rtl:p,scrollContainer:M,ssrColumns:h,vue:3,wall:k,watch:P});return(I,z)=>(_(),x("div",{ref_key:"wall",ref:k,class:"masonry-wall",style:Q({display:"flex",gap:`${m(g)}px`})},[(_(!0),x(U,null,j($.value,(D,i)=>(_(),x("div",{key:i,class:"masonry-column","data-index":i,style:Q({display:"flex","flex-basis":`${m(B)(i)}px`,"flex-direction":"column","flex-grow":1,gap:`${m(g)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(_(!0),x(U,null,j(D,(w,t)=>(_(),x("div",{key:m(C)(m(s)[w],i,t,w),class:"masonry-item"},[ne(I.$slots,"default",{item:m(s)[w],column:i,row:t,index:w},()=>[G(L(m(s)[w]),1)])]))),128))],12,xe))),128))],4))}}),Te=(()=>{const n=Ce;return n.install=r=>{r.component("MasonryWall",n)},n})();const Se=["src"],Ae={class:"header"},Ve={class:"platform"},$e={style:{"font-size":"1.6em","font-weight":"bold"}},Ee={key:0},Me={key:1,style:{"font-weight":"bold"}},Be={key:3,style:{height:"32px"}},Ie={style:{"font-size":"0.9em","line-height":"1.3em"}},De={style:{margin:"10px 0px"}},Le=K({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(n){const r=n,E=te(),S=_e(se(r,"token_meta")),s=T(!1),g=T(0),p=T(),h=T(),M=ye(),A=le(),V=H(()=>pe(r.token_meta.entity.platform)),C=async()=>{const i=await fe(r.token_meta);if(!i){ve("Error getting source file");return}window.open(i,"_blank")},$=H(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),k=()=>{const i=E.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(i.href)},B=()=>{window.open(r.token_meta.entity.public_link,"_blank")},I=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function z(){if(!p.value){console.log("animateDivHeight - error finding tile container");return}if(!s.value&&g.value==0&&(g.value=p.value.offsetHeight),s.value=!s.value,!h.value){console.log("animateDivHeight - error finding detail container");return}let i;s.value&&h.value.offsetHeight>g.value?i=h.value.offsetHeight:i=g.value;const w=300,t=10,e=p.value.offsetHeight,c=Math.ceil(i-e),f=Math.ceil(w/t),u=c/f;let l=0;const o=setInterval(()=>{if(l>=f){p.value.style.height=i+"px",clearInterval(o);return}l++;const b=e+u*l;p.value.style.height=b+"px"},t)}const D=()=>{ce.prompt(`Are you sure you want to delete ${r.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:i})=>{if(i)return ge(r.token_meta.id)}).then(()=>{X({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(i=>{X({message:`Error deleting artwork - ${i}`,type:"error",showClose:!0,duration:12e3})})};return(i,w)=>{const t=R("el-button"),e=R("el-tooltip");return _(),x("div",{ref_key:"tile_container",ref:p,class:"custom-card",onClick:z,style:Q(`height: ${m($)}px !important`)},[v("img",{class:O(s.value?"absolute":""),src:m(S)},null,10,Se),v("div",{class:O([s.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),v("div",{class:O(["transition absolute",s.value?"hide-blur":"show-blur"])},[v("div",Ae,L(`${n.token_meta.entity.name} | ${n.token_meta.entity.artist}`),1),v("div",Ve,L(m(V)),1)],2),v("div",{ref_key:"detail_container",ref:h,class:O(["detail-container transition",s.value?"show-blur":"hide-blur"])},[v("div",$e,L(n.token_meta.entity.name),1),n.token_meta.entity.artist_social_link?(_(),x("div",Ee,[a(t,{link:"",style:{"font-weight":"bold",display:"block"},disabled:!s.value,onClick:F(I,["stop"])},{default:y(()=>[G(L(n.token_meta.entity.artist),1)]),_:1},8,["disabled","onClick"])])):(_(),x("div",Me,L(n.token_meta.entity.artist),1)),s.value?(_(),x(U,{key:2},[a(e,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:y(()=>[a(t,{icon:"Edit",text:"",circle:"",onClick:w[0]||(w[0]=F(c=>m(E).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),a(e,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:y(()=>[a(t,{icon:"Download",text:"",circle:"",onClick:F(C,["stop"])},null,8,["onClick"])]),_:1}),a(e,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:y(()=>[a(t,{icon:"Tickets",text:"",circle:"",onClick:F(k,["stop"])},null,8,["onClick"])]),_:1}),n.token_meta.entity.public_link?(_(),q(e,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:y(()=>[a(t,{icon:"Link",text:"",circle:"",onClick:F(B,["stop"])},null,8,["onClick"])]),_:1})):Y("",!0),m(M).is_user_admin?(_(),q(e,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:y(()=>[a(t,{icon:"Delete",text:"",circle:"",onClick:F(D,["stop"])},null,8,["onClick"])]),_:1})):Y("",!0)],64)):(_(),x("div",Be)),v("div",Ie,L(n.token_meta.entity.description),1),v("div",De,[(_(!0),x(U,null,j(m(A).token_id_to_gallery_map.get(r.token_meta.id),c=>(_(),q(t,{size:"small",round:"",plain:"",type:"primary",style:{margin:"3px 10px 3px 0px"}},{default:y(()=>[G(L(c.entity.name),1)]),_:2},1024))),256))])],2)],4)}}});var Re=ee(Le,[["__scopeId","data-v-17591e03"]]);const N=n=>(de("data-v-7f2573dc"),n=n(),me(),n),ze={class:"subheader",style:{display:"flex","align-items":"center"}},He=N(()=>v("div",{class:"caption"},"Filter by gallery",-1)),Fe=N(()=>v("div",{class:"caption"},"Filter by aspect ratio",-1)),Pe=N(()=>v("div",{class:"caption"},"Filter by platform",-1)),Ue=N(()=>v("div",{class:"caption"},"Sort order",-1)),We=N(()=>v("div",{style:{"padding-bottom":"40px"}},null,-1)),qe={key:1,style:{padding:"1em"}},Ge=K({__name:"ArtworkTileGrid",setup(n){const r=te(),E=he(),S=le(),s=T(null),g=30,p=T(g),h=T(""),M=T(localStorage.getItem("artwork_grid_aspect_ratio_filter")||"");P(M,t=>{localStorage.setItem("artwork_grid_aspect_ratio_filter",t)});const A=T(localStorage.getItem("artwork_grid_filter_by_gallery")||"");P(A,t=>{localStorage.setItem("artwork_grid_filter_by_gallery",t)});const V=T(localStorage.getItem("artwork_grid_filter_by_platform")||"");P(V,t=>{localStorage.setItem("artwork_grid_filter_by_platform",t)});const C=T(localStorage.getItem("artwork_grid_sort_order")||"name");P(C,t=>{localStorage.setItem("artwork_grid_sort_order",t)}),P(h,t=>{p.value=g});const $=250,k=10,{screen_type:B}=ke(),I=H(()=>{switch(B.value){case"xs":return 340-k*2;case"sm":return 650-k*2;case"md":return 960-k*2;case"lg":return 1200-k*2;case"xl":return 1700-k*2}return 0}),z=H(()=>{let t=Math.floor(I.value/($+k));return t>5&&(t=5),(I.value-(t-1)*k)/t}),D=H(()=>E.sorted_all_token_metas.filter(t=>Boolean(t.entity.aspect_ratio))),i=H(()=>{let t=D.value.filter(e=>{var c,f,u;if(h.value&&!((c=e.entity.artist)!=null&&c.toLowerCase().includes(h.value.toLowerCase()))&&!((f=e.entity.name)!=null&&f.toLowerCase().includes(h.value.toLowerCase()))||A.value&&!((u=S.gallery_list.find(l=>l.id==A.value))!=null&&u.entity.token_meta_id_list.includes(e.id)))return!1;switch(V.value){case"moda_archive":if(e.entity.platform!=J.Archive)return!1;break;case"opensea":if(e.entity.platform!=J.Opensea&&e.entity.platform!=J.OpenseaArchive)return!1;break}switch(M.value){case"portrait":if(!e.entity.aspect_ratio||e.entity.aspect_ratio>.9)return!1;break;case"landscape":if(!e.entity.aspect_ratio||e.entity.aspect_ratio<1.1)return!1;break;case"square":if(!e.entity.aspect_ratio||e.entity.aspect_ratio<.9||e.entity.aspect_ratio>1.1)return!1;break}return!0});return C.value==="name"?t=t.sort((e,c)=>e.entity.name.localeCompare(c.entity.name)):C.value==="created_at"&&(t=t.sort((e,c)=>e.entity.created_at==null&&c.entity.created_at==null?0:e.entity.created_at==null?1:c.entity.created_at==null?-1:c.entity.created_at.seconds-e.entity.created_at.seconds)),t}),w=H(()=>{const t=i.value,e=0,c=e+p.value;return t.slice(e,c)});return Z(()=>{const t=document.getElementById("masonry-container");if(!t){console.log("ArtworkTileGrid error, masonary_wall element not found");return}t.addEventListener("scroll",()=>{const e=t.scrollTop,c=t.scrollHeight,f=t.clientHeight;e/(c-f)*100>90&&p.value<i.value.length&&(p.value=p.value+20)})}),(t,e)=>{const c=R("el-input"),f=R("el-button"),u=R("el-option"),l=R("el-select"),o=R("el-popover"),b=R("RouterView");return _(),x(U,null,[v("div",ze,[a(c,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=d=>h.value=d),"prefix-icon":m(ue),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),a(o,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:y(()=>[a(f,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:y(()=>[G("Filters")]),_:1})]),default:y(()=>[He,a(l,{modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=d=>A.value=d),placeholder:"Filter by gallery",class:"filter-select"},{default:y(()=>[a(u,{label:"All artwork",value:""}),(_(!0),x(U,null,j(m(S).gallery_list,d=>(_(),q(u,{key:d.id,label:`${d.entity.name}`,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Fe,a(l,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=d=>M.value=d),class:"filter-select"},{default:y(()=>[a(u,{label:"All",value:""}),a(u,{label:"Landscape",value:"landscape"}),a(u,{label:"Portrait",value:"portrait"}),a(u,{label:"Square",value:"square"})]),_:1},8,["modelValue"]),Pe,a(l,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=d=>V.value=d),class:"filter-select"},{default:y(()=>[a(u,{label:"All",value:""}),a(u,{label:"Moda Archive",value:"moda_archive"}),a(u,{label:"Opensea",value:"opensea"})]),_:1},8,["modelValue"]),Ue,a(l,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=d=>C.value=d),placeholder:"Sort by",class:"filter-select"},{default:y(()=>[a(u,{label:"Sort by name",value:"name"}),a(u,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),a(f,{icon:"Plus",type:"info",onClick:e[5]||(e[5]=d=>m(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:y(()=>[G("Artwork")]),_:1})]),We,v("div",{id:"masonry-container",ref_key:"masonryContainer",ref:s,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[m(w).length>0?(_(),q(m(Te),{key:0,id:"masonary-wall","scroll-container":s.value,items:m(w),"column-width":$,gap:k,style:Q(`width: ${m(I)}px; margin: auto`),"max-columns":5},{default:y(({item:d})=>[a(Re,{token_meta:d,column_width:m(z)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(_(),x("div",qe,"No artwork found"))],512),a(b)],64)}}});var lt=ee(Ge,[["__scopeId","data-v-7f2573dc"]]);export{lt as default};
