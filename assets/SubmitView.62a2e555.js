var M=Object.defineProperty;var V=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var w=(a,o,e)=>o in a?M(a,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[o]=e,x=(a,o)=>{for(var e in o||(o={}))q.call(o,e)&&w(a,e,o[e]);if(V)for(var e of V(o))F.call(o,e)&&w(a,e,o[e]);return a};import{D as L,p as E,f as N,l as I,e as O,g as P,d as j,u as H,b as B}from"./firebaseConfig.d7dbf4c4.js";import{B as K}from"./types.8335cbb0.js";import{d as z,q as b,m as C,r as _,b as G,l as J,e as l,g as r,w as s,f as v,j as S,t as Q,bA as W}from"./index.0ae5db31.js";const X=L(N),Y=E(X,"token-meta"),Z=async a=>{const o=await I(Y,x(x({},K.createBaseEntity()),a)),e=await O(o);return{id:o.id,entity:e.data()}},ee=P(),oe=async(a,o,e,i)=>{console.log("uploadFile - starting file upload for ",a);const y=j(ee,a);H(y,o).on("state_changed",d=>{console.log("snapshot",d.bytesTransferred,d.totalBytes),e(d.bytesTransferred/d.totalBytes)},d=>{console.log("uploadFile error - ",d)},()=>{console.log("SUCCESS CALLBACK"),i()})},te={style:{padding:"20px"}},le=v("h1",{style:{"margin-bottom":"15px"}},"SUBMIT TO MODA ARCHIVES",-1),ae=v("div",{class:"el-upload__text"},[S(" Drop file here or "),v("em",null,"click to upload")],-1),se=v("div",null,"SUBMIT",-1),ue=z({setup(a){const o=b();b();const e=C({name:"",artist:"",description:"",public_link:"",created_at:B.now(),updated_at:B.now(),media_id:"",media_type:""}),i=b([]),y=C({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}]}),f=b(!1),d=b("0%"),h=(u,t)=>W.confirm(`Cancel the upload of ${u.name} ?`).then(()=>!0,()=>!1),R=()=>{},T=async u=>{var g;if(!u){console.log("SubmitView.vue Submit - formRef is null");return}if(!await u.validate(p=>p))return;if(f.value=!0,((g=i==null?void 0:i.value)==null?void 0:g.length)!==1){console.log("file_list error",i.value);return}const n=i.value[0],c=p=>{console.log("Progress",p),d.value=`${Math.round(p*100)}%`},k=()=>{U(u,n)};oe(`${n.uid||""}`,n.raw,c,k).catch(p=>{console.error(p)})},U=(u,t)=>{e.media_id=`${(t==null?void 0:t.uid)||""}`,e.media_type=`.${t.name.split(".").pop()||""}`,console.log("upload success, sending form: ",e),Z(e).then(n=>{u.resetFields(),i.value=[],f.value=!1,alert("Successfully submitted token")}).catch(n=>{f.value=!1,alert(n)})};return(u,t)=>{const n=_("el-input"),c=_("el-form-item"),k=_("upload-filled"),g=_("el-icon"),p=_("el-upload"),$=_("Loading"),A=_("el-button"),D=_("el-form");return G(),J("div",te,[le,l(D,{ref_key:"formRef",ref:o,model:r(e),rules:r(y),"label-position":"left","label-width":"95px",style:{"max-width":"700px"}},{default:s(()=>[l(c,{label:"Name",style:{"max-width":"400px"},prop:"name"},{default:s(()=>[l(n,{modelValue:r(e).name,"onUpdate:modelValue":t[0]||(t[0]=m=>r(e).name=m)},null,8,["modelValue"])]),_:1}),l(c,{label:"Artist",style:{"max-width":"400px"},prop:"artist"},{default:s(()=>[l(n,{modelValue:r(e).artist,"onUpdate:modelValue":t[1]||(t[1]=m=>r(e).artist=m)},null,8,["modelValue"])]),_:1}),l(c,{label:"Description",prop:"description"},{default:s(()=>[l(n,{modelValue:r(e).description,"onUpdate:modelValue":t[2]||(t[2]=m=>r(e).description=m),type:"textarea",rows:"4"},null,8,["modelValue"])]),_:1}),l(c,{label:"Public Link",prop:"public_link"},{default:s(()=>[l(n,{modelValue:r(e).public_link,"onUpdate:modelValue":t[3]||(t[3]=m=>r(e).public_link=m)},null,8,["modelValue"])]),_:1}),l(c,null,{default:s(()=>[l(p,{class:"upload-demo","auto-upload":!1,action:"","on-remove":R,"before-remove":h,limit:1,drag:"","file-list":i.value},{default:s(()=>[l(g,{class:"el-icon--upload"},{default:s(()=>[l(k)]),_:1}),ae]),_:1},8,["file-list"])]),_:1}),l(c,null,{default:s(()=>[l(A,{onClick:t[4]||(t[4]=m=>T(o.value)),loading:f.value},{loading:s(()=>[l(g,{class:"is-loading",style:{"margin-right":"4px"}},{default:s(()=>[l($)]),_:1}),S(" "+Q(d.value),1)]),default:s(()=>[se]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}});export{ue as default};
