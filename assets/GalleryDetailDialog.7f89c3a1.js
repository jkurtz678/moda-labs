import{u as oe,a as re,b as ne}from"./account.7bcd864b.js";import{u as ie}from"./token-meta.25a5c272.js";import{u as ue,s as _e,d as de,c as ce}from"./gallery-token.25579f23.js";import{G as b,T as pe}from"./types.3cc10997.js";import{n as p}from"./firebaseConfig.4bdd3a5f.js";import{d as z,c as V,b as f,o as k,h as $,k as i,t as D,i as s,f as d,C as me,F as j,r as v,q as K,L as ye,g as L,K as fe,e as Y,_ as ve,P as ge,w as _,u as he,a as qe,j as F,Y as we,z as ke,p as xe,m as be}from"./index.ea001822.js";import{s as w}from"./util.526cea20.js";import{u as Ge,d as Ve,a as $e,c as Ee,b as Ue}from"./gallery.8e4743a2.js";import{u as Se}from"./breakpoints.cf5ccac3.js";import{u as Pe}from"./plaque.41fc2883.js";import{_ as Be}from"./TokenSelectList.1e2f1c1b.js";import"./token-meta.16ce217f.js";import"./plaque.180c7ae7.js";import"./thumbnail-image.f3fc39ed.js";import"./ArtworkFilters.15d7d58a.js";const Ce={class:"card-flex-container"},De={style:{flex:"3 1 0%",display:"flex","align-items":"center",padding:"0px 10px 0px 0px"}},Ie={class:"bold"},Le=i("hr",{class:"hr"},null,-1),Ae=z({__name:"AddPlaqueItem",props:{in_list:{type:Boolean},plaque:null},emits:["update_plaque_list"],setup(x,{emit:E}){const n=x,a=V({get(){return n.in_list},set(){E("update_plaque_list",n.plaque.id)}});return(m,y)=>{const G=f("el-checkbox");return k(),$(j,null,[i("div",Ce,[i("div",De,[i("p",Ie,D(n.plaque.entity.name),1)]),s(G,{modelValue:d(a),"onUpdate:modelValue":y[0]||(y[0]=S=>me(a)?a.value=S:null),style:{"margin-right":"10px"}},null,8,["modelValue"])]),Le],64)}}}),Te={style:{"margin-top":"10px","overflow-y":"auto","max-height":"250px"}},Ne={key:0},Oe=z({__name:"PlaqueSelectList",props:{selected_plaque_id_list:null,plaque_list:null},emits:["update:selected_plaque_id_list"],setup(x,{emit:E}){const n=x,a=v(""),m=v([]);K(()=>{if(!!n.plaque_list)for(let u of n.plaque_list)G.value.has(u.id)?m.value.unshift(u):m.value.push(u)});const y=V(()=>a.value.trim()!==""?m.value.filter(u=>{var o;return(o=u.entity.name)==null?void 0:o.toLowerCase().includes(a.value.toLowerCase())}):m.value),G=V(()=>new Set(n.selected_plaque_id_list)),S=u=>{let o=[...n.selected_plaque_id_list];o.some(h=>h===u)?o=o.filter(h=>h!=u):o.push(u),E("update:selected_plaque_id_list",o)};return(u,o)=>{const h=f("el-input");return k(),$(j,null,[s(h,{type:"text",modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=g=>a.value=g),"prefix-icon":d(ye),placeholder:"Search by plaque name"},null,8,["modelValue","prefix-icon"]),i("div",Te,[d(y).length==0?(k(),$("div",Ne,"No plaque found")):L("",!0),(k(!0),$(j,null,fe(d(y),g=>(k(),Y(Ae,{plaque:g,in_list:Boolean(d(G).has(g.id)),onUpdate_plaque_list:S},null,8,["plaque","in_list"]))),256))])],64)}}});const H=x=>(xe("data-v-436f62d8"),x=x(),be(),x),Re={class:"gallery-dialog"},Me={style:{"max-width":"600px",margin:"0 auto"}},je=H(()=>i("div",{class:"header"},"Gallery Name",-1)),ze={key:0},Fe={key:0,style:{display:"flex","align-items":"center",padding:"1em 0em","max-width":"350px"}},Ke={style:{"margin-bottom":"2em"}},Ye={class:"dialog-footer"},He=H(()=>i("div",{style:{"flex-grow":"1"}},null,-1)),Je=z({__name:"GalleryDetailDialog",setup(x){const E=v(!0),n=v({name:"",created_at:p.now(),updated_at:p.now()}),a=v([]),m=v([]),y=v([]),G=v(),S=ge({name:[{required:!0,message:"Required",trigger:"blur"}]}),u=v(!1),o=v(""),h=he(),g=qe(),I=oe(),J=Pe(),P=Ge(),Q=ie(),{screen_type:W}=Se(),U=v([]),X=V(()=>a.value.map(l=>U.value.find(e=>e.id==l.user_id))),A=V(()=>{if(I.is_user_admin)return!0;const l=a.value.find(e=>e.user_id==I.get_account.id);return l?l.role==b.Owner||l.role==b.Editor:!1}),Z=V(()=>Object.values(J.plaque_map)),ee=V(()=>Object.values(Q.all_token_metas).filter(l=>l.entity.platform!=pe.Opensea));K(async()=>{if(g.params.gallery_id){const l=P.gallery_list.find(e=>e.id===g.params.gallery_id);if(!l){w("Gallery not found"),h.push({name:"gallery-list"});return}n.value=l.entity,a.value=P.gallery_user_list.filter(e=>e.entity.gallery_id==l.id).sort((e,c)=>e.entity.role===b.Owner?-1:c.entity.role===b.Owner?1:e.entity.role===b.Editor?-1:c.entity.role===b.Editor?1:0).map(e=>e.entity),m.value=P.gallery_plaque_list.filter(e=>e.entity.gallery_id==l.id).map(e=>e.entity.plaque_id),y.value=P.gallery_token_meta_list.filter(e=>e.entity.gallery_id==l.id).map(e=>e.entity.token_meta_id),await re(a.value.map(e=>e.user_id)).then(e=>{e.forEach(c=>{U.value.push(c)})}).catch(e=>{w(e)})}else{U.value.push(I.get_account);const l={user_id:I.get_account.id,role:b.Owner,created_at:p.now(),updated_at:p.now(),gallery_id:""};a.value=[l]}});const le=async l=>{if(!l){w("Error finding form element");return}if(!await l.validate(t=>t))return;u.value=!0;let c;if(g.params.gallery_id?c=await ue(g.params.gallery_id,n.value).catch(t=>(w(t),null)):c=await _e(n.value).catch(t=>(w(`Error saving gallery: ${t}`),null)),!c){w("Error saving gallery");return}const q=c;g.params.gallery_id&&await Promise.all([Ve(q.id),$e(q.id),de(q.id)]),a.value.forEach(t=>{t.gallery_id=q.id,t.created_at=p.now(),t.updated_at=p.now()});const B=Ee(a.value),C=Ue(m.value.map(t=>({gallery_id:q.id,plaque_id:t,created_at:p.now(),updated_at:p.now()}))),T=ce(y.value.map(t=>({gallery_id:q.id,token_meta_id:t,created_at:p.now(),updated_at:p.now()})));Promise.all([B,C,T]).then(t=>{const N=t[0],O=t[1],R=t[2];P.addGalleryToStore(q,N,O,R),ke({message:"Gallery saved",type:"success"}),h.push({name:"gallery-list"})}).catch(t=>{w(`Error saving gallery: ${t}`)}).finally(()=>{u.value=!1})},te=async()=>{if(U.value.find(l=>l.entity.email===o.value)){w("User already added");return}await ne(o.value).then(l=>{l&&(U.value.push(l),a.value.push({gallery_id:"",user_id:l.id,role:b.Reader,created_at:p.now(),updated_at:p.now()}))}).catch(l=>{console.log(l),w("Invalid email")})},ae=l=>{a.value.splice(l,1),U.value.splice(l,1)};return(l,e)=>{const c=f("el-input"),q=f("el-form-item"),B=f("el-table-column"),C=f("el-button"),T=f("el-row"),t=f("el-tab-pane"),N=f("el-tabs"),O=f("el-form"),R=f("el-dialog");return k(),$("div",Re,[s(R,{modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=r=>E.value=r),title:"Edit Gallery",onClose:e[6]||(e[6]=r=>d(h).push({name:"gallery-list"})),top:"2vh",width:"75%",fullscreen:d(W)=="xs"},{footer:_(()=>[i("div",Ye,[He,d(A)?(k(),Y(C,{key:0,color:"#000000",onClick:e[4]||(e[4]=r=>le(G.value)),loading:u.value},{default:_(()=>[F("Save")]),_:1},8,["loading"])):L("",!0)])]),default:_(()=>[i("div",Me,[s(O,{ref_key:"form_ref",ref:G,model:n.value,rules:S},{default:_(()=>[s(q,{prop:"name",style:{"max-width":"280px","margin-bottom":"2em"}},{default:_(()=>[je,s(c,{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value.name=r),placeholder:"Name"},null,8,["modelValue"])]),_:1}),s(N,{class:"demo-tabs",type:"border-card"},{default:_(()=>[s(t,{label:"Users"},{default:_(()=>[s(T,{style:{display:"block","margin-bottom":"1em"}},{default:_(()=>[s(d(we),{data:d(X),style:{width:"100%"}},{default:_(()=>[s(B,{prop:"entity.email",label:"Email"}),s(B,{label:"Role"},{default:_(r=>{var M;return[i("div",null,D(((M=a.value.find(se=>se.user_id==r.row.id))==null?void 0:M.role)||"not found"),1)]}),_:1}),s(B,{fixed:"right",label:"",width:"50"},{default:_(r=>[r.$index&&d(A)?(k(),$("div",ze,[s(C,{link:"",type:"primary",size:"small",icon:"close",onClick:M=>ae(r.$index)},null,8,["onClick"])])):L("",!0)]),_:1})]),_:1},8,["data"]),i("div",null,D(`Users in gallery: ${a.value.length}`),1),d(A)?(k(),$("div",Fe,[s(c,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value=r),placeholder:"Email"},null,8,["modelValue"]),s(C,{icon:"Plus",color:"#000000",size:"small",style:{"margin-left":"1em"},onClick:te},{default:_(()=>[F(" Add user ")]),_:1})])):L("",!0)]),_:1})]),_:1}),s(t,{label:"Artwork"},{default:_(()=>[i("div",null,[s(Be,{selected_token_meta_id_list:y.value,"onUpdate:selected_token_meta_id_list":e[2]||(e[2]=r=>y.value=r),token_meta_list:d(ee),max_height:350},null,8,["selected_token_meta_id_list","token_meta_list"]),i("div",null,D(`Artwork in gallery: ${y.value.length}`),1)])]),_:1}),s(t,{label:"Plaques"},{default:_(()=>[i("div",Ke,[s(Oe,{selected_plaque_id_list:m.value,"onUpdate:selected_plaque_id_list":e[3]||(e[3]=r=>m.value=r),plaque_list:d(Z)},null,8,["selected_plaque_id_list","plaque_list"]),i("div",null,D(`Plaques in gallery: ${m.value.length}`),1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","fullscreen"])])}}});var dl=ve(Je,[["__scopeId","data-v-436f62d8"]]);export{dl as default};
