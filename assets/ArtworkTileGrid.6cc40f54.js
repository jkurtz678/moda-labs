import{d as O,P as ne,Q as oe,r as M,o as u,h as y,F,K as j,l as W,f as s,S as le,j as N,t as H,T as ae,U as se,q as Y,B as J,_ as X,u as Z,M as re,c as L,b as q,k as x,n as U,i as f,w as $,V as I,e as G,g as Q,A as ie,z as K,L as ce,p as ue,m as me}from"./index.80efe40e.js";import{a as de}from"./thumbnail-image.73b95669.js";import{c as pe,d as _e}from"./types.d2ec9214.js";import{s as fe}from"./util.9a4e8d85.js";import{u as ve}from"./account.9ecc5baa.js";import{f as ke}from"./token-meta.7f5c0ba8.js";import{u as ee}from"./gallery.959b2195.js";import{u as te}from"./breakpoints.3be562a3.js";import{u as he}from"./token-meta.cbc4c2a1.js";import{A as ye}from"./ArtworkFilters.1bf33203.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.d53d87c7.js";const ge={columnWidth:400,gap:0,keyMapper:(t,n,E,g)=>g,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:t,columnWidth:n,emit:E,gap:g,items:r,maxColumns:i,minColumns:m,nextTick:v,onBeforeUnmount:D,onMounted:_,rtl:B,scrollContainer:C,ssrColumns:A,vue:R,wall:b,watch:a}){function c(l,e,h,z){const P=w(h);return z+e+P<=l?c(l,e,h+1,z+e+P):h}function w(l){const e=Array.isArray(n.value)?n.value:[n.value];return e[l%e.length]}function p(){const l=c(b.value.getBoundingClientRect().width,g.value,0,-g.value),e=d(o(l));return e>0?e:1}function o(l){const e=i==null?void 0:i.value;return e&&l>e?e:l}function d(l){const e=m==null?void 0:m.value;return e&&l<e?e:l}function k(l){return[...new Array(l)].map(()=>[])}if(A.value>0){const l=k(A.value);r.value.forEach((e,h)=>l[h%A.value].push(h)),t.value=l}async function T(l){if(l>=r.value.length)return;await v();const e=[...b.value.children];B.value&&e.reverse();const h=e.reduce((z,P)=>P.getBoundingClientRect().height<z.getBoundingClientRect().height?P:z);t.value[+h.dataset.index].push(l),await T(l+1)}async function S(l=!1){if(t.value.length===p()&&!l){E(R===2?"redraw-skip":"redrawSkip");return}t.value=k(p());const e=C==null?void 0:C.value,h=e?e.scrollTop:window.scrollY;await T(0),e?e.scrollBy({top:h-e.scrollTop}):window.scrollTo({top:h}),E("redraw")}const V=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>S());return _(()=>{S(),V==null||V.observe(b.value)}),D(()=>V==null?void 0:V.unobserve(b.value)),a([r,B],()=>S(!0)),a([n,g,m,i],()=>S()),{getColumnWidthTarget:w}}const xe=["data-index"],Ce=O({__name:"masonry-wall",props:ne({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ge),emits:["redraw","redrawSkip"],setup(t,{emit:n}){const E=t,{columnWidth:g,items:r,gap:i,rtl:m,ssrColumns:v,scrollContainer:D,minColumns:_,maxColumns:B,keyMapper:C}=oe(E),A=M([]),R=M(),{getColumnWidthTarget:b}=we({columns:A,columnWidth:g,emit:n,gap:i,items:r,keyMapper:C,maxColumns:B,minColumns:_,nextTick:ae,onBeforeUnmount:se,onMounted:Y,rtl:m,scrollContainer:D,ssrColumns:v,vue:3,wall:R,watch:J});return(a,c)=>(u(),y("div",{ref_key:"wall",ref:R,class:"masonry-wall",style:W({display:"flex",gap:`${s(i)}px`})},[(u(!0),y(F,null,j(A.value,(w,p)=>(u(),y("div",{key:p,class:"masonry-column","data-index":p,style:W({display:"flex","flex-basis":`${s(b)(p)}px`,"flex-direction":"column","flex-grow":1,gap:`${s(i)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(u(!0),y(F,null,j(w,(o,d)=>(u(),y("div",{key:s(C)(s(r)[o],p,d,o),class:"masonry-item"},[le(a.$slots,"default",{item:s(r)[o],column:p,row:d,index:o},()=>[N(H(s(r)[o]),1)])]))),128))],12,xe))),128))],4))}}),be=(()=>{const t=Ce;return t.install=n=>{n.component("MasonryWall",t)},t})();const Te=["src"],Ee={class:"header"},Ae={class:"platform"},Me={style:{"font-size":"1.6em","font-weight":"bold"}},Be={key:1,style:{"font-weight":"bold"}},Se={key:3,style:{height:"32px"}},$e={style:{"font-size":"0.9em","line-height":"1.3em"}},De={style:{margin:"10px 0px"}},Re=O({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(t){const n=t,E=Z(),g=de(re(n,"token_meta")),r=M(!1),i=M(0),m=M(),v=M(),D=ve(),_=ee(),{screen_type:B}=te(),C=L(()=>pe(n.token_meta.entity.platform)),A=async()=>{const o=await _e(n.token_meta);if(!o){fe("Error getting source file");return}window.open(o,"_blank")},R=L(()=>n.token_meta.entity.aspect_ratio?n.column_width/n.token_meta.entity.aspect_ratio:n.column_width),b=()=>{const o=E.resolve({name:"preview-plaque",params:{token_meta_id:n.token_meta.id}});window.open(o.href)},a=()=>{window.open(n.token_meta.entity.public_link,"_blank")},c=()=>{window.open(n.token_meta.entity.artist_social_link,"_blank")};function w(){if(!m.value){console.log("animateDivHeight - error finding tile container");return}if(!r.value&&i.value==0&&(i.value=m.value.offsetHeight),r.value=!r.value,!v.value){console.log("animateDivHeight - error finding detail container");return}let o;r.value&&v.value.offsetHeight>i.value?o=v.value.offsetHeight:o=i.value;const d=300,k=10,T=m.value.offsetHeight,S=Math.ceil(o-T),V=Math.ceil(d/k),l=S/V;let e=0;const h=setInterval(()=>{if(e>=V){m.value.style.height=o+"px",clearInterval(h);return}e++;const z=T+l*e;m.value.style.height=z+"px"},k)}const p=()=>{ie.prompt(`Are you sure you want to delete ${n.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:o})=>{if(o)return ke(n.token_meta.id)}).then(()=>{K({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(o=>{K({message:`Error deleting artwork - ${o}`,type:"error",showClose:!0,duration:12e3})})};return(o,d)=>{const k=q("el-button"),T=q("el-tooltip");return u(),y("div",{ref_key:"tile_container",ref:m,class:"custom-card",onClick:w,style:W(`height: ${s(R)}px !important`)},[x("img",{class:U(r.value?"absolute":""),src:s(g)},null,10,Te),x("div",{class:U([r.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),x("div",{class:U(["transition absolute",r.value?"hide-blur":"show-blur"])},[x("div",Ee,H(`${t.token_meta.entity.name} | ${t.token_meta.entity.artist}`),1),x("div",Ae,H(s(C)),1)],2),x("div",{ref_key:"detail_container",ref:v,class:U(["detail-container transition",r.value?"show-blur":"hide-blur"])},[x("div",Me,H(t.token_meta.entity.name),1),t.token_meta.entity.artist_social_link?(u(),y("div",{key:0,style:W(s(B)=="xs"?"display: flex; justify-content: center;":"")},[f(k,{link:"",style:{"font-weight":"bold",display:"block"},disabled:!r.value,onClick:I(c,["stop"])},{default:$(()=>[N(H(t.token_meta.entity.artist),1)]),_:1},8,["disabled","onClick"])],4)):(u(),y("div",Be,H(t.token_meta.entity.artist),1)),r.value?(u(),y(F,{key:2},[f(T,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:$(()=>[f(k,{icon:"Edit",text:"",circle:"",onClick:d[0]||(d[0]=I(S=>s(E).push({name:"edit-artwork",params:{token_meta_id:n.token_meta.id}}),["stop"]))})]),_:1}),f(T,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:$(()=>[f(k,{icon:"Download",text:"",circle:"",onClick:I(A,["stop"])},null,8,["onClick"])]),_:1}),f(T,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:$(()=>[f(k,{icon:"Tickets",text:"",circle:"",onClick:I(b,["stop"])},null,8,["onClick"])]),_:1}),t.token_meta.entity.public_link?(u(),G(T,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:$(()=>[f(k,{icon:"Link",text:"",circle:"",onClick:I(a,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0),s(D).is_user_admin?(u(),G(T,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:$(()=>[f(k,{icon:"Delete",text:"",circle:"",onClick:I(p,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0)],64)):(u(),y("div",Se)),x("div",$e,H(t.token_meta.entity.description),1),x("div",De,[(u(!0),y(F,null,j(s(_).token_id_to_gallery_map.get(n.token_meta.id),S=>(u(),G(k,{size:"small",round:"",plain:"",type:"primary",style:{margin:"3px 10px 3px 0px"}},{default:$(()=>[N(H(S.entity.name),1)]),_:2},1024))),256))])],2)],4)}}});var He=X(Re,[["__scopeId","data-v-2eac3150"]]);const Ve=t=>(ue("data-v-065dde58"),t=t(),me(),t),ze=Ve(()=>x("div",{style:{"padding-bottom":"90px"}},null,-1)),Ie={key:1,style:{padding:"1em"}},Le=O({__name:"ArtworkTileGrid",setup(t){const n=Z(),E=he();ee();const g=M(null),r=30,i=M(r),m=M([]),v=M("");J(v,a=>{i.value=r});const D=250,_=10,{screen_type:B}=te(),C=L(()=>{switch(B.value){case"xs":return 340-_*2;case"sm":return 650-_*2;case"md":return 960-_*2;case"lg":return 1200-_*2;case"xl":return 1700-_*2}return 0}),A=L(()=>{let a=Math.floor(C.value/(D+_));return a>5&&(a=5),(C.value-(a-1)*_)/a}),R=L(()=>E.sorted_all_token_metas.filter(a=>Boolean(a.entity.aspect_ratio))),b=L(()=>{const a=m.value,c=0,w=c+i.value;return a.slice(c,w)});return Y(()=>{const a=document.getElementById("masonry-container");if(!a){console.log("ArtworkTileGrid error, masonary_wall element not found");return}a.addEventListener("scroll",()=>{const c=a.scrollTop,w=a.scrollHeight,p=a.clientHeight;c/(w-p)*100>90&&i.value<m.value.length&&(i.value=i.value+20)})}),(a,c)=>{const w=q("el-input"),p=q("el-button"),o=q("RouterView");return u(),y(F,null,[x("div",{class:"subheader",style:W([{display:"flex","align-items":"center"},s(B)=="xs"?"padding: 0px 8px 10px;":""])},[f(w,{modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=d=>v.value=d),"prefix-icon":s(ce),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),f(ye,{all_tokens:s(R),search_filter:v.value,use_local_storage:!0,onUpdateFilteredTokens:c[1]||(c[1]=d=>m.value=d)},null,8,["all_tokens","search_filter"]),f(p,{icon:"Plus",type:"info",onClick:c[2]||(c[2]=d=>s(n).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:$(()=>[N("Artwork")]),_:1})],4),ze,x("div",{id:"masonry-container",ref_key:"masonryContainer",ref:g,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[s(b).length>0?(u(),G(s(be),{key:0,id:"masonary-wall","scroll-container":g.value,items:s(b),"column-width":D,gap:_,style:W(`width: ${s(C)}px; margin: auto`),"max-columns":5},{default:$(({item:d})=>[f(He,{token_meta:d,column_width:s(A)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(u(),y("div",Ie,"No artwork found"))],512),f(o)],64)}}});var Je=X(Le,[["__scopeId","data-v-065dde58"]]);export{Je as default};
