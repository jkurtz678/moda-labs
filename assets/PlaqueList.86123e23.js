import{_ as R,d as j,r as w,c as z,z as K,b as c,o as _,h,i as t,w as n,k as a,t as A,j as f,f as g,A as ue,p as Q,l as W,x as I,u as de,e as T,B as oe,C as ve,D as fe,g as D,G as ye,H as ge,F as B,I as G,J as se,K as ke}from"./index.39a9c556.js";import{u as E,c as qe}from"./plaque.093acf64.js";import{c as he}from"./token-meta.2d60a689.js";import{u as F}from"./plaque.bb2e7053.js";import{u as re,g as we}from"./account.bf83d446.js";import{s as O}from"./util.3c52f1a6.js";import{T as ie}from"./types.6a5ef88e.js";import{u as _e}from"./breakpoints.250b198f.js";import{u as ce}from"./token-meta.23a22a73.js";import{_ as xe}from"./TokenSelectList.c26f3e02.js";import{n as H}from"./firebaseConfig.d7a6b5a9.js";import{_ as Ce}from"./PlaqueTokenItem.1949e553.js";import{u as $e}from"./gallery.9bf25e08.js";import"./thumbnail-image.c1189983.js";import"./gallery.82c2a091.js";const be=u=>(Q("data-v-cc2989e6"),u=u(),W(),u),Ae={class:"dialog-container"},Pe={class:"dialog-footer"},Se=be(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Ve=j({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(u,{emit:o}){const P=u,d=w([]),y=w(!1),{screen_type:x}=_e(),$=F(),C=ce(),b=re(),m=z({get(){return P.show_add_token_dialog},set(s){o("update:show_add_token_dialog",s)}});K(m,s=>{s&&(d.value=JSON.parse(JSON.stringify(r.value.entity.token_meta_id_list)))});const r=z(()=>$.plaque_map[P.plaque_id]),k=z(()=>C.sorted_all_token_metas),S=async()=>{y.value=!0;try{for(let[s,e]of d.value.entries()){const l=C.all_token_metas[e];if(!l)throw"Failed to find store token for token: "+e;if(l.entity.platform!=ie.Opensea)continue;const i=JSON.parse(JSON.stringify(l));i.entity.user_id=b.get_account.id,i.entity.platform=ie.OpenseaArchive;const q=await he(i.entity);d.value[s]=q.id}await E(P.plaque_id,{token_meta_id_list:d.value}),$.plaque_map[P.plaque_id].entity.token_meta_id_list=d.value}catch(s){O(`Error updating plaque tokens - ${s}`)}y.value=!1,m.value=!1},L=()=>{d.value=[]};return(s,e)=>{const l=c("el-button"),i=c("el-dialog");return _(),h("div",Ae,[t(i,{center:"",modelValue:g(m),"onUpdate:modelValue":e[1]||(e[1]=q=>ue(m)?m.value=q:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:g(x)=="xs",top:"2vh"},{footer:n(()=>[a("div",Pe,[a("div",null,A(`Artwork in playlist: ${d.value.length}`),1),Se,t(l,{onClick:L},{default:n(()=>[f("Clear")]),_:1}),t(l,{type:"info",onClick:S,loading:y.value},{default:n(()=>[f("Save")]),_:1},8,["loading"])])]),default:n(()=>[t(xe,{selected_token_meta_id_list:d.value,"onUpdate:selected_token_meta_id_list":e[0]||(e[0]=q=>d.value=q),token_meta_list:g(k)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Ne=R(Ve,[["__scopeId","data-v-cc2989e6"]]);const ze={class:"controller-buttons"},Ie=j({__name:"PlaqueController",props:{plaque:null},setup(u){const o=u,P=F(),d=w(!1),y=w(!1),x=w(!1),$=w(!1),C=z({get:()=>o.plaque.entity.orientation||"landscape",set:m=>{E(o.plaque.id,{orientation:m}).then(()=>{P.plaque_map[o.plaque.id].entity.orientation=m,I({type:"success",message:"Plaque orientation updated"})}).catch(r=>{O(`Error updating plaque orientation - ${r}`)})}}),b=m=>{const r={type:m,time_sent:H.now()};E(o.plaque.id,{command:r}).then(()=>{P.plaque_map[o.plaque.id].entity.command=r,I({type:"success",message:"Command sent to plaque"})}).catch(k=>{O(`Error sending command to plaque - ${k}`)}).finally(()=>{d.value=!1,y.value=!1,x.value=!1,$.value=!1})};return(m,r)=>{const k=c("el-button"),S=c("el-radio"),L=c("el-radio-group");return _(),h("div",null,[a("div",ze,[t(k,{circle:"",text:"",loading:d.value,icon:"DArrowLeft",onClick:r[0]||(r[0]=s=>{d.value=!0,b("playlist_previous")})},null,8,["loading"]),t(k,{circle:"",text:"",loading:y.value,icon:"VideoPlay",onClick:r[1]||(r[1]=s=>{y.value=!0,b("play")})},null,8,["loading"]),t(k,{circle:"",text:"",icon:"VideoPause",loading:x.value,onClick:r[2]||(r[2]=s=>{x.value=!0,b("pause")})},null,8,["loading"]),t(k,{circle:"",text:"",icon:"DArrowRight",loading:$.value,onClick:r[3]||(r[3]=s=>{$.value=!0,b("playlist_next")})},null,8,["loading"])]),t(L,{modelValue:g(C),"onUpdate:modelValue":r[4]||(r[4]=s=>ue(C)?C.value=s:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:n(()=>[t(S,{label:"landscape",size:"small"},{default:n(()=>[f("Landscape")]),_:1}),t(S,{label:"portrait",size:"small"},{default:n(()=>[f("Portrait")]),_:1}),t(S,{label:"landscape_reversed",size:"small"},{default:n(()=>[f("Landscape Reversed")]),_:1}),t(S,{label:"portrait_reversed",size:"small"},{default:n(()=>[f("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Le=R(Ie,[["__scopeId","data-v-100e65c8"]]);const V=u=>(Q("data-v-7e521c84"),u=u(),W(),u),Te={style:{display:"flex","align-items":"center",padding:"1em"}},De={key:0},Ee=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Ue={class:"card-simple"},Be=V(()=>a("hr",null,null,-1)),Oe=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Re=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),je={style:{padding:"0.3em 1em"}},Fe={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Je={key:0,class:"card-detail"},Me={style:{padding:"0 1em"}},Ge={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},He=V(()=>a("hr",null,null,-1)),Ke=V(()=>a("div",{style:{padding:"1em"}},"No artwork added",-1)),Qe=V(()=>a("hr",null,null,-1)),We={style:{display:"flex",padding:"1em"}},Xe=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Ye={key:0,style:{padding:"1em"}},Ze={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},et={key:0},tt=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),lt={key:0},at={key:1},nt={style:{"font-size":"var(--el-font-size-extra-small)"}},ot={key:1},st=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),it={style:{display:"flex","justify-content":"end"}},ut=j({__name:"PlaqueCard",props:{plaque:null},setup(u){const o=u,P=F();de();const d=w("simple"),y=w(!1),x=w(!1),$=w(""),C=w(!1),b=async()=>{C.value=!0,await E(o.plaque.id,{name:o.plaque.entity.name}).catch(e=>{O(`Error updating plaque tokens - ${e}`)}),x.value=!1,C.value=!1},m=ce(),r=z(()=>k.value.length==0?null:k.value[0]),k=z(()=>{const e=m.archive_token_meta_map;return o.plaque.entity.token_meta_id_list.map(i=>e[i])}),S=()=>{se.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{E(o.plaque.id,{token_meta_id_list:[]}).then(()=>{P.plaque_map[o.plaque.id].entity.token_meta_id_list=[],I({type:"success",message:"Tokens cleared"})}).catch(e=>{I({message:`Error clearing tokens from plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})},L=()=>{se.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{E(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{P.plaque_map[o.plaque.id].entity.user_id="",P.plaque_map[o.plaque.id].entity.token_meta_id_list=[],I({type:"success",message:"Plaque forgotten"})}).catch(e=>{I({message:`Error forgetting plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})};K(d,e=>{e=="settings"&&o.plaque.entity.user_id&&!$.value&&we(o.plaque.entity.user_id).then(l=>{$.value=l.entity.email}).catch(l=>{I({message:`Error loading user account - ${l}`,type:"error",showClose:!0,duration:12e3})})});const s=z(()=>{var i,q,N;const e=(N=(q=(i=o==null?void 0:o.plaque)==null?void 0:i.entity)==null?void 0:q.machine_data)==null?void 0:N.updated_at;return e?new Date(e.seconds*1e3+e.nanoseconds/1e6).toLocaleString():"N/A"});return(e,l)=>{const i=c("el-button"),q=c("el-tag"),N=c("el-col"),J=c("el-row"),M=c("ArrowRight"),U=c("el-icon"),v=c("el-collapse-transition"),X=c("Close"),me=c("el-card");return _(),T(me,null,{default:n(()=>[a("div",Te,[x.value?oe((_(),h("input",{key:1,"onUpdate:modelValue":l[0]||(l[0]=p=>o.plaque.entity.name=p),class:"edit-name-input"},null,512)),[[ve,o.plaque.entity.name]]):(_(),h("h1",De,A(o.plaque.entity.name),1)),x.value?D("",!0):(_(),T(i,{key:2,icon:g(fe),onClick:l[1]||(l[1]=p=>x.value=!0),class:"editIcon",circle:""},null,8,["icon"])),x.value?(_(),T(i,{key:3,icon:g(ye),loading:C.value,onClick:b,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):D("",!0),Ee,t(q,{class:"ml-2",type:"success"},{default:n(()=>[f("online")]),_:1})]),t(v,null,{default:n(()=>[oe(a("section",Ue,[Be,t(J,{style:{padding:"1em"}},{default:n(()=>[t(N,{span:12},{default:n(()=>{var p;return[Oe,a("span",null,A(((p=g(r))==null?void 0:p.entity.name)||"N/A"),1)]}),_:1}),t(N,{span:12},{default:n(()=>{var p;return[Re,f(" "+A(((p=g(r))==null?void 0:p.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),a("div",je,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),a("div",Fe,[t(i,{type:"info",onClick:l[2]||(l[2]=p=>y.value=!0)},{default:n(()=>[f("Add Artwork")]),_:1}),t(i,{onClick:l[3]||(l[3]=p=>d.value="detail")},{default:n(()=>[f(" Details"),t(U,{class:"el-icon--right"},{default:n(()=>[t(M)]),_:1})]),_:1})])],512),[[ge,d.value=="simple"]])]),_:1}),t(v,null,{default:n(()=>[d.value=="detail"?(_(),h("section",Je,[a("p",Me,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),a("div",Ge,[t(i,{onClick:l[4]||(l[4]=p=>d.value="settings")},{default:n(()=>[f("Settings")]),_:1}),t(i,{onClick:S},{default:n(()=>[f("Clear Artwork")]),_:1})]),He,g(k).length==0?(_(),h(B,{key:0},[Ke,Qe],64)):D("",!0),(_(!0),h(B,null,G(g(k),p=>(_(),T(Ce,{token_meta:p},null,8,["token_meta"]))),256)),a("div",We,[t(i,{type:"info",onClick:l[5]||(l[5]=p=>y.value=!0)},{default:n(()=>[f("Add Artwork")]),_:1}),Xe,t(i,{onClick:l[6]||(l[6]=p=>d.value="simple")},{default:n(()=>[f("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(X)]),_:1})]),_:1})])])):D("",!0)]),_:1}),t(v,null,{default:n(()=>{var p,Y,Z,ee,te,le,ae,ne;return[d.value=="settings"?(_(),h("section",Ye,[t(Le,{plaque:o.plaque},null,8,["plaque"]),a("div",Ze,[u.plaque.entity.user_id?(_(),h("div",et,[tt,$.value?(_(),h("div",lt,A($.value),1)):(_(),h("div",at,"Loading...")),a("div",nt,A(u.plaque.entity.user_id),1)])):(_(),h("div",ot,"No associated user")),u.plaque.entity.user_id?(_(),T(i,{key:2,type:"danger",plain:"",onClick:L},{default:n(()=>[f("Forget Display")]),_:1})):D("",!0)]),a("div",null,[st,a("div",null,"Machine name: "+A((Y=(p=u.plaque.entity.machine_data)==null?void 0:p.machine_name)!=null?Y:"N/A"),1),a("div",null,"Version: "+A((ee=(Z=u.plaque.entity.machine_data)==null?void 0:Z.version)!=null?ee:"N/A"),1),a("div",null,"Local IP: "+A((le=(te=u.plaque.entity.machine_data)==null?void 0:te.local_ip)!=null?le:"N/A"),1),a("div",null,"Public IP: "+A((ne=(ae=u.plaque.entity.machine_data)==null?void 0:ae.public_ip)!=null?ne:"N/A"),1),a("div",null,"Updated At: "+A(g(s)),1)]),a("div",it,[t(i,{onClick:l[7]||(l[7]=yt=>d.value="detail")},{default:n(()=>[f("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(X)]),_:1})]),_:1})])])):D("",!0)]}),_:1}),t(Ne,{plaque_id:o.plaque.id,show_add_token_dialog:y.value,"onUpdate:show_add_token_dialog":l[8]||(l[8]=p=>y.value=p)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var dt=R(ut,[["__scopeId","data-v-7e521c84"]]);const pe=u=>(Q("data-v-0ea15fab"),u=u(),W(),u),rt={class:"subheader",style:{display:"flex","align-items":"center"}},_t=pe(()=>a("div",{style:{"padding-bottom":"40px"}},null,-1)),ct={class:"add-button-container"},pt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},mt=pe(()=>a("div",{style:{"font-size":"17px"}},"Add plaque",-1)),vt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},ft=j({__name:"PlaqueList",setup(u){const o=w(!1),{width:P,screen_type:d}=_e(),y=w(!1),x=de(),$=re(),C=$e(),b=w(""),m=w(localStorage.getItem("filter_by_gallery")||"");K(m,s=>{localStorage.setItem("filter_by_gallery",s)});const r=F(),k=async()=>{o.value=!0,await qe({name:"Test Plaque",user_id:$.get_account.id,token_meta_id_list:[],created_at:H.now(),updated_at:H.now()}).catch(s=>I({message:`Error creating test plaque- ${s}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,y.value=!1},S=z(()=>JSON.parse(JSON.stringify(r.all_plaque_list)).sort((e,l)=>{const i=e.entity.name.toLowerCase(),q=l.entity.name.toLowerCase();return i<q?-1:i>q?1:0})),L=z(()=>{let s=[...S.value];return s=s.filter(e=>e.entity.name||e.entity.user_id||e.entity.token_meta_id_list.length>0),m.value&&(s=s.filter(e=>{var l;return(l=C.gallery_list.find(i=>i.id==m.value))==null?void 0:l.entity.plaque_id_list.includes(e.id)})),b?s.filter(e=>e.entity.name.toLowerCase().includes(b.value.toLowerCase())):s});return(s,e)=>{const l=c("el-input"),i=c("el-option"),q=c("el-select"),N=c("el-button"),J=c("Plus"),M=c("el-icon"),U=c("el-dialog");return _(),h(B,null,[a("div",rt,[t(l,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=v=>b.value=v),"prefix-icon":g(ke),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),t(q,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=v=>m.value=v),placeholder:"Filter by gallery",style:{"margin-left":"10px",width:"260px"}},{default:n(()=>[t(i,{label:"All plaques",value:""}),(_(!0),h(B,null,G(g(C).gallery_list,v=>(_(),T(i,{key:v.id,label:`Filter by gallery - ${v.entity.name}`,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(N,{icon:"Camera",type:"info",onClick:e[2]||(e[2]=v=>g(x).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:n(()=>[f("Scan")]),_:1})]),_t,(_(!0),h(B,null,G(g(L),v=>(_(),T(dt,{plaque:v,key:v.id},null,8,["plaque"]))),128)),a("div",ct,[a("div",pt,[a("div",{class:"add-button",onClick:e[3]||(e[3]=v=>y.value=!0)},[t(M,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:n(()=>[t(J)]),_:1}),mt])])]),t(U,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=v=>y.value=v),title:"Add plaque",width:g(d)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:n(()=>[a("div",vt,[t(N,{onClick:e[4]||(e[4]=v=>{g(x).push("qr-scan"),y.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:n(()=>[f("Scan Plaque QR Code")]),_:1}),t(N,{icon:"plus",onClick:k,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:n(()=>[f("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var It=R(ft,[["__scopeId","data-v-0ea15fab"]]);export{It as default};
