import{_ as H,d as K,r as h,c as z,B as M,b as _,o as c,h as b,i as e,w as a,k as l,t as A,j as m,f as v,C as ee,p as te,m as le,z as T,u as ve,e as L,D as ce,G as we,H as xe,g as B,I as Ce,J as $e,F as R,K as Z,A as pe,l as be,L as Se}from"./index.80efe40e.js";import{u as D,d as Pe}from"./plaque.28daac16.js";import{c as Ve}from"./token-meta.7f5c0ba8.js";import{u as Q}from"./plaque.e6f188fc.js";import{u as fe,g as Ae}from"./account.9ecc5baa.js";import{s as j,a as ye}from"./util.9a4e8d85.js";import{T as me,O as ze}from"./types.d2ec9214.js";import{u as ge}from"./breakpoints.3be562a3.js";import{u as ke}from"./token-meta.cbc4c2a1.js";import{_ as Ie}from"./TokenSelectList.7316dc63.js";import{n as F}from"./firebaseConfig.d7a6b5a9.js";import{P as Ne}from"./PlaqueTokenItem.d2292be4.js";import{u as Le}from"./gallery.959b2195.js";import"./thumbnail-image.73b95669.js";import"./ArtworkFilters.1bf33203.js";import"./gallery.d53d87c7.js";const Te=u=>(te("data-v-381e6960"),u=u(),le(),u),Ee={class:"dialog-container"},Ue={class:"dialog-footer"},De=Te(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Oe=K({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(u,{emit:n}){const x=u,r=h([]),C=h(!1),{screen_type:V}=ge(),S=Q(),w=ke(),P=fe(),g=z({get(){return x.show_add_token_dialog},set(k){n("update:show_add_token_dialog",k)}});M(g,k=>{k&&(r.value=JSON.parse(JSON.stringify(d.value.entity.token_meta_id_list)))});const d=z(()=>S.plaque_map[x.plaque_id]),$=z(()=>w.sorted_all_token_metas),N=async()=>{C.value=!0;try{for(let[k,i]of r.value.entries()){const t=w.all_token_metas[i];if(!t)throw"Failed to find store token for token: "+i;if(t.entity.platform!=me.Opensea)continue;const f=JSON.parse(JSON.stringify(t));f.entity.user_id=P.get_account.id,f.entity.platform=me.OpenseaArchive;const s=await Ve(f.entity);r.value[k]=s.id}await D(x.plaque_id,{token_meta_id_list:r.value}),S.plaque_map[x.plaque_id].entity.token_meta_id_list=r.value}catch(k){j(`Error updating plaque tokens - ${k}`)}C.value=!1,g.value=!1},E=()=>{r.value=[]};return(k,i)=>{const t=_("el-button"),f=_("el-dialog");return c(),b("div",Ee,[e(f,{center:"",modelValue:v(g),"onUpdate:modelValue":i[1]||(i[1]=s=>ee(g)?g.value=s:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:v(V)=="xs",top:"2vh","destroy-on-close":""},{footer:a(()=>[l("div",Ue,[l("div",null,A(`Artwork in playlist: ${r.value.length}`),1),De,e(t,{onClick:E},{default:a(()=>[m("Clear")]),_:1}),e(t,{type:"info",onClick:N,loading:C.value},{default:a(()=>[m("Save")]),_:1},8,["loading"])])]),default:a(()=>[e(Ie,{selected_token_meta_id_list:r.value,"onUpdate:selected_token_meta_id_list":i[0]||(i[0]=s=>r.value=s),token_meta_list:v($)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Be=H(Oe,[["__scopeId","data-v-381e6960"]]);const Fe={class:"controller-buttons"},Me=K({__name:"PlaqueController",props:{plaque:null},setup(u){const n=u,x=Q(),r=h(!1),C=h(!1),V=h(!1),S=h(!1),w=z({get:()=>n.plaque.entity.orientation||"landscape",set:g=>{D(n.plaque.id,{orientation:g}).then(()=>{x.plaque_map[n.plaque.id].entity.orientation=g,T({type:"success",message:"Plaque orientation updated"})}).catch(d=>{j(`Error updating plaque orientation - ${d}`)})}}),P=g=>{const d={type:g,time_sent:F.now()};D(n.plaque.id,{command:d}).then(()=>{x.plaque_map[n.plaque.id].entity.command=d,T({type:"success",message:"Command sent to plaque"})}).catch($=>{j(`Error sending command to plaque - ${$}`)}).finally(()=>{r.value=!1,C.value=!1,V.value=!1,S.value=!1})};return(g,d)=>{const $=_("el-button"),N=_("el-radio"),E=_("el-radio-group");return c(),b("div",null,[l("div",Fe,[e($,{circle:"",text:"",loading:r.value,icon:"DArrowLeft",onClick:d[0]||(d[0]=k=>{r.value=!0,P("playlist_previous")})},null,8,["loading"]),e($,{circle:"",text:"",loading:C.value,icon:"VideoPlay",onClick:d[1]||(d[1]=k=>{C.value=!0,P("play")})},null,8,["loading"]),e($,{circle:"",text:"",icon:"VideoPause",loading:V.value,onClick:d[2]||(d[2]=k=>{V.value=!0,P("pause")})},null,8,["loading"]),e($,{circle:"",text:"",icon:"DArrowRight",loading:S.value,onClick:d[3]||(d[3]=k=>{S.value=!0,P("playlist_next")})},null,8,["loading"])]),e(E,{modelValue:v(w),"onUpdate:modelValue":d[4]||(d[4]=k=>ee(w)?w.value=k:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:a(()=>[e(N,{label:"landscape",size:"small"},{default:a(()=>[m("Landscape")]),_:1}),e(N,{label:"portrait",size:"small"},{default:a(()=>[m("Portrait")]),_:1}),e(N,{label:"landscape_reversed",size:"small"},{default:a(()=>[m("Landscape Reversed")]),_:1}),e(N,{label:"portrait_reversed",size:"small"},{default:a(()=>[m("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Re=H(Me,[["__scopeId","data-v-100e65c8"]]);const I=u=>(te("data-v-8786a792"),u=u(),le(),u),je={style:{display:"flex","align-items":"center",padding:"1em"}},Je={key:0},Ge=I(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),He={class:"card-simple"},Ke=I(()=>l("hr",null,null,-1)),Qe=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),We=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Xe={style:{padding:"0.3em 1em"}},Ye={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Ze={key:0,class:"card-detail"},et={style:{padding:"0 1em"}},tt={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},lt=I(()=>l("hr",null,null,-1)),at=I(()=>l("div",{style:{padding:"1em"}},"No artwork added",-1)),nt=I(()=>l("hr",null,null,-1)),ot={style:{display:"flex",padding:"1em"}},st=I(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),it={key:0,style:{padding:"1em"}},rt={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},ut={key:0},dt=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),_t={key:0},ct={key:1},pt={style:{"font-size":"var(--el-font-size-extra-small)"}},mt={key:1},vt={style:{"margin-bottom":"1em"}},ft=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),yt=I(()=>l("div",{class:"caption"},"Enable Support VPN",-1)),gt={style:{display:"flex","justify-content":"end"}},kt=K({__name:"PlaqueCard",props:{plaque:null},setup(u){const n=u,x=Q();ve();const r=h("simple"),C=h(!1),V=h(!1),S=h(""),w=h(!1),P=async()=>{w.value=!0,await D(n.plaque.id,{name:n.plaque.entity.name}).catch(s=>{j(`Error updating plaque tokens - ${s}`)}),V.value=!1,w.value=!1},g=ke(),d=z(()=>$.value.length==0?null:$.value[0]),$=z(()=>{const s=g.archive_token_meta_map;return n.plaque.entity.token_meta_id_list.map(q=>s[q])}),N=z(()=>ye(n.plaque)),E=z(()=>{const s=n.plaque.entity.last_check_in_time;return s?new Date(s.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):"N/A"}),k=()=>{pe.confirm(`Are you sure you want to clear tokens for plaque '${n.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{D(n.plaque.id,{token_meta_id_list:[]}).then(()=>{x.plaque_map[n.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Tokens cleared"})}).catch(s=>{T({message:`Error clearing tokens from plaque - ${s}`,type:"error",showClose:!0,duration:12e3})})})},i=()=>{pe.confirm(`Are you sure you want to forget the plaque named '${n.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{D(n.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{x.plaque_map[n.plaque.id].entity.user_id="",x.plaque_map[n.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Plaque forgotten"})}).catch(s=>{T({message:`Error forgetting plaque - ${s}`,type:"error",showClose:!0,duration:12e3})})})};M(r,s=>{s=="settings"&&n.plaque.entity.user_id&&!S.value&&Ae(n.plaque.entity.user_id).then(o=>{S.value=o.entity.email}).catch(o=>{T({message:`Error loading user account - ${o}`,type:"error",showClose:!0,duration:12e3})})});const t=z({get:()=>Boolean(n.plaque.entity.vpn_active),set:s=>{D(n.plaque.id,{vpn_active:s}).then(()=>{x.plaque_map[n.plaque.id].entity.vpn_active=s,T({type:"success",message:"VPN setting updated"})}).catch(o=>{j(`Error updating VPN setting- ${o}`)})}}),f=z(()=>{var q,U,O;const s=(O=(U=(q=n==null?void 0:n.plaque)==null?void 0:q.entity)==null?void 0:U.machine_data)==null?void 0:O.updated_at;return s?new Date(s.seconds*1e3+s.nanoseconds/1e6).toLocaleString():"N/A"});return(s,o)=>{const q=_("el-button"),U=_("el-tag"),O=_("el-tooltip"),G=_("el-col"),W=_("el-row"),X=_("ArrowRight"),p=_("el-icon"),Y=_("el-collapse-transition"),ae=_("Close"),qe=_("el-switch"),he=_("el-card");return c(),L(he,null,{default:a(()=>[l("div",je,[V.value?ce((c(),b("input",{key:1,"onUpdate:modelValue":o[0]||(o[0]=y=>n.plaque.entity.name=y),class:"edit-name-input"},null,512)),[[we,n.plaque.entity.name]]):(c(),b("h1",Je,A(n.plaque.entity.name),1)),V.value?B("",!0):(c(),L(q,{key:2,icon:v(xe),onClick:o[1]||(o[1]=y=>V.value=!0),class:"editIcon",circle:""},null,8,["icon"])),V.value?(c(),L(q,{key:3,icon:v(Ce),loading:w.value,onClick:P,class:"editIcon",circle:"",type:w.value?"":"success",text:""},null,8,["icon","loading","type"])):B("",!0),Ge,e(O,{class:"box-item",effect:"dark",content:`Last activity ${v(E)}`,placement:"top"},{default:a(()=>[v(N)?(c(),L(U,{key:0,class:"ml-2",type:"success"},{default:a(()=>[m("online")]),_:1})):(c(),L(U,{key:1,class:"ml-2",type:"danger"},{default:a(()=>[m("offline")]),_:1}))]),_:1},8,["content"])]),e(Y,null,{default:a(()=>[ce(l("section",He,[Ke,e(W,{style:{padding:"1em"}},{default:a(()=>[e(G,{span:12},{default:a(()=>{var y;return[Qe,l("span",null,A(((y=v(d))==null?void 0:y.entity.name)||"N/A"),1)]}),_:1}),e(G,{span:12},{default:a(()=>{var y;return[We,m(" "+A(((y=v(d))==null?void 0:y.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),l("div",Xe,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),l("div",Ye,[e(q,{type:"info",onClick:o[2]||(o[2]=y=>C.value=!0)},{default:a(()=>[m("Add Artwork")]),_:1}),e(q,{onClick:o[3]||(o[3]=y=>r.value="detail")},{default:a(()=>[m(" Details"),e(p,{class:"el-icon--right"},{default:a(()=>[e(X)]),_:1})]),_:1})])],512),[[$e,r.value=="simple"]])]),_:1}),e(Y,null,{default:a(()=>[r.value=="detail"?(c(),b("section",Ze,[l("p",et,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),l("div",tt,[e(q,{onClick:o[4]||(o[4]=y=>r.value="settings")},{default:a(()=>[m("Settings")]),_:1}),e(q,{onClick:k},{default:a(()=>[m("Clear Artwork")]),_:1})]),lt,v($).length==0?(c(),b(R,{key:0},[at,nt],64)):B("",!0),(c(!0),b(R,null,Z(v($),y=>(c(),L(Ne,{token_meta:y},null,8,["token_meta"]))),256)),l("div",ot,[e(q,{type:"info",onClick:o[5]||(o[5]=y=>C.value=!0)},{default:a(()=>[m("Add Artwork")]),_:1}),st,e(q,{onClick:o[6]||(o[6]=y=>r.value="simple")},{default:a(()=>[m("Close"),e(p,{class:"el-icon--right"},{default:a(()=>[e(ae)]),_:1})]),_:1})])])):B("",!0)]),_:1}),e(Y,null,{default:a(()=>{var y,ne,oe,se,ie,re,ue,de;return[r.value=="settings"?(c(),b("section",it,[e(Re,{plaque:n.plaque},null,8,["plaque"]),l("div",rt,[u.plaque.entity.user_id?(c(),b("div",ut,[dt,S.value?(c(),b("div",_t,A(S.value),1)):(c(),b("div",ct,"Loading...")),l("div",pt,A(u.plaque.entity.user_id),1)])):(c(),b("div",mt,"No associated user")),u.plaque.entity.user_id?(c(),L(q,{key:2,type:"danger",plain:"",onClick:i},{default:a(()=>[m("Forget Display")]),_:1})):B("",!0)]),l("div",vt,[ft,l("div",null,"Machine name: "+A((ne=(y=u.plaque.entity.machine_data)==null?void 0:y.machine_name)!=null?ne:"N/A"),1),l("div",null,"Version: "+A((se=(oe=u.plaque.entity.machine_data)==null?void 0:oe.version)!=null?se:"N/A"),1),l("div",null,"Local IP: "+A((re=(ie=u.plaque.entity.machine_data)==null?void 0:ie.local_ip)!=null?re:"N/A"),1),l("div",null,"Public IP: "+A((de=(ue=u.plaque.entity.machine_data)==null?void 0:ue.public_ip)!=null?de:"N/A"),1),l("div",null,"Updated At: "+A(v(f)),1)]),l("div",null,[yt,e(qe,{modelValue:v(t),"onUpdate:modelValue":o[7]||(o[7]=_e=>ee(t)?t.value=_e:null),"active-text":"Enabled","inactive-text":"Off"},null,8,["modelValue"])]),l("div",gt,[e(q,{onClick:o[8]||(o[8]=_e=>r.value="detail")},{default:a(()=>[m("Close"),e(p,{class:"el-icon--right"},{default:a(()=>[e(ae)]),_:1})]),_:1})])])):B("",!0)]}),_:1}),e(Be,{plaque_id:n.plaque.id,show_add_token_dialog:C.value,"onUpdate:show_add_token_dialog":o[9]||(o[9]=y=>C.value=y)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var qt=H(kt,[["__scopeId","data-v-8786a792"]]);const J=u=>(te("data-v-517aa68d"),u=u(),le(),u),ht=J(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),wt=J(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),xt=J(()=>l("div",{class:"caption"},"Sort order",-1)),Ct=J(()=>l("div",{style:{"padding-bottom":"90px"}},null,-1)),$t={class:"add-button-container"},bt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},St=J(()=>l("div",{style:{"font-size":"17px"}},"Add plaque",-1)),Pt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},Vt=K({__name:"PlaqueList",setup(u){const n=h(!1),{screen_type:x}=ge(),r=h(!1),C=ve(),V=fe(),S=Le(),w=h(""),P=h(localStorage.getItem("plaque_list_filter_by_gallery")||"");M(P,i=>{localStorage.setItem("plaque_list_filter_by_gallery",i)});const g=h(localStorage.getItem("online_filter")==="true"||!1);M(g,i=>{if(i){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const d=h(localStorage.getItem("plaque_list_sort_order")||"name");M(d,i=>{localStorage.setItem("plaque_list_sort_order",i)});const $=Q(),N=async()=>{n.value=!0,await Pe({name:"Test Plaque",user_id:V.get_account.id,token_meta_id_list:[],created_at:F.now(),updated_at:F.now(),orientation:ze.Landscape,command:{type:"",time_sent:F.fromMillis(0)},last_check_in_time:F.fromMillis(0),vpn_active:!1,machine_data:{machine_name:"",version:"",local_ip:"",public_ip:"",updated_at:F.fromMillis(0)}}).catch(i=>T({message:`Error creating test plaque- ${i}`,type:"error",showClose:!0,duration:12e3})),n.value=!1,r.value=!1},E=z(()=>JSON.parse(JSON.stringify($.all_plaque_list)).sort((t,f)=>{const s=t.entity.name.toLowerCase(),o=f.entity.name.toLowerCase();return s<o?-1:s>o?1:0})),k=z(()=>{let i=[...E.value];return i=i.filter(t=>t.entity.name||t.entity.user_id||t.entity.token_meta_id_list.length>0),P.value&&(i=i.filter(t=>{var f;return(f=S.gallery_list.find(s=>s.id==P.value))==null?void 0:f.entity.plaque_id_list.includes(t.id)})),g.value&&(i=i.filter(t=>ye(t))),d.value=="name"?i=i.sort((t,f)=>t.entity.name.localeCompare(f.entity.name)):d.value=="last_check_in_time"&&(i=i.sort((t,f)=>t.entity.last_check_in_time==null&&f.entity.last_check_in_time==null?0:t.entity.last_check_in_time==null?1:f.entity.last_check_in_time==null?-1:f.entity.last_check_in_time.seconds-t.entity.last_check_in_time.seconds)),w.value?i.filter(t=>t.entity.name.toLowerCase().includes(w.value.toLowerCase())):i});return(i,t)=>{const f=_("el-input"),s=_("el-button"),o=_("el-option"),q=_("el-select"),U=_("el-switch"),O=_("el-popover"),G=_("Plus"),W=_("el-icon"),X=_("el-dialog");return c(),b(R,null,[l("div",{class:"subheader",style:be([{display:"flex","align-items":"center"},v(x)=="xs"?"padding: 0px 8px 10px;":""])},[e(f,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=p=>w.value=p),"prefix-icon":v(Se),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),e(O,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:a(()=>[e(s,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:a(()=>[m("Filters")]),_:1})]),default:a(()=>[ht,e(q,{modelValue:P.value,"onUpdate:modelValue":t[1]||(t[1]=p=>P.value=p),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:a(()=>[e(o,{label:"All plaques",value:""}),(c(!0),b(R,null,Z(v(S).gallery_list,p=>(c(),L(o,{key:p.id,label:`${p.entity.name}`,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),wt,e(U,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=p=>g.value=p),style:{"margin-bottom":"1em"}},null,8,["modelValue"]),xt,e(q,{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=p=>d.value=p),placeholder:"Sort by",class:"filter-select"},{default:a(()=>[e(o,{label:"Sort by name",value:"name"}),e(o,{label:"Sort by last activity",value:"last_check_in_time"})]),_:1},8,["modelValue"])]),_:1}),e(s,{icon:"Camera",type:"info",onClick:t[4]||(t[4]=p=>v(C).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:a(()=>[m("Scan")]),_:1})],4),Ct,(c(!0),b(R,null,Z(v(k),p=>(c(),L(qt,{plaque:p,key:p.id},null,8,["plaque"]))),128)),l("div",$t,[l("div",bt,[l("div",{class:"add-button",onClick:t[5]||(t[5]=p=>r.value=!0)},[e(W,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:a(()=>[e(G)]),_:1}),St])])]),e(X,{modelValue:r.value,"onUpdate:modelValue":t[7]||(t[7]=p=>r.value=p),title:"Add plaque",width:v(x)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:a(()=>[l("div",Pt,[e(s,{onClick:t[6]||(t[6]=p=>{v(C).push("qr-scan"),r.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:a(()=>[m("Scan Plaque QR Code")]),_:1}),e(s,{icon:"plus",onClick:N,loading:n.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:a(()=>[m("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Gt=H(Vt,[["__scopeId","data-v-517aa68d"]]);export{Gt as default};
