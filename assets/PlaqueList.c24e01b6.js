import{_ as j,d as F,r as h,c as z,y as Q,b as _,o as r,h as q,i as t,w as n,k as a,t as P,j as m,f as y,z as se,p as K,l as W,v as N,u as ie,e as L,A as ae,B as pe,C as me,g as T,D as ve,G as fe,F as O,H as G,I as ne,J as ye}from"./index.0ebf980d.js";import{u as D,c as ge}from"./plaque.093acf64.js";import{c as ke}from"./token-meta.2d60a689.js";import{u as J}from"./plaque.9a59c6ea.js";import{u as ue,g as qe}from"./account.ae1d4f79.js";import{s as R}from"./util.047f5109.js";import{T as oe}from"./types.6a5ef88e.js";import{u as de}from"./breakpoints.b83013bd.js";import{u as re}from"./token-meta.e599d7a2.js";import{_ as he}from"./TokenSelectList.9aaec5c6.js";import{n as H}from"./firebaseConfig.d7a6b5a9.js";import{_ as we}from"./PlaqueTokenItem.9e237f0f.js";import{u as xe}from"./gallery.47ae72de.js";import"./thumbnail-image.ebf23718.js";import"./gallery.82c2a091.js";const Ce=s=>(K("data-v-cc2989e6"),s=s(),W(),s),$e={class:"dialog-container"},be={class:"dialog-footer"},Ae=Ce(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Pe=F({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(s,{emit:o}){const A=s,u=h([]),v=h(!1),{screen_type:w}=de(),C=J(),x=re(),$=ue(),p=z({get(){return A.show_add_token_dialog},set(l){o("update:show_add_token_dialog",l)}});Q(p,l=>{l&&(u.value=JSON.parse(JSON.stringify(d.value.entity.token_meta_id_list)))});const d=z(()=>C.plaque_map[A.plaque_id]),g=z(()=>x.sorted_all_token_metas),S=async()=>{v.value=!0;try{for(let[l,e]of u.value.entries()){const i=x.all_token_metas[e];if(!i)throw"Failed to find store token for token: "+e;if(i.entity.platform!=oe.Opensea)continue;const k=JSON.parse(JSON.stringify(i));k.entity.user_id=$.get_account.id,k.entity.platform=oe.OpenseaArchive;const b=await ke(k.entity);u.value[l]=b.id}await D(A.plaque_id,{token_meta_id_list:u.value}),C.plaque_map[A.plaque_id].entity.token_meta_id_list=u.value}catch(l){R(`Error updating plaque tokens - ${l}`)}v.value=!1,p.value=!1},I=()=>{u.value=[]};return(l,e)=>{const i=_("el-button"),k=_("el-dialog");return r(),q("div",$e,[t(k,{center:"",modelValue:y(p),"onUpdate:modelValue":e[1]||(e[1]=b=>se(p)?p.value=b:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:y(w)=="xs",top:"2vh"},{footer:n(()=>[a("div",be,[a("div",null,P(`Artwork in playlist: ${u.value.length}`),1),Ae,t(i,{onClick:I},{default:n(()=>[m("Clear")]),_:1}),t(i,{type:"info",onClick:S,loading:v.value},{default:n(()=>[m("Save")]),_:1},8,["loading"])])]),default:n(()=>[t(he,{selected_token_meta_id_list:u.value,"onUpdate:selected_token_meta_id_list":e[0]||(e[0]=b=>u.value=b),token_meta_list:y(g)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Se=j(Pe,[["__scopeId","data-v-cc2989e6"]]);const Ve={class:"controller-buttons"},Ne=F({__name:"PlaqueController",props:{plaque:null},setup(s){const o=s,A=J(),u=h(!1),v=h(!1),w=h(!1),C=h(!1),x=z({get:()=>o.plaque.entity.orientation||"landscape",set:p=>{D(o.plaque.id,{orientation:p}).then(()=>{A.plaque_map[o.plaque.id].entity.orientation=p,N({type:"success",message:"Plaque orientation updated"})}).catch(d=>{R(`Error updating plaque orientation - ${d}`)})}}),$=p=>{const d={type:p,time_sent:H.now()};D(o.plaque.id,{command:d}).then(()=>{A.plaque_map[o.plaque.id].entity.command=d,N({type:"success",message:"Command sent to plaque"})}).catch(g=>{R(`Error sending command to plaque - ${g}`)}).finally(()=>{u.value=!1,v.value=!1,w.value=!1,C.value=!1})};return(p,d)=>{const g=_("el-button"),S=_("el-radio"),I=_("el-radio-group");return r(),q("div",null,[a("div",Ve,[t(g,{circle:"",text:"",loading:u.value,icon:"DArrowLeft",onClick:d[0]||(d[0]=l=>{u.value=!0,$("playlist_previous")})},null,8,["loading"]),t(g,{circle:"",text:"",loading:v.value,icon:"VideoPlay",onClick:d[1]||(d[1]=l=>{v.value=!0,$("play")})},null,8,["loading"]),t(g,{circle:"",text:"",icon:"VideoPause",loading:w.value,onClick:d[2]||(d[2]=l=>{w.value=!0,$("pause")})},null,8,["loading"]),t(g,{circle:"",text:"",icon:"DArrowRight",loading:C.value,onClick:d[3]||(d[3]=l=>{C.value=!0,$("playlist_next")})},null,8,["loading"])]),t(I,{modelValue:y(x),"onUpdate:modelValue":d[4]||(d[4]=l=>se(x)?x.value=l:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:n(()=>[t(S,{label:"landscape",size:"small"},{default:n(()=>[m("Landscape")]),_:1}),t(S,{label:"portrait",size:"small"},{default:n(()=>[m("Portrait")]),_:1}),t(S,{label:"landscape_reversed",size:"small"},{default:n(()=>[m("Landscape Reversed")]),_:1}),t(S,{label:"portrait_reversed",size:"small"},{default:n(()=>[m("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var ze=j(Ne,[["__scopeId","data-v-100e65c8"]]);const V=s=>(K("data-v-379658af"),s=s(),W(),s),Ie={style:{display:"flex","align-items":"center",padding:"1em"}},Le={key:0},Te=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),De={class:"card-simple"},Ee=V(()=>a("hr",null,null,-1)),Ue=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Be=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Oe={style:{padding:"0.3em 1em"}},Re={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},je={key:0,class:"card-detail"},Fe={style:{padding:"0 1em"}},Je={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},Me=V(()=>a("hr",null,null,-1)),Ge=V(()=>a("div",{style:{padding:"1em"}},"No artwork added",-1)),He=V(()=>a("hr",null,null,-1)),Qe={style:{display:"flex",padding:"1em"}},Ke=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),We={key:0,style:{padding:"1em"}},Xe={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},Ye={key:0},Ze=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),et={key:0},tt={key:1},lt={style:{"font-size":"var(--el-font-size-extra-small)"}},at={key:1},nt=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),ot={style:{display:"flex","justify-content":"end"}},st=F({__name:"PlaqueCard",props:{plaque:null},setup(s){const o=s,A=J();ie();const u=h("simple"),v=h(!1),w=h(!1),C=h(""),x=h(!1),$=async()=>{x.value=!0,await D(o.plaque.id,{name:o.plaque.entity.name}).catch(l=>{R(`Error updating plaque tokens - ${l}`)}),w.value=!1,x.value=!1},p=re(),d=z(()=>g.value.length==0?null:g.value[0]),g=z(()=>{const l=p.archive_token_meta_map;return o.plaque.entity.token_meta_id_list.map(i=>l[i])}),S=()=>{ne.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{D(o.plaque.id,{token_meta_id_list:[]}).then(()=>{A.plaque_map[o.plaque.id].entity.token_meta_id_list=[],N({type:"success",message:"Tokens cleared"})}).catch(l=>{N({message:`Error clearing tokens from plaque - ${l}`,type:"error",showClose:!0,duration:12e3})})})},I=()=>{ne.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{D(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{A.plaque_map[o.plaque.id].entity.user_id="",A.plaque_map[o.plaque.id].entity.token_meta_id_list=[],N({type:"success",message:"Plaque forgotten"})}).catch(l=>{N({message:`Error forgetting plaque - ${l}`,type:"error",showClose:!0,duration:12e3})})})};return Q(u,l=>{l=="settings"&&o.plaque.entity.user_id&&!C.value&&qe(o.plaque.entity.user_id).then(e=>{C.value=e.entity.email}).catch(e=>{N({message:`Error loading user account - ${e}`,type:"error",showClose:!0,duration:12e3})})}),(l,e)=>{const i=_("el-button"),k=_("el-tag"),b=_("el-col"),E=_("el-row"),M=_("ArrowRight"),U=_("el-icon"),B=_("el-collapse-transition"),f=_("Close"),ce=_("el-card");return r(),L(ce,null,{default:n(()=>[a("div",Ie,[w.value?ae((r(),q("input",{key:1,"onUpdate:modelValue":e[0]||(e[0]=c=>o.plaque.entity.name=c),class:"edit-name-input"},null,512)),[[pe,o.plaque.entity.name]]):(r(),q("h1",Le,P(o.plaque.entity.name),1)),w.value?T("",!0):(r(),L(i,{key:2,icon:y(me),onClick:e[1]||(e[1]=c=>w.value=!0),class:"editIcon",circle:""},null,8,["icon"])),w.value?(r(),L(i,{key:3,icon:y(ve),loading:x.value,onClick:$,class:"editIcon",circle:"",type:x.value?"":"success",text:""},null,8,["icon","loading","type"])):T("",!0),Te,t(k,{class:"ml-2",type:"success"},{default:n(()=>[m("online")]),_:1})]),t(B,null,{default:n(()=>[ae(a("section",De,[Ee,t(E,{style:{padding:"1em"}},{default:n(()=>[t(b,{span:12},{default:n(()=>{var c;return[Ue,a("span",null,P(((c=y(d))==null?void 0:c.entity.name)||"N/A"),1)]}),_:1}),t(b,{span:12},{default:n(()=>{var c;return[Be,m(" "+P(((c=y(d))==null?void 0:c.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),a("div",Oe,P(`Total artworks: ${s.plaque.entity.token_meta_id_list.length}`),1),a("div",Re,[t(i,{type:"info",onClick:e[2]||(e[2]=c=>v.value=!0)},{default:n(()=>[m("Add Artwork")]),_:1}),t(i,{onClick:e[3]||(e[3]=c=>u.value="detail")},{default:n(()=>[m(" Details"),t(U,{class:"el-icon--right"},{default:n(()=>[t(M)]),_:1})]),_:1})])],512),[[fe,u.value=="simple"]])]),_:1}),t(B,null,{default:n(()=>[u.value=="detail"?(r(),q("section",je,[a("p",Fe,P(`Total artworks: ${s.plaque.entity.token_meta_id_list.length}`),1),a("div",Je,[t(i,{onClick:e[4]||(e[4]=c=>u.value="settings")},{default:n(()=>[m("Settings")]),_:1}),t(i,{onClick:S},{default:n(()=>[m("Clear Artwork")]),_:1})]),Me,y(g).length==0?(r(),q(O,{key:0},[Ge,He],64)):T("",!0),(r(!0),q(O,null,G(y(g),c=>(r(),L(we,{token_meta:c},null,8,["token_meta"]))),256)),a("div",Qe,[t(i,{type:"info",onClick:e[5]||(e[5]=c=>v.value=!0)},{default:n(()=>[m("Add Artwork")]),_:1}),Ke,t(i,{onClick:e[6]||(e[6]=c=>u.value="simple")},{default:n(()=>[m("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(f)]),_:1})]),_:1})])])):T("",!0)]),_:1}),t(B,null,{default:n(()=>{var c,X,Y,Z,ee,te,le;return[u.value=="settings"?(r(),q("section",We,[t(ze,{plaque:o.plaque},null,8,["plaque"]),a("div",Xe,[s.plaque.entity.user_id?(r(),q("div",Ye,[Ze,C.value?(r(),q("div",et,P(C.value),1)):(r(),q("div",tt,"Loading...")),a("div",lt,P(s.plaque.entity.user_id),1)])):(r(),q("div",at,"No associated user")),s.plaque.entity.user_id?(r(),L(i,{key:2,type:"danger",plain:"",onClick:I},{default:n(()=>[m("Forget Display")]),_:1})):T("",!0)]),a("div",null,[nt,a("div",null,"Machine name: "+P((X=(c=s.plaque.entity.machine_data)==null?void 0:c.machine_name)!=null?X:"N/A"),1),a("div",null,"Local IP: "+P((Z=(Y=s.plaque.entity.machine_data)==null?void 0:Y.local_ip)!=null?Z:"N/A"),1),a("div",null,"Public IP: "+P((te=(ee=s.plaque.entity.machine_data)==null?void 0:ee.public_ip)!=null?te:"N/A"),1),a("div",null,"Updated At: "+P((le=s.plaque.entity.machine_data)!=null&&le.updated_at?s.plaque.entity.machine_data.updated_at.toDate().toLocaleString():"N/A"),1)]),a("div",ot,[t(i,{onClick:e[7]||(e[7]=vt=>u.value="detail")},{default:n(()=>[m("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(f)]),_:1})]),_:1})])])):T("",!0)]}),_:1}),t(Se,{plaque_id:o.plaque.id,show_add_token_dialog:v.value,"onUpdate:show_add_token_dialog":e[8]||(e[8]=c=>v.value=c)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var it=j(st,[["__scopeId","data-v-379658af"]]);const _e=s=>(K("data-v-0ea15fab"),s=s(),W(),s),ut={class:"subheader",style:{display:"flex","align-items":"center"}},dt=_e(()=>a("div",{style:{"padding-bottom":"40px"}},null,-1)),rt={class:"add-button-container"},_t={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},ct=_e(()=>a("div",{style:{"font-size":"17px"}},"Add plaque",-1)),pt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},mt=F({__name:"PlaqueList",setup(s){const o=h(!1),{width:A,screen_type:u}=de(),v=h(!1),w=ie(),C=ue(),x=xe(),$=h(""),p=h(localStorage.getItem("filter_by_gallery")||"");Q(p,l=>{localStorage.setItem("filter_by_gallery",l)});const d=J(),g=async()=>{o.value=!0,await ge({name:"Test Plaque",user_id:C.get_account.id,token_meta_id_list:[],created_at:H.now(),updated_at:H.now()}).catch(l=>N({message:`Error creating test plaque- ${l}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,v.value=!1},S=z(()=>JSON.parse(JSON.stringify(d.all_plaque_list)).sort((e,i)=>{const k=e.entity.name.toLowerCase(),b=i.entity.name.toLowerCase();return k<b?-1:k>b?1:0})),I=z(()=>{let l=[...S.value];return l=l.filter(e=>e.entity.name||e.entity.user_id||e.entity.token_meta_id_list.length>0),p.value&&(l=l.filter(e=>{var i;return(i=x.gallery_list.find(k=>k.id==p.value))==null?void 0:i.entity.plaque_id_list.includes(e.id)})),$?l.filter(e=>e.entity.name.toLowerCase().includes($.value.toLowerCase())):l});return(l,e)=>{const i=_("el-input"),k=_("el-option"),b=_("el-select"),E=_("el-button"),M=_("Plus"),U=_("el-icon"),B=_("el-dialog");return r(),q(O,null,[a("div",ut,[t(i,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=f=>$.value=f),"prefix-icon":y(ye),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),t(b,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=f=>p.value=f),placeholder:"Filter by gallery",style:{"margin-left":"10px",width:"260px"}},{default:n(()=>[t(k,{label:"All plaques",value:""}),(r(!0),q(O,null,G(y(x).gallery_list,f=>(r(),L(k,{key:f.id,label:`Filter by gallery - ${f.entity.name}`,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(E,{icon:"Camera",type:"info",onClick:e[2]||(e[2]=f=>y(w).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:n(()=>[m("Scan")]),_:1})]),dt,(r(!0),q(O,null,G(y(I),f=>(r(),L(it,{plaque:f,key:f.id},null,8,["plaque"]))),128)),a("div",rt,[a("div",_t,[a("div",{class:"add-button",onClick:e[3]||(e[3]=f=>v.value=!0)},[t(U,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:n(()=>[t(M)]),_:1}),ct])])]),t(B,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=f=>v.value=f),title:"Add plaque",width:y(u)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:n(()=>[a("div",pt,[t(E,{onClick:e[4]||(e[4]=f=>{y(w).push("qr-scan"),v.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:n(()=>[m("Scan Plaque QR Code")]),_:1}),t(E,{icon:"plus",onClick:g,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:n(()=>[m("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Nt=j(mt,[["__scopeId","data-v-0ea15fab"]]);export{Nt as default};
