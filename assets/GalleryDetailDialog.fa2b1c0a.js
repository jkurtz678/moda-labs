import{u as Q,a as W,b as Y}from"./account.57bcab3b.js";import{u as Z}from"./token-meta.493ba6b6.js";import{u as ee,s as le}from"./gallery.d53d87c7.js";import{T as te}from"./types.d2ec9214.js";import{n as B}from"./firebaseConfig.d7a6b5a9.js";import{d as G,c as V,b as m,o as x,h as $,k as a,t as U,i as s,f as u,C as ae,F as E,r as y,q as I,L as se,g as L,K as oe,e as ie,_ as ne,O as re,w as p,u as ue,a as _e,j as P,X as de,y as D,p as ce,m as pe}from"./index.9e8f8fc5.js";import{s as q}from"./util.dcf45611.js";import{u as me}from"./gallery.b472b4b2.js";import{u as ve}from"./breakpoints.d8fd811e.js";import{u as fe}from"./plaque.da87043a.js";import{_ as ye}from"./TokenSelectList.6ebbd631.js";import"./token-meta.7f5c0ba8.js";import"./plaque.28daac16.js";import"./thumbnail-image.66004347.js";import"./ArtworkFilters.e11a187c.js";const ge={class:"card-flex-container"},he={style:{flex:"3 1 0%",display:"flex","align-items":"center",padding:"0px 10px 0px 0px"}},qe={class:"bold"},xe=a("hr",{class:"hr"},null,-1),ke=G({__name:"AddPlaqueItem",props:{in_list:{type:Boolean},plaque:null},emits:["update_plaque_list"],setup(v,{emit:k}){const e=v,r=V({get(){return e.in_list},set(){k("update_plaque_list",e.plaque.id)}});return(g,d)=>{const c=m("el-checkbox");return x(),$(E,null,[a("div",ge,[a("div",he,[a("p",qe,U(e.plaque.entity.name),1)]),s(c,{modelValue:u(r),"onUpdate:modelValue":d[0]||(d[0]=f=>ae(r)?r.value=f:null),style:{"margin-right":"10px"}},null,8,["modelValue"])]),xe],64)}}}),we={style:{"margin-top":"10px","overflow-y":"auto","max-height":"250px"}},be={key:0},Ve=G({__name:"PlaqueSelectList",props:{selected_plaque_id_list:null,plaque_list:null},emits:["update:selected_plaque_id_list"],setup(v,{emit:k}){const e=v,r=y(""),g=y([]);I(()=>{if(!!e.plaque_list)for(let o of e.plaque_list)c.value.has(o.id)?g.value.unshift(o):g.value.push(o)});const d=V(()=>r.value.trim()!==""?g.value.filter(o=>{var i;return(i=o.entity.name)==null?void 0:i.toLowerCase().includes(r.value.toLowerCase())}):g.value),c=V(()=>new Set(e.selected_plaque_id_list)),f=o=>{let i=[...e.selected_plaque_id_list];i.some(h=>h===o)?i=i.filter(h=>h!=o):i.push(o),k("update:selected_plaque_id_list",i)};return(o,i)=>{const h=m("el-input");return x(),$(E,null,[s(h,{type:"text",modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=w=>r.value=w),"prefix-icon":u(se),placeholder:"Search by plaque name"},null,8,["modelValue","prefix-icon"]),a("div",we,[u(d).length==0?(x(),$("div",be,"No plaque found")):L("",!0),(x(!0),$(E,null,oe(u(d),w=>(x(),ie(ke,{plaque:w,in_list:Boolean(u(c).has(w.id)),onUpdate_plaque_list:f},null,8,["plaque","in_list"]))),256))])],64)}}});const S=v=>(ce("data-v-1929efac"),v=v(),pe(),v),$e={class:"gallery-dialog"},Se={style:{"max-width":"500px",margin:"0 auto"}},Ue=S(()=>a("div",{class:"header"},"Gallery Name",-1)),Ce=S(()=>a("div",{class:"header"},"Users",-1)),Ee={key:0},Ge={style:{display:"flex","align-items":"center",padding:"1em 0em","max-width":"350px"}},Ae={style:{"margin-bottom":"2em"}},Be=S(()=>a("div",{class:"header"},"Plaques",-1)),Pe=S(()=>a("div",{class:"header"},"Artwork",-1)),De={class:"dialog-footer"},Ie=S(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Le=G({__name:"GalleryDetailDialog",setup(v){const k=y(!0),e=y({name:"",user_id_list:[],plaque_id_list:[],token_meta_id_list:[],created_at:B.now(),updated_at:B.now()}),r=y(),g=re({name:[{required:!0,message:"Required",trigger:"blur"}]}),d=y(!1),c=y(""),f=ue(),o=_e(),i=Q(),h=fe(),w=me(),N=Z(),{screen_type:T}=ve(),b=y([]),O=V(()=>e.value.user_id_list.map(t=>b.value.find(l=>l.id==t))),R=V(()=>Object.values(h.plaque_map)),j=V(()=>Object.values(N.all_token_metas).filter(t=>t.entity.platform!=te.Opensea));I(async()=>{if(o.params.gallery_id){const t=w.gallery_list.find(l=>l.id===o.params.gallery_id);if(!t){q("Gallery not found"),f.push({name:"gallery-list"});return}e.value=t.entity,console.log("gallery.value",e.value),await W(e.value.user_id_list).then(l=>{console.log("accounts"),l.forEach(_=>{b.value.push(_)})}).catch(l=>{q(l)})}else b.value.push(i.get_account),e.value.user_id_list=[i.get_account.id]});const M=async t=>{if(!t){q("Error finding form element");return}if(!!await t.validate(_=>_)){if(d.value=!0,o.params.gallery_id){await ee(o.params.gallery_id,e.value).then(()=>{D.success("Gallery updated"),f.push({name:"gallery-list"})}).catch(_=>{q(_)}).finally(()=>{d.value=!1});return}le(e.value).then(()=>{D({message:"Gallery saved",type:"success"}),f.push({name:"gallery-list"})}).catch(_=>{q(`Error saving gallery: ${_}`)}).finally(()=>{d.value=!1})}},z=async()=>{if(b.value.find(t=>t.entity.email===c.value)){q("User already added");return}await Y(c.value).then(t=>{t&&(b.value.push(t),e.value.user_id_list.push(t.id))}).catch(t=>{console.log(t),q("Invalid email")})},F=t=>{e.value.user_id_list.splice(t,1),b.value.splice(t,1)};return(t,l)=>{const _=m("el-input"),K=m("el-form-item"),A=m("el-table-column"),C=m("el-button"),X=m("el-row"),H=m("el-form"),J=m("el-dialog");return x(),$("div",$e,[s(J,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=n=>k.value=n),title:"Edit Gallery",onClose:l[6]||(l[6]=n=>u(f).push({name:"gallery-list"})),top:"2vh",width:"75%",fullscreen:u(T)=="xs"},{footer:p(()=>[a("div",De,[Ie,s(C,{color:"#000000",onClick:l[4]||(l[4]=n=>M(r.value))},{default:p(()=>[P("Save")]),_:1})])]),default:p(()=>[a("div",Se,[s(H,{ref_key:"form_ref",ref:r,model:e.value,rules:g},{default:p(()=>[s(K,{prop:"name",style:{"max-width":"280px","margin-bottom":"2em"}},{default:p(()=>[Ue,s(_,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=n=>e.value.name=n),placeholder:"Name"},null,8,["modelValue"])]),_:1}),s(X,{style:{display:"block","margin-bottom":"1em"}},{default:p(()=>[Ce,s(u(de),{data:u(O),style:{width:"100%"}},{default:p(()=>[s(A,{prop:"entity.email",label:"Email"}),s(A,{fixed:"right",label:"",width:"50"},{default:p(n=>[n.$index?(x(),$("div",Ee,[s(C,{link:"",type:"primary",size:"small",icon:"close",onClick:Ne=>F(n.$index)},null,8,["onClick"])])):L("",!0)]),_:1})]),_:1},8,["data"]),a("div",null,U(`Users in gallery: ${e.value.user_id_list.length}`),1),a("div",Ge,[s(_,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=n=>c.value=n),placeholder:"Email"},null,8,["modelValue"]),s(C,{icon:"Plus",color:"#000000",size:"small",style:{"margin-left":"1em"},onClick:z},{default:p(()=>[P(" Add user ")]),_:1})])]),_:1}),a("div",Ae,[Be,s(Ve,{selected_plaque_id_list:e.value.plaque_id_list,"onUpdate:selected_plaque_id_list":l[2]||(l[2]=n=>e.value.plaque_id_list=n),plaque_list:u(R)},null,8,["selected_plaque_id_list","plaque_list"]),a("div",null,U(`Plaques in gallery: ${e.value.plaque_id_list.length}`),1)]),a("div",null,[Pe,s(ye,{selected_token_meta_id_list:e.value.token_meta_id_list,"onUpdate:selected_token_meta_id_list":l[3]||(l[3]=n=>e.value.token_meta_id_list=n),token_meta_list:u(j),max_height:350},null,8,["selected_token_meta_id_list","token_meta_list"]),a("div",null,U(`Artwork in gallery: ${e.value.token_meta_id_list.length}`),1)])]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","fullscreen"])])}}});var el=ne(Le,[["__scopeId","data-v-1929efac"]]);export{el as default};
