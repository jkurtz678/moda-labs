import{d as N,P as Z,Q as ee,r as S,o as y,h as w,F as D,I as P,M as O,f as p,S as te,j as G,t as I,T as ne,U as oe,m as Q,z as K,_ as Y,u as J,L as le,c as q,b as $,k,n as U,i as c,w as h,V as W,e as X,g as ae,K as ie,p as re,l as se}from"./index.d7badc26.js";import{u as ce}from"./thumbnail-image.59b5922c.js";import{c as ue,d as de}from"./types.6a5ef88e.js";import{s as me}from"./util.1f160661.js";import{u as _e}from"./token-meta.875a2dc7.js";import{u as pe}from"./gallery.974fd23e.js";import"./firebaseConfig.d7a6b5a9.js";import"./token-meta.2d60a689.js";import"./account.056481f0.js";import"./gallery.82c2a091.js";const fe={columnWidth:400,gap:0,keyMapper:(o,u,T,g)=>g,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function ve({columns:o,columnWidth:u,emit:T,gap:g,items:i,maxColumns:f,minColumns:d,nextTick:V,onBeforeUnmount:x,onMounted:B,rtl:M,scrollContainer:A,ssrColumns:r,vue:t,wall:e,watch:l}){function m(a,n,C,F){const L=_(C);return F+n+L<=a?m(a,n,C+1,F+n+L):C}function _(a){const n=Array.isArray(u.value)?u.value:[u.value];return n[a%n.length]}function v(){const a=m(e.value.getBoundingClientRect().width,g.value,0,-g.value),n=s(b(a));return n>0?n:1}function b(a){const n=f==null?void 0:f.value;return n&&a>n?n:a}function s(a){const n=d==null?void 0:d.value;return n&&a<n?n:a}function E(a){return[...new Array(a)].map(()=>[])}if(r.value>0){const a=E(r.value);i.value.forEach((n,C)=>a[C%r.value].push(C)),o.value=a}async function R(a){if(a>=i.value.length)return;await V();const n=[...e.value.children];M.value&&n.reverse();const C=n.reduce((F,L)=>L.getBoundingClientRect().height<F.getBoundingClientRect().height?L:F);o.value[+C.dataset.index].push(a),await R(a+1)}async function z(a=!1){if(o.value.length===v()&&!a){T(t===2?"redraw-skip":"redrawSkip");return}o.value=E(v());const n=A==null?void 0:A.value,C=n?n.scrollTop:window.scrollY;await R(0),n?n.scrollBy({top:C-n.scrollTop}):window.scrollTo({top:C}),T("redraw")}const H=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>z());return B(()=>{z(),H==null||H.observe(e.value)}),x(()=>H==null?void 0:H.unobserve(e.value)),l([i,M],()=>z(!0)),l([u,g,d,f],()=>z()),{getColumnWidthTarget:_}}const ye=["data-index"],ke=N({__name:"masonry-wall",props:Z({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},fe),emits:["redraw","redrawSkip"],setup(o,{emit:u}){const T=o,{columnWidth:g,items:i,gap:f,rtl:d,ssrColumns:V,scrollContainer:x,minColumns:B,maxColumns:M,keyMapper:A}=ee(T),r=S([]),t=S(),{getColumnWidthTarget:e}=ve({columns:r,columnWidth:g,emit:u,gap:f,items:i,keyMapper:A,maxColumns:M,minColumns:B,nextTick:ne,onBeforeUnmount:oe,onMounted:Q,rtl:d,scrollContainer:x,ssrColumns:V,vue:3,wall:t,watch:K});return(l,m)=>(y(),w("div",{ref_key:"wall",ref:t,class:"masonry-wall",style:O({display:"flex",gap:`${p(f)}px`})},[(y(!0),w(D,null,P(r.value,(_,v)=>(y(),w("div",{key:v,class:"masonry-column","data-index":v,style:O({display:"flex","flex-basis":`${p(e)(v)}px`,"flex-direction":"column","flex-grow":1,gap:`${p(f)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(y(!0),w(D,null,P(_,(b,s)=>(y(),w("div",{key:p(A)(p(i)[b],v,s,b),class:"masonry-item"},[te(l.$slots,"default",{item:p(i)[b],column:v,row:s,index:b},()=>[G(I(p(i)[b]),1)])]))),128))],12,ye))),128))],4))}}),ge=(()=>{const o=ke;return o.install=u=>{u.component("MasonryWall",o)},o})();const he=["src"],we={class:"header"},xe={class:"platform"},be={style:{"font-size":"1.6em","font-weight":"bold"}},Ce={key:0},Se={key:1,style:{"font-weight":"bold"}},Te={key:3,style:{height:"32px"}},Ve={style:{"font-size":"0.9em","line-height":"1.3em"}},Ae=N({__name:"ArtworkTile",props:{token_meta:null},setup(o){const u=o,T=J(),g=ce(le(u,"token_meta")),i=S(!1),f=S(0),d=S(),V=S(),x=q(()=>ue(u.token_meta.entity.platform)),B=async()=>{const e=await de(u.token_meta);if(!e){me("Error getting source file");return}window.open(e,"_blank")},M=()=>{const e=T.resolve({name:"preview-plaque",params:{token_meta_id:u.token_meta.id}});window.open(e.href)},A=()=>{window.open(u.token_meta.entity.public_link,"_blank")},r=()=>{window.open(u.token_meta.entity.artist_social_link,"_blank")};function t(e){if(!d.value){console.log("animateDivHeight - error finding tile container");return}if(e&&f.value==0&&(f.value=d.value.offsetHeight),!V.value){console.log("animateDivHeight - error finding detail container");return}let l;e?l=V.value.offsetHeight:l=f.value;const m=300,_=10,v=d.value.offsetHeight,b=Math.ceil(l-v),s=Math.ceil(m/_),E=b/s;let R=0;const z=setInterval(()=>{if(R>=s){d.value.style.height=l+"px",clearInterval(z);return}R++;const H=v+E*R;d.value.style.height=H+"px"},_)}return(e,l)=>{const m=$("el-button"),_=$("el-tooltip");return y(),w("div",{ref_key:"tile_container",ref:d,class:"custom-card",onClick:l[1]||(l[1]=()=>{i.value=!i.value,t(i.value)})},[k("img",{class:U(i.value?"absolute":""),src:p(g)},null,10,he),k("div",{class:U([i.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),k("div",{class:U(["transition absolute",i.value?"hide-blur":"show-blur"])},[k("div",we,I(`${o.token_meta.entity.name} | ${o.token_meta.entity.artist}`),1),k("div",xe,I(p(x)),1)],2),k("div",{ref_key:"detail_container",ref:V,class:U(["detail-container transition",i.value?"show-blur":"hide-blur absolute-no-b"])},[k("div",be,I(o.token_meta.entity.name),1),o.token_meta.entity.artist_social_link?(y(),w("div",Ce,[c(m,{link:"",style:{"font-weight":"bold",display:"block"},onClick:W(r,["stop"])},{default:h(()=>[G(I(o.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(y(),w("div",Se,I(o.token_meta.entity.artist),1)),i.value?(y(),w(D,{key:2},[c(_,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:h(()=>[c(m,{icon:"Download",text:"",circle:"",onClick:W(B,["stop"])},null,8,["onClick"])]),_:1}),c(_,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:h(()=>[c(m,{icon:"Tickets",text:"",circle:"",onClick:W(M,["stop"])},null,8,["onClick"])]),_:1}),o.token_meta.entity.public_link?(y(),X(_,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:h(()=>[c(m,{icon:"Link",text:"",circle:"",onClick:W(A,["stop"])},null,8,["onClick"])]),_:1})):ae("",!0),c(_,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:h(()=>[c(m,{icon:"Edit",text:"",circle:"",onClick:l[0]||(l[0]=W(v=>p(T).push({name:"edit-artwork",params:{token_meta_id:u.token_meta.id}}),["stop"]))})]),_:1})],64)):(y(),w("div",Te)),k("div",Ve,I(o.token_meta.entity.description),1)],2)],512)}}});var Me=Y(Ae,[["__scopeId","data-v-4c7c2f92"]]);const j=o=>(re("data-v-6cc8d86a"),o=o(),se(),o),$e={class:"subheader",style:{display:"flex","align-items":"center"}},Be=j(()=>k("div",{class:"caption"},"Filter by gallery",-1)),Ie=j(()=>k("div",{class:"caption"},"Sort order",-1)),Re=j(()=>k("div",{style:{"padding-bottom":"40px"}},null,-1)),ze=N({__name:"ArtworkTileGrid",setup(o){const u=J(),T=_e(),g=pe(),i=S(""),f=S(null),d=S(localStorage.getItem("token_list_sort_order")||"name"),V=S(1e3),x=S(localStorage.getItem("artwork_grid_filter_by_gallery")||"");K(x,r=>{localStorage.setItem("artwork_grid_filter_by_gallery",r)});const B=q(()=>T.sorted_all_token_metas),M=q(()=>{let r=B.value.filter(t=>{var e,l;return((e=t.entity.artist)==null?void 0:e.toLowerCase().includes(i.value.toLowerCase()))||((l=t.entity.name)==null?void 0:l.toLowerCase().includes(i.value.toLowerCase()))});return x.value&&(r=r.filter(t=>{var e;return(e=g.gallery_list.find(l=>l.id==x.value))==null?void 0:e.entity.token_meta_id_list.includes(t.id)})),d.value==="name"?r=r.sort((t,e)=>t.entity.name.localeCompare(e.entity.name)):d.value==="created_at"&&(r=r.sort((t,e)=>t.entity.created_at==null&&e.entity.created_at==null?0:t.entity.created_at==null?1:e.entity.created_at==null?-1:e.entity.created_at.seconds-t.entity.created_at.seconds)),r}),A=q(()=>{const r=M.value,t=0,e=t+V.value;return r.slice(t,e)});return Q(()=>{if(!document.getElementById("masonry-container")){console.log("ArtworkTileGrid error, masonary_wall element not found");return}}),(r,t)=>{const e=$("el-input"),l=$("el-button"),m=$("el-option"),_=$("el-select"),v=$("el-popover"),b=$("RouterView");return y(),w(D,null,[k("div",$e,[c(e,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),"prefix-icon":p(ie),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),c(v,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:h(()=>[c(l,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:h(()=>[G("Filters")]),_:1})]),default:h(()=>[Be,c(_,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:h(()=>[c(m,{label:"All plaques",value:""}),(y(!0),w(D,null,P(p(g).gallery_list,s=>(y(),X(m,{key:s.id,label:`${s.entity.name}`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ie,c(_,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=s=>d.value=s),placeholder:"Sort by"},{default:h(()=>[c(m,{label:"Sort by name",value:"name"}),c(m,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),c(l,{icon:"Plus",type:"info",onClick:t[3]||(t[3]=s=>p(u).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:h(()=>[G("Artwork")]),_:1})]),Re,k("div",{id:"masonry-container",ref_key:"masonryContainer",ref:f,style:{"overflow-y":"auto",height:"100%",padding:"10px",margin:"-10px"}},[c(p(ge),{id:"masonary-wall","scroll-container":f.value,items:p(A),"column-width":250,gap:14},{default:h(({item:s})=>[c(Me,{token_meta:s},null,8,["token_meta"])]),_:1},8,["scroll-container","items"])],512),c(b)],64)}}});var Ne=Y(ze,[["__scopeId","data-v-6cc8d86a"]]);export{Ne as default};
