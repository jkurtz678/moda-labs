import{d as K,P as oe,Q as le,r as T,o as f,h as S,F as W,I as J,M as N,f as d,S as ne,j as O,t as R,T as ae,U as re,m as Z,z as P,_ as ee,u as te,L as ie,c as z,b as L,k as b,n as G,i as n,w,V as F,e as j,g as Y,J as se,x as X,K as ce,p as ue,l as de}from"./index.459f1e60.js";import{u as me}from"./thumbnail-image.6cbcac86.js";import{c as _e,d as pe,T as Q}from"./types.6a5ef88e.js";import{s as fe}from"./util.7c3d329f.js";import{u as ve}from"./account.3baa41f1.js";import{f as ye}from"./token-meta.e73e8480.js";import{u as he}from"./token-meta.244a1395.js";import{u as ke}from"./gallery.798d266b.js";import{u as ge}from"./breakpoints.5c4e1e08.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.82c2a091.js";const we={columnWidth:400,gap:0,keyMapper:(a,r,M,A)=>A,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function be({columns:a,columnWidth:r,emit:M,gap:A,items:i,maxColumns:y,minColumns:h,nextTick:x,onBeforeUnmount:B,onMounted:V,rtl:$,scrollContainer:C,ssrColumns:E,vue:k,wall:I,watch:D}){function H(o,l,g,c){const U=m(g);return c+l+U<=o?H(o,l,g+1,c+l+U):g}function m(o){const l=Array.isArray(r.value)?r.value:[r.value];return l[o%l.length]}function u(){const o=H(I.value.getBoundingClientRect().width,A.value,0,-A.value),l=e(_(o));return l>0?l:1}function _(o){const l=y==null?void 0:y.value;return l&&o>l?l:o}function e(o){const l=h==null?void 0:h.value;return l&&o<l?l:o}function t(o){return[...new Array(o)].map(()=>[])}if(E.value>0){const o=t(E.value);i.value.forEach((l,g)=>o[g%E.value].push(g)),a.value=o}async function p(o){if(o>=i.value.length)return;await x();const l=[...I.value.children];$.value&&l.reverse();const g=l.reduce((c,U)=>U.getBoundingClientRect().height<c.getBoundingClientRect().height?U:c);a.value[+g.dataset.index].push(o),await p(o+1)}async function v(o=!1){if(a.value.length===u()&&!o){M(k===2?"redraw-skip":"redrawSkip");return}a.value=t(u());const l=C==null?void 0:C.value,g=l?l.scrollTop:window.scrollY;await p(0),l?l.scrollBy({top:g-l.scrollTop}):window.scrollTo({top:g}),M("redraw")}const s=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>v());return V(()=>{v(),s==null||s.observe(I.value)}),B(()=>s==null?void 0:s.unobserve(I.value)),D([i,$],()=>v(!0)),D([r,A,h,y],()=>v()),{getColumnWidthTarget:m}}const xe=["data-index"],Ce=K({__name:"masonry-wall",props:oe({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},we),emits:["redraw","redrawSkip"],setup(a,{emit:r}){const M=a,{columnWidth:A,items:i,gap:y,rtl:h,ssrColumns:x,scrollContainer:B,minColumns:V,maxColumns:$,keyMapper:C}=le(M),E=T([]),k=T(),{getColumnWidthTarget:I}=be({columns:E,columnWidth:A,emit:r,gap:y,items:i,keyMapper:C,maxColumns:$,minColumns:V,nextTick:ae,onBeforeUnmount:re,onMounted:Z,rtl:h,scrollContainer:B,ssrColumns:x,vue:3,wall:k,watch:P});return(D,H)=>(f(),S("div",{ref_key:"wall",ref:k,class:"masonry-wall",style:N({display:"flex",gap:`${d(y)}px`})},[(f(!0),S(W,null,J(E.value,(m,u)=>(f(),S("div",{key:u,class:"masonry-column","data-index":u,style:N({display:"flex","flex-basis":`${d(I)(u)}px`,"flex-direction":"column","flex-grow":1,gap:`${d(y)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(f(!0),S(W,null,J(m,(_,e)=>(f(),S("div",{key:d(C)(d(i)[_],u,e,_),class:"masonry-item"},[ne(D.$slots,"default",{item:d(i)[_],column:u,row:e,index:_},()=>[O(R(d(i)[_]),1)])]))),128))],12,xe))),128))],4))}}),Te=(()=>{const a=Ce;return a.install=r=>{r.component("MasonryWall",a)},a})();const Se=["src"],Ae={class:"header"},Ve={class:"platform"},$e={style:{"font-size":"1.6em","font-weight":"bold"}},Ee={key:0},Me={key:1,style:{"font-weight":"bold"}},Be={key:3,style:{height:"32px"}},Ie={style:{"font-size":"0.9em","line-height":"1.3em"}},De=K({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(a){const r=a,M=te(),A=me(ie(r,"token_meta")),i=T(!1),y=T(0),h=T(),x=T(),B=ve(),V=z(()=>_e(r.token_meta.entity.platform)),$=async()=>{const m=await pe(r.token_meta);if(!m){fe("Error getting source file");return}window.open(m,"_blank")},C=z(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),E=()=>{const m=M.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(m.href)},k=()=>{window.open(r.token_meta.entity.public_link,"_blank")},I=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function D(m){if(!h.value){console.log("animateDivHeight - error finding tile container");return}if(m&&y.value==0&&(y.value=h.value.offsetHeight),!x.value){console.log("animateDivHeight - error finding detail container");return}let u;m&&x.value.offsetHeight>y.value?u=x.value.offsetHeight:u=y.value;const _=300,e=10,t=h.value.offsetHeight,p=Math.ceil(u-t),v=Math.ceil(_/e),s=p/v;let o=0;const l=setInterval(()=>{if(o>=v){h.value.style.height=u+"px",clearInterval(l);return}o++;const g=t+s*o;h.value.style.height=g+"px"},e)}const H=()=>{se.prompt(`Are you sure you want to delete ${r.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:m})=>{if(m)return ye(r.token_meta.id)}).then(()=>{X({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(m=>{X({message:`Error deleting artwork - ${m}`,type:"error",showClose:!0,duration:12e3})})};return(m,u)=>{const _=L("el-button"),e=L("el-tooltip");return f(),S("div",{ref_key:"tile_container",ref:h,class:"custom-card",onClick:u[1]||(u[1]=()=>{i.value=!i.value,D(i.value)}),style:N(i.value?"":`height: ${d(C)}px !important`)},[b("img",{class:G(i.value?"absolute":""),src:d(A)},null,10,Se),b("div",{class:G([i.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),b("div",{class:G(["transition absolute",i.value?"hide-blur":"show-blur"])},[b("div",Ae,R(`${a.token_meta.entity.name} | ${a.token_meta.entity.artist}`),1),b("div",Ve,R(d(V)),1)],2),b("div",{ref_key:"detail_container",ref:x,class:G(["detail-container transition",i.value?"show-blur":"hide-blur absolute-no-b"])},[b("div",$e,R(a.token_meta.entity.name),1),a.token_meta.entity.artist_social_link?(f(),S("div",Ee,[n(_,{link:"",style:{"font-weight":"bold",display:"block"},onClick:F(I,["stop"])},{default:w(()=>[O(R(a.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(f(),S("div",Me,R(a.token_meta.entity.artist),1)),i.value?(f(),S(W,{key:2},[n(e,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:w(()=>[n(_,{icon:"Edit",text:"",circle:"",onClick:u[0]||(u[0]=F(t=>d(M).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),n(e,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:w(()=>[n(_,{icon:"Download",text:"",circle:"",onClick:F($,["stop"])},null,8,["onClick"])]),_:1}),n(e,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:w(()=>[n(_,{icon:"Tickets",text:"",circle:"",onClick:F(E,["stop"])},null,8,["onClick"])]),_:1}),a.token_meta.entity.public_link?(f(),j(e,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:w(()=>[n(_,{icon:"Link",text:"",circle:"",onClick:F(k,["stop"])},null,8,["onClick"])]),_:1})):Y("",!0),d(B).is_user_admin?(f(),j(e,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:w(()=>[n(_,{icon:"Delete",text:"",circle:"",onClick:F(H,["stop"])},null,8,["onClick"])]),_:1})):Y("",!0)],64)):(f(),S("div",Be)),b("div",Ie,R(a.token_meta.entity.description),1)],2)],4)}}});var Le=ee(De,[["__scopeId","data-v-bc2a1e7c"]]);const q=a=>(ue("data-v-6a29ce8d"),a=a(),de(),a),He={class:"subheader",style:{display:"flex","align-items":"center"}},Re=q(()=>b("div",{class:"caption"},"Filter by gallery",-1)),ze=q(()=>b("div",{class:"caption"},"Filter by aspect ratio",-1)),Fe=q(()=>b("div",{class:"caption"},"Filter by platform",-1)),Pe=q(()=>b("div",{class:"caption"},"Sort order",-1)),Ue=q(()=>b("div",{style:{"padding-bottom":"40px"}},null,-1)),We={key:1,style:{padding:"1em"}},qe=K({__name:"ArtworkTileGrid",setup(a){const r=te(),M=he(),A=ke(),i=T(""),y=T(null),h=30,x=T(h),B=T(localStorage.getItem("artwork_grid_aspect_ratio_filter")||"");P(B,e=>{localStorage.setItem("artwork_grid_aspect_ratio_filter",e)});const V=T(localStorage.getItem("artwork_grid_filter_by_gallery")||"");P(V,e=>{localStorage.setItem("artwork_grid_filter_by_gallery",e)});const $=T(localStorage.getItem("artwork_grid_filter_by_platform")||"");P($,e=>{localStorage.setItem("artwork_grid_filter_by_platform",e)});const C=T(localStorage.getItem("artwork_grid_sort_order")||"name");P(C,e=>{localStorage.setItem("artwork_grid_sort_order",e)}),P(i,e=>{x.value=h});const E=250,k=10,{screen_type:I}=ge(),D=z(()=>{switch(I.value){case"xs":return 340-k*2;case"sm":return 650-k*2;case"md":return 960-k*2;case"lg":return 1200-k*2;case"xl":return 1700-k*2}return 0}),H=z(()=>{let e=Math.floor(D.value/(E+k));return e>5&&(e=5),(D.value-(e-1)*k)/e}),m=z(()=>M.sorted_all_token_metas.filter(e=>Boolean(e.entity.aspect_ratio))),u=z(()=>{let e=m.value.filter(t=>{var p,v,s;if(i.value&&!((p=t.entity.artist)!=null&&p.toLowerCase().includes(i.value.toLowerCase()))&&!((v=t.entity.name)!=null&&v.toLowerCase().includes(i.value.toLowerCase()))||V.value&&!((s=A.gallery_list.find(o=>o.id==V.value))!=null&&s.entity.token_meta_id_list.includes(t.id)))return!1;switch($.value){case"moda_archive":if(t.entity.platform!=Q.Archive)return!1;break;case"opensea":if(t.entity.platform!=Q.Opensea&&t.entity.platform!=Q.OpenseaArchive)return!1;break}switch(B.value){case"portrait":if(!t.entity.aspect_ratio||t.entity.aspect_ratio>.9)return!1;break;case"landscape":if(!t.entity.aspect_ratio||t.entity.aspect_ratio<1.1)return!1;break;case"square":if(!t.entity.aspect_ratio||t.entity.aspect_ratio<.9||t.entity.aspect_ratio>1.1)return!1;break}return!0});return C.value==="name"?e=e.sort((t,p)=>t.entity.name.localeCompare(p.entity.name)):C.value==="created_at"&&(e=e.sort((t,p)=>t.entity.created_at==null&&p.entity.created_at==null?0:t.entity.created_at==null?1:p.entity.created_at==null?-1:p.entity.created_at.seconds-t.entity.created_at.seconds)),e}),_=z(()=>{const e=u.value,t=0,p=t+x.value;return e.slice(t,p)});return Z(()=>{const e=document.getElementById("masonry-container");if(!e){console.log("ArtworkTileGrid error, masonary_wall element not found");return}e.addEventListener("scroll",()=>{const t=e.scrollTop,p=e.scrollHeight,v=e.clientHeight;t/(p-v)*100>90&&x.value<u.value.length&&(x.value=x.value+20)})}),(e,t)=>{const p=L("el-input"),v=L("el-button"),s=L("el-option"),o=L("el-select"),l=L("el-popover"),g=L("RouterView");return f(),S(W,null,[b("div",He,[n(p,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c),"prefix-icon":d(ce),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),n(l,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:w(()=>[n(v,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:w(()=>[O("Filters")]),_:1})]),default:w(()=>[Re,n(o,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=c=>V.value=c),placeholder:"Filter by gallery",class:"filter-select"},{default:w(()=>[n(s,{label:"All artwork",value:""}),(f(!0),S(W,null,J(d(A).gallery_list,c=>(f(),j(s,{key:c.id,label:`${c.entity.name}`,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),ze,n(o,{modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=c=>B.value=c),class:"filter-select"},{default:w(()=>[n(s,{label:"All",value:""}),n(s,{label:"Landscape",value:"landscape"}),n(s,{label:"Portrait",value:"portrait"}),n(s,{label:"Square",value:"square"})]),_:1},8,["modelValue"]),Fe,n(o,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=c=>$.value=c),class:"filter-select"},{default:w(()=>[n(s,{label:"All",value:""}),n(s,{label:"Moda Archive",value:"moda_archive"}),n(s,{label:"Opensea",value:"opensea"})]),_:1},8,["modelValue"]),Pe,n(o,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=c=>C.value=c),placeholder:"Sort by",class:"filter-select"},{default:w(()=>[n(s,{label:"Sort by name",value:"name"}),n(s,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),n(v,{icon:"Plus",type:"info",onClick:t[5]||(t[5]=c=>d(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:w(()=>[O("Artwork")]),_:1})]),Ue,b("div",{id:"masonry-container",ref_key:"masonryContainer",ref:y,style:{"overflow-y":"auto",height:"100%",padding:"10px"}},[d(_).length>0?(f(),j(d(Te),{key:0,id:"masonary-wall","scroll-container":y.value,items:d(_),"column-width":E,gap:k,style:N(`width: ${d(D)}px; margin: auto`),"max-columns":5},{default:w(({item:c})=>[n(Le,{token_meta:c,column_width:d(H)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(f(),S("div",We,"No artwork found"))],512),n(g)],64)}}});var tt=ee(qe,[["__scopeId","data-v-6a29ce8d"]]);export{tt as default};
