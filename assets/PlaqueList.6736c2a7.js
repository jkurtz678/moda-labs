import{_ as J,d as M,r as w,c as N,y as Y,b as r,o as d,h as q,i as l,w as o,k as a,t as P,j as m,f,z as ne,p as R,l as G,u as Z,e as V,A as Q,B as se,C as ie,g as T,D as de,G as ue,F as O,H as F,I as K,v as B,J as re}from"./index.0b499ab4.js";import{u as j,c as _e}from"./plaque.093acf64.js";import{c as ce}from"./token-meta.2d60a689.js";import{u as H}from"./plaque.effe820f.js";import{u as ee}from"./account.c01a5e50.js";import{s as te}from"./util.5d88da01.js";import{T as W}from"./types.6a5ef88e.js";import{u as le}from"./breakpoints.3f93b18b.js";import{u as ae}from"./token-meta.6624afc3.js";import{_ as pe}from"./TokenSelectList.261f2a78.js";import{_ as me}from"./PlaqueTokenItem.26bafd5e.js";import{n as X}from"./firebaseConfig.d7a6b5a9.js";import{u as fe}from"./gallery.3fa599fb.js";import"./thumbnail-image.84beb344.js";import"./gallery.82c2a091.js";const ye=n=>(R("data-v-cc2989e6"),n=n(),G(),n),ve={class:"dialog-container"},ge={class:"dialog-footer"},ke=ye(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),qe=M({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(n,{emit:s}){const x=n,i=w([]),y=w(!1),{screen_type:h}=le(),C=H(),A=ae(),b=ee(),v=N({get(){return x.show_add_token_dialog},set(t){s("update:show_add_token_dialog",t)}});Y(v,t=>{t&&(i.value=JSON.parse(JSON.stringify(S.value.entity.token_meta_id_list)))});const S=N(()=>C.plaque_map[x.plaque_id]),I=N(()=>A.sorted_all_token_metas),D=async()=>{y.value=!0;try{for(let[t,e]of i.value.entries()){const p=A.all_token_metas[e];if(!p)throw"Failed to find store token for token: "+e;if(p.entity.platform!=W.Opensea)continue;const c=JSON.parse(JSON.stringify(p));c.entity.user_id=b.get_account.id,c.entity.platform=W.OpenseaArchive;const k=await ce(c.entity);i.value[t]=k.id}await j(x.plaque_id,{token_meta_id_list:i.value}),C.plaque_map[x.plaque_id].entity.token_meta_id_list=i.value}catch(t){te(`Error updating plaque tokens - ${t}`)}y.value=!1,v.value=!1},g=()=>{i.value=[]};return(t,e)=>{const p=r("el-button"),c=r("el-dialog");return d(),q("div",ve,[l(c,{center:"",modelValue:f(v),"onUpdate:modelValue":e[1]||(e[1]=k=>ne(v)?v.value=k:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:f(h)=="xs",top:"2vh"},{footer:o(()=>[a("div",ge,[a("div",null,P(`Artwork in playlist: ${i.value.length}`),1),ke,l(p,{onClick:g},{default:o(()=>[m("Clear")]),_:1}),l(p,{type:"info",onClick:D,loading:y.value},{default:o(()=>[m("Save")]),_:1},8,["loading"])])]),default:o(()=>[l(pe,{selected_token_meta_id_list:i.value,"onUpdate:selected_token_meta_id_list":e[0]||(e[0]=k=>i.value=k),token_meta_list:f(I)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var he=J(qe,[["__scopeId","data-v-cc2989e6"]]);const $=n=>(R("data-v-31a993d0"),n=n(),G(),n),we={style:{display:"flex","align-items":"center",padding:"1em"}},xe={key:0},Ce=$(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),$e={class:"card-simple"},be=$(()=>a("hr",null,null,-1)),Se=$(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Ae=$(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Pe={style:{padding:"0.3em 1em"}},Ve={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Ne={key:0,class:"card-detail"},Te={style:{padding:"0 1em"}},Ie={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},De=$(()=>a("hr",null,null,-1)),Ee=$(()=>a("div",{style:{padding:"1em"}},"No artwork added",-1)),Le=$(()=>a("hr",null,null,-1)),ze={style:{display:"flex",padding:"1em"}},Be=$(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Oe={key:0,style:{padding:"1em"}},Ue={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},je={key:0},Fe=$(()=>a("div",null,"Associated User ID:",-1)),Je={key:1},Me={style:{display:"flex","justify-content":"end"}},Re=M({__name:"PlaqueCard",props:{plaque:null},setup(n){const s=n,x=H();Z();const i=w("simple"),y=w(!1),h=w(!1),C=w(!1),A=async()=>{C.value=!0,await j(s.plaque.id,{name:s.plaque.entity.name}).catch(g=>{te(`Error updating plaque tokens - ${g}`)}),h.value=!1,C.value=!1},b=ae(),v=N(()=>S.value.length==0?null:S.value[0]),S=N(()=>{const g=b.archive_token_meta_map;return s.plaque.entity.token_meta_id_list.map(e=>g[e])}),I=()=>{K.confirm(`Are you sure you want to clear tokens for plaque '${s.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{j(s.plaque.id,{token_meta_id_list:[]}).then(()=>{x.plaque_map[s.plaque.id].entity.token_meta_id_list=[],B({type:"success",message:"Tokens cleared"})}).catch(g=>{B({message:`Error clearing tokens from plaque - ${g}`,type:"error",showClose:!0,duration:12e3})})})},D=()=>{K.confirm(`Are you sure you want to forget the plaque named '${s.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{j(s.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{x.plaque_map[s.plaque.id].entity.user_id="",x.plaque_map[s.plaque.id].entity.token_meta_id_list=[],B({type:"success",message:"Plaque forgotten"})}).catch(g=>{B({message:`Error forgetting plaque - ${g}`,type:"error",showClose:!0,duration:12e3})})})};return(g,t)=>{const e=r("el-button"),p=r("el-tag"),c=r("el-col"),k=r("el-row"),E=r("ArrowRight"),L=r("el-icon"),z=r("el-collapse-transition"),U=r("Close"),_=r("el-card");return d(),V(_,null,{default:o(()=>[a("div",we,[h.value?Q((d(),q("input",{key:1,"onUpdate:modelValue":t[0]||(t[0]=u=>s.plaque.entity.name=u),class:"edit-name-input"},null,512)),[[se,s.plaque.entity.name]]):(d(),q("h1",xe,P(s.plaque.entity.name),1)),h.value?T("",!0):(d(),V(e,{key:2,icon:f(ie),onClick:t[1]||(t[1]=u=>h.value=!0),class:"editIcon",circle:""},null,8,["icon"])),h.value?(d(),V(e,{key:3,icon:f(de),loading:C.value,onClick:A,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):T("",!0),Ce,l(p,{class:"ml-2",type:"success"},{default:o(()=>[m("online")]),_:1})]),l(z,null,{default:o(()=>[Q(a("section",$e,[be,l(k,{style:{padding:"1em"}},{default:o(()=>[l(c,{span:12},{default:o(()=>{var u;return[Se,a("span",null,P(((u=f(v))==null?void 0:u.entity.name)||"N/A"),1)]}),_:1}),l(c,{span:12},{default:o(()=>{var u;return[Ae,m(" "+P(((u=f(v))==null?void 0:u.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),a("div",Pe,P(`Total artworks: ${n.plaque.entity.token_meta_id_list.length}`),1),a("div",Ve,[l(e,{type:"info",onClick:t[2]||(t[2]=u=>y.value=!0)},{default:o(()=>[m("Add Artwork")]),_:1}),l(e,{onClick:t[3]||(t[3]=u=>i.value="detail")},{default:o(()=>[m(" Details"),l(L,{class:"el-icon--right"},{default:o(()=>[l(E)]),_:1})]),_:1})])],512),[[ue,i.value=="simple"]])]),_:1}),l(z,null,{default:o(()=>[i.value=="detail"?(d(),q("section",Ne,[a("p",Te,P(`Total artworks: ${n.plaque.entity.token_meta_id_list.length}`),1),a("div",Ie,[l(e,{onClick:t[4]||(t[4]=u=>i.value="settings")},{default:o(()=>[m("Settings")]),_:1}),l(e,{onClick:I},{default:o(()=>[m("Clear Artwork")]),_:1})]),De,f(S).length==0?(d(),q(O,{key:0},[Ee,Le],64)):T("",!0),(d(!0),q(O,null,F(f(S),u=>(d(),V(me,{token_meta:u},null,8,["token_meta"]))),256)),a("div",ze,[l(e,{type:"info",onClick:t[5]||(t[5]=u=>y.value=!0)},{default:o(()=>[m("Add Artwork")]),_:1}),Be,l(e,{onClick:t[6]||(t[6]=u=>i.value="simple")},{default:o(()=>[m("Close"),l(L,{class:"el-icon--right"},{default:o(()=>[l(U)]),_:1})]),_:1})])])):T("",!0)]),_:1}),l(z,null,{default:o(()=>[i.value=="settings"?(d(),q("section",Oe,[a("div",Ue,[n.plaque.entity.user_id?(d(),q("div",je,[Fe,a("div",null,P(n.plaque.entity.user_id),1)])):(d(),q("div",Je,"No associated user")),n.plaque.entity.user_id?(d(),V(e,{key:2,type:"danger",plain:"",onClick:D},{default:o(()=>[m("Forget Display")]),_:1})):T("",!0)]),a("div",Me,[l(e,{onClick:t[7]||(t[7]=u=>i.value="detail")},{default:o(()=>[m("Close"),l(L,{class:"el-icon--right"},{default:o(()=>[l(U)]),_:1})]),_:1})])])):T("",!0)]),_:1}),l(he,{plaque_id:s.plaque.id,show_add_token_dialog:y.value,"onUpdate:show_add_token_dialog":t[8]||(t[8]=u=>y.value=u)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var Ge=J(Re,[["__scopeId","data-v-31a993d0"]]);const oe=n=>(R("data-v-0ea15fab"),n=n(),G(),n),He={class:"subheader",style:{display:"flex","align-items":"center"}},Qe=oe(()=>a("div",{style:{"padding-bottom":"40px"}},null,-1)),Ke={class:"add-button-container"},We={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},Xe=oe(()=>a("div",{style:{"font-size":"17px"}},"Add plaque",-1)),Ye={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},Ze=M({__name:"PlaqueList",setup(n){const s=w(!1),{width:x,screen_type:i}=le(),y=w(!1),h=Z(),C=ee(),A=fe(),b=w(""),v=w(localStorage.getItem("filter_by_gallery")||"");Y(v,t=>{localStorage.setItem("filter_by_gallery",t)});const S=H(),I=async()=>{s.value=!0,await _e({name:"Test Plaque",user_id:C.get_account.id,token_meta_id_list:[],created_at:X.now(),updated_at:X.now()}).catch(t=>B({message:`Error creating test plaque- ${t}`,type:"error",showClose:!0,duration:12e3})),s.value=!1,y.value=!1},D=N(()=>JSON.parse(JSON.stringify(S.all_plaque_list)).sort((e,p)=>{const c=e.entity.name.toLowerCase(),k=p.entity.name.toLowerCase();return c<k?-1:c>k?1:0})),g=N(()=>{let t=[...D.value];return t=t.filter(e=>e.entity.name||e.entity.user_id||e.entity.token_meta_id_list.length>0),v.value&&(t=t.filter(e=>{var p;return(p=A.gallery_list.find(c=>c.id==v.value))==null?void 0:p.entity.plaque_id_list.includes(e.id)})),b?t.filter(e=>e.entity.name.toLowerCase().includes(b.value.toLowerCase())):t});return(t,e)=>{const p=r("el-input"),c=r("el-option"),k=r("el-select"),E=r("el-button"),L=r("Plus"),z=r("el-icon"),U=r("el-dialog");return d(),q(O,null,[a("div",He,[l(p,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=_=>b.value=_),"prefix-icon":f(re),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),l(k,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=_=>v.value=_),placeholder:"Filter by gallery",style:{"margin-left":"10px",width:"260px"}},{default:o(()=>[l(c,{label:"All plaques",value:""}),(d(!0),q(O,null,F(f(A).gallery_list,_=>(d(),V(c,{key:_.id,label:`Filter by gallery - ${_.entity.name}`,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(E,{icon:"Camera",type:"info",onClick:e[2]||(e[2]=_=>f(h).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:o(()=>[m("Scan")]),_:1})]),Qe,(d(!0),q(O,null,F(f(g),_=>(d(),V(Ge,{plaque:_,key:_.id},null,8,["plaque"]))),128)),a("div",Ke,[a("div",We,[a("div",{class:"add-button",onClick:e[3]||(e[3]=_=>y.value=!0)},[l(z,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:o(()=>[l(L)]),_:1}),Xe])])]),l(U,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=_=>y.value=_),title:"Add plaque",width:f(i)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:o(()=>[a("div",Ye,[l(E,{onClick:e[4]||(e[4]=_=>{f(h).push("qr-scan"),y.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:o(()=>[m("Scan Plaque QR Code")]),_:1}),l(E,{icon:"plus",onClick:I,loading:s.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:o(()=>[m("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var ft=J(Ze,[["__scopeId","data-v-0ea15fab"]]);export{ft as default};
