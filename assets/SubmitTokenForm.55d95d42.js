import{c as P}from"./token-meta.ed14bc9b.js";import{i as I,r as j,j as G,h as C,B as O,T as z,u as H,s as k}from"./account.940f64b9.js";import{m as U,d as J,k as _,G as $,r as u,o as V,f as x,w as l,h as t,e as a,g as R,j as v,t as T,i as w,D as K}from"./index.33ecc5ed.js";const Q=I(),W=async(h,f,e,i)=>{console.log("uploadFile - starting file upload for ",h);const y=j(Q,h);G(y,f).on("state_changed",d=>{console.log("snapshot",d.bytesTransferred,d.totalBytes),e(d.bytesTransferred/d.totalBytes)},d=>{console.log("uploadFile error - ",d),U({message:`Error uploading file to moda archive - ${d}`,type:"error",showClose:!0,duration:12e3})},i)};const X=v("Ethereum"),Y=v("Off-chain"),Z=w("div",{class:"el-upload__text"},[v(" Drop file here or "),w("em",null,"click to upload")],-1),le=J({setup(h){const f=_();_();const e=$({name:"",artist:"",description:"",public_link:"",created_at:C.now(),updated_at:C.now(),media_id:"",media_type:"",wallet_address:"",blockchain:O.Ethereum,asset_contract_address:"",token_id:"",platform:z.Archive}),i=_([]),y=$({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),p=_(!1),d=_("0%"),q=H(),A=(c,o)=>K.confirm(`Cancel the upload of ${c.name} ?`).then(()=>!0,()=>!1),E=()=>{},S=async c=>{var b;if(!c){k("Error finding form element");return}if(!await c.validate(m=>m))return;if(e.wallet_address=q.get_account.entity.wallet_address,e.blockchain!="ethereum"&&(e.asset_contract_address="",e.token_id=""),((b=i==null?void 0:i.value)==null?void 0:b.length)!==1){k("Please add a file to upload");return}const r=i.value[0],n=m=>{d.value=`${Math.round(m*100)}%`},g=()=>{D(c,r)};p.value=!0,W(`${r.uid||""}`,r.raw,n,g).catch(m=>{console.error(m),p.value=!1,k(`Error uploading file to moda archive - ${m}`)})},D=(c,o)=>{e.media_id=`${(o==null?void 0:o.uid)||""}`,e.media_type=`.${o.name.split(".").pop()||""}`,console.log("upload success, sending form: ",e),P(e).then(r=>{c.resetFields(),i.value=[],U({type:"success",message:"Successfully submitted token"})}).catch(r=>{k(`Error uploading metadata to moda archive - ${r}`)}).finally(()=>p.value=!1)};return(c,o)=>{const r=u("el-input"),n=u("el-form-item"),g=u("el-radio"),b=u("el-radio-group"),m=u("upload-filled"),B=u("el-icon"),F=u("el-upload"),M=u("Loading"),N=u("el-button"),L=u("el-form");return V(),x(L,{ref_key:"formRef",ref:f,model:a(e),rules:a(y),"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:l(()=>[t(n,{label:"Artwork title",style:{"max-width":"550px"},prop:"name"},{default:l(()=>[t(r,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=s=>a(e).name=s)},null,8,["modelValue"])]),_:1}),t(n,{label:"Artist name",style:{"max-width":"550px"},prop:"artist"},{default:l(()=>[t(r,{modelValue:a(e).artist,"onUpdate:modelValue":o[1]||(o[1]=s=>a(e).artist=s)},null,8,["modelValue"])]),_:1}),t(n,{label:"Blockchain"},{default:l(()=>[t(b,{modelValue:a(e).blockchain,"onUpdate:modelValue":o[2]||(o[2]=s=>a(e).blockchain=s)},{default:l(()=>[t(g,{label:"ethereum"},{default:l(()=>[X]),_:1}),t(g,{label:"off_chain"},{default:l(()=>[Y]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(e).blockchain=="ethereum"?(V(),x(n,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:l(()=>[t(r,{modelValue:a(e).asset_contract_address,"onUpdate:modelValue":o[3]||(o[3]=s=>a(e).asset_contract_address=s)},null,8,["modelValue"])]),_:1})):R("",!0),a(e).blockchain=="ethereum"?(V(),x(n,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:l(()=>[t(r,{modelValue:a(e).token_id,"onUpdate:modelValue":o[4]||(o[4]=s=>a(e).token_id=s)},null,8,["modelValue"])]),_:1})):R("",!0),t(n,{label:"Description",prop:"description"},{default:l(()=>[t(r,{modelValue:a(e).description,"onUpdate:modelValue":o[5]||(o[5]=s=>a(e).description=s),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(n,{label:"Public Link",prop:"public_link"},{default:l(()=>[t(r,{modelValue:a(e).public_link,"onUpdate:modelValue":o[6]||(o[6]=s=>a(e).public_link=s)},null,8,["modelValue"])]),_:1}),t(n,null,{default:l(()=>[t(F,{class:"upload-demo","auto-upload":!1,action:"","on-remove":E,"before-remove":A,limit:1,drag:"","file-list":i.value},{default:l(()=>[t(B,{class:"el-icon--upload"},{default:l(()=>[t(m)]),_:1}),Z]),_:1},8,["file-list"])]),_:1}),t(n,null,{default:l(()=>[t(N,{onClick:o[7]||(o[7]=s=>S(f.value)),loading:p.value},{loading:l(()=>[t(B,{class:"is-loading",style:{"margin-right":"4px"}},{default:l(()=>[t(M)]),_:1}),v(" "+T(d.value),1)]),default:l(()=>[w("div",null,T(p.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});export{le as _};
