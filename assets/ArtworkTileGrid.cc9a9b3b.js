import{d as J,P as ae,r as A,Q as se,S as re,m as Z,z as ee,T as ie,o as i,h as f,F as N,H as Q,n as I,u as E,U as ce,k as q,t as z,J as ue,c as L,i as h,l as W,j as _,w as S,V as P,a as G,g as O,b as te,f as U,_ as ne,y as de,x as Y,I as me}from"./index.5f8a4b4c.js";import{a as pe}from"./thumbnail-image.1f8b9761.js";import{c as _e,d as fe}from"./types.903c99bc.js";import{s as ve,m as ke}from"./util.4ea42a61.js";import{u as ye}from"./account.c4505bc5.js";import{f as he}from"./token-meta.3b6b8610.js";import{u as oe}from"./gallery.2133b462.js";import{u as le}from"./breakpoints.479d360a.js";import{u as ge}from"./token-meta.b008b41b.js";import{A as we}from"./ArtworkFilters.f29f15dc.js";import"./firebaseConfig.4d01e9b5.js";import"./gallery-token.7f50acd9.js";import"./plaque.7062bb32.js";import"./plaque.9bc68070.js";const xe={columnWidth:400,gap:0,keyMapper:(d,m,o,v)=>v,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function be({columns:d,columnWidth:m,emit:o,gap:v,items:l,maxColumns:p,minColumns:a,nextTick:x,onBeforeUnmount:B,onMounted:g,rtl:y,scrollContainer:b,ssrColumns:R,vue:r,wall:s,watch:C}){function D(n,e,u,V){const F=H(u);return V+e+F<=n?D(n,e,u+1,V+e+F):u}function H(n){const e=Array.isArray(m.value)?m.value:[m.value];return e[n%e.length]}function w(){const n=D(s.value.getBoundingClientRect().width,v.value,0,-v.value),e=t(j(n));return e>0?e:1}function j(n){const e=p==null?void 0:p.value;return e&&n>e?e:n}function t(n){const e=a==null?void 0:a.value;return e&&n<e?e:n}function T(n){return Array.from({length:n}).map(()=>[])}if(R.value>0){const n=T(R.value);l.value.forEach((e,u)=>n[u%R.value].push(u)),d.value=n}async function c(n){if(n>=l.value.length)return;await x();const e=[...s.value.children];y.value&&e.reverse();const u=e.reduce((V,F)=>F.getBoundingClientRect().height<V.getBoundingClientRect().height?F:V);d.value[+u.dataset.index].push(n),await c(n+1)}async function k(n=!1){if(d.value.length===w()&&!n){o(r===2?"redraw-skip":"redrawSkip");return}d.value=T(w());const e=b==null?void 0:b.value,u=e?e.scrollTop:window.scrollY;await c(0),e?e.scrollBy({top:u-e.scrollTop}):window.scrollTo({top:u}),o("redraw")}const M=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>k());return g(()=>{k(),M==null||M.observe(s.value)}),B(()=>M==null?void 0:M.unobserve(s.value)),C([l,y],()=>k(!0)),C([m,v,a,p],()=>k()),{getColumnWidthTarget:H}}const Ce=["data-index"],Te=J({__name:"masonry-wall",props:ae({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},xe),emits:["redraw","redrawSkip"],setup(d,{emit:m}){const o=d,v=A([]),l=A(),{getColumnWidthTarget:p}=be({columns:v,emit:m,nextTick:se,onBeforeUnmount:re,onMounted:Z,vue:3,wall:l,watch:ee,...ie(o)});return(a,x)=>(i(),f("div",{ref_key:"wall",ref:l,class:"masonry-wall",style:I({display:"flex",gap:`${a.gap}px`})},[(i(!0),f(N,null,Q(v.value,(B,g)=>(i(),f("div",{key:g,class:"masonry-column","data-index":g,style:I({display:"flex","flex-basis":`${E(p)(g)}px`,"flex-direction":"column","flex-grow":1,gap:`${a.gap}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(i(!0),f(N,null,Q(B,(y,b)=>(i(),f("div",{key:a.keyMapper(a.items[y],g,b,y),class:"masonry-item"},[ce(a.$slots,"default",{item:a.items[y],column:g,row:b,index:y},()=>[q(z(a.items[y]),1)])]))),128))],12,Ce))),128))],4))}}),Ee=(()=>{const d=Te;return d.install=m=>{m.component("MasonryWall",d)},d})();const Ae=["src"],Be={class:"header"},De={class:"platform"},Me={style:{"font-size":"1.6em","font-weight":"bold"}},ze={key:1,style:{"font-weight":"bold"}},Se={key:2,style:{display:"flex","align-items":"center"}},$e={key:2,style:{"font-size":"0.8em","padding-left":"1em",color:"#606266"}},Re={key:3,style:{height:"32px"}},He={style:{"font-size":"0.9em","line-height":"1.3em"}},Ve={style:{margin:"10px 0px"}},Fe=J({__name:"ArtworkTile",props:{token_meta:{},column_width:{}},setup(d){const m=te(),o=d,v=pe(ue(o,"token_meta")),l=A(!1),p=A(0),a=A(),x=A(),B=ye(),g=oe(),{screen_type:y}=le(),b=L(()=>_e(o.token_meta.entity.platform)),R=async()=>{const t=await fe(o.token_meta);if(!t){ve("Error getting source file");return}window.open(t,"_blank")},r=L(()=>o.token_meta.entity.aspect_ratio?o.column_width/o.token_meta.entity.aspect_ratio:o.column_width),s=L(()=>{var T,c;const t=(c=(T=o.token_meta)==null?void 0:T.entity)==null?void 0:c.media_size;return t?ke(t):""}),C=()=>{const t=m.resolve({name:"preview-plaque",params:{token_meta_id:o.token_meta.id}});window.open(t.href)},D=()=>{window.open(o.token_meta.entity.public_link,"_blank")},H=()=>{window.open(o.token_meta.entity.artist_social_link,"_blank")};function w(){if(!a.value){console.log("animateDivHeight - error finding tile container");return}if(!l.value&&p.value==0&&(p.value=a.value.offsetHeight),l.value=!l.value,!x.value){console.log("animateDivHeight - error finding detail container");return}let t;l.value&&x.value.offsetHeight>p.value?t=x.value.offsetHeight:t=p.value;const T=300,c=10,k=a.value.offsetHeight,M=Math.ceil(t-k),n=Math.ceil(T/c),e=M/n;let u=0;const V=setInterval(()=>{if(u>=n){a.value.style.height=t+"px",clearInterval(V);return}u++;const F=k+e*u;a.value.style.height=F+"px"},c)}const j=()=>{de.prompt(`Are you sure you want to delete ${o.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:t})=>{if(t)return he(o.token_meta.id)}).then(()=>{Y({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(t=>{Y({message:`Error deleting artwork - ${t}`,type:"error",showClose:!0,duration:12e3})})};return(t,T)=>{const c=U("el-button"),k=U("el-tooltip");return i(),f("div",{ref_key:"tile_container",ref:a,class:"custom-card",onClick:w,style:I(`height: ${r.value}px !important`)},[h("img",{class:W(l.value?"absolute":""),src:E(v)},null,10,Ae),h("div",{class:W([l.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),h("div",{class:W(["transition absolute",l.value?"hide-blur":"show-blur"])},[h("div",Be,z(`${t.token_meta.entity.name} | ${t.token_meta.entity.artist}`),1),h("div",De,z(b.value),1)],2),h("div",{ref_key:"detail_container",ref:x,class:W(["detail-container transition",l.value?"show-blur":"hide-blur"])},[h("div",Me,z(t.token_meta.entity.name),1),t.token_meta.entity.artist_social_link?(i(),f("div",{key:0,style:I(E(y)=="xs"?"display: flex; justify-content: center;":"")},[_(c,{link:"",style:{"font-weight":"bold",display:"block"},disabled:!l.value,onClick:P(H,["stop"])},{default:S(()=>[q(z(t.token_meta.entity.artist),1)]),_:1},8,["disabled"])],4)):(i(),f("div",ze,z(t.token_meta.entity.artist),1)),l.value?(i(),f("div",Se,[_(k,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:S(()=>[_(c,{icon:"Edit",text:"",circle:"",onClick:T[0]||(T[0]=P(M=>E(m).push({name:"edit-artwork",params:{token_meta_id:o.token_meta.id}}),["stop"]))})]),_:1}),_(k,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:S(()=>[_(c,{icon:"Download",text:"",circle:"",onClick:P(R,["stop"])})]),_:1}),_(k,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:S(()=>[_(c,{icon:"Tickets",text:"",circle:"",onClick:P(C,["stop"])})]),_:1}),t.token_meta.entity.public_link?(i(),G(k,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:S(()=>[_(c,{icon:"Link",text:"",circle:"",onClick:P(D,["stop"])})]),_:1})):O("",!0),E(B).is_user_admin?(i(),G(k,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:S(()=>[_(c,{icon:"Delete",text:"",circle:"",onClick:P(j,["stop"])})]),_:1})):O("",!0),s.value?(i(),f("span",$e,z(s.value),1)):O("",!0)])):(i(),f("div",Re)),h("div",He,z(t.token_meta.entity.description),1),h("div",Ve,[(i(!0),f(N,null,Q(E(g).token_id_to_gallery_map.get(o.token_meta.id),M=>(i(),G(c,{size:"small",round:"",plain:"",type:"primary",style:{margin:"3px 10px 3px 0px"}},{default:S(()=>[q(z(M.entity.name),1)]),_:2},1024))),256))])],2)],4)}}});var Le=ne(Fe,[["__scopeId","data-v-a0cdccec"]]);const Pe={key:1,style:{padding:"1em"}},K=30,X=250,$=10,Ie=J({__name:"ArtworkTileGrid",setup(d){const m=te(),o=ge();oe();const v=A(null),l=A(K),p=A([]),a=A("");ee(a,r=>{l.value=K});const{screen_type:x}=le(),B=L(()=>{switch(x.value){case"xs":return 340-$*2;case"sm":return 650-$*2;case"md":return 960-$*2;case"lg":return 1200-$*2;case"xl":return 1700-$*2}return 0}),g=L(()=>{let r=Math.floor(B.value/(X+$));return r>5&&(r=5),(B.value-(r-1)*$)/r}),y=L(()=>o.sorted_all_token_metas),b=L(()=>{const r=p.value,s=0,C=s+l.value;return r.slice(s,C)});Z(()=>{const r=document.getElementById("masonry-container");if(!r){console.log("ArtworkTileGrid error, masonary_wall element not found");return}r.addEventListener("scroll",()=>{const s=r.scrollTop,C=r.scrollHeight,D=r.clientHeight;s/(C-D)*100>90&&l.value<p.value.length&&(l.value=l.value+20)})});const R=r=>{console.log("updateFilteredTokens",r),p.value=r};return(r,s)=>{const C=U("el-input"),D=U("el-button"),H=U("RouterView");return i(),f(N,null,[h("div",{class:"subheader",style:I([{display:"flex","align-items":"center"},E(x)=="xs"?"padding: 0px 8px 10px;":""])},[_(C,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=w=>a.value=w),"prefix-icon":E(me),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),_(we,{all_tokens:y.value,search_filter:a.value,use_local_storage:!0,onUpdateFilteredTokens:s[1]||(s[1]=w=>R(w))},null,8,["all_tokens","search_filter"]),_(D,{icon:"Plus",type:"info",onClick:s[2]||(s[2]=w=>E(m).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:S(()=>s[3]||(s[3]=[q("Artwork")])),_:1})],4),s[4]||(s[4]=h("div",{style:{"padding-bottom":"90px"}},null,-1)),h("div",{id:"masonry-container",ref_key:"masonryContainer",ref:v,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[b.value.length>0?(i(),G(E(Ee),{key:0,id:"masonary-wall","scroll-container":v.value,items:b.value,"column-width":X,gap:$,style:I(`width: ${B.value}px; margin: auto`),"max-columns":5},{default:S(({item:w})=>[_(Le,{token_meta:w,column_width:g.value},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(i(),f("div",Pe,"No artwork found"))],512),_(H)],64)}}});var tt=ne(Ie,[["__scopeId","data-v-3a4e64d3"]]);export{tt as default};
