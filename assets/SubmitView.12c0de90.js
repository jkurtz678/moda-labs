import{c as $}from"./token-meta.1befabf2.js";import{bS as L,bT as E,bU as F,d as I,t as g,S as V,bV as x,a as q,u as D,o as N,E as P,b as O,r as p,c as z,y as G,f as o,h as r,w as a,z as b,P as S,G as H,V as K}from"./index.39763943.js";const j=L(),J=async(v,f,t,u)=>{console.log("uploadFile - starting file upload for ",v);const y=E(j,v);F(y,f).on("state_changed",i=>{console.log("snapshot",i.bytesTransferred,i.totalBytes),t(i.bytesTransferred/i.totalBytes)},i=>{console.log("uploadFile error - ",i)},()=>{console.log("SUCCESS CALLBACK"),u()})},Q={style:{padding:"20px"}},W=b("h1",{style:{"margin-bottom":"15px"}},"SUBMIT TO MODA ARCHIVES",-1),X=b("div",{class:"el-upload__text"},[S(" Drop file here or "),b("em",null,"click to upload")],-1),Y=b("div",null,"SUBMIT",-1),oe=I({setup(v){const f=g();g();const t=V({name:"",artist:"",description:"",public_link:"",created_at:x.now(),updated_at:x.now(),media_id:"",media_type:"",account_id:""}),u=g([]),y=V({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}]}),m=g(!1),i=g("0%"),h=q(),w=D();N(async()=>{const n=window.localStorage.getItem("account_address"),e=window.localStorage.getItem("account_signature");if(n==null||e==null){h.push({name:"login"});return}const l=P.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await w.loadAccount(n,e),t.account_id=w.get_account.id}catch(s){O({message:`Error loading moda archive account - ${s}`,type:"error",showClose:!0,duration:12e3})}finally{l.close()}});const C=(n,e)=>K.confirm(`Cancel the upload of ${n.name} ?`).then(()=>!0,()=>!1),B=()=>{},R=async n=>{var _;if(!n){console.log("SubmitView.vue Submit - formRef is null");return}if(!await n.validate(d=>d))return;if(m.value=!0,((_=u==null?void 0:u.value)==null?void 0:_.length)!==1){console.log("file_list error",u.value);return}const l=u.value[0],s=d=>{console.log("Progress",d),i.value=`${Math.round(d*100)}%`},k=()=>{A(n,l)};J(`${l.uid||""}`,l.raw,s,k).catch(d=>{console.error(d)})},A=(n,e)=>{t.media_id=`${(e==null?void 0:e.uid)||""}`,t.media_type=`.${e.name.split(".").pop()||""}`,console.log("upload success, sending form: ",t),$(t).then(l=>{n.resetFields(),u.value=[],m.value=!1,alert("Successfully submitted token")}).catch(l=>{m.value=!1,alert(l)})};return(n,e)=>{const l=p("el-input"),s=p("el-form-item"),k=p("upload-filled"),_=p("el-icon"),d=p("el-upload"),M=p("Loading"),T=p("el-button"),U=p("el-form");return z(),G("div",Q,[W,o(U,{ref_key:"formRef",ref:f,model:r(t),rules:r(y),"label-position":"left","label-width":"120px",style:{"max-width":"700px"}},{default:a(()=>[o(s,{label:"Artwork title",style:{"max-width":"400px"},prop:"name"},{default:a(()=>[o(l,{modelValue:r(t).name,"onUpdate:modelValue":e[0]||(e[0]=c=>r(t).name=c)},null,8,["modelValue"])]),_:1}),o(s,{label:"Artist name",style:{"max-width":"400px"},prop:"artist"},{default:a(()=>[o(l,{modelValue:r(t).artist,"onUpdate:modelValue":e[1]||(e[1]=c=>r(t).artist=c)},null,8,["modelValue"])]),_:1}),o(s,{label:"Description",prop:"description"},{default:a(()=>[o(l,{modelValue:r(t).description,"onUpdate:modelValue":e[2]||(e[2]=c=>r(t).description=c),type:"textarea",rows:"4"},null,8,["modelValue"])]),_:1}),o(s,{label:"Public Link",prop:"public_link"},{default:a(()=>[o(l,{modelValue:r(t).public_link,"onUpdate:modelValue":e[3]||(e[3]=c=>r(t).public_link=c)},null,8,["modelValue"])]),_:1}),o(s,null,{default:a(()=>[o(d,{class:"upload-demo","auto-upload":!1,action:"","on-remove":B,"before-remove":C,limit:1,drag:"","file-list":u.value},{default:a(()=>[o(_,{class:"el-icon--upload"},{default:a(()=>[o(k)]),_:1}),X]),_:1},8,["file-list"])]),_:1}),o(s,null,{default:a(()=>[o(T,{onClick:e[4]||(e[4]=c=>R(f.value)),loading:m.value},{loading:a(()=>[o(_,{class:"is-loading",style:{"margin-right":"4px"}},{default:a(()=>[o(M)]),_:1}),S(" "+H(i.value),1)]),default:a(()=>[Y]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}});export{oe as default};
