import{d as Q,P as Z,Q as ee,r as V,o as p,h as k,F as U,I as P,M as G,f as c,S as te,j as N,t as L,T as ne,U as oe,m as Y,z as j,_ as J,u as X,L as le,c as E,b as z,k as h,n as q,i as s,w,V as D,e as O,g as ae,K as ie,p as re,l as se}from"./index.6336a010.js";import{u as ce}from"./thumbnail-image.1a6829e1.js";import{c as ue,d as de}from"./types.6a5ef88e.js";import{s as me}from"./util.0288e7af.js";import{u as _e}from"./token-meta.95bc866f.js";import{u as pe}from"./gallery.95d8bbbc.js";import{u as ve}from"./breakpoints.4cb106e8.js";import"./firebaseConfig.d7a6b5a9.js";import"./token-meta.ee0ff4d3.js";import"./account.8e1308bd.js";import"./gallery.82c2a091.js";const fe={columnWidth:400,gap:0,keyMapper:(l,r,$,g)=>g,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function ye({columns:l,columnWidth:r,emit:$,gap:g,items:a,maxColumns:v,minColumns:u,nextTick:x,onBeforeUnmount:b,onMounted:C,rtl:I,scrollContainer:d,ssrColumns:B,vue:M,wall:A,watch:f}){function m(o,t,T,F){const W=y(T);return F+t+W<=o?m(o,t,T+1,F+t+W):T}function y(o){const t=Array.isArray(r.value)?r.value:[r.value];return t[o%t.length]}function e(){const o=m(A.value.getBoundingClientRect().width,g.value,0,-g.value),t=i(n(o));return t>0?t:1}function n(o){const t=v==null?void 0:v.value;return t&&o>t?t:o}function i(o){const t=u==null?void 0:u.value;return t&&o<t?t:o}function _(o){return[...new Array(o)].map(()=>[])}if(B.value>0){const o=_(B.value);a.value.forEach((t,T)=>o[T%B.value].push(T)),l.value=o}async function H(o){if(o>=a.value.length)return;await x();const t=[...A.value.children];I.value&&t.reverse();const T=t.reduce((F,W)=>W.getBoundingClientRect().height<F.getBoundingClientRect().height?W:F);l.value[+T.dataset.index].push(o),await H(o+1)}async function S(o=!1){if(l.value.length===e()&&!o){$(M===2?"redraw-skip":"redrawSkip");return}l.value=_(e());const t=d==null?void 0:d.value,T=t?t.scrollTop:window.scrollY;await H(0),t?t.scrollBy({top:T-t.scrollTop}):window.scrollTo({top:T}),$("redraw")}const R=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>S());return C(()=>{S(),R==null||R.observe(A.value)}),b(()=>R==null?void 0:R.unobserve(A.value)),f([a,I],()=>S(!0)),f([r,g,u,v],()=>S()),{getColumnWidthTarget:y}}const he=["data-index"],ke=Q({__name:"masonry-wall",props:Z({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},fe),emits:["redraw","redrawSkip"],setup(l,{emit:r}){const $=l,{columnWidth:g,items:a,gap:v,rtl:u,ssrColumns:x,scrollContainer:b,minColumns:C,maxColumns:I,keyMapper:d}=ee($),B=V([]),M=V(),{getColumnWidthTarget:A}=ye({columns:B,columnWidth:g,emit:r,gap:v,items:a,keyMapper:d,maxColumns:I,minColumns:C,nextTick:ne,onBeforeUnmount:oe,onMounted:Y,rtl:u,scrollContainer:b,ssrColumns:x,vue:3,wall:M,watch:j});return(f,m)=>(p(),k("div",{ref_key:"wall",ref:M,class:"masonry-wall",style:G({display:"flex",gap:`${c(v)}px`})},[(p(!0),k(U,null,P(B.value,(y,e)=>(p(),k("div",{key:e,class:"masonry-column","data-index":e,style:G({display:"flex","flex-basis":`${c(A)(e)}px`,"flex-direction":"column","flex-grow":1,gap:`${c(v)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(p(!0),k(U,null,P(y,(n,i)=>(p(),k("div",{key:c(d)(c(a)[n],e,i,n),class:"masonry-item"},[te(f.$slots,"default",{item:c(a)[n],column:e,row:i,index:n},()=>[N(L(c(a)[n]),1)])]))),128))],12,he))),128))],4))}}),ge=(()=>{const l=ke;return l.install=r=>{r.component("MasonryWall",l)},l})();const we=["src"],xe={class:"header"},be={class:"platform"},Ce={style:{"font-size":"1.6em","font-weight":"bold"}},Se={key:0},Te={key:1,style:{"font-weight":"bold"}},Ve={key:3,style:{height:"32px"}},$e={style:{"font-size":"0.9em","line-height":"1.3em"}},Be=Q({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(l){const r=l,$=X(),g=ce(le(r,"token_meta")),a=V(!1),v=V(0),u=V(),x=V(),b=E(()=>ue(r.token_meta.entity.platform)),C=async()=>{const f=await de(r.token_meta);if(!f){me("Error getting source file");return}window.open(f,"_blank")},I=E(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),d=()=>{const f=$.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(f.href)},B=()=>{window.open(r.token_meta.entity.public_link,"_blank")},M=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function A(f){if(!u.value){console.log("animateDivHeight - error finding tile container");return}if(f&&v.value==0&&(v.value=u.value.offsetHeight),!x.value){console.log("animateDivHeight - error finding detail container");return}let m;f&&x.value.offsetHeight>v.value?m=x.value.offsetHeight:m=v.value;const y=300,e=10,n=u.value.offsetHeight,i=Math.ceil(m-n),_=Math.ceil(y/e),H=i/_;let S=0;const R=setInterval(()=>{if(S>=_){u.value.style.height=m+"px",clearInterval(R);return}S++;const o=n+H*S;u.value.style.height=o+"px"},e)}return(f,m)=>{const y=z("el-button"),e=z("el-tooltip");return p(),k("div",{ref_key:"tile_container",ref:u,class:"custom-card",onClick:m[1]||(m[1]=()=>{a.value=!a.value,A(a.value)}),style:G(a.value?"":`height: ${c(I)}px !important`)},[h("img",{class:q(a.value?"absolute":""),src:c(g)},null,10,we),h("div",{class:q([a.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),h("div",{class:q(["transition absolute",a.value?"hide-blur":"show-blur"])},[h("div",xe,L(`${l.token_meta.entity.name} | ${l.token_meta.entity.artist}`),1),h("div",be,L(c(b)),1)],2),h("div",{ref_key:"detail_container",ref:x,class:q(["detail-container transition",a.value?"show-blur":"hide-blur absolute-no-b"])},[h("div",Ce,L(l.token_meta.entity.name),1),l.token_meta.entity.artist_social_link?(p(),k("div",Se,[s(y,{link:"",style:{"font-weight":"bold",display:"block"},onClick:D(M,["stop"])},{default:w(()=>[N(L(l.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(p(),k("div",Te,L(l.token_meta.entity.artist),1)),a.value?(p(),k(U,{key:2},[s(e,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:w(()=>[s(y,{icon:"Edit",text:"",circle:"",onClick:m[0]||(m[0]=D(n=>c($).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),s(e,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:w(()=>[s(y,{icon:"Download",text:"",circle:"",onClick:D(C,["stop"])},null,8,["onClick"])]),_:1}),s(e,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:w(()=>[s(y,{icon:"Tickets",text:"",circle:"",onClick:D(d,["stop"])},null,8,["onClick"])]),_:1}),l.token_meta.entity.public_link?(p(),O(e,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:w(()=>[s(y,{icon:"Link",text:"",circle:"",onClick:D(B,["stop"])},null,8,["onClick"])]),_:1})):ae("",!0)],64)):(p(),k("div",Ve)),h("div",$e,L(l.token_meta.entity.description),1)],2)],4)}}});var Me=J(Be,[["__scopeId","data-v-09547db6"]]);const K=l=>(re("data-v-57f8ef75"),l=l(),se(),l),Ae={class:"subheader",style:{display:"flex","align-items":"center"}},He=K(()=>h("div",{class:"caption"},"Filter by gallery",-1)),Ie=K(()=>h("div",{class:"caption"},"Sort order",-1)),Re=K(()=>h("div",{style:{"padding-bottom":"40px"}},null,-1)),ze={key:1,style:{padding:"1em"}},Le=Q({__name:"ArtworkTileGrid",setup(l){const r=X(),$=_e(),g=pe(),a=V(""),v=V(null),u=V(localStorage.getItem("token_list_sort_order")||"name"),x=30,b=V(x),C=V(localStorage.getItem("artwork_grid_filter_by_gallery")||"");j(C,e=>{localStorage.setItem("artwork_grid_filter_by_gallery",e)}),j(a,e=>{b.value=x});const I=250,d=10,{screen_type:B}=ve(),M=E(()=>{switch(B.value){case"xs":return 340-d*2;case"sm":return 650-d*2;case"md":return 960-d*2;case"lg":return 1200-d*2;case"xl":return 1700-d*2}return 0}),A=E(()=>{let e=Math.floor(M.value/(I+d));return e>5&&(e=5),(M.value-(e-1)*d)/e}),f=E(()=>$.sorted_all_token_metas.filter(e=>Boolean(e.entity.aspect_ratio))),m=E(()=>{let e=f.value.filter(n=>{var i,_;return((i=n.entity.artist)==null?void 0:i.toLowerCase().includes(a.value.toLowerCase()))||((_=n.entity.name)==null?void 0:_.toLowerCase().includes(a.value.toLowerCase()))});return C.value&&(e=e.filter(n=>{var i;return(i=g.gallery_list.find(_=>_.id==C.value))==null?void 0:i.entity.token_meta_id_list.includes(n.id)})),u.value==="name"?e=e.sort((n,i)=>n.entity.name.localeCompare(i.entity.name)):u.value==="created_at"&&(e=e.sort((n,i)=>n.entity.created_at==null&&i.entity.created_at==null?0:n.entity.created_at==null?1:i.entity.created_at==null?-1:i.entity.created_at.seconds-n.entity.created_at.seconds)),e}),y=E(()=>{const e=m.value,n=0,i=n+b.value;return e.slice(n,i)});return Y(()=>{const e=document.getElementById("masonry-container");if(!e){console.log("ArtworkTileGrid error, masonary_wall element not found");return}e.addEventListener("scroll",()=>{const n=e.scrollTop,i=e.scrollHeight,_=e.clientHeight;n/(i-_)*100>90&&b.value<m.value.length&&(b.value=b.value+20)})}),(e,n)=>{const i=z("el-input"),_=z("el-button"),H=z("el-option"),S=z("el-select"),R=z("el-popover"),o=z("RouterView");return p(),k(U,null,[h("div",Ae,[s(i,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=t=>a.value=t),"prefix-icon":c(ie),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),s(R,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:w(()=>[s(_,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:w(()=>[N("Filters")]),_:1})]),default:w(()=>[He,s(S,{modelValue:C.value,"onUpdate:modelValue":n[1]||(n[1]=t=>C.value=t),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:w(()=>[s(H,{label:"All plaques",value:""}),(p(!0),k(U,null,P(c(g).gallery_list,t=>(p(),O(H,{key:t.id,label:`${t.entity.name}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ie,s(S,{modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=t=>u.value=t),placeholder:"Sort by"},{default:w(()=>[s(H,{label:"Sort by name",value:"name"}),s(H,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),s(_,{icon:"Plus",type:"info",onClick:n[3]||(n[3]=t=>c(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:w(()=>[N("Artwork")]),_:1})]),Re,h("div",{id:"masonry-container",ref_key:"masonryContainer",ref:v,style:{"overflow-y":"auto",height:"100%",padding:"10px"}},[c(y).length>0?(p(),O(c(ge),{key:0,id:"masonary-wall","scroll-container":v.value,items:c(y),"column-width":I,gap:d,style:G(`width: ${c(M)}px; margin: auto`),"max-columns":5},{default:w(({item:t})=>[s(Me,{token_meta:t,column_width:c(A)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(p(),k("div",ze,"No artwork found"))],512),s(o)],64)}}});var Qe=J(Le,[["__scopeId","data-v-57f8ef75"]]);export{Qe as default};
