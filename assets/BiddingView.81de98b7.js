import{s as b}from"./util.e28b3603.js";import{g as E,c as $}from"./bid.0f39a804.js";import{h as q}from"./token-meta.9b03395e.js";import{i as k}from"./firebaseConfig.4d01e9b5.js";import{d as L,r as d,Q as N,q as U,E as A,c as C,h as c,l as s,t as V,j as v,i as n,w as r,e as T,f as p,o as f,z as D}from"./index.54522f83.js";import"./types.67d14e22.js";const I={class:"container"},R={class:"top-bid"},S=s("h3",null,"Highest Bid",-1),W={class:"bid"},j={key:0},z={style:{"font-weight":"bold","margin-right":"5px"}},F={style:{"font-weight":"bold"}},H={key:1},Q={class:"bid-form"},G=s("h3",{style:{"padding-bottom":"15px"}},"Place a Bid",-1),ae=L({__name:"BiddingView",setup(J){const u=T(),h=d(),a=d({token_meta_id:"",bidding_name:"",email:"",phone_number:"",amount:0,created_at:k.now(),updated_at:k.now()}),g=d([]),w=d(),B=N({bidding_name:[{required:!0,message:"Please enter your bidding name",trigger:"blur"}],email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email address",trigger:["blur","change"]}],phone_number:[{required:!0,message:"Please enter your phone number",trigger:"blur"},{pattern:/^\d{10}$/,message:"Please enter a valid 10-digit phone number",trigger:"blur"}],amount:[{required:!0,message:"Please enter a bid amount",trigger:"blur"},{validator:(t,e,o)=>{let i=0;m.value&&(i=m.value.entity.amount+1),e<=i?o(new Error(`Please enter a bid amount greater than $${i}`)):o()},trigger:"blur"},{pattern:/^\d+(\.\d+)?$/,message:"Please enter a valid number",trigger:"blur"}]}),y=d(),_=d(!1);U(async()=>{if(!u.params.token_meta_id||u.params.token_meta_id instanceof Array){b("Error invalid token meta id");return}y.value=A.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),console.log("route.params.token_meta_id",u.params.token_meta_id),await q(u.params.token_meta_id,t=>{w.value=t,a.value.token_meta_id=t.id}),await E(u.params.token_meta_id,t=>{g.value=t,y.value.close()})});const m=C(()=>g.value.length===0?null:g.value.reduce((t,e)=>t.entity.amount>e.entity.amount?t:e)),x=async t=>{if(!t){b("Error finding form element");return}!await t.validate(o=>o)||(_.value=!0,await $(a.value).then(()=>{_.value=!1,t.resetFields(),D({type:"success",message:"Successfully submitted bid!"})}).catch(o=>{_.value=!1,b(o)}))};return(t,e)=>{const o=p("el-input"),i=p("el-form-item"),P=p("el-button"),M=p("el-form");return f(),c("div",I,[s("div",R,[S,s("div",W,[m.value?(f(),c("div",j,[s("span",z,V(m.value.entity.bidding_name),1),v("- "),s("span",F,"$"+V(m.value.entity.amount),1)])):(f(),c("div",H,"No bids"))])]),s("div",Q,[G,n(M,{ref_key:"formRef",ref:h,model:a.value,rules:B,"label-width":"160px","label-position":"left"},{default:r(()=>[n(i,{label:"Email (private)",prop:"email"},{default:r(()=>[n(o,{modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.email=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),n(i,{label:"Phone (private)",prop:"phone_number"},{default:r(()=>[n(o,{modelValue:a.value.phone_number,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.phone_number=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),n(i,{label:"Bidding Name (public)",prop:"bidding_name"},{default:r(()=>[n(o,{modelValue:a.value.bidding_name,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.bidding_name=l)},null,8,["modelValue"])]),_:1}),n(i,{label:"Bid Amount (public)",prop:"amount",style:{"max-width":"350px"}},{default:r(()=>[n(o,{modelValue:a.value.amount,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.amount=l),modelModifiers:{number:!0}},{append:r(()=>[v("$")]),_:1},8,["modelValue"])]),_:1}),n(P,{loading:_.value,onClick:e[4]||(e[4]=l=>x(h.value)),class:"submit-button",color:"#000000"},{default:r(()=>[v(" SUBMIT ")]),_:1},8,["loading"])]),_:1},8,["model","rules"])])])}}});export{ae as default};
