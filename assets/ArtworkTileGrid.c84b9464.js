import{d as K,P as le,Q as oe,r as T,o as p,h as S,F as W,I as J,M as N,f as _,S as ne,j as O,t as H,T as ae,U as re,m as Z,z as P,_ as ee,u as te,L as ie,c as z,b as L,k as w,n as G,i as n,w as k,V as F,e as j,g as Y,J as se,x as X,K as ce,p as ue,l as de}from"./index.e6f2dfb6.js";import{u as me}from"./thumbnail-image.d99f8a9b.js";import{c as _e,d as pe,T as Q}from"./types.6a5ef88e.js";import{s as fe}from"./util.39d690bd.js";import{u as ve}from"./account.60b58166.js";import{f as ye}from"./token-meta.e73e8480.js";import{u as he}from"./token-meta.2bb936c3.js";import{u as ge}from"./gallery.bbf144ab.js";import{u as ke}from"./breakpoints.661d75ce.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.214f82bf.js";const we={columnWidth:400,gap:0,keyMapper:(a,r,M,A)=>A,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function be({columns:a,columnWidth:r,emit:M,gap:A,items:i,maxColumns:v,minColumns:y,nextTick:b,onBeforeUnmount:B,onMounted:V,rtl:$,scrollContainer:x,ssrColumns:E,vue:h,wall:I,watch:D}){function R(l,o,C,c){const U=u(C);return c+o+U<=l?R(l,o,C+1,c+o+U):C}function u(l){const o=Array.isArray(r.value)?r.value:[r.value];return o[l%o.length]}function f(){const l=R(I.value.getBoundingClientRect().width,A.value,0,-A.value),o=e(d(l));return o>0?o:1}function d(l){const o=v==null?void 0:v.value;return o&&l>o?o:l}function e(l){const o=y==null?void 0:y.value;return o&&l<o?o:l}function t(l){return[...new Array(l)].map(()=>[])}if(E.value>0){const l=t(E.value);i.value.forEach((o,C)=>l[C%E.value].push(C)),a.value=l}async function m(l){if(l>=i.value.length)return;await b();const o=[...I.value.children];$.value&&o.reverse();const C=o.reduce((c,U)=>U.getBoundingClientRect().height<c.getBoundingClientRect().height?U:c);a.value[+C.dataset.index].push(l),await m(l+1)}async function g(l=!1){if(a.value.length===f()&&!l){M(h===2?"redraw-skip":"redrawSkip");return}a.value=t(f());const o=x==null?void 0:x.value,C=o?o.scrollTop:window.scrollY;await m(0),o?o.scrollBy({top:C-o.scrollTop}):window.scrollTo({top:C}),M("redraw")}const s=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>g());return V(()=>{g(),s==null||s.observe(I.value)}),B(()=>s==null?void 0:s.unobserve(I.value)),D([i,$],()=>g(!0)),D([r,A,y,v],()=>g()),{getColumnWidthTarget:u}}const xe=["data-index"],Ce=K({__name:"masonry-wall",props:le({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},we),emits:["redraw","redrawSkip"],setup(a,{emit:r}){const M=a,{columnWidth:A,items:i,gap:v,rtl:y,ssrColumns:b,scrollContainer:B,minColumns:V,maxColumns:$,keyMapper:x}=oe(M),E=T([]),h=T(),{getColumnWidthTarget:I}=be({columns:E,columnWidth:A,emit:r,gap:v,items:i,keyMapper:x,maxColumns:$,minColumns:V,nextTick:ae,onBeforeUnmount:re,onMounted:Z,rtl:y,scrollContainer:B,ssrColumns:b,vue:3,wall:h,watch:P});return(D,R)=>(p(),S("div",{ref_key:"wall",ref:h,class:"masonry-wall",style:N({display:"flex",gap:`${_(v)}px`})},[(p(!0),S(W,null,J(E.value,(u,f)=>(p(),S("div",{key:f,class:"masonry-column","data-index":f,style:N({display:"flex","flex-basis":`${_(I)(f)}px`,"flex-direction":"column","flex-grow":1,gap:`${_(v)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(p(!0),S(W,null,J(u,(d,e)=>(p(),S("div",{key:_(x)(_(i)[d],f,e,d),class:"masonry-item"},[ne(D.$slots,"default",{item:_(i)[d],column:f,row:e,index:d},()=>[O(H(_(i)[d]),1)])]))),128))],12,xe))),128))],4))}}),Te=(()=>{const a=Ce;return a.install=r=>{r.component("MasonryWall",a)},a})();const Se=["src"],Ae={class:"header"},Ve={class:"platform"},$e={style:{"font-size":"1.6em","font-weight":"bold"}},Ee={key:0},Me={key:1,style:{"font-weight":"bold"}},Be={key:3,style:{height:"32px"}},Ie={style:{"font-size":"0.9em","line-height":"1.3em"}},De=K({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(a){const r=a,M=te(),A=me(ie(r,"token_meta")),i=T(!1),v=T(0),y=T(),b=T(),B=ve(),V=z(()=>_e(r.token_meta.entity.platform)),$=async()=>{const u=await pe(r.token_meta);if(!u){fe("Error getting source file");return}window.open(u,"_blank")},x=z(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),E=()=>{const u=M.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(u.href)},h=()=>{window.open(r.token_meta.entity.public_link,"_blank")},I=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function D(){if(!y.value){console.log("animateDivHeight - error finding tile container");return}if(!i.value&&v.value==0&&(v.value=y.value.offsetHeight),i.value=!i.value,!b.value){console.log("animateDivHeight - error finding detail container");return}let u;i.value&&b.value.offsetHeight>v.value?u=b.value.offsetHeight:u=v.value;const f=300,d=10,e=y.value.offsetHeight,t=Math.ceil(u-e),m=Math.ceil(f/d),g=t/m;let s=0;const l=setInterval(()=>{if(s>=m){y.value.style.height=u+"px",clearInterval(l);return}s++;const o=e+g*s;y.value.style.height=o+"px"},d)}const R=()=>{se.prompt(`Are you sure you want to delete ${r.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:u})=>{if(u)return ye(r.token_meta.id)}).then(()=>{X({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(u=>{X({message:`Error deleting artwork - ${u}`,type:"error",showClose:!0,duration:12e3})})};return(u,f)=>{const d=L("el-button"),e=L("el-tooltip");return p(),S("div",{ref_key:"tile_container",ref:y,class:"custom-card",onClick:D,style:N(`height: ${_(x)}px !important`)},[w("img",{class:G(i.value?"absolute":""),src:_(A)},null,10,Se),w("div",{class:G([i.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),w("div",{class:G(["transition absolute",i.value?"hide-blur":"show-blur"])},[w("div",Ae,H(`${a.token_meta.entity.name} | ${a.token_meta.entity.artist}`),1),w("div",Ve,H(_(V)),1)],2),w("div",{ref_key:"detail_container",ref:b,class:G(["detail-container transition",i.value?"show-blur":"hide-blur"])},[w("div",$e,H(a.token_meta.entity.name),1),a.token_meta.entity.artist_social_link?(p(),S("div",Ee,[n(d,{link:"",style:{"font-weight":"bold",display:"block"},onClick:F(I,["stop"])},{default:k(()=>[O(H(a.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(p(),S("div",Me,H(a.token_meta.entity.artist),1)),i.value?(p(),S(W,{key:2},[n(e,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:k(()=>[n(d,{icon:"Edit",text:"",circle:"",onClick:f[0]||(f[0]=F(t=>_(M).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),n(e,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:k(()=>[n(d,{icon:"Download",text:"",circle:"",onClick:F($,["stop"])},null,8,["onClick"])]),_:1}),n(e,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:k(()=>[n(d,{icon:"Tickets",text:"",circle:"",onClick:F(E,["stop"])},null,8,["onClick"])]),_:1}),a.token_meta.entity.public_link?(p(),j(e,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:k(()=>[n(d,{icon:"Link",text:"",circle:"",onClick:F(h,["stop"])},null,8,["onClick"])]),_:1})):Y("",!0),_(B).is_user_admin?(p(),j(e,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:k(()=>[n(d,{icon:"Delete",text:"",circle:"",onClick:F(R,["stop"])},null,8,["onClick"])]),_:1})):Y("",!0)],64)):(p(),S("div",Be)),w("div",Ie,H(a.token_meta.entity.description),1)],2)],4)}}});var Le=ee(De,[["__scopeId","data-v-77befd83"]]);const q=a=>(ue("data-v-2f1203e8"),a=a(),de(),a),Re={class:"subheader",style:{display:"flex","align-items":"center"}},He=q(()=>w("div",{class:"caption"},"Filter by gallery",-1)),ze=q(()=>w("div",{class:"caption"},"Filter by aspect ratio",-1)),Fe=q(()=>w("div",{class:"caption"},"Filter by platform",-1)),Pe=q(()=>w("div",{class:"caption"},"Sort order",-1)),Ue=q(()=>w("div",{style:{"padding-bottom":"40px"}},null,-1)),We={key:1,style:{padding:"1em"}},qe=K({__name:"ArtworkTileGrid",setup(a){const r=te(),M=he(),A=ge(),i=T(""),v=T(null),y=30,b=T(y),B=T(localStorage.getItem("artwork_grid_aspect_ratio_filter")||"");P(B,e=>{localStorage.setItem("artwork_grid_aspect_ratio_filter",e)});const V=T(localStorage.getItem("artwork_grid_filter_by_gallery")||"");P(V,e=>{localStorage.setItem("artwork_grid_filter_by_gallery",e)});const $=T(localStorage.getItem("artwork_grid_filter_by_platform")||"");P($,e=>{localStorage.setItem("artwork_grid_filter_by_platform",e)});const x=T(localStorage.getItem("artwork_grid_sort_order")||"name");P(x,e=>{localStorage.setItem("artwork_grid_sort_order",e)}),P(i,e=>{b.value=y});const E=250,h=10,{screen_type:I}=ke(),D=z(()=>{switch(I.value){case"xs":return 340-h*2;case"sm":return 650-h*2;case"md":return 960-h*2;case"lg":return 1200-h*2;case"xl":return 1700-h*2}return 0}),R=z(()=>{let e=Math.floor(D.value/(E+h));return e>5&&(e=5),(D.value-(e-1)*h)/e}),u=z(()=>M.sorted_all_token_metas.filter(e=>Boolean(e.entity.aspect_ratio))),f=z(()=>{let e=u.value.filter(t=>{var m,g,s;if(i.value&&!((m=t.entity.artist)!=null&&m.toLowerCase().includes(i.value.toLowerCase()))&&!((g=t.entity.name)!=null&&g.toLowerCase().includes(i.value.toLowerCase()))||V.value&&!((s=A.gallery_list.find(l=>l.id==V.value))!=null&&s.entity.token_meta_id_list.includes(t.id)))return!1;switch($.value){case"moda_archive":if(t.entity.platform!=Q.Archive)return!1;break;case"opensea":if(t.entity.platform!=Q.Opensea&&t.entity.platform!=Q.OpenseaArchive)return!1;break}switch(B.value){case"portrait":if(!t.entity.aspect_ratio||t.entity.aspect_ratio>.9)return!1;break;case"landscape":if(!t.entity.aspect_ratio||t.entity.aspect_ratio<1.1)return!1;break;case"square":if(!t.entity.aspect_ratio||t.entity.aspect_ratio<.9||t.entity.aspect_ratio>1.1)return!1;break}return!0});return x.value==="name"?e=e.sort((t,m)=>t.entity.name.localeCompare(m.entity.name)):x.value==="created_at"&&(e=e.sort((t,m)=>t.entity.created_at==null&&m.entity.created_at==null?0:t.entity.created_at==null?1:m.entity.created_at==null?-1:m.entity.created_at.seconds-t.entity.created_at.seconds)),e}),d=z(()=>{const e=f.value,t=0,m=t+b.value;return e.slice(t,m)});return Z(()=>{const e=document.getElementById("masonry-container");if(!e){console.log("ArtworkTileGrid error, masonary_wall element not found");return}e.addEventListener("scroll",()=>{const t=e.scrollTop,m=e.scrollHeight,g=e.clientHeight;t/(m-g)*100>90&&b.value<f.value.length&&(b.value=b.value+20)})}),(e,t)=>{const m=L("el-input"),g=L("el-button"),s=L("el-option"),l=L("el-select"),o=L("el-popover"),C=L("RouterView");return p(),S(W,null,[w("div",Re,[n(m,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c),"prefix-icon":_(ce),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),n(o,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:k(()=>[n(g,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:k(()=>[O("Filters")]),_:1})]),default:k(()=>[He,n(l,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=c=>V.value=c),placeholder:"Filter by gallery",class:"filter-select"},{default:k(()=>[n(s,{label:"All artwork",value:""}),(p(!0),S(W,null,J(_(A).gallery_list,c=>(p(),j(s,{key:c.id,label:`${c.entity.name}`,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),ze,n(l,{modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=c=>B.value=c),class:"filter-select"},{default:k(()=>[n(s,{label:"All",value:""}),n(s,{label:"Landscape",value:"landscape"}),n(s,{label:"Portrait",value:"portrait"}),n(s,{label:"Square",value:"square"})]),_:1},8,["modelValue"]),Fe,n(l,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=c=>$.value=c),class:"filter-select"},{default:k(()=>[n(s,{label:"All",value:""}),n(s,{label:"Moda Archive",value:"moda_archive"}),n(s,{label:"Opensea",value:"opensea"})]),_:1},8,["modelValue"]),Pe,n(l,{modelValue:x.value,"onUpdate:modelValue":t[4]||(t[4]=c=>x.value=c),placeholder:"Sort by",class:"filter-select"},{default:k(()=>[n(s,{label:"Sort by name",value:"name"}),n(s,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),n(g,{icon:"Plus",type:"info",onClick:t[5]||(t[5]=c=>_(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:k(()=>[O("Artwork")]),_:1})]),Ue,w("div",{id:"masonry-container",ref_key:"masonryContainer",ref:v,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[_(d).length>0?(p(),j(_(Te),{key:0,id:"masonary-wall","scroll-container":v.value,items:_(d),"column-width":E,gap:h,style:N(`width: ${_(D)}px; margin: auto`),"max-columns":5},{default:k(({item:c})=>[n(Le,{token_meta:c,column_width:_(R)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(p(),S("div",We,"No artwork found"))],512),n(C)],64)}}});var tt=ee(qe,[["__scopeId","data-v-2f1203e8"]]);export{tt as default};
