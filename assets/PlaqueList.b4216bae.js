import{_ as j,d as F,r as q,c as N,z as Q,b as p,o as _,h as w,i as t,w as n,k as l,t as A,j as f,f as k,A as de,p as W,l as X,x as T,u as re,e as L,B as se,C as ye,D as ge,g as E,G as ke,H as qe,F as B,I as H,J as ie,K as he}from"./index.55507f85.js";import{u as O,c as we}from"./plaque.093acf64.js";import{c as xe}from"./token-meta.2d60a689.js";import{u as J}from"./plaque.aeeb1f06.js";import{u as _e,g as Ce}from"./account.09a8b448.js";import{s as R,a as ce}from"./util.1de3842e.js";import{T as ue}from"./types.6a5ef88e.js";import{u as pe}from"./breakpoints.6ce593be.js";import{u as me}from"./token-meta.308f749c.js";import{_ as $e}from"./TokenSelectList.0c21a5c4.js";import{n as K}from"./firebaseConfig.d7a6b5a9.js";import{_ as be}from"./PlaqueTokenItem.91f15196.js";import{u as Ae}from"./gallery.a567b86c.js";import"./thumbnail-image.aabb1b6c.js";import"./gallery.82c2a091.js";const Pe=i=>(W("data-v-cc2989e6"),i=i(),X(),i),Se={class:"dialog-container"},Ve={class:"dialog-footer"},Ne=Pe(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),ze=F({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(i,{emit:o}){const P=i,u=q([]),y=q(!1),{screen_type:x}=pe(),$=J(),C=me(),b=_e(),v=N({get(){return P.show_add_token_dialog},set(g){o("update:show_add_token_dialog",g)}});Q(v,g=>{g&&(u.value=JSON.parse(JSON.stringify(d.value.entity.token_meta_id_list)))});const d=N(()=>$.plaque_map[P.plaque_id]),h=N(()=>C.sorted_all_token_metas),V=async()=>{y.value=!0;try{for(let[g,r]of u.value.entries()){const e=C.all_token_metas[r];if(!e)throw"Failed to find store token for token: "+r;if(e.entity.platform!=ue.Opensea)continue;const a=JSON.parse(JSON.stringify(e));a.entity.user_id=b.get_account.id,a.entity.platform=ue.OpenseaArchive;const s=await xe(a.entity);u.value[g]=s.id}await O(P.plaque_id,{token_meta_id_list:u.value}),$.plaque_map[P.plaque_id].entity.token_meta_id_list=u.value}catch(g){R(`Error updating plaque tokens - ${g}`)}y.value=!1,v.value=!1},D=()=>{u.value=[]};return(g,r)=>{const e=p("el-button"),a=p("el-dialog");return _(),w("div",Se,[t(a,{center:"",modelValue:k(v),"onUpdate:modelValue":r[1]||(r[1]=s=>de(v)?v.value=s:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:k(x)=="xs",top:"2vh"},{footer:n(()=>[l("div",Ve,[l("div",null,A(`Artwork in playlist: ${u.value.length}`),1),Ne,t(e,{onClick:D},{default:n(()=>[f("Clear")]),_:1}),t(e,{type:"info",onClick:V,loading:y.value},{default:n(()=>[f("Save")]),_:1},8,["loading"])])]),default:n(()=>[t($e,{selected_token_meta_id_list:u.value,"onUpdate:selected_token_meta_id_list":r[0]||(r[0]=s=>u.value=s),token_meta_list:k(h)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Ie=j(ze,[["__scopeId","data-v-cc2989e6"]]);const Le={class:"controller-buttons"},Te=F({__name:"PlaqueController",props:{plaque:null},setup(i){const o=i,P=J(),u=q(!1),y=q(!1),x=q(!1),$=q(!1),C=N({get:()=>o.plaque.entity.orientation||"landscape",set:v=>{O(o.plaque.id,{orientation:v}).then(()=>{P.plaque_map[o.plaque.id].entity.orientation=v,T({type:"success",message:"Plaque orientation updated"})}).catch(d=>{R(`Error updating plaque orientation - ${d}`)})}}),b=v=>{const d={type:v,time_sent:K.now()};O(o.plaque.id,{command:d}).then(()=>{P.plaque_map[o.plaque.id].entity.command=d,T({type:"success",message:"Command sent to plaque"})}).catch(h=>{R(`Error sending command to plaque - ${h}`)}).finally(()=>{u.value=!1,y.value=!1,x.value=!1,$.value=!1})};return(v,d)=>{const h=p("el-button"),V=p("el-radio"),D=p("el-radio-group");return _(),w("div",null,[l("div",Le,[t(h,{circle:"",text:"",loading:u.value,icon:"DArrowLeft",onClick:d[0]||(d[0]=g=>{u.value=!0,b("playlist_previous")})},null,8,["loading"]),t(h,{circle:"",text:"",loading:y.value,icon:"VideoPlay",onClick:d[1]||(d[1]=g=>{y.value=!0,b("play")})},null,8,["loading"]),t(h,{circle:"",text:"",icon:"VideoPause",loading:x.value,onClick:d[2]||(d[2]=g=>{x.value=!0,b("pause")})},null,8,["loading"]),t(h,{circle:"",text:"",icon:"DArrowRight",loading:$.value,onClick:d[3]||(d[3]=g=>{$.value=!0,b("playlist_next")})},null,8,["loading"])]),t(D,{modelValue:k(C),"onUpdate:modelValue":d[4]||(d[4]=g=>de(C)?C.value=g:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:n(()=>[t(V,{label:"landscape",size:"small"},{default:n(()=>[f("Landscape")]),_:1}),t(V,{label:"portrait",size:"small"},{default:n(()=>[f("Portrait")]),_:1}),t(V,{label:"landscape_reversed",size:"small"},{default:n(()=>[f("Landscape Reversed")]),_:1}),t(V,{label:"portrait_reversed",size:"small"},{default:n(()=>[f("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var De=j(Te,[["__scopeId","data-v-100e65c8"]]);const z=i=>(W("data-v-1c4e515f"),i=i(),X(),i),Ee={style:{display:"flex","align-items":"center",padding:"1em"}},Oe={key:0},Ue=z(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Be={class:"card-simple"},Re=z(()=>l("hr",null,null,-1)),je=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Fe=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Je={style:{padding:"0.3em 1em"}},Me={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Ge={key:0,class:"card-detail"},He={style:{padding:"0 1em"}},Ke={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},Qe=z(()=>l("hr",null,null,-1)),We=z(()=>l("div",{style:{padding:"1em"}},"No artwork added",-1)),Xe=z(()=>l("hr",null,null,-1)),Ye={style:{display:"flex",padding:"1em"}},Ze=z(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),et={key:0,style:{padding:"1em"}},tt={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},lt={key:0},at=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),nt={key:0},ot={key:1},st={style:{"font-size":"var(--el-font-size-extra-small)"}},it={key:1},ut=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),dt={style:{display:"flex","justify-content":"end"}},rt=F({__name:"PlaqueCard",props:{plaque:null},setup(i){const o=i,P=J();re();const u=q("simple"),y=q(!1),x=q(!1),$=q(""),C=q(!1),b=async()=>{C.value=!0,await O(o.plaque.id,{name:o.plaque.entity.name}).catch(e=>{R(`Error updating plaque tokens - ${e}`)}),x.value=!1,C.value=!1},v=me(),d=N(()=>h.value.length==0?null:h.value[0]),h=N(()=>{const e=v.archive_token_meta_map;return o.plaque.entity.token_meta_id_list.map(s=>e[s])}),V=N(()=>ce(o.plaque)),D=()=>{ie.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{O(o.plaque.id,{token_meta_id_list:[]}).then(()=>{P.plaque_map[o.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Tokens cleared"})}).catch(e=>{T({message:`Error clearing tokens from plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})},g=()=>{ie.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{O(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{P.plaque_map[o.plaque.id].entity.user_id="",P.plaque_map[o.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Plaque forgotten"})}).catch(e=>{T({message:`Error forgetting plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})};Q(u,e=>{e=="settings"&&o.plaque.entity.user_id&&!$.value&&Ce(o.plaque.entity.user_id).then(a=>{$.value=a.entity.email}).catch(a=>{T({message:`Error loading user account - ${a}`,type:"error",showClose:!0,duration:12e3})})});const r=N(()=>{var s,S,I;const e=(I=(S=(s=o==null?void 0:o.plaque)==null?void 0:s.entity)==null?void 0:S.machine_data)==null?void 0:I.updated_at;return e?new Date(e.seconds*1e3+e.nanoseconds/1e6).toLocaleString():"N/A"});return(e,a)=>{const s=p("el-button"),S=p("el-tag"),I=p("el-col"),M=p("el-row"),G=p("ArrowRight"),U=p("el-icon"),c=p("el-collapse-transition"),Y=p("Close"),ve=p("el-card");return _(),L(ve,null,{default:n(()=>[l("div",Ee,[x.value?se((_(),w("input",{key:1,"onUpdate:modelValue":a[0]||(a[0]=m=>o.plaque.entity.name=m),class:"edit-name-input"},null,512)),[[ye,o.plaque.entity.name]]):(_(),w("h1",Oe,A(o.plaque.entity.name),1)),x.value?E("",!0):(_(),L(s,{key:2,icon:k(ge),onClick:a[1]||(a[1]=m=>x.value=!0),class:"editIcon",circle:""},null,8,["icon"])),x.value?(_(),L(s,{key:3,icon:k(ke),loading:C.value,onClick:b,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):E("",!0),Ue,k(V)?(_(),L(S,{key:4,class:"ml-2",type:"success"},{default:n(()=>[f("online")]),_:1})):(_(),L(S,{key:5,class:"ml-2",type:"danger"},{default:n(()=>[f("offline")]),_:1}))]),t(c,null,{default:n(()=>[se(l("section",Be,[Re,t(M,{style:{padding:"1em"}},{default:n(()=>[t(I,{span:12},{default:n(()=>{var m;return[je,l("span",null,A(((m=k(d))==null?void 0:m.entity.name)||"N/A"),1)]}),_:1}),t(I,{span:12},{default:n(()=>{var m;return[Fe,f(" "+A(((m=k(d))==null?void 0:m.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),l("div",Je,A(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),l("div",Me,[t(s,{type:"info",onClick:a[2]||(a[2]=m=>y.value=!0)},{default:n(()=>[f("Add Artwork")]),_:1}),t(s,{onClick:a[3]||(a[3]=m=>u.value="detail")},{default:n(()=>[f(" Details"),t(U,{class:"el-icon--right"},{default:n(()=>[t(G)]),_:1})]),_:1})])],512),[[qe,u.value=="simple"]])]),_:1}),t(c,null,{default:n(()=>[u.value=="detail"?(_(),w("section",Ge,[l("p",He,A(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),l("div",Ke,[t(s,{onClick:a[4]||(a[4]=m=>u.value="settings")},{default:n(()=>[f("Settings")]),_:1}),t(s,{onClick:D},{default:n(()=>[f("Clear Artwork")]),_:1})]),Qe,k(h).length==0?(_(),w(B,{key:0},[We,Xe],64)):E("",!0),(_(!0),w(B,null,H(k(h),m=>(_(),L(be,{token_meta:m},null,8,["token_meta"]))),256)),l("div",Ye,[t(s,{type:"info",onClick:a[5]||(a[5]=m=>y.value=!0)},{default:n(()=>[f("Add Artwork")]),_:1}),Ze,t(s,{onClick:a[6]||(a[6]=m=>u.value="simple")},{default:n(()=>[f("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(Y)]),_:1})]),_:1})])])):E("",!0)]),_:1}),t(c,null,{default:n(()=>{var m,Z,ee,te,le,ae,ne,oe;return[u.value=="settings"?(_(),w("section",et,[t(De,{plaque:o.plaque},null,8,["plaque"]),l("div",tt,[i.plaque.entity.user_id?(_(),w("div",lt,[at,$.value?(_(),w("div",nt,A($.value),1)):(_(),w("div",ot,"Loading...")),l("div",st,A(i.plaque.entity.user_id),1)])):(_(),w("div",it,"No associated user")),i.plaque.entity.user_id?(_(),L(s,{key:2,type:"danger",plain:"",onClick:g},{default:n(()=>[f("Forget Display")]),_:1})):E("",!0)]),l("div",null,[ut,l("div",null,"Machine name: "+A((Z=(m=i.plaque.entity.machine_data)==null?void 0:m.machine_name)!=null?Z:"N/A"),1),l("div",null,"Version: "+A((te=(ee=i.plaque.entity.machine_data)==null?void 0:ee.version)!=null?te:"N/A"),1),l("div",null,"Local IP: "+A((ae=(le=i.plaque.entity.machine_data)==null?void 0:le.local_ip)!=null?ae:"N/A"),1),l("div",null,"Public IP: "+A((oe=(ne=i.plaque.entity.machine_data)==null?void 0:ne.public_ip)!=null?oe:"N/A"),1),l("div",null,"Updated At: "+A(k(r)),1)]),l("div",dt,[t(s,{onClick:a[7]||(a[7]=kt=>u.value="detail")},{default:n(()=>[f("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(Y)]),_:1})]),_:1})])])):E("",!0)]}),_:1}),t(Ie,{plaque_id:o.plaque.id,show_add_token_dialog:y.value,"onUpdate:show_add_token_dialog":a[8]||(a[8]=m=>y.value=m)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var _t=j(rt,[["__scopeId","data-v-1c4e515f"]]);const fe=i=>(W("data-v-f02552ca"),i=i(),X(),i),ct={class:"subheader",style:{display:"flex","align-items":"center"}},pt=fe(()=>l("div",{style:{"padding-bottom":"40px"}},null,-1)),mt={class:"add-button-container"},ft={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},vt=fe(()=>l("div",{style:{"font-size":"17px"}},"Add plaque",-1)),yt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},gt=F({__name:"PlaqueList",setup(i){const o=q(!1),{width:P,screen_type:u}=pe(),y=q(!1),x=re(),$=_e(),C=Ae(),b=q(""),v=q(localStorage.getItem("filter_by_gallery")||""),d=q(!1);Q(v,r=>{localStorage.setItem("filter_by_gallery",r)});const h=J(),V=async()=>{o.value=!0,await we({name:"Test Plaque",user_id:$.get_account.id,token_meta_id_list:[],created_at:K.now(),updated_at:K.now()}).catch(r=>T({message:`Error creating test plaque- ${r}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,y.value=!1},D=N(()=>JSON.parse(JSON.stringify(h.all_plaque_list)).sort((e,a)=>{const s=e.entity.name.toLowerCase(),S=a.entity.name.toLowerCase();return s<S?-1:s>S?1:0})),g=N(()=>{let r=[...D.value];return r=r.filter(e=>e.entity.name||e.entity.user_id||e.entity.token_meta_id_list.length>0),v.value&&(r=r.filter(e=>{var a;return(a=C.gallery_list.find(s=>s.id==v.value))==null?void 0:a.entity.plaque_id_list.includes(e.id)})),d.value&&(r=r.filter(e=>ce(e))),b.value?r.filter(e=>e.entity.name.toLowerCase().includes(b.value.toLowerCase())):r});return(r,e)=>{const a=p("el-input"),s=p("el-option"),S=p("el-select"),I=p("el-button"),M=p("Plus"),G=p("el-icon"),U=p("el-dialog");return _(),w(B,null,[l("div",ct,[t(a,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=c=>b.value=c),"prefix-icon":k(he),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),t(S,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=c=>v.value=c),placeholder:"Filter by gallery",style:{"margin-left":"10px",width:"260px"}},{default:n(()=>[t(s,{label:"All plaques",value:""}),(_(!0),w(B,null,H(k(C).gallery_list,c=>(_(),L(s,{key:c.id,label:`Filter by gallery - ${c.entity.name}`,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(S,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=c=>d.value=c),style:{"margin-left":"10px",width:"260px"}},{default:n(()=>[t(s,{label:"Offline and online",value:!1}),t(s,{label:"Online only",value:!0})]),_:1},8,["modelValue"]),t(I,{icon:"Camera",type:"info",onClick:e[3]||(e[3]=c=>k(x).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:n(()=>[f("Scan")]),_:1})]),pt,(_(!0),w(B,null,H(k(g),c=>(_(),L(_t,{plaque:c,key:c.id},null,8,["plaque"]))),128)),l("div",mt,[l("div",ft,[l("div",{class:"add-button",onClick:e[4]||(e[4]=c=>y.value=!0)},[t(G,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:n(()=>[t(M)]),_:1}),vt])])]),t(U,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=c=>y.value=c),title:"Add plaque",width:k(u)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:n(()=>[l("div",yt,[t(I,{onClick:e[5]||(e[5]=c=>{k(x).push("qr-scan"),y.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:n(()=>[f("Scan Plaque QR Code")]),_:1}),t(I,{icon:"plus",onClick:V,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:n(()=>[f("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Tt=j(gt,[["__scopeId","data-v-f02552ca"]]);export{Tt as default};
