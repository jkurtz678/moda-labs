import{_ as M,d as G,r as q,c as z,z as j,b as c,o as _,h as w,i as t,w as a,k as l,t as A,j as p,f as k,A as _e,p as Z,l as ee,x as L,u as ce,e as N,B as ue,C as ye,D as ge,g as E,G as ke,H as qe,F as B,I as X,J as re,K as he}from"./index.78c2dd7d.js";import{u as U,c as we}from"./plaque.093acf64.js";import{c as xe}from"./token-meta.2d60a689.js";import{u as H}from"./plaque.b0983fff.js";import{u as pe,g as Ce}from"./account.205675a6.js";import{s as J,a as me}from"./util.67350d72.js";import{T as de}from"./types.6a5ef88e.js";import{u as fe}from"./breakpoints.bc070c78.js";import{u as ve}from"./token-meta.77bf9b50.js";import{_ as $e}from"./TokenSelectList.2fe9d40e.js";import{n as Y}from"./firebaseConfig.d7a6b5a9.js";import{_ as be}from"./PlaqueTokenItem.253480ba.js";import{u as Ae}from"./gallery.13c52e52.js";import"./thumbnail-image.ff5b2233.js";import"./gallery.82c2a091.js";const Pe=i=>(Z("data-v-cc2989e6"),i=i(),ee(),i),Se={class:"dialog-container"},Ve={class:"dialog-footer"},ze=Pe(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Ie=G({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(i,{emit:o}){const P=i,d=q([]),y=q(!1),{screen_type:x}=fe(),$=H(),C=ve(),b=pe(),f=z({get(){return P.show_add_token_dialog},set(g){o("update:show_add_token_dialog",g)}});j(f,g=>{g&&(d.value=JSON.parse(JSON.stringify(r.value.entity.token_meta_id_list)))});const r=z(()=>$.plaque_map[P.plaque_id]),h=z(()=>C.sorted_all_token_metas),V=async()=>{y.value=!0;try{for(let[g,u]of d.value.entries()){const e=C.all_token_metas[u];if(!e)throw"Failed to find store token for token: "+u;if(e.entity.platform!=de.Opensea)continue;const n=JSON.parse(JSON.stringify(e));n.entity.user_id=b.get_account.id,n.entity.platform=de.OpenseaArchive;const s=await xe(n.entity);d.value[g]=s.id}await U(P.plaque_id,{token_meta_id_list:d.value}),$.plaque_map[P.plaque_id].entity.token_meta_id_list=d.value}catch(g){J(`Error updating plaque tokens - ${g}`)}y.value=!1,f.value=!1},T=()=>{d.value=[]};return(g,u)=>{const e=c("el-button"),n=c("el-dialog");return _(),w("div",Se,[t(n,{center:"",modelValue:k(f),"onUpdate:modelValue":u[1]||(u[1]=s=>_e(f)?f.value=s:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:k(x)=="xs",top:"2vh"},{footer:a(()=>[l("div",Ve,[l("div",null,A(`Artwork in playlist: ${d.value.length}`),1),ze,t(e,{onClick:T},{default:a(()=>[p("Clear")]),_:1}),t(e,{type:"info",onClick:V,loading:y.value},{default:a(()=>[p("Save")]),_:1},8,["loading"])])]),default:a(()=>[t($e,{selected_token_meta_id_list:d.value,"onUpdate:selected_token_meta_id_list":u[0]||(u[0]=s=>d.value=s),token_meta_list:k(h)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Ne=M(Ie,[["__scopeId","data-v-cc2989e6"]]);const Le={class:"controller-buttons"},Te=G({__name:"PlaqueController",props:{plaque:null},setup(i){const o=i,P=H(),d=q(!1),y=q(!1),x=q(!1),$=q(!1),C=z({get:()=>o.plaque.entity.orientation||"landscape",set:f=>{U(o.plaque.id,{orientation:f}).then(()=>{P.plaque_map[o.plaque.id].entity.orientation=f,L({type:"success",message:"Plaque orientation updated"})}).catch(r=>{J(`Error updating plaque orientation - ${r}`)})}}),b=f=>{const r={type:f,time_sent:Y.now()};U(o.plaque.id,{command:r}).then(()=>{P.plaque_map[o.plaque.id].entity.command=r,L({type:"success",message:"Command sent to plaque"})}).catch(h=>{J(`Error sending command to plaque - ${h}`)}).finally(()=>{d.value=!1,y.value=!1,x.value=!1,$.value=!1})};return(f,r)=>{const h=c("el-button"),V=c("el-radio"),T=c("el-radio-group");return _(),w("div",null,[l("div",Le,[t(h,{circle:"",text:"",loading:d.value,icon:"DArrowLeft",onClick:r[0]||(r[0]=g=>{d.value=!0,b("playlist_previous")})},null,8,["loading"]),t(h,{circle:"",text:"",loading:y.value,icon:"VideoPlay",onClick:r[1]||(r[1]=g=>{y.value=!0,b("play")})},null,8,["loading"]),t(h,{circle:"",text:"",icon:"VideoPause",loading:x.value,onClick:r[2]||(r[2]=g=>{x.value=!0,b("pause")})},null,8,["loading"]),t(h,{circle:"",text:"",icon:"DArrowRight",loading:$.value,onClick:r[3]||(r[3]=g=>{$.value=!0,b("playlist_next")})},null,8,["loading"])]),t(T,{modelValue:k(C),"onUpdate:modelValue":r[4]||(r[4]=g=>_e(C)?C.value=g:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:a(()=>[t(V,{label:"landscape",size:"small"},{default:a(()=>[p("Landscape")]),_:1}),t(V,{label:"portrait",size:"small"},{default:a(()=>[p("Portrait")]),_:1}),t(V,{label:"landscape_reversed",size:"small"},{default:a(()=>[p("Landscape Reversed")]),_:1}),t(V,{label:"portrait_reversed",size:"small"},{default:a(()=>[p("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var De=M(Te,[["__scopeId","data-v-100e65c8"]]);const I=i=>(Z("data-v-1c4e515f"),i=i(),ee(),i),Ee={style:{display:"flex","align-items":"center",padding:"1em"}},Ue={key:0},Fe=I(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Oe={class:"card-simple"},Be=I(()=>l("hr",null,null,-1)),Re=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),je=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Je={style:{padding:"0.3em 1em"}},Me={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Ge={key:0,class:"card-detail"},He={style:{padding:"0 1em"}},Ke={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},Qe=I(()=>l("hr",null,null,-1)),We=I(()=>l("div",{style:{padding:"1em"}},"No artwork added",-1)),Xe=I(()=>l("hr",null,null,-1)),Ye={style:{display:"flex",padding:"1em"}},Ze=I(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),et={key:0,style:{padding:"1em"}},tt={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},lt={key:0},at=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),nt={key:0},ot={key:1},st={style:{"font-size":"var(--el-font-size-extra-small)"}},it={key:1},ut=I(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),rt={style:{display:"flex","justify-content":"end"}},dt=G({__name:"PlaqueCard",props:{plaque:null},setup(i){const o=i,P=H();ce();const d=q("simple"),y=q(!1),x=q(!1),$=q(""),C=q(!1),b=async()=>{C.value=!0,await U(o.plaque.id,{name:o.plaque.entity.name}).catch(e=>{J(`Error updating plaque tokens - ${e}`)}),x.value=!1,C.value=!1},f=ve(),r=z(()=>h.value.length==0?null:h.value[0]),h=z(()=>{const e=f.archive_token_meta_map;return o.plaque.entity.token_meta_id_list.map(s=>e[s])}),V=z(()=>me(o.plaque)),T=()=>{re.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{U(o.plaque.id,{token_meta_id_list:[]}).then(()=>{P.plaque_map[o.plaque.id].entity.token_meta_id_list=[],L({type:"success",message:"Tokens cleared"})}).catch(e=>{L({message:`Error clearing tokens from plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})},g=()=>{re.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{U(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{P.plaque_map[o.plaque.id].entity.user_id="",P.plaque_map[o.plaque.id].entity.token_meta_id_list=[],L({type:"success",message:"Plaque forgotten"})}).catch(e=>{L({message:`Error forgetting plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})};j(d,e=>{e=="settings"&&o.plaque.entity.user_id&&!$.value&&Ce(o.plaque.entity.user_id).then(n=>{$.value=n.entity.email}).catch(n=>{L({message:`Error loading user account - ${n}`,type:"error",showClose:!0,duration:12e3})})});const u=z(()=>{var s,S,D;const e=(D=(S=(s=o==null?void 0:o.plaque)==null?void 0:s.entity)==null?void 0:S.machine_data)==null?void 0:D.updated_at;return e?new Date(e.seconds*1e3+e.nanoseconds/1e6).toLocaleString():"N/A"});return(e,n)=>{const s=c("el-button"),S=c("el-tag"),D=c("el-col"),Q=c("el-row"),W=c("ArrowRight"),F=c("el-icon"),O=c("el-collapse-transition"),R=c("Close"),v=c("el-card");return _(),N(v,null,{default:a(()=>[l("div",Ee,[x.value?ue((_(),w("input",{key:1,"onUpdate:modelValue":n[0]||(n[0]=m=>o.plaque.entity.name=m),class:"edit-name-input"},null,512)),[[ye,o.plaque.entity.name]]):(_(),w("h1",Ue,A(o.plaque.entity.name),1)),x.value?E("",!0):(_(),N(s,{key:2,icon:k(ge),onClick:n[1]||(n[1]=m=>x.value=!0),class:"editIcon",circle:""},null,8,["icon"])),x.value?(_(),N(s,{key:3,icon:k(ke),loading:C.value,onClick:b,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):E("",!0),Fe,k(V)?(_(),N(S,{key:4,class:"ml-2",type:"success"},{default:a(()=>[p("online")]),_:1})):(_(),N(S,{key:5,class:"ml-2",type:"danger"},{default:a(()=>[p("offline")]),_:1}))]),t(O,null,{default:a(()=>[ue(l("section",Oe,[Be,t(Q,{style:{padding:"1em"}},{default:a(()=>[t(D,{span:12},{default:a(()=>{var m;return[Re,l("span",null,A(((m=k(r))==null?void 0:m.entity.name)||"N/A"),1)]}),_:1}),t(D,{span:12},{default:a(()=>{var m;return[je,p(" "+A(((m=k(r))==null?void 0:m.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),l("div",Je,A(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),l("div",Me,[t(s,{type:"info",onClick:n[2]||(n[2]=m=>y.value=!0)},{default:a(()=>[p("Add Artwork")]),_:1}),t(s,{onClick:n[3]||(n[3]=m=>d.value="detail")},{default:a(()=>[p(" Details"),t(F,{class:"el-icon--right"},{default:a(()=>[t(W)]),_:1})]),_:1})])],512),[[qe,d.value=="simple"]])]),_:1}),t(O,null,{default:a(()=>[d.value=="detail"?(_(),w("section",Ge,[l("p",He,A(`Total artworks: ${i.plaque.entity.token_meta_id_list.length}`),1),l("div",Ke,[t(s,{onClick:n[4]||(n[4]=m=>d.value="settings")},{default:a(()=>[p("Settings")]),_:1}),t(s,{onClick:T},{default:a(()=>[p("Clear Artwork")]),_:1})]),Qe,k(h).length==0?(_(),w(B,{key:0},[We,Xe],64)):E("",!0),(_(!0),w(B,null,X(k(h),m=>(_(),N(be,{token_meta:m},null,8,["token_meta"]))),256)),l("div",Ye,[t(s,{type:"info",onClick:n[5]||(n[5]=m=>y.value=!0)},{default:a(()=>[p("Add Artwork")]),_:1}),Ze,t(s,{onClick:n[6]||(n[6]=m=>d.value="simple")},{default:a(()=>[p("Close"),t(F,{class:"el-icon--right"},{default:a(()=>[t(R)]),_:1})]),_:1})])])):E("",!0)]),_:1}),t(O,null,{default:a(()=>{var m,te,le,ae,ne,oe,se,ie;return[d.value=="settings"?(_(),w("section",et,[t(De,{plaque:o.plaque},null,8,["plaque"]),l("div",tt,[i.plaque.entity.user_id?(_(),w("div",lt,[at,$.value?(_(),w("div",nt,A($.value),1)):(_(),w("div",ot,"Loading...")),l("div",st,A(i.plaque.entity.user_id),1)])):(_(),w("div",it,"No associated user")),i.plaque.entity.user_id?(_(),N(s,{key:2,type:"danger",plain:"",onClick:g},{default:a(()=>[p("Forget Display")]),_:1})):E("",!0)]),l("div",null,[ut,l("div",null,"Machine name: "+A((te=(m=i.plaque.entity.machine_data)==null?void 0:m.machine_name)!=null?te:"N/A"),1),l("div",null,"Version: "+A((ae=(le=i.plaque.entity.machine_data)==null?void 0:le.version)!=null?ae:"N/A"),1),l("div",null,"Local IP: "+A((oe=(ne=i.plaque.entity.machine_data)==null?void 0:ne.local_ip)!=null?oe:"N/A"),1),l("div",null,"Public IP: "+A((ie=(se=i.plaque.entity.machine_data)==null?void 0:se.public_ip)!=null?ie:"N/A"),1),l("div",null,"Updated At: "+A(k(u)),1)]),l("div",rt,[t(s,{onClick:n[7]||(n[7]=ht=>d.value="detail")},{default:a(()=>[p("Close"),t(F,{class:"el-icon--right"},{default:a(()=>[t(R)]),_:1})]),_:1})])])):E("",!0)]}),_:1}),t(Ne,{plaque_id:o.plaque.id,show_add_token_dialog:y.value,"onUpdate:show_add_token_dialog":n[8]||(n[8]=m=>y.value=m)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var _t=M(dt,[["__scopeId","data-v-1c4e515f"]]);const K=i=>(Z("data-v-4cbbee76"),i=i(),ee(),i),ct={class:"subheader",style:{display:"flex","align-items":"center"}},pt=K(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),mt=K(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),ft=K(()=>l("div",{style:{"padding-bottom":"40px"}},null,-1)),vt={class:"add-button-container"},yt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},gt=K(()=>l("div",{style:{"font-size":"17px"}},"Add plaque",-1)),kt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},qt=G({__name:"PlaqueList",setup(i){const o=q(!1),{width:P,screen_type:d}=fe(),y=q(!1),x=ce(),$=pe(),C=Ae(),b=q(""),f=q(localStorage.getItem("filter_by_gallery")||""),r=q(localStorage.getItem("online_filter")==="true"||!1);j(f,u=>{localStorage.setItem("filter_by_gallery",u)}),j(r,u=>{if(u){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const h=H(),V=async()=>{o.value=!0,await we({name:"Test Plaque",user_id:$.get_account.id,token_meta_id_list:[],created_at:Y.now(),updated_at:Y.now()}).catch(u=>L({message:`Error creating test plaque- ${u}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,y.value=!1},T=z(()=>JSON.parse(JSON.stringify(h.all_plaque_list)).sort((e,n)=>{const s=e.entity.name.toLowerCase(),S=n.entity.name.toLowerCase();return s<S?-1:s>S?1:0})),g=z(()=>{let u=[...T.value];return u=u.filter(e=>e.entity.name||e.entity.user_id||e.entity.token_meta_id_list.length>0),f.value&&(u=u.filter(e=>{var n;return(n=C.gallery_list.find(s=>s.id==f.value))==null?void 0:n.entity.plaque_id_list.includes(e.id)})),r.value&&(u=u.filter(e=>me(e))),b.value?u.filter(e=>e.entity.name.toLowerCase().includes(b.value.toLowerCase())):u});return(u,e)=>{const n=c("el-input"),s=c("el-button"),S=c("el-option"),D=c("el-select"),Q=c("el-switch"),W=c("el-popover"),F=c("Plus"),O=c("el-icon"),R=c("el-dialog");return _(),w(B,null,[l("div",ct,[t(n,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=v=>b.value=v),"prefix-icon":k(he),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),t(W,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:a(()=>[t(s,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:a(()=>[p("Filters")]),_:1})]),default:a(()=>[pt,t(D,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=v=>f.value=v),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:a(()=>[t(S,{label:"All plaques",value:""}),(_(!0),w(B,null,X(k(C).gallery_list,v=>(_(),N(S,{key:v.id,label:`${v.entity.name}`,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),mt,t(Q,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=v=>r.value=v)},null,8,["modelValue"])]),_:1}),t(s,{icon:"Camera",type:"info",onClick:e[3]||(e[3]=v=>k(x).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:a(()=>[p("Scan")]),_:1})]),ft,(_(!0),w(B,null,X(k(g),v=>(_(),N(_t,{plaque:v,key:v.id},null,8,["plaque"]))),128)),l("div",vt,[l("div",yt,[l("div",{class:"add-button",onClick:e[4]||(e[4]=v=>y.value=!0)},[t(O,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:a(()=>[t(F)]),_:1}),gt])])]),t(R,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=v=>y.value=v),title:"Add plaque",width:k(d)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:a(()=>[l("div",kt,[t(s,{onClick:e[5]||(e[5]=v=>{k(x).push("qr-scan"),y.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:a(()=>[p("Scan Plaque QR Code")]),_:1}),t(s,{icon:"plus",onClick:V,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:a(()=>[p("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Et=M(qt,[["__scopeId","data-v-4cbbee76"]]);export{Et as default};
