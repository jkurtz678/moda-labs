import{d as Q,u as W,e as z}from"./token-meta.7f5c0ba8.js";import{g as H,b as K}from"./gallery.d53d87c7.js";import{g as X,d as Y,u as Z,n as A}from"./firebaseConfig.d7a6b5a9.js";import{x as w,d as ee,r as _,O as le,m as ae,b as i,o as v,e as g,w as o,i as t,j as x,g as h,h as te,F as oe,I as ne,t as B,k as T,J as re}from"./index.7011f6fd.js";import{b as se,T as ue}from"./types.d2ec9214.js";import{u as ie}from"./account.1599fab9.js";import{u as de}from"./token-meta.c83c6f6d.js";import{s as k}from"./util.5a3f501d.js";const me=X(),ce=async(y,p,V,l)=>{console.log("uploadFile - starting file upload for ",y);const c=Y(me,y);Z(c,p).on("state_changed",n=>{console.log("snapshot",n.bytesTransferred,n.totalBytes),V(n.bytesTransferred/n.totalBytes)},n=>{console.log("uploadFile error - ",n),w({message:`Error uploading file to moda archive - ${n}`,type:"error",showClose:!0,duration:12e3})},l)};const pe=T("div",{class:"el-upload__text"},[x(" Drop file here or "),T("em",null,"click to upload")],-1),he=ee({__name:"SubmitTokenForm",props:{token_meta_id:null},setup(y){const p=y,V=_();_();const l=_({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:A.now(),updated_at:A.now(),media_id:"",media_type:"",user_id:"",blockchain:se.OffChain,asset_contract_address:"",token_id:"",platform:ue.Archive}),c=_([]),$=le({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),n=_(!1),U=_("0%"),b=_([]),E=ie(),S=de(),C=_([]);ae(()=>{p.token_meta_id?l.value={...S.all_token_metas[p.token_meta_id].entity}:H().then(u=>{C.value=u})});const q=(u,e)=>re.confirm(`Cancel the upload of ${u.name} ?`).then(()=>!0,()=>!1),F=()=>{},M=async u=>{var s;if(!u){k("Error finding form element");return}if(!!await u.validate(r=>r)){if(l.value.user_id=E.get_account.id,l.value.blockchain!="ethereum"&&(l.value.asset_contract_address="",l.value.token_id=""),p.token_meta_id){D(p.token_meta_id);return}if(((s=c==null?void 0:c.value)==null?void 0:s.length)!==1){k("Please add a file to upload");return}await L(u)}},L=async u=>{const e=c.value[0];n.value=!0;const s=await Q().catch(d=>{console.error(d),n.value=!1,k(`Error getting moda archive token meta document - ${d}`)});if(!s)return;const r=d=>{U.value=`${Math.round(d*100)}%`},f=()=>{N(u,e,s)},m=`${s.id}.${e.name.split(".").pop()}`;return ce(m,e.raw,r,f).catch(d=>{console.error(d),n.value=!1,k(`Error uploading file to moda archive - ${d}`)})},N=async(u,e,s)=>{var f;l.value.media_id=`${s.id}`,l.value.media_type=`.${e.name.split(".").pop()}`;let r;try{r=await z(s,l.value)}catch(m){k(`Error uploading metadata to moda archive - ${m}`),n.value=!1;return}if((f=b.value)!=null&&f.length)try{const m=[];b.value.forEach(async d=>{m.push(K(d,r.id))}),await Promise.all(m)}catch(m){k(`Error adding token to gallery - ${m}`),n.value=!1;return}u.resetFields(),c.value=[],b.value=[],w({type:"success",message:"Successfully submitted token"}),n.value=!1},D=u=>{n.value=!0,W(u,l.value).then(()=>{w({type:"success",message:"Successfully updated token"})}).catch(e=>{k(`Error updating token metadata - ${e}`)}).finally(()=>n.value=!1)};return(u,e)=>{const s=i("el-input"),r=i("el-form-item"),f=i("el-radio"),m=i("el-radio-group"),d=i("el-option"),P=i("el-select"),G=i("upload-filled"),R=i("el-icon"),I=i("el-upload"),O=i("Loading"),j=i("el-button"),J=i("el-form");return v(),g(J,{ref_key:"formRef",ref:V,model:l.value,rules:$,"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:o(()=>[t(r,{label:"Artwork Title",style:{"max-width":"550px"},prop:"name"},{default:o(()=>[t(s,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.name=a)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist Name",style:{"max-width":"550px"},prop:"artist"},{default:o(()=>[t(s,{modelValue:l.value.artist,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.artist=a)},null,8,["modelValue"])]),_:1}),t(r,{label:"Artist Social Media Link",style:{"max-width":"550px"},prop:"artist_social_link"},{default:o(()=>[t(s,{modelValue:l.value.artist_social_link,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.artist_social_link=a)},null,8,["modelValue"])]),_:1}),t(r,{label:"Link to Blockchain"},{default:o(()=>[t(m,{modelValue:l.value.blockchain,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.blockchain=a)},{default:o(()=>[t(f,{label:"off_chain"},{default:o(()=>[x("Off-chain")]),_:1}),t(f,{label:"ethereum"},{default:o(()=>[x("Ethereum")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l.value.blockchain=="ethereum"?(v(),g(r,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:o(()=>[t(s,{modelValue:l.value.asset_contract_address,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.asset_contract_address=a)},null,8,["modelValue"])]),_:1})):h("",!0),l.value.blockchain=="ethereum"?(v(),g(r,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:o(()=>[t(s,{modelValue:l.value.token_id,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.token_id=a)},null,8,["modelValue"])]),_:1})):h("",!0),t(r,{label:"Plaque Description",prop:"description"},{default:o(()=>[t(s,{modelValue:l.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.description=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(r,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[t(s,{modelValue:l.value.public_link,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.public_link=a)},null,8,["modelValue"])]),_:1}),p.token_meta_id?h("",!0):(v(),g(r,{key:2,label:"Add to Gallery"},{default:o(()=>[t(P,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=a=>b.value=a),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(v(!0),te(oe,null,ne(C.value,a=>(v(),g(d,{key:a.id,label:`${a.entity.name}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),p.token_meta_id?h("",!0):(v(),g(r,{key:3},{default:o(()=>[t(I,{class:"upload-demo","auto-upload":!1,action:"","on-remove":F,"before-remove":q,limit:1,drag:"","file-list":c.value,"onUpdate:fileList":e[9]||(e[9]=a=>c.value=a)},{default:o(()=>[t(R,{class:"el-icon--upload"},{default:o(()=>[t(G)]),_:1}),pe]),_:1},8,["file-list"])]),_:1})),t(r,null,{default:o(()=>[t(j,{onClick:e[10]||(e[10]=a=>M(V.value)),loading:n.value,color:"#000000"},{loading:o(()=>[t(R,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[t(O)]),_:1}),x(" "+B(U.value),1)]),default:o(()=>[T("div",null,B(n.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});export{he as _};
