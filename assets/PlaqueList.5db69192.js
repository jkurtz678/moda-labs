import{_ as Q,d as W,r as w,c as I,B as J,b as c,o as _,h as $,i as e,w as a,k as l,t as A,j as m,f as v,C as te,p as le,m as ae,z as E,u as ye,e as D,D as me,G as be,H as $e,g as F,I as Se,J as Pe,F as G,K as ee,A as ve,l as Ve,L as Ae}from"./index.d0c928ce.js";import{u as O,d as ze}from"./plaque.180c7ae7.js";import{c as Ie}from"./token-meta.16ce217f.js";import{u as X}from"./plaque.b68ae7d1.js";import{u as ne,g as Ne}from"./account.9ff8eaee.js";import{s as j,a as ge}from"./util.fb0c5f5a.js";import{T as fe,O as Le}from"./types.3cc10997.js";import{u as ke}from"./breakpoints.e732164e.js";import{u as qe}from"./token-meta.b7bfe417.js";import{_ as Te}from"./TokenSelectList.9eff5162.js";import{n as M}from"./firebaseConfig.4bdd3a5f.js";import{P as Ee}from"./PlaqueTokenItem.85f2c9c0.js";import{u as Ue}from"./gallery.6bb73fac.js";import"./thumbnail-image.7442e5f4.js";import"./ArtworkFilters.e327e1da.js";import"./gallery-token.25579f23.js";const De=u=>(le("data-v-381e6960"),u=u(),ae(),u),Oe={class:"dialog-container"},Be={class:"dialog-footer"},Fe=De(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Me=W({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(u,{emit:n}){const x=u,i=w([]),S=w(!1),{screen_type:V}=ke(),P=X(),C=qe(),b=ne(),k=I({get(){return x.show_add_token_dialog},set(q){n("update:show_add_token_dialog",q)}});J(k,q=>{q&&(i.value=JSON.parse(JSON.stringify(r.value.entity.token_meta_id_list)))});const r=I(()=>P.plaque_map[x.plaque_id]),z=I(()=>C.sorted_all_token_metas),N=async()=>{S.value=!0;try{for(let[q,s]of i.value.entries()){const t=C.all_token_metas[s];if(!t)throw"Failed to find store token for token: "+s;if(t.entity.platform!=fe.Opensea)continue;const f=JSON.parse(JSON.stringify(t));f.entity.user_id=b.get_account.id,f.entity.platform=fe.OpenseaArchive;const g=await Ie(f.entity);i.value[q]=g.id}await O(x.plaque_id,{token_meta_id_list:i.value}),P.plaque_map[x.plaque_id].entity.token_meta_id_list=i.value}catch(q){j(`Error updating plaque tokens - ${q}`)}S.value=!1,k.value=!1},T=()=>{i.value=[]};return(q,s)=>{const t=c("el-button"),f=c("el-dialog");return _(),$("div",Oe,[e(f,{center:"",modelValue:v(k),"onUpdate:modelValue":s[1]||(s[1]=g=>te(k)?k.value=g:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:v(V)=="xs",top:"2vh","destroy-on-close":""},{footer:a(()=>[l("div",Be,[l("div",null,A(`Artwork in playlist: ${i.value.length}`),1),Fe,e(t,{onClick:T},{default:a(()=>[m("Clear")]),_:1}),e(t,{type:"info",onClick:N,loading:S.value},{default:a(()=>[m("Save")]),_:1},8,["loading"])])]),default:a(()=>[e(Te,{selected_token_meta_id_list:i.value,"onUpdate:selected_token_meta_id_list":s[0]||(s[0]=g=>i.value=g),token_meta_list:v(z)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Re=Q(Me,[["__scopeId","data-v-381e6960"]]);const je={class:"controller-buttons"},Je=W({__name:"PlaqueController",props:{plaque:null},setup(u){const n=u,x=X(),i=w(!1),S=w(!1),V=w(!1),P=w(!1),C=I({get:()=>n.plaque.entity.orientation||"landscape",set:k=>{O(n.plaque.id,{orientation:k}).then(()=>{x.plaque_map[n.plaque.id].entity.orientation=k,E({type:"success",message:"Plaque orientation updated"})}).catch(r=>{j(`Error updating plaque orientation - ${r}`)})}}),b=k=>{const r={type:k,time_sent:M.now()};O(n.plaque.id,{command:r}).then(()=>{x.plaque_map[n.plaque.id].entity.command=r,E({type:"success",message:"Command sent to plaque"})}).catch(z=>{j(`Error sending command to plaque - ${z}`)}).finally(()=>{i.value=!1,S.value=!1,V.value=!1,P.value=!1})};return(k,r)=>{const z=c("el-button"),N=c("el-radio"),T=c("el-radio-group");return _(),$("div",null,[l("div",je,[e(z,{circle:"",text:"",loading:i.value,icon:"DArrowLeft",onClick:r[0]||(r[0]=q=>{i.value=!0,b("playlist_previous")})},null,8,["loading"]),e(z,{circle:"",text:"",loading:S.value,icon:"VideoPlay",onClick:r[1]||(r[1]=q=>{S.value=!0,b("play")})},null,8,["loading"]),e(z,{circle:"",text:"",icon:"VideoPause",loading:V.value,onClick:r[2]||(r[2]=q=>{V.value=!0,b("pause")})},null,8,["loading"]),e(z,{circle:"",text:"",icon:"DArrowRight",loading:P.value,onClick:r[3]||(r[3]=q=>{P.value=!0,b("playlist_next")})},null,8,["loading"])]),e(T,{modelValue:v(C),"onUpdate:modelValue":r[4]||(r[4]=q=>te(C)?C.value=q:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:a(()=>[e(N,{label:"landscape",size:"small"},{default:a(()=>[m("Landscape")]),_:1}),e(N,{label:"portrait",size:"small"},{default:a(()=>[m("Portrait")]),_:1}),e(N,{label:"landscape_reversed",size:"small"},{default:a(()=>[m("Landscape Reversed")]),_:1}),e(N,{label:"portrait_reversed",size:"small"},{default:a(()=>[m("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Ge=Q(Je,[["__scopeId","data-v-100e65c8"]]);const L=u=>(le("data-v-ab478a56"),u=u(),ae(),u),He={style:{display:"flex","align-items":"center",padding:"1em"}},Ke={key:0},Qe=L(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),We={class:"card-simple"},Xe=L(()=>l("hr",null,null,-1)),Ye=L(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Ze=L(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),et={style:{padding:"0.3em 1em"}},tt={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},lt={key:0,class:"card-detail"},at={style:{padding:"0 1em"}},nt={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},ot=L(()=>l("hr",null,null,-1)),st=L(()=>l("div",{style:{padding:"1em"}},"No artwork added",-1)),it=L(()=>l("hr",null,null,-1)),ut={style:{display:"flex",padding:"1em"}},rt=L(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),dt={key:0,style:{padding:"1em"}},_t={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},ct={key:0},pt=L(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),mt={key:0},vt={key:1},ft={style:{"font-size":"var(--el-font-size-extra-small)"}},yt={key:1},gt={style:{"margin-bottom":"1em"}},kt=L(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),qt={style:{"margin-bottom":"1em"}},ht=L(()=>l("div",{class:"caption"},"Enable Support VPN",-1)),wt={key:0},xt={style:{display:"flex","justify-content":"end"}},Ct=W({__name:"PlaqueCard",props:{plaque:null},setup(u){const n=u,x=X();ye();const i=w("simple"),S=w(!1),V=w(!1),P=w(""),C=w(!1),b=w(!1),k=async()=>{C.value=!0,await O(n.plaque.id,{name:n.plaque.entity.name}).catch(d=>{j(`Error updating plaque tokens - ${d}`)}),V.value=!1,C.value=!1},r=ne(),z=qe(),N=I(()=>T.value.length==0?null:T.value[0]),T=I(()=>{const d=z.archive_token_meta_map;return n.plaque.entity.token_meta_id_list.map(h=>d[h])}),q=I(()=>ge(n.plaque)),s=I(()=>{const d=n.plaque.entity.last_check_in_time;return d?new Date(d.seconds*1e3).toLocaleString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):"N/A"}),t=()=>{ve.confirm(`Are you sure you want to clear tokens for plaque '${n.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{O(n.plaque.id,{token_meta_id_list:[]}).then(()=>{x.plaque_map[n.plaque.id].entity.token_meta_id_list=[],E({type:"success",message:"Tokens cleared"})}).catch(d=>{E({message:`Error clearing tokens from plaque - ${d}`,type:"error",showClose:!0,duration:12e3})})})},f=()=>{ve.confirm(`Are you sure you want to forget the plaque named '${n.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{O(n.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{x.plaque_map[n.plaque.id].entity.user_id="",x.plaque_map[n.plaque.id].entity.token_meta_id_list=[],E({type:"success",message:"Plaque forgotten"})}).catch(d=>{E({message:`Error forgetting plaque - ${d}`,type:"error",showClose:!0,duration:12e3})})})};J(i,d=>{d=="settings"&&n.plaque.entity.user_id&&!P.value&&Ne(n.plaque.entity.user_id).then(o=>{P.value=o.entity.email}).catch(o=>{E({message:`Error loading user account - ${o}`,type:"error",showClose:!0,duration:12e3})})});const g=I({get:()=>Boolean(n.plaque.entity.vpn_active),set:d=>{O(n.plaque.id,{vpn_active:d}).then(()=>{x.plaque_map[n.plaque.id].entity.vpn_active=d,E({type:"success",message:"VPN setting updated"})}).catch(o=>{j(`Error updating VPN setting- ${o}`)})}}),U=I(()=>{var h,B,R;const d=(R=(B=(h=n==null?void 0:n.plaque)==null?void 0:h.entity)==null?void 0:B.machine_data)==null?void 0:R.updated_at;return d?new Date(d.seconds*1e3+d.nanoseconds/1e6).toLocaleString():"N/A"}),K=()=>{const d={type:"upload_logs",time_sent:M.now()};b.value=!0,O(n.plaque.id,{command:d}).then(()=>{x.plaque_map[n.plaque.id].entity.command=d,E({type:"success",message:"Command sent to plaque"})}).catch(o=>{j(`Error sending command to plaque - ${o}`)}).finally(()=>{b.value=!1})};return(d,o)=>{const h=c("el-button"),B=c("el-tag"),R=c("el-tooltip"),p=c("el-col"),he=c("el-row"),we=c("ArrowRight"),Y=c("el-icon"),Z=c("el-collapse-transition"),oe=c("Close"),xe=c("el-switch"),Ce=c("el-card");return _(),D(Ce,null,{default:a(()=>[l("div",He,[V.value?me((_(),$("input",{key:1,"onUpdate:modelValue":o[0]||(o[0]=y=>n.plaque.entity.name=y),class:"edit-name-input"},null,512)),[[be,n.plaque.entity.name]]):(_(),$("h1",Ke,A(n.plaque.entity.name),1)),V.value?F("",!0):(_(),D(h,{key:2,icon:v($e),onClick:o[1]||(o[1]=y=>V.value=!0),class:"editIcon",circle:""},null,8,["icon"])),V.value?(_(),D(h,{key:3,icon:v(Se),loading:C.value,onClick:k,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):F("",!0),Qe,e(R,{class:"box-item",effect:"dark",content:`Last activity ${v(s)}`,placement:"top"},{default:a(()=>[v(q)?(_(),D(B,{key:0,class:"ml-2",type:"success"},{default:a(()=>[m("online")]),_:1})):(_(),D(B,{key:1,class:"ml-2",type:"danger"},{default:a(()=>[m("offline")]),_:1}))]),_:1},8,["content"])]),e(Z,null,{default:a(()=>[me(l("section",We,[Xe,e(he,{style:{padding:"1em"}},{default:a(()=>[e(p,{span:12},{default:a(()=>{var y;return[Ye,l("span",null,A(((y=v(N))==null?void 0:y.entity.name)||"N/A"),1)]}),_:1}),e(p,{span:12},{default:a(()=>{var y;return[Ze,m(" "+A(((y=v(N))==null?void 0:y.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),l("div",et,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),l("div",tt,[e(h,{type:"info",onClick:o[2]||(o[2]=y=>S.value=!0)},{default:a(()=>[m("Add Artwork")]),_:1}),e(h,{onClick:o[3]||(o[3]=y=>i.value="detail")},{default:a(()=>[m(" Details"),e(Y,{class:"el-icon--right"},{default:a(()=>[e(we)]),_:1})]),_:1})])],512),[[Pe,i.value=="simple"]])]),_:1}),e(Z,null,{default:a(()=>[i.value=="detail"?(_(),$("section",lt,[l("p",at,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),l("div",nt,[e(h,{onClick:o[4]||(o[4]=y=>i.value="settings")},{default:a(()=>[m("Settings")]),_:1}),e(h,{onClick:t},{default:a(()=>[m("Clear Artwork")]),_:1})]),ot,v(T).length==0?(_(),$(G,{key:0},[st,it],64)):F("",!0),(_(!0),$(G,null,ee(v(T),y=>(_(),D(Ee,{token_meta:y},null,8,["token_meta"]))),256)),l("div",ut,[e(h,{type:"info",onClick:o[5]||(o[5]=y=>S.value=!0)},{default:a(()=>[m("Add Artwork")]),_:1}),rt,e(h,{onClick:o[6]||(o[6]=y=>i.value="simple")},{default:a(()=>[m("Close"),e(Y,{class:"el-icon--right"},{default:a(()=>[e(oe)]),_:1})]),_:1})])])):F("",!0)]),_:1}),e(Z,null,{default:a(()=>{var y,se,ie,ue,re,de,_e,ce;return[i.value=="settings"?(_(),$("section",dt,[e(Ge,{plaque:n.plaque},null,8,["plaque"]),l("div",_t,[u.plaque.entity.user_id?(_(),$("div",ct,[pt,P.value?(_(),$("div",mt,A(P.value),1)):(_(),$("div",vt,"Loading...")),l("div",ft,A(u.plaque.entity.user_id),1)])):(_(),$("div",yt,"No associated user")),u.plaque.entity.user_id?(_(),D(h,{key:2,type:"danger",plain:"",onClick:f},{default:a(()=>[m("Forget Display")]),_:1})):F("",!0)]),l("div",gt,[kt,l("div",null,"Machine name: "+A((se=(y=u.plaque.entity.machine_data)==null?void 0:y.machine_name)!=null?se:"N/A"),1),l("div",null,"Version: "+A((ue=(ie=u.plaque.entity.machine_data)==null?void 0:ie.version)!=null?ue:"N/A"),1),l("div",null,"Local IP: "+A((de=(re=u.plaque.entity.machine_data)==null?void 0:re.local_ip)!=null?de:"N/A"),1),l("div",null,"Public IP: "+A((ce=(_e=u.plaque.entity.machine_data)==null?void 0:_e.public_ip)!=null?ce:"N/A"),1),l("div",null,"Updated At: "+A(v(U)),1)]),l("div",qt,[ht,e(xe,{modelValue:v(g),"onUpdate:modelValue":o[7]||(o[7]=pe=>te(g)?g.value=pe:null),"active-text":"Enabled","inactive-text":"Off"},null,8,["modelValue"])]),v(r).is_user_admin?(_(),$("div",wt,[e(h,{plain:"",onClick:K,loading:b.value},{default:a(()=>[m("Upload Logs To Cloud")]),_:1},8,["loading"])])):F("",!0),l("div",xt,[e(h,{onClick:o[8]||(o[8]=pe=>i.value="detail")},{default:a(()=>[m("Close"),e(Y,{class:"el-icon--right"},{default:a(()=>[e(oe)]),_:1})]),_:1})])])):F("",!0)]}),_:1}),e(Re,{plaque_id:n.plaque.id,show_add_token_dialog:S.value,"onUpdate:show_add_token_dialog":o[9]||(o[9]=y=>S.value=y)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var bt=Q(Ct,[["__scopeId","data-v-ab478a56"]]);const H=u=>(le("data-v-517aa68d"),u=u(),ae(),u),$t=H(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Filter by gallery",-1)),St=H(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Online only",-1)),Pt=H(()=>l("div",{class:"caption"},"Sort order",-1)),Vt=H(()=>l("div",{style:{"padding-bottom":"90px"}},null,-1)),At={class:"add-button-container"},zt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},It=H(()=>l("div",{style:{"font-size":"17px"}},"Add plaque",-1)),Nt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},Lt=W({__name:"PlaqueList",setup(u){const n=w(!1),{screen_type:x}=ke(),i=w(!1),S=ye(),V=ne(),P=Ue(),C=w(""),b=w(localStorage.getItem("plaque_list_filter_by_gallery")||"");J(b,s=>{localStorage.setItem("plaque_list_filter_by_gallery",s)});const k=w(localStorage.getItem("online_filter")==="true"||!1);J(k,s=>{if(s){localStorage.setItem("online_filter","true");return}localStorage.setItem("online_filter","false")});const r=w(localStorage.getItem("plaque_list_sort_order")||"name");J(r,s=>{localStorage.setItem("plaque_list_sort_order",s)});const z=X(),N=async()=>{n.value=!0,await ze({name:"Test Plaque",user_id:V.get_account.id,token_meta_id_list:[],created_at:M.now(),updated_at:M.now(),orientation:Le.Landscape,command:{type:"",time_sent:M.fromMillis(0)},last_check_in_time:M.fromMillis(0),vpn_active:!1,machine_data:{machine_name:"",version:"",local_ip:"",public_ip:"",updated_at:M.fromMillis(0)}}).catch(s=>E({message:`Error creating test plaque- ${s}`,type:"error",showClose:!0,duration:12e3})),n.value=!1,i.value=!1},T=I(()=>JSON.parse(JSON.stringify(z.all_plaque_list)).sort((t,f)=>{const g=t.entity.name.toLowerCase(),U=f.entity.name.toLowerCase();return g<U?-1:g>U?1:0})),q=I(()=>{let s=[...T.value];return s=s.filter(t=>t.entity.name||t.entity.user_id||t.entity.token_meta_id_list.length>0),b.value&&(s=s.filter(t=>{var f;return(f=P.gallery_list.find(g=>g.id==b.value))==null?void 0:f.entity.plaque_id_list.includes(t.id)})),k.value&&(s=s.filter(t=>ge(t))),r.value=="name"?s=s.sort((t,f)=>t.entity.name.localeCompare(f.entity.name)):r.value=="last_check_in_time"&&(s=s.sort((t,f)=>t.entity.last_check_in_time==null&&f.entity.last_check_in_time==null?0:t.entity.last_check_in_time==null?1:f.entity.last_check_in_time==null?-1:f.entity.last_check_in_time.seconds-t.entity.last_check_in_time.seconds)),C.value?s.filter(t=>t.entity.name.toLowerCase().includes(C.value.toLowerCase())):s});return(s,t)=>{const f=c("el-input"),g=c("el-button"),U=c("el-option"),K=c("el-select"),d=c("el-switch"),o=c("el-popover"),h=c("Plus"),B=c("el-icon"),R=c("el-dialog");return _(),$(G,null,[l("div",{class:"subheader",style:Ve([{display:"flex","align-items":"center"},v(x)=="xs"?"padding: 0px 8px 10px;":""])},[e(f,{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=p=>C.value=p),"prefix-icon":v(Ae),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),e(o,{placement:"bottom",title:"Plaque Filters",width:300,trigger:"click"},{reference:a(()=>[e(g,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:a(()=>[m("Filters")]),_:1})]),default:a(()=>[$t,e(K,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=p=>b.value=p),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:a(()=>[e(U,{label:"All plaques",value:""}),(_(!0),$(G,null,ee(v(P).gallery_list,p=>(_(),D(U,{key:p.id,label:`${p.entity.name}`,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),St,e(d,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=p=>k.value=p),style:{"margin-bottom":"1em"}},null,8,["modelValue"]),Pt,e(K,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=p=>r.value=p),placeholder:"Sort by",class:"filter-select"},{default:a(()=>[e(U,{label:"Sort by name",value:"name"}),e(U,{label:"Sort by last activity",value:"last_check_in_time"})]),_:1},8,["modelValue"])]),_:1}),e(g,{icon:"Camera",type:"info",onClick:t[4]||(t[4]=p=>v(S).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:a(()=>[m("Scan")]),_:1})],4),Vt,(_(!0),$(G,null,ee(v(q),p=>(_(),D(bt,{plaque:p,key:p.id},null,8,["plaque"]))),128)),l("div",At,[l("div",zt,[l("div",{class:"add-button",onClick:t[5]||(t[5]=p=>i.value=!0)},[e(B,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:a(()=>[e(h)]),_:1}),It])])]),e(R,{modelValue:i.value,"onUpdate:modelValue":t[7]||(t[7]=p=>i.value=p),title:"Add plaque",width:v(x)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:a(()=>[l("div",Nt,[e(g,{onClick:t[6]||(t[6]=p=>{v(S).push("qr-scan"),i.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:a(()=>[m("Scan Plaque QR Code")]),_:1}),e(g,{icon:"plus",onClick:N,loading:n.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:a(()=>[m("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Xt=Q(Lt,[["__scopeId","data-v-517aa68d"]]);export{Xt as default};
