import{u as oe,a as re,b as ne}from"./account.03d67460.js";import{u as ie}from"./token-meta.7a0b8f54.js";import{u as ue,s as _e,d as de,c as ce}from"./gallery-token.f19a7c70.js";import{G as b,T as pe}from"./types.67d14e22.js";import{i as p}from"./firebaseConfig.4d01e9b5.js";import{d as z,c as V,h as $,l as u,t as D,i as a,F as j,f as v,o as w,r as f,q as J,u as I,g as A,J as me,K as ye,a as K,_ as ve,Q as fe,w as _,b as ge,e as he,j as F,Z as qe,z as we,p as xe,m as ke}from"./index.bb66a239.js";import{s as q}from"./util.28150ffc.js";import{u as be,d as Ge,a as Ve,c as $e,b as Ee}from"./gallery.ff6e8954.js";import{u as Ue}from"./breakpoints.f1f048b6.js";import{u as Se}from"./plaque.0a5d6778.js";import{_ as Pe}from"./TokenSelectList.06971c77.js";import"./token-meta.9b03395e.js";import"./plaque.34819a80.js";import"./thumbnail-image.c59476c2.js";import"./ArtworkFilters.e6b0ea3d.js";const Be={class:"card-flex-container"},Ce={style:{flex:"3 1 0%",display:"flex","align-items":"center",padding:"0px 10px 0px 0px"}},De={class:"bold"},Ie=u("hr",{class:"hr"},null,-1),Ae=z({__name:"AddPlaqueItem",props:{in_list:{type:Boolean},plaque:{}},emits:["update_plaque_list"],setup(x,{emit:E}){const o=x,r=E,d=V({get(){return o.in_list},set(){r("update_plaque_list",o.plaque.id)}});return(m,k)=>{const U=v("el-checkbox");return w(),$(j,null,[u("div",Be,[u("div",Ce,[u("p",De,D(o.plaque.entity.name),1)]),a(U,{modelValue:d.value,"onUpdate:modelValue":k[0]||(k[0]=G=>d.value=G),style:{"margin-right":"10px"}},null,8,["modelValue"])]),Ie],64)}}}),Le={style:{"margin-top":"10px","overflow-y":"auto","max-height":"250px"}},Te={key:0},Ne=z({__name:"PlaqueSelectList",props:{selected_plaque_id_list:{},plaque_list:{}},emits:["update:selected_plaque_id_list"],setup(x,{emit:E}){const o=x,r=E,d=f(""),m=f([]);J(()=>{if(!!o.plaque_list)for(let n of o.plaque_list)U.value.has(n.id)?m.value.unshift(n):m.value.push(n)});const k=V(()=>d.value.trim()!==""?m.value.filter(n=>{var i;return(i=n.entity.name)==null?void 0:i.toLowerCase().includes(d.value.toLowerCase())}):m.value),U=V(()=>new Set(o.selected_plaque_id_list)),G=n=>{let i=[...o.selected_plaque_id_list];i.some(y=>y===n)?i=i.filter(y=>y!=n):i.push(n),r("update:selected_plaque_id_list",i)};return(n,i)=>{const y=v("el-input");return w(),$(j,null,[a(y,{type:"text",modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=g=>d.value=g),"prefix-icon":I(ye),placeholder:"Search by plaque name"},null,8,["modelValue","prefix-icon"]),u("div",Le,[k.value.length==0?(w(),$("div",Te,"No plaque found")):A("",!0),(w(!0),$(j,null,me(k.value,g=>(w(),K(Ae,{plaque:g,in_list:Boolean(U.value.has(g.id)),onUpdate_plaque_list:G},null,8,["plaque","in_list"]))),256))])],64)}}});const Q=x=>(xe("data-v-436f62d8"),x=x(),ke(),x),Oe={class:"gallery-dialog"},Re={style:{"max-width":"600px",margin:"0 auto"}},Me=Q(()=>u("div",{class:"header"},"Gallery Name",-1)),je={key:0},ze={key:0,style:{display:"flex","align-items":"center",padding:"1em 0em","max-width":"350px"}},Fe={style:{"margin-bottom":"2em"}},Je={class:"dialog-footer"},Ke=Q(()=>u("div",{style:{"flex-grow":"1"}},null,-1)),Qe=z({__name:"GalleryDetailDialog",setup(x){const E=f(!0),o=f({name:"",created_at:p.now(),updated_at:p.now()}),r=f([]),d=f([]),m=f([]),k=f(),U=fe({name:[{required:!0,message:"Required",trigger:"blur"}]}),G=f(!1),n=f(""),i=ge(),y=he(),g=oe(),Z=Se(),P=be(),H=ie(),{screen_type:W}=Ue(),S=f([]),X=V(()=>r.value.map(l=>S.value.find(e=>e.id==l.user_id))),L=V(()=>{if(g.is_user_admin)return!0;const l=r.value.find(e=>e.user_id==g.get_account.id);return l?l.role==b.Owner||l.role==b.Editor:!1}),Y=V(()=>Object.values(Z.plaque_map)),ee=V(()=>Object.values(H.all_token_metas).filter(l=>l.entity.platform!=pe.Opensea));J(async()=>{if(y.params.gallery_id){const l=P.gallery_list.find(e=>e.id===y.params.gallery_id);if(!l){q("Gallery not found"),i.push({name:"gallery-list"});return}o.value=l.entity,r.value=P.gallery_user_list.filter(e=>e.entity.gallery_id==l.id).sort((e,c)=>e.entity.role===b.Owner?-1:c.entity.role===b.Owner?1:e.entity.role===b.Editor?-1:c.entity.role===b.Editor?1:0).map(e=>e.entity),d.value=P.gallery_plaque_list.filter(e=>e.entity.gallery_id==l.id).map(e=>e.entity.plaque_id),m.value=P.gallery_token_meta_list.filter(e=>e.entity.gallery_id==l.id).map(e=>e.entity.token_meta_id),await re(r.value.map(e=>e.user_id)).then(e=>{e.forEach(c=>{S.value.push(c)})}).catch(e=>{q(e)})}else{S.value.push(g.get_account);const l={user_id:g.get_account.id,role:b.Owner,created_at:p.now(),updated_at:p.now(),gallery_id:""};r.value=[l]}});const le=async l=>{if(!l){q("Error finding form element");return}if(!await l.validate(t=>t))return;G.value=!0;let c;if(y.params.gallery_id?c=await ue(y.params.gallery_id,o.value).catch(t=>(q(t),null)):c=await _e(o.value).catch(t=>(q(`Error saving gallery: ${t}`),null)),!c){q("Error saving gallery");return}const h=c;y.params.gallery_id&&await Promise.all([Ge(h.id),Ve(h.id),de(h.id)]),r.value.forEach(t=>{t.gallery_id=h.id,t.created_at=p.now(),t.updated_at=p.now()});const B=$e(r.value),C=Ee(d.value.map(t=>({gallery_id:h.id,plaque_id:t,created_at:p.now(),updated_at:p.now()}))),T=ce(m.value.map(t=>({gallery_id:h.id,token_meta_id:t,created_at:p.now(),updated_at:p.now()})));Promise.all([B,C,T]).then(t=>{const N=t[0],O=t[1],R=t[2];P.addGalleryToStore(h,N,O,R),we({message:"Gallery saved",type:"success"}),i.push({name:"gallery-list"})}).catch(t=>{q(`Error saving gallery: ${t}`)}).finally(()=>{G.value=!1})},te=async()=>{if(S.value.find(l=>l.entity.email===n.value)){q("User already added");return}await ne(n.value).then(l=>{l&&(S.value.push(l),r.value.push({gallery_id:"",user_id:l.id,role:b.Reader,created_at:p.now(),updated_at:p.now()}))}).catch(l=>{console.log(l),q("Invalid email")})},ae=l=>{r.value.splice(l,1),S.value.splice(l,1)};return(l,e)=>{const c=v("el-input"),h=v("el-form-item"),B=v("el-table-column"),C=v("el-button"),T=v("el-row"),t=v("el-tab-pane"),N=v("el-tabs"),O=v("el-form"),R=v("el-dialog");return w(),$("div",Oe,[a(R,{modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=s=>E.value=s),title:"Edit Gallery",onClose:e[6]||(e[6]=s=>I(i).push({name:"gallery-list"})),top:"2vh",width:"75%",fullscreen:I(W)=="xs"},{footer:_(()=>[u("div",Je,[Ke,L.value?(w(),K(C,{key:0,color:"#000000",onClick:e[4]||(e[4]=s=>le(k.value)),loading:G.value},{default:_(()=>[F("Save")]),_:1},8,["loading"])):A("",!0)])]),default:_(()=>[u("div",Re,[a(O,{ref_key:"form_ref",ref:k,model:o.value,rules:U},{default:_(()=>[a(h,{prop:"name",style:{"max-width":"280px","margin-bottom":"2em"}},{default:_(()=>[Me,a(c,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.name=s),placeholder:"Name"},null,8,["modelValue"])]),_:1}),a(N,{class:"demo-tabs",type:"border-card"},{default:_(()=>[a(t,{label:"Users"},{default:_(()=>[a(T,{style:{display:"block","margin-bottom":"1em"}},{default:_(()=>[a(I(qe),{data:X.value,style:{width:"100%"}},{default:_(()=>[a(B,{prop:"entity.email",label:"Email"}),a(B,{label:"Role"},{default:_(s=>{var M;return[u("div",null,D(((M=r.value.find(se=>se.user_id==s.row.id))==null?void 0:M.role)||"not found"),1)]}),_:1}),a(B,{fixed:"right",label:"",width:"50"},{default:_(s=>[s.$index&&L.value?(w(),$("div",je,[a(C,{link:"",type:"primary",size:"small",icon:"close",onClick:M=>ae(s.$index)},null,8,["onClick"])])):A("",!0)]),_:1})]),_:1},8,["data"]),u("div",null,D(`Users in gallery: ${r.value.length}`),1),L.value?(w(),$("div",ze,[a(c,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value=s),placeholder:"Email"},null,8,["modelValue"]),a(C,{icon:"Plus",color:"#000000",size:"small",style:{"margin-left":"1em"},onClick:te},{default:_(()=>[F(" Add user ")]),_:1})])):A("",!0)]),_:1})]),_:1}),a(t,{label:"Artwork"},{default:_(()=>[u("div",null,[a(Pe,{selected_token_meta_id_list:m.value,"onUpdate:selected_token_meta_id_list":e[2]||(e[2]=s=>m.value=s),token_meta_list:ee.value,max_height:350},null,8,["selected_token_meta_id_list","token_meta_list"]),u("div",null,D(`Artwork in gallery: ${m.value.length}`),1)])]),_:1}),a(t,{label:"Plaques"},{default:_(()=>[u("div",Fe,[a(Ne,{selected_plaque_id_list:d.value,"onUpdate:selected_plaque_id_list":e[3]||(e[3]=s=>d.value=s),plaque_list:Y.value},null,8,["selected_plaque_id_list","plaque_list"]),u("div",null,D(`Plaques in gallery: ${d.value.length}`),1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","fullscreen"])])}}});var _l=ve(Qe,[["__scopeId","data-v-436f62d8"]]);export{_l as default};
