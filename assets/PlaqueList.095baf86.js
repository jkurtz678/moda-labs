import{_ as R,d as j,r as w,c as z,z as K,b as c,o as _,h,i as t,w as n,k as a,t as P,j as v,f as g,A as se,p as Q,l as W,x as I,u as ie,e as T,B as ae,C as pe,D as me,g as D,G as fe,H as ve,F as B,I as G,J as ne,K as ye}from"./index.97ab4089.js";import{u as E,c as ge}from"./plaque.093acf64.js";import{c as ke}from"./token-meta.2d60a689.js";import{u as F}from"./plaque.b10108ca.js";import{u as ue,g as qe}from"./account.c96f8471.js";import{s as O}from"./util.b0da9864.js";import{T as oe}from"./types.6a5ef88e.js";import{u as de}from"./breakpoints.252c9c29.js";import{u as re}from"./token-meta.6a078e4a.js";import{_ as he}from"./TokenSelectList.a88f12ee.js";import{n as H}from"./firebaseConfig.d7a6b5a9.js";import{_ as we}from"./PlaqueTokenItem.3931d2c4.js";import{u as xe}from"./gallery.029a7805.js";import"./thumbnail-image.9b17bebd.js";import"./gallery.82c2a091.js";const Ce=u=>(Q("data-v-cc2989e6"),u=u(),W(),u),$e={class:"dialog-container"},be={class:"dialog-footer"},Ae=Ce(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Pe=j({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(u,{emit:o}){const A=u,d=w([]),y=w(!1),{screen_type:x}=de(),$=F(),C=re(),b=ue(),m=z({get(){return A.show_add_token_dialog},set(s){o("update:show_add_token_dialog",s)}});K(m,s=>{s&&(d.value=JSON.parse(JSON.stringify(r.value.entity.token_meta_id_list)))});const r=z(()=>$.plaque_map[A.plaque_id]),k=z(()=>C.sorted_all_token_metas),S=async()=>{y.value=!0;try{for(let[s,e]of d.value.entries()){const l=C.all_token_metas[e];if(!l)throw"Failed to find store token for token: "+e;if(l.entity.platform!=oe.Opensea)continue;const i=JSON.parse(JSON.stringify(l));i.entity.user_id=b.get_account.id,i.entity.platform=oe.OpenseaArchive;const q=await ke(i.entity);d.value[s]=q.id}await E(A.plaque_id,{token_meta_id_list:d.value}),$.plaque_map[A.plaque_id].entity.token_meta_id_list=d.value}catch(s){O(`Error updating plaque tokens - ${s}`)}y.value=!1,m.value=!1},L=()=>{d.value=[]};return(s,e)=>{const l=c("el-button"),i=c("el-dialog");return _(),h("div",$e,[t(i,{center:"",modelValue:g(m),"onUpdate:modelValue":e[1]||(e[1]=q=>se(m)?m.value=q:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:g(x)=="xs",top:"2vh"},{footer:n(()=>[a("div",be,[a("div",null,P(`Artwork in playlist: ${d.value.length}`),1),Ae,t(l,{onClick:L},{default:n(()=>[v("Clear")]),_:1}),t(l,{type:"info",onClick:S,loading:y.value},{default:n(()=>[v("Save")]),_:1},8,["loading"])])]),default:n(()=>[t(he,{selected_token_meta_id_list:d.value,"onUpdate:selected_token_meta_id_list":e[0]||(e[0]=q=>d.value=q),token_meta_list:g(k)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Se=R(Pe,[["__scopeId","data-v-cc2989e6"]]);const Ve={class:"controller-buttons"},Ne=j({__name:"PlaqueController",props:{plaque:null},setup(u){const o=u,A=F(),d=w(!1),y=w(!1),x=w(!1),$=w(!1),C=z({get:()=>o.plaque.entity.orientation||"landscape",set:m=>{E(o.plaque.id,{orientation:m}).then(()=>{A.plaque_map[o.plaque.id].entity.orientation=m,I({type:"success",message:"Plaque orientation updated"})}).catch(r=>{O(`Error updating plaque orientation - ${r}`)})}}),b=m=>{const r={type:m,time_sent:H.now()};E(o.plaque.id,{command:r}).then(()=>{A.plaque_map[o.plaque.id].entity.command=r,I({type:"success",message:"Command sent to plaque"})}).catch(k=>{O(`Error sending command to plaque - ${k}`)}).finally(()=>{d.value=!1,y.value=!1,x.value=!1,$.value=!1})};return(m,r)=>{const k=c("el-button"),S=c("el-radio"),L=c("el-radio-group");return _(),h("div",null,[a("div",Ve,[t(k,{circle:"",text:"",loading:d.value,icon:"DArrowLeft",onClick:r[0]||(r[0]=s=>{d.value=!0,b("playlist_previous")})},null,8,["loading"]),t(k,{circle:"",text:"",loading:y.value,icon:"VideoPlay",onClick:r[1]||(r[1]=s=>{y.value=!0,b("play")})},null,8,["loading"]),t(k,{circle:"",text:"",icon:"VideoPause",loading:x.value,onClick:r[2]||(r[2]=s=>{x.value=!0,b("pause")})},null,8,["loading"]),t(k,{circle:"",text:"",icon:"DArrowRight",loading:$.value,onClick:r[3]||(r[3]=s=>{$.value=!0,b("playlist_next")})},null,8,["loading"])]),t(L,{modelValue:g(C),"onUpdate:modelValue":r[4]||(r[4]=s=>se(C)?C.value=s:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:n(()=>[t(S,{label:"landscape",size:"small"},{default:n(()=>[v("Landscape")]),_:1}),t(S,{label:"portrait",size:"small"},{default:n(()=>[v("Portrait")]),_:1}),t(S,{label:"landscape_reversed",size:"small"},{default:n(()=>[v("Landscape Reversed")]),_:1}),t(S,{label:"portrait_reversed",size:"small"},{default:n(()=>[v("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var ze=R(Ne,[["__scopeId","data-v-100e65c8"]]);const V=u=>(Q("data-v-43e778f5"),u=u(),W(),u),Ie={style:{display:"flex","align-items":"center",padding:"1em"}},Le={key:0},Te=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),De={class:"card-simple"},Ee=V(()=>a("hr",null,null,-1)),Ue=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Be=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Oe={style:{padding:"0.3em 1em"}},Re={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},je={key:0,class:"card-detail"},Fe={style:{padding:"0 1em"}},Je={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},Me=V(()=>a("hr",null,null,-1)),Ge=V(()=>a("div",{style:{padding:"1em"}},"No artwork added",-1)),He=V(()=>a("hr",null,null,-1)),Ke={style:{display:"flex",padding:"1em"}},Qe=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),We={key:0,style:{padding:"1em"}},Xe={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},Ye={key:0},Ze=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),et={key:0},tt={key:1},lt={style:{"font-size":"var(--el-font-size-extra-small)"}},at={key:1},nt=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),ot={style:{display:"flex","justify-content":"end"}},st=j({__name:"PlaqueCard",props:{plaque:null},setup(u){const o=u,A=F();ie();const d=w("simple"),y=w(!1),x=w(!1),$=w(""),C=w(!1),b=async()=>{C.value=!0,await E(o.plaque.id,{name:o.plaque.entity.name}).catch(e=>{O(`Error updating plaque tokens - ${e}`)}),x.value=!1,C.value=!1},m=re(),r=z(()=>k.value.length==0?null:k.value[0]),k=z(()=>{const e=m.archive_token_meta_map;return o.plaque.entity.token_meta_id_list.map(i=>e[i])}),S=()=>{ne.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{E(o.plaque.id,{token_meta_id_list:[]}).then(()=>{A.plaque_map[o.plaque.id].entity.token_meta_id_list=[],I({type:"success",message:"Tokens cleared"})}).catch(e=>{I({message:`Error clearing tokens from plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})},L=()=>{ne.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{E(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{A.plaque_map[o.plaque.id].entity.user_id="",A.plaque_map[o.plaque.id].entity.token_meta_id_list=[],I({type:"success",message:"Plaque forgotten"})}).catch(e=>{I({message:`Error forgetting plaque - ${e}`,type:"error",showClose:!0,duration:12e3})})})};K(d,e=>{e=="settings"&&o.plaque.entity.user_id&&!$.value&&qe(o.plaque.entity.user_id).then(l=>{$.value=l.entity.email}).catch(l=>{I({message:`Error loading user account - ${l}`,type:"error",showClose:!0,duration:12e3})})});const s=z(()=>{var i,q,N;const e=(N=(q=(i=o==null?void 0:o.plaque)==null?void 0:i.entity)==null?void 0:q.machine_data)==null?void 0:N.updated_at;return e?new Date(e.seconds*1e3+e.nanoseconds/1e6).toLocaleString():"N/A"});return(e,l)=>{const i=c("el-button"),q=c("el-tag"),N=c("el-col"),J=c("el-row"),M=c("ArrowRight"),U=c("el-icon"),f=c("el-collapse-transition"),X=c("Close"),ce=c("el-card");return _(),T(ce,null,{default:n(()=>[a("div",Ie,[x.value?ae((_(),h("input",{key:1,"onUpdate:modelValue":l[0]||(l[0]=p=>o.plaque.entity.name=p),class:"edit-name-input"},null,512)),[[pe,o.plaque.entity.name]]):(_(),h("h1",Le,P(o.plaque.entity.name),1)),x.value?D("",!0):(_(),T(i,{key:2,icon:g(me),onClick:l[1]||(l[1]=p=>x.value=!0),class:"editIcon",circle:""},null,8,["icon"])),x.value?(_(),T(i,{key:3,icon:g(fe),loading:C.value,onClick:b,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):D("",!0),Te,t(q,{class:"ml-2",type:"success"},{default:n(()=>[v("online")]),_:1})]),t(f,null,{default:n(()=>[ae(a("section",De,[Ee,t(J,{style:{padding:"1em"}},{default:n(()=>[t(N,{span:12},{default:n(()=>{var p;return[Ue,a("span",null,P(((p=g(r))==null?void 0:p.entity.name)||"N/A"),1)]}),_:1}),t(N,{span:12},{default:n(()=>{var p;return[Be,v(" "+P(((p=g(r))==null?void 0:p.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),a("div",Oe,P(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),a("div",Re,[t(i,{type:"info",onClick:l[2]||(l[2]=p=>y.value=!0)},{default:n(()=>[v("Add Artwork")]),_:1}),t(i,{onClick:l[3]||(l[3]=p=>d.value="detail")},{default:n(()=>[v(" Details"),t(U,{class:"el-icon--right"},{default:n(()=>[t(M)]),_:1})]),_:1})])],512),[[ve,d.value=="simple"]])]),_:1}),t(f,null,{default:n(()=>[d.value=="detail"?(_(),h("section",je,[a("p",Fe,P(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),a("div",Je,[t(i,{onClick:l[4]||(l[4]=p=>d.value="settings")},{default:n(()=>[v("Settings")]),_:1}),t(i,{onClick:S},{default:n(()=>[v("Clear Artwork")]),_:1})]),Me,g(k).length==0?(_(),h(B,{key:0},[Ge,He],64)):D("",!0),(_(!0),h(B,null,G(g(k),p=>(_(),T(we,{token_meta:p},null,8,["token_meta"]))),256)),a("div",Ke,[t(i,{type:"info",onClick:l[5]||(l[5]=p=>y.value=!0)},{default:n(()=>[v("Add Artwork")]),_:1}),Qe,t(i,{onClick:l[6]||(l[6]=p=>d.value="simple")},{default:n(()=>[v("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(X)]),_:1})]),_:1})])])):D("",!0)]),_:1}),t(f,null,{default:n(()=>{var p,Y,Z,ee,te,le;return[d.value=="settings"?(_(),h("section",We,[t(ze,{plaque:o.plaque},null,8,["plaque"]),a("div",Xe,[u.plaque.entity.user_id?(_(),h("div",Ye,[Ze,$.value?(_(),h("div",et,P($.value),1)):(_(),h("div",tt,"Loading...")),a("div",lt,P(u.plaque.entity.user_id),1)])):(_(),h("div",at,"No associated user")),u.plaque.entity.user_id?(_(),T(i,{key:2,type:"danger",plain:"",onClick:L},{default:n(()=>[v("Forget Display")]),_:1})):D("",!0)]),a("div",null,[nt,a("div",null,"Machine name: "+P((Y=(p=u.plaque.entity.machine_data)==null?void 0:p.machine_name)!=null?Y:"N/A"),1),a("div",null,"Local IP: "+P((ee=(Z=u.plaque.entity.machine_data)==null?void 0:Z.local_ip)!=null?ee:"N/A"),1),a("div",null,"Public IP: "+P((le=(te=u.plaque.entity.machine_data)==null?void 0:te.public_ip)!=null?le:"N/A"),1),a("div",null,"Updated At: "+P(g(s)),1)]),a("div",ot,[t(i,{onClick:l[7]||(l[7]=ft=>d.value="detail")},{default:n(()=>[v("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(X)]),_:1})]),_:1})])])):D("",!0)]}),_:1}),t(Se,{plaque_id:o.plaque.id,show_add_token_dialog:y.value,"onUpdate:show_add_token_dialog":l[8]||(l[8]=p=>y.value=p)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var it=R(st,[["__scopeId","data-v-43e778f5"]]);const _e=u=>(Q("data-v-0ea15fab"),u=u(),W(),u),ut={class:"subheader",style:{display:"flex","align-items":"center"}},dt=_e(()=>a("div",{style:{"padding-bottom":"40px"}},null,-1)),rt={class:"add-button-container"},_t={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},ct=_e(()=>a("div",{style:{"font-size":"17px"}},"Add plaque",-1)),pt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},mt=j({__name:"PlaqueList",setup(u){const o=w(!1),{width:A,screen_type:d}=de(),y=w(!1),x=ie(),$=ue(),C=xe(),b=w(""),m=w(localStorage.getItem("filter_by_gallery")||"");K(m,s=>{localStorage.setItem("filter_by_gallery",s)});const r=F(),k=async()=>{o.value=!0,await ge({name:"Test Plaque",user_id:$.get_account.id,token_meta_id_list:[],created_at:H.now(),updated_at:H.now()}).catch(s=>I({message:`Error creating test plaque- ${s}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,y.value=!1},S=z(()=>JSON.parse(JSON.stringify(r.all_plaque_list)).sort((e,l)=>{const i=e.entity.name.toLowerCase(),q=l.entity.name.toLowerCase();return i<q?-1:i>q?1:0})),L=z(()=>{let s=[...S.value];return s=s.filter(e=>e.entity.name||e.entity.user_id||e.entity.token_meta_id_list.length>0),m.value&&(s=s.filter(e=>{var l;return(l=C.gallery_list.find(i=>i.id==m.value))==null?void 0:l.entity.plaque_id_list.includes(e.id)})),b?s.filter(e=>e.entity.name.toLowerCase().includes(b.value.toLowerCase())):s});return(s,e)=>{const l=c("el-input"),i=c("el-option"),q=c("el-select"),N=c("el-button"),J=c("Plus"),M=c("el-icon"),U=c("el-dialog");return _(),h(B,null,[a("div",ut,[t(l,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=f=>b.value=f),"prefix-icon":g(ye),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),t(q,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=f=>m.value=f),placeholder:"Filter by gallery",style:{"margin-left":"10px",width:"260px"}},{default:n(()=>[t(i,{label:"All plaques",value:""}),(_(!0),h(B,null,G(g(C).gallery_list,f=>(_(),T(i,{key:f.id,label:`Filter by gallery - ${f.entity.name}`,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(N,{icon:"Camera",type:"info",onClick:e[2]||(e[2]=f=>g(x).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:n(()=>[v("Scan")]),_:1})]),dt,(_(!0),h(B,null,G(g(L),f=>(_(),T(it,{plaque:f,key:f.id},null,8,["plaque"]))),128)),a("div",rt,[a("div",_t,[a("div",{class:"add-button",onClick:e[3]||(e[3]=f=>y.value=!0)},[t(M,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:n(()=>[t(J)]),_:1}),ct])])]),t(U,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=f=>y.value=f),title:"Add plaque",width:g(d)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:n(()=>[a("div",pt,[t(N,{onClick:e[4]||(e[4]=f=>{g(x).push("qr-scan"),y.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:n(()=>[v("Scan Plaque QR Code")]),_:1}),t(N,{icon:"plus",onClick:k,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:n(()=>[v("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Nt=R(mt,[["__scopeId","data-v-0ea15fab"]]);export{Nt as default};
