import{d as O,Q as ne,S as oe,r as A,o as d,h,F as q,K as j,l as L,f as s,T as le,j as N,t as H,U as ae,V as se,q as Y,B as J,_ as X,u as Z,M as re,c as I,b as P,k as w,n as U,i as f,w as S,W,e as G,g as Q,A as ie,z as K,L as ce,p as ue,m as de}from"./index.2c25157e.js";import{a as me}from"./thumbnail-image.e361499a.js";import{c as pe,d as _e}from"./types.3cc10997.js";import{s as fe}from"./util.b53628ef.js";import{u as ke}from"./account.edbf8a9e.js";import{f as ve}from"./token-meta.16ce217f.js";import{u as ee}from"./gallery.b33219db.js";import{u as te}from"./breakpoints.26b81faf.js";import{u as he}from"./token-meta.3efef434.js";import{A as ye}from"./ArtworkFilters.115004cb.js";import"./firebaseConfig.4bdd3a5f.js";import"./gallery-token.25579f23.js";const ge={columnWidth:400,gap:0,keyMapper:(n,o,T,y)=>y,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:n,columnWidth:o,emit:T,gap:y,items:r,maxColumns:c,minColumns:m,nextTick:k,onBeforeUnmount:$,onMounted:_,rtl:M,scrollContainer:x,ssrColumns:E,vue:D,wall:C,watch:R}){function l(a,e,v,z){const F=u(v);return z+e+F<=a?l(a,e,v+1,z+e+F):v}function u(a){const e=Array.isArray(o.value)?o.value:[o.value];return e[a%e.length]}function p(){const a=l(C.value.getBoundingClientRect().width,y.value,0,-y.value),e=g(t(a));return e>0?e:1}function t(a){const e=c==null?void 0:c.value;return e&&a>e?e:a}function g(a){const e=m==null?void 0:m.value;return e&&a<e?e:a}function i(a){return[...new Array(a)].map(()=>[])}if(E.value>0){const a=i(E.value);r.value.forEach((e,v)=>a[v%E.value].push(v)),n.value=a}async function b(a){if(a>=r.value.length)return;await k();const e=[...C.value.children];M.value&&e.reverse();const v=e.reduce((z,F)=>F.getBoundingClientRect().height<z.getBoundingClientRect().height?F:z);n.value[+v.dataset.index].push(a),await b(a+1)}async function B(a=!1){if(n.value.length===p()&&!a){T(D===2?"redraw-skip":"redrawSkip");return}n.value=i(p());const e=x==null?void 0:x.value,v=e?e.scrollTop:window.scrollY;await b(0),e?e.scrollBy({top:v-e.scrollTop}):window.scrollTo({top:v}),T("redraw")}const V=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>B());return _(()=>{B(),V==null||V.observe(C.value)}),$(()=>V==null?void 0:V.unobserve(C.value)),R([r,M],()=>B(!0)),R([o,y,m,c],()=>B()),{getColumnWidthTarget:u}}const xe=["data-index"],Ce=O({__name:"masonry-wall",props:ne({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ge),emits:["redraw","redrawSkip"],setup(n,{emit:o}){const T=n,{columnWidth:y,items:r,gap:c,rtl:m,ssrColumns:k,scrollContainer:$,minColumns:_,maxColumns:M,keyMapper:x}=oe(T),E=A([]),D=A(),{getColumnWidthTarget:C}=we({columns:E,columnWidth:y,emit:o,gap:c,items:r,keyMapper:x,maxColumns:M,minColumns:_,nextTick:ae,onBeforeUnmount:se,onMounted:Y,rtl:m,scrollContainer:$,ssrColumns:k,vue:3,wall:D,watch:J});return(R,l)=>(d(),h("div",{ref_key:"wall",ref:D,class:"masonry-wall",style:L({display:"flex",gap:`${s(c)}px`})},[(d(!0),h(q,null,j(E.value,(u,p)=>(d(),h("div",{key:p,class:"masonry-column","data-index":p,style:L({display:"flex","flex-basis":`${s(C)(p)}px`,"flex-direction":"column","flex-grow":1,gap:`${s(c)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(d(!0),h(q,null,j(u,(t,g)=>(d(),h("div",{key:s(x)(s(r)[t],p,g,t),class:"masonry-item"},[le(R.$slots,"default",{item:s(r)[t],column:p,row:g,index:t},()=>[N(H(s(r)[t]),1)])]))),128))],12,xe))),128))],4))}}),be=(()=>{const n=Ce;return n.install=o=>{o.component("MasonryWall",n)},n})();const Te=["src"],Ee={class:"header"},Ae={class:"platform"},Me={style:{"font-size":"1.6em","font-weight":"bold"}},Be={key:1,style:{"font-weight":"bold"}},Se={key:3,style:{height:"32px"}},$e={style:{"font-size":"0.9em","line-height":"1.3em"}},De={style:{margin:"10px 0px"}},Re=O({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(n){const o=n,T=Z(),y=me(re(o,"token_meta")),r=A(!1),c=A(0),m=A(),k=A(),$=ke(),_=ee(),{screen_type:M}=te(),x=I(()=>pe(o.token_meta.entity.platform)),E=async()=>{const t=await _e(o.token_meta);if(!t){fe("Error getting source file");return}window.open(t,"_blank")},D=I(()=>o.token_meta.entity.aspect_ratio?o.column_width/o.token_meta.entity.aspect_ratio:o.column_width),C=()=>{const t=T.resolve({name:"preview-plaque",params:{token_meta_id:o.token_meta.id}});window.open(t.href)},R=()=>{window.open(o.token_meta.entity.public_link,"_blank")},l=()=>{window.open(o.token_meta.entity.artist_social_link,"_blank")};function u(){if(!m.value){console.log("animateDivHeight - error finding tile container");return}if(!r.value&&c.value==0&&(c.value=m.value.offsetHeight),r.value=!r.value,!k.value){console.log("animateDivHeight - error finding detail container");return}let t;r.value&&k.value.offsetHeight>c.value?t=k.value.offsetHeight:t=c.value;const g=300,i=10,b=m.value.offsetHeight,B=Math.ceil(t-b),V=Math.ceil(g/i),a=B/V;let e=0;const v=setInterval(()=>{if(e>=V){m.value.style.height=t+"px",clearInterval(v);return}e++;const z=b+a*e;m.value.style.height=z+"px"},i)}const p=()=>{ie.prompt(`Are you sure you want to delete ${o.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:t})=>{if(t)return ve(o.token_meta.id)}).then(()=>{K({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(t=>{K({message:`Error deleting artwork - ${t}`,type:"error",showClose:!0,duration:12e3})})};return(t,g)=>{const i=P("el-button"),b=P("el-tooltip");return d(),h("div",{ref_key:"tile_container",ref:m,class:"custom-card",onClick:u,style:L(`height: ${s(D)}px !important`)},[w("img",{class:U(r.value?"absolute":""),src:s(y)},null,10,Te),w("div",{class:U([r.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),w("div",{class:U(["transition absolute",r.value?"hide-blur":"show-blur"])},[w("div",Ee,H(`${n.token_meta.entity.name} | ${n.token_meta.entity.artist}`),1),w("div",Ae,H(s(x)),1)],2),w("div",{ref_key:"detail_container",ref:k,class:U(["detail-container transition",r.value?"show-blur":"hide-blur"])},[w("div",Me,H(n.token_meta.entity.name),1),n.token_meta.entity.artist_social_link?(d(),h("div",{key:0,style:L(s(M)=="xs"?"display: flex; justify-content: center;":"")},[f(i,{link:"",style:{"font-weight":"bold",display:"block"},disabled:!r.value,onClick:W(l,["stop"])},{default:S(()=>[N(H(n.token_meta.entity.artist),1)]),_:1},8,["disabled","onClick"])],4)):(d(),h("div",Be,H(n.token_meta.entity.artist),1)),r.value?(d(),h(q,{key:2},[f(b,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:S(()=>[f(i,{icon:"Edit",text:"",circle:"",onClick:g[0]||(g[0]=W(B=>s(T).push({name:"edit-artwork",params:{token_meta_id:o.token_meta.id}}),["stop"]))})]),_:1}),f(b,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:S(()=>[f(i,{icon:"Download",text:"",circle:"",onClick:W(E,["stop"])},null,8,["onClick"])]),_:1}),f(b,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:S(()=>[f(i,{icon:"Tickets",text:"",circle:"",onClick:W(C,["stop"])},null,8,["onClick"])]),_:1}),n.token_meta.entity.public_link?(d(),G(b,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:S(()=>[f(i,{icon:"Link",text:"",circle:"",onClick:W(R,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0),s($).is_user_admin?(d(),G(b,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:S(()=>[f(i,{icon:"Delete",text:"",circle:"",onClick:W(p,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0)],64)):(d(),h("div",Se)),w("div",$e,H(n.token_meta.entity.description),1),w("div",De,[(d(!0),h(q,null,j(s(_).token_id_to_gallery_map.get(o.token_meta.id),B=>(d(),G(i,{size:"small",round:"",plain:"",type:"primary",style:{margin:"3px 10px 3px 0px"}},{default:S(()=>[N(H(B.entity.name),1)]),_:2},1024))),256))])],2)],4)}}});var He=X(Re,[["__scopeId","data-v-2eac3150"]]);const Ve=n=>(ue("data-v-0fdc092a"),n=n(),de(),n),ze=Ve(()=>w("div",{style:{"padding-bottom":"90px"}},null,-1)),We={key:1,style:{padding:"1em"}},Ie=O({__name:"ArtworkTileGrid",setup(n){const o=Z(),T=he();ee();const y=A(null),r=30,c=A(r),m=A([]),k=A("");J(k,l=>{c.value=r});const $=250,_=10,{screen_type:M}=te(),x=I(()=>{switch(M.value){case"xs":return 340-_*2;case"sm":return 650-_*2;case"md":return 960-_*2;case"lg":return 1200-_*2;case"xl":return 1700-_*2}return 0}),E=I(()=>{let l=Math.floor(x.value/($+_));return l>5&&(l=5),(x.value-(l-1)*_)/l}),D=I(()=>T.sorted_all_token_metas.filter(l=>Boolean(l.entity.aspect_ratio))),C=I(()=>{const l=m.value,u=0,p=u+c.value;return l.slice(u,p)});Y(()=>{const l=document.getElementById("masonry-container");if(!l){console.log("ArtworkTileGrid error, masonary_wall element not found");return}l.addEventListener("scroll",()=>{const u=l.scrollTop,p=l.scrollHeight,t=l.clientHeight;u/(p-t)*100>90&&c.value<m.value.length&&(c.value=c.value+20)})});const R=l=>{console.log("updateFilteredTokens",l),m.value=l};return(l,u)=>{const p=P("el-input"),t=P("el-button"),g=P("RouterView");return d(),h(q,null,[w("div",{class:"subheader",style:L([{display:"flex","align-items":"center"},s(M)=="xs"?"padding: 0px 8px 10px;":""])},[f(p,{modelValue:k.value,"onUpdate:modelValue":u[0]||(u[0]=i=>k.value=i),"prefix-icon":s(ce),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),f(ye,{all_tokens:s(D),search_filter:k.value,use_local_storage:!0,onUpdateFilteredTokens:u[1]||(u[1]=i=>R(i))},null,8,["all_tokens","search_filter"]),f(t,{icon:"Plus",type:"info",onClick:u[2]||(u[2]=i=>s(o).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:S(()=>[N("Artwork")]),_:1})],4),ze,w("div",{id:"masonry-container",ref_key:"masonryContainer",ref:y,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[s(C).length>0?(d(),G(s(be),{key:0,id:"masonary-wall","scroll-container":y.value,items:s(C),"column-width":$,gap:_,style:L(`width: ${s(x)}px; margin: auto`),"max-columns":5},{default:S(({item:i})=>[f(He,{token_meta:i,column_width:s(E)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(d(),h("div",We,"No artwork found"))],512),f(g)],64)}}});var Je=X(Ie,[["__scopeId","data-v-0fdc092a"]]);export{Je as default};
