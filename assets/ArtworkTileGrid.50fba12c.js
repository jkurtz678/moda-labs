import{d as O,P as ne,Q as oe,r as A,o as u,h as y,F,I as j,M as U,f as r,S as le,j as N,t as H,T as ae,U as se,m as K,z as Y,_ as X,u as Z,L as re,c as L,b as P,k as x,n as q,i as f,w as $,V as I,e as G,g as Q,J as ie,x as J,K as ce,p as ue,l as me}from"./index.2a5ea296.js";import{a as de}from"./thumbnail-image.f7851393.js";import{c as _e,d as pe}from"./types.d2ec9214.js";import{s as fe}from"./util.10a0288c.js";import{u as ve}from"./account.910df78c.js";import{f as ke}from"./token-meta.7f5c0ba8.js";import{u as ee}from"./gallery.b63ce518.js";import{u as te}from"./breakpoints.963098aa.js";import{u as he}from"./token-meta.4f958212.js";import{A as ye}from"./ArtworkFilters.326976ae.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.d53d87c7.js";const ge={columnWidth:400,gap:0,keyMapper:(t,n,E,g)=>g,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:t,columnWidth:n,emit:E,gap:g,items:s,maxColumns:i,minColumns:m,nextTick:v,onBeforeUnmount:S,onMounted:p,rtl:D,scrollContainer:C,ssrColumns:M,vue:R,wall:b,watch:a}){function c(l,e,h,z){const W=w(h);return z+e+W<=l?c(l,e,h+1,z+e+W):h}function w(l){const e=Array.isArray(n.value)?n.value:[n.value];return e[l%e.length]}function _(){const l=c(b.value.getBoundingClientRect().width,g.value,0,-g.value),e=d(o(l));return e>0?e:1}function o(l){const e=i==null?void 0:i.value;return e&&l>e?e:l}function d(l){const e=m==null?void 0:m.value;return e&&l<e?e:l}function k(l){return[...new Array(l)].map(()=>[])}if(M.value>0){const l=k(M.value);s.value.forEach((e,h)=>l[h%M.value].push(h)),t.value=l}async function T(l){if(l>=s.value.length)return;await v();const e=[...b.value.children];D.value&&e.reverse();const h=e.reduce((z,W)=>W.getBoundingClientRect().height<z.getBoundingClientRect().height?W:z);t.value[+h.dataset.index].push(l),await T(l+1)}async function B(l=!1){if(t.value.length===_()&&!l){E(R===2?"redraw-skip":"redrawSkip");return}t.value=k(_());const e=C==null?void 0:C.value,h=e?e.scrollTop:window.scrollY;await T(0),e?e.scrollBy({top:h-e.scrollTop}):window.scrollTo({top:h}),E("redraw")}const V=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>B());return p(()=>{B(),V==null||V.observe(b.value)}),S(()=>V==null?void 0:V.unobserve(b.value)),a([s,D],()=>B(!0)),a([n,g,m,i],()=>B()),{getColumnWidthTarget:w}}const xe=["data-index"],Ce=O({__name:"masonry-wall",props:ne({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ge),emits:["redraw","redrawSkip"],setup(t,{emit:n}){const E=t,{columnWidth:g,items:s,gap:i,rtl:m,ssrColumns:v,scrollContainer:S,minColumns:p,maxColumns:D,keyMapper:C}=oe(E),M=A([]),R=A(),{getColumnWidthTarget:b}=we({columns:M,columnWidth:g,emit:n,gap:i,items:s,keyMapper:C,maxColumns:D,minColumns:p,nextTick:ae,onBeforeUnmount:se,onMounted:K,rtl:m,scrollContainer:S,ssrColumns:v,vue:3,wall:R,watch:Y});return(a,c)=>(u(),y("div",{ref_key:"wall",ref:R,class:"masonry-wall",style:U({display:"flex",gap:`${r(i)}px`})},[(u(!0),y(F,null,j(M.value,(w,_)=>(u(),y("div",{key:_,class:"masonry-column","data-index":_,style:U({display:"flex","flex-basis":`${r(b)(_)}px`,"flex-direction":"column","flex-grow":1,gap:`${r(i)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(u(!0),y(F,null,j(w,(o,d)=>(u(),y("div",{key:r(C)(r(s)[o],_,d,o),class:"masonry-item"},[le(a.$slots,"default",{item:r(s)[o],column:_,row:d,index:o},()=>[N(H(r(s)[o]),1)])]))),128))],12,xe))),128))],4))}}),be=(()=>{const t=Ce;return t.install=n=>{n.component("MasonryWall",t)},t})();const Te=["src"],Ee={class:"header"},Me={class:"platform"},Ae={style:{"font-size":"1.6em","font-weight":"bold"}},Be={key:1,style:{"font-weight":"bold"}},$e={key:3,style:{height:"32px"}},Se={style:{"font-size":"0.9em","line-height":"1.3em"}},De={style:{margin:"10px 0px"}},Re=O({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(t){const n=t,E=Z(),g=de(re(n,"token_meta")),s=A(!1),i=A(0),m=A(),v=A(),S=ve(),p=ee(),{screen_type:D}=te(),C=L(()=>_e(n.token_meta.entity.platform)),M=async()=>{const o=await pe(n.token_meta);if(!o){fe("Error getting source file");return}window.open(o,"_blank")},R=L(()=>n.token_meta.entity.aspect_ratio?n.column_width/n.token_meta.entity.aspect_ratio:n.column_width),b=()=>{const o=E.resolve({name:"preview-plaque",params:{token_meta_id:n.token_meta.id}});window.open(o.href)},a=()=>{window.open(n.token_meta.entity.public_link,"_blank")},c=()=>{window.open(n.token_meta.entity.artist_social_link,"_blank")};function w(){if(!m.value){console.log("animateDivHeight - error finding tile container");return}if(!s.value&&i.value==0&&(i.value=m.value.offsetHeight),s.value=!s.value,!v.value){console.log("animateDivHeight - error finding detail container");return}let o;s.value&&v.value.offsetHeight>i.value?o=v.value.offsetHeight:o=i.value;const d=300,k=10,T=m.value.offsetHeight,B=Math.ceil(o-T),V=Math.ceil(d/k),l=B/V;let e=0;const h=setInterval(()=>{if(e>=V){m.value.style.height=o+"px",clearInterval(h);return}e++;const z=T+l*e;m.value.style.height=z+"px"},k)}const _=()=>{ie.prompt(`Are you sure you want to delete ${n.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:o})=>{if(o)return ke(n.token_meta.id)}).then(()=>{J({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(o=>{J({message:`Error deleting artwork - ${o}`,type:"error",showClose:!0,duration:12e3})})};return(o,d)=>{const k=P("el-button"),T=P("el-tooltip");return u(),y("div",{ref_key:"tile_container",ref:m,class:"custom-card",onClick:w,style:U(`height: ${r(R)}px !important`)},[x("img",{class:q(s.value?"absolute":""),src:r(g)},null,10,Te),x("div",{class:q([s.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),x("div",{class:q(["transition absolute",s.value?"hide-blur":"show-blur"])},[x("div",Ee,H(`${t.token_meta.entity.name} | ${t.token_meta.entity.artist}`),1),x("div",Me,H(r(C)),1)],2),x("div",{ref_key:"detail_container",ref:v,class:q(["detail-container transition",s.value?"show-blur":"hide-blur"])},[x("div",Ae,H(t.token_meta.entity.name),1),t.token_meta.entity.artist_social_link?(u(),y("div",{key:0,style:U(r(D)=="xs"?"display: flex; justify-content: center;":"")},[f(k,{link:"",style:{"font-weight":"bold",display:"block"},disabled:!s.value,onClick:I(c,["stop"])},{default:$(()=>[N(H(t.token_meta.entity.artist),1)]),_:1},8,["disabled","onClick"])],4)):(u(),y("div",Be,H(t.token_meta.entity.artist),1)),s.value?(u(),y(F,{key:2},[f(T,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:$(()=>[f(k,{icon:"Edit",text:"",circle:"",onClick:d[0]||(d[0]=I(B=>r(E).push({name:"edit-artwork",params:{token_meta_id:n.token_meta.id}}),["stop"]))})]),_:1}),f(T,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:$(()=>[f(k,{icon:"Download",text:"",circle:"",onClick:I(M,["stop"])},null,8,["onClick"])]),_:1}),f(T,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:$(()=>[f(k,{icon:"Tickets",text:"",circle:"",onClick:I(b,["stop"])},null,8,["onClick"])]),_:1}),t.token_meta.entity.public_link?(u(),G(T,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:$(()=>[f(k,{icon:"Link",text:"",circle:"",onClick:I(a,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0),r(S).is_user_admin?(u(),G(T,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:$(()=>[f(k,{icon:"Delete",text:"",circle:"",onClick:I(_,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0)],64)):(u(),y("div",$e)),x("div",Se,H(t.token_meta.entity.description),1),x("div",De,[(u(!0),y(F,null,j(r(p).token_id_to_gallery_map.get(n.token_meta.id),B=>(u(),G(k,{size:"small",round:"",plain:"",type:"primary",style:{margin:"3px 10px 3px 0px"}},{default:$(()=>[N(H(B.entity.name),1)]),_:2},1024))),256))])],2)],4)}}});var He=X(Re,[["__scopeId","data-v-2eac3150"]]);const Ve=t=>(ue("data-v-750cec11"),t=t(),me(),t),ze={class:"subheader",style:{display:"flex","align-items":"center"}},Ie=Ve(()=>x("div",{style:{"padding-bottom":"40px"}},null,-1)),Le={key:1,style:{padding:"1em"}},We=O({__name:"ArtworkTileGrid",setup(t){const n=Z(),E=he();ee();const g=A(null),s=30,i=A(s),m=A([]),v=A("");Y(v,a=>{i.value=s});const S=250,p=10,{screen_type:D}=te(),C=L(()=>{switch(D.value){case"xs":return 340-p*2;case"sm":return 650-p*2;case"md":return 960-p*2;case"lg":return 1200-p*2;case"xl":return 1700-p*2}return 0}),M=L(()=>{let a=Math.floor(C.value/(S+p));return a>5&&(a=5),(C.value-(a-1)*p)/a}),R=L(()=>E.sorted_all_token_metas.filter(a=>Boolean(a.entity.aspect_ratio))),b=L(()=>{const a=m.value,c=0,w=c+i.value;return a.slice(c,w)});return K(()=>{const a=document.getElementById("masonry-container");if(!a){console.log("ArtworkTileGrid error, masonary_wall element not found");return}a.addEventListener("scroll",()=>{const c=a.scrollTop,w=a.scrollHeight,_=a.clientHeight;c/(w-_)*100>90&&i.value<m.value.length&&(i.value=i.value+20)})}),(a,c)=>{const w=P("el-input"),_=P("el-button"),o=P("RouterView");return u(),y(F,null,[x("div",ze,[f(w,{modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=d=>v.value=d),"prefix-icon":r(ce),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),f(ye,{all_tokens:r(R),search_filter:v.value,use_local_storage:!0,onUpdateFilteredTokens:c[1]||(c[1]=d=>m.value=d)},null,8,["all_tokens","search_filter"]),f(_,{icon:"Plus",type:"info",onClick:c[2]||(c[2]=d=>r(n).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:$(()=>[N("Artwork")]),_:1})]),Ie,x("div",{id:"masonry-container",ref_key:"masonryContainer",ref:g,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[r(b).length>0?(u(),G(r(be),{key:0,id:"masonary-wall","scroll-container":g.value,items:r(b),"column-width":S,gap:p,style:U(`width: ${r(C)}px; margin: auto`),"max-columns":5},{default:$(({item:d})=>[f(He,{token_meta:d,column_width:r(M)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(u(),y("div",Le,"No artwork found"))],512),f(o)],64)}}});var Xe=X(We,[["__scopeId","data-v-750cec11"]]);export{Xe as default};
