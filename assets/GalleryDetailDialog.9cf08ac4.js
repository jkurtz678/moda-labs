import{u as se,a as re,b as oe}from"./account.d0f431b1.js";import{u as ne}from"./token-meta.b2c301b8.js";import{u as ie,s as ue,d as de,c as _e}from"./gallery-token.c4aa5fe8.js";import{G as k,T as me}from"./types.4ea69ea7.js";import{i as p}from"./firebaseConfig.4d01e9b5.js";import{d as z,c as G,h as V,i as u,t as C,j as a,F as j,f as v,o as x,r as f,m as H,u as A,g as I,H as pe,I as ce,a as X,_ as ye,O as ve,w as d,b as fe,e as ge,k as F,X as qe,x as he}from"./index.fced87bf.js";import{s as w}from"./util.6c19ab9d.js";import{u as we,d as xe,a as ke,c as be,b as Ge}from"./gallery.85d28687.js";import{u as Ve}from"./breakpoints.5d352d22.js";import{u as $e}from"./plaque.e662cd1c.js";import{_ as Ee}from"./TokenSelectList.9c846d75.js";import"./token-meta.8015aff1.js";import"./plaque.f697ad87.js";import"./thumbnail-image.3e43f47a.js";import"./ArtworkFilters.b2750ac9.js";const Ue={class:"card-flex-container"},Pe={style:{flex:"3 1 0%",display:"flex","align-items":"center",padding:"0px 10px 0px 0px"}},Be={class:"bold"},Se=z({__name:"AddPlaqueItem",props:{in_list:{type:Boolean},plaque:{}},emits:["update_plaque_list"],setup(D,{emit:$}){const r=D,o=$,_=G({get(){return r.in_list},set(){o("update_plaque_list",r.plaque.id)}});return(c,g)=>{const E=v("el-checkbox");return x(),V(j,null,[u("div",Ue,[u("div",Pe,[u("p",Be,C(r.plaque.entity.name),1)]),a(E,{modelValue:_.value,"onUpdate:modelValue":g[0]||(g[0]=b=>_.value=b),style:{"margin-right":"10px"}},null,8,["modelValue"])]),g[1]||(g[1]=u("hr",{class:"hr"},null,-1))],64)}}}),Ce={style:{"margin-top":"10px","overflow-y":"auto","max-height":"250px"}},De={key:0},Ae=z({__name:"PlaqueSelectList",props:{selected_plaque_id_list:{},plaque_list:{}},emits:["update:selected_plaque_id_list"],setup(D,{emit:$}){const r=D,o=$,_=f(""),c=f([]);H(()=>{if(!!r.plaque_list)for(let n of r.plaque_list)E.value.has(n.id)?c.value.unshift(n):c.value.push(n)});const g=G(()=>_.value.trim()!==""?c.value.filter(n=>{var i;return(i=n.entity.name)==null?void 0:i.toLowerCase().includes(_.value.toLowerCase())}):c.value),E=G(()=>new Set(r.selected_plaque_id_list)),b=n=>{let i=[...r.selected_plaque_id_list];i.some(y=>y===n)?i=i.filter(y=>y!=n):i.push(n),o("update:selected_plaque_id_list",i)};return(n,i)=>{const y=v("el-input");return x(),V(j,null,[a(y,{type:"text",modelValue:_.value,"onUpdate:modelValue":i[0]||(i[0]=q=>_.value=q),"prefix-icon":A(ce),placeholder:"Search by plaque name"},null,8,["modelValue","prefix-icon"]),u("div",Ce,[g.value.length==0?(x(),V("div",De,"No plaque found")):I("",!0),(x(!0),V(j,null,pe(g.value,q=>(x(),X(Se,{plaque:q,in_list:Boolean(E.value.has(q.id)),onUpdate_plaque_list:b},null,8,["plaque","in_list"]))),256))])],64)}}});const Ie={class:"gallery-dialog"},Le={style:{"max-width":"600px",margin:"0 auto"}},Oe={key:0},Te={key:0,style:{display:"flex","align-items":"center",padding:"1em 0em","max-width":"350px"}},Ne={style:{"margin-bottom":"2em"}},Re={class:"dialog-footer"},Me=z({__name:"GalleryDetailDialog",setup(D){const $=f(!0),r=f({name:"",created_at:p.now(),updated_at:p.now()}),o=f([]),_=f([]),c=f([]),g=f(),E=ve({name:[{required:!0,message:"Required",trigger:"blur"}]}),b=f(!1),n=f(""),i=fe(),y=ge(),q=se(),J=$e(),P=we(),K=ne(),{screen_type:Q}=Ve(),U=f([]),W=G(()=>o.value.map(l=>U.value.find(e=>e.id==l.user_id))),L=G(()=>{if(q.is_user_admin)return!0;const l=o.value.find(e=>e.user_id==q.get_account.id);return l?l.role==k.Owner||l.role==k.Editor:!1}),Y=G(()=>Object.values(J.plaque_map)),Z=G(()=>Object.values(K.all_token_metas).filter(l=>l.entity.platform!=me.Opensea));H(async()=>{if(y.params.gallery_id){const l=P.gallery_list.find(e=>e.id===y.params.gallery_id);if(!l){w("Gallery not found"),i.push({name:"gallery-list"});return}r.value=l.entity,o.value=P.gallery_user_list.filter(e=>e.entity.gallery_id==l.id).sort((e,m)=>e.entity.role===k.Owner?-1:m.entity.role===k.Owner?1:e.entity.role===k.Editor?-1:m.entity.role===k.Editor?1:0).map(e=>e.entity),_.value=P.gallery_plaque_list.filter(e=>e.entity.gallery_id==l.id).map(e=>e.entity.plaque_id),c.value=P.gallery_token_meta_list.filter(e=>e.entity.gallery_id==l.id).map(e=>e.entity.token_meta_id),await re(o.value.map(e=>e.user_id)).then(e=>{e.forEach(m=>{U.value.push(m)})}).catch(e=>{w(e)})}else{U.value.push(q.get_account);const l={user_id:q.get_account.id,role:k.Owner,created_at:p.now(),updated_at:p.now(),gallery_id:""};o.value=[l]}});const ee=async l=>{if(!l){w("Error finding form element");return}if(!await l.validate(t=>t))return;b.value=!0;let m;if(y.params.gallery_id?m=await ie(y.params.gallery_id,r.value).catch(t=>(w(t),null)):m=await ue(r.value).catch(t=>(w(`Error saving gallery: ${t}`),null)),!m){w("Error saving gallery");return}const h=m;y.params.gallery_id&&await Promise.all([xe(h.id),ke(h.id),de(h.id)]),o.value.forEach(t=>{t.gallery_id=h.id,t.created_at=p.now(),t.updated_at=p.now()});const B=be(o.value),S=Ge(_.value.map(t=>({gallery_id:h.id,plaque_id:t,created_at:p.now(),updated_at:p.now()}))),O=_e(c.value.map(t=>({gallery_id:h.id,token_meta_id:t,created_at:p.now(),updated_at:p.now()})));Promise.all([B,S,O]).then(t=>{const T=t[0],N=t[1],R=t[2];P.addGalleryToStore(h,T,N,R),he({message:"Gallery saved",type:"success"}),i.push({name:"gallery-list"})}).catch(t=>{w(`Error saving gallery: ${t}`)}).finally(()=>{b.value=!1})},le=async()=>{if(U.value.find(l=>l.entity.email===n.value)){w("User already added");return}await oe(n.value).then(l=>{l&&(U.value.push(l),o.value.push({gallery_id:"",user_id:l.id,role:k.Reader,created_at:p.now(),updated_at:p.now()}))}).catch(l=>{console.log(l),w("Invalid email")})},te=l=>{o.value.splice(l,1),U.value.splice(l,1)};return(l,e)=>{const m=v("el-input"),h=v("el-form-item"),B=v("el-table-column"),S=v("el-button"),O=v("el-row"),t=v("el-tab-pane"),T=v("el-tabs"),N=v("el-form"),R=v("el-dialog");return x(),V("div",Ie,[a(R,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=s=>$.value=s),title:"Edit Gallery",onClose:e[6]||(e[6]=s=>A(i).push({name:"gallery-list"})),top:"2vh",width:"75%",fullscreen:A(Q)=="xs"},{footer:d(()=>[u("div",Re,[e[10]||(e[10]=u("div",{style:{"flex-grow":"1"}},null,-1)),L.value?(x(),X(S,{key:0,color:"#000000",onClick:e[4]||(e[4]=s=>ee(g.value)),loading:b.value},{default:d(()=>e[9]||(e[9]=[F("Save")])),_:1},8,["loading"])):I("",!0)])]),default:d(()=>[u("div",Le,[a(N,{ref_key:"form_ref",ref:g,model:r.value,rules:E},{default:d(()=>[a(h,{prop:"name",style:{"max-width":"280px","margin-bottom":"2em"}},{default:d(()=>[e[7]||(e[7]=u("div",{class:"header"},"Gallery Name",-1)),a(m,{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value.name=s),placeholder:"Name"},null,8,["modelValue"])]),_:1}),a(T,{class:"demo-tabs",type:"border-card"},{default:d(()=>[a(t,{label:"Users"},{default:d(()=>[a(O,{style:{display:"block","margin-bottom":"1em"}},{default:d(()=>[a(A(qe),{data:W.value,style:{width:"100%"}},{default:d(()=>[a(B,{prop:"entity.email",label:"Email"}),a(B,{label:"Role"},{default:d(s=>{var M;return[u("div",null,C(((M=o.value.find(ae=>ae.user_id==s.row.id))==null?void 0:M.role)||"not found"),1)]}),_:1}),a(B,{fixed:"right",label:"",width:"50"},{default:d(s=>[s.$index&&L.value?(x(),V("div",Oe,[a(S,{link:"",type:"primary",size:"small",icon:"close",onClick:M=>te(s.$index)},null,8,["onClick"])])):I("",!0)]),_:1})]),_:1},8,["data"]),u("div",null,C(`Users in gallery: ${o.value.length}`),1),L.value?(x(),V("div",Te,[a(m,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value=s),placeholder:"Email"},null,8,["modelValue"]),a(S,{icon:"Plus",color:"#000000",size:"small",style:{"margin-left":"1em"},onClick:le},{default:d(()=>e[8]||(e[8]=[F(" Add user ")])),_:1})])):I("",!0)]),_:1})]),_:1}),a(t,{label:"Artwork"},{default:d(()=>[u("div",null,[a(Ee,{selected_token_meta_id_list:c.value,"onUpdate:selected_token_meta_id_list":e[2]||(e[2]=s=>c.value=s),token_meta_list:Z.value,max_height:350},null,8,["selected_token_meta_id_list","token_meta_list"]),u("div",null,C(`Artwork in gallery: ${c.value.length}`),1)])]),_:1}),a(t,{label:"Plaques"},{default:d(()=>[u("div",Ne,[a(Ae,{selected_plaque_id_list:_.value,"onUpdate:selected_plaque_id_list":e[3]||(e[3]=s=>_.value=s),plaque_list:Y.value},null,8,["selected_plaque_id_list","plaque_list"]),u("div",null,C(`Plaques in gallery: ${_.value.length}`),1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","fullscreen"])])}}});var sl=ye(Me,[["__scopeId","data-v-436f62d8"]]);export{sl as default};
