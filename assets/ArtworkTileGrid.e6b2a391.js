import{d as J,P as te,Q as oe,r as S,o as f,h as T,F as W,I as Q,M as N,f as d,S as le,j,t as R,T as ne,U as ae,m as X,z as P,_ as Z,u as ee,L as re,c as z,b as L,k as b,n as G,i as n,w,V as F,e as O,g as K,J as ie,x as Y,K as se,p as ce,l as ue}from"./index.703c7fa8.js";import{u as de}from"./thumbnail-image.b385cf5f.js";import{c as me,d as _e}from"./types.6a5ef88e.js";import{s as pe}from"./util.4ba9799e.js";import{u as fe}from"./account.cce505d8.js";import{f as ve}from"./token-meta.e73e8480.js";import{u as ye}from"./token-meta.d76c133e.js";import{u as he}from"./gallery.a8d301af.js";import{u as ge}from"./breakpoints.7d34130c.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.82c2a091.js";const ke={columnWidth:400,gap:0,keyMapper:(a,r,M,V)=>V,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:a,columnWidth:r,emit:M,gap:V,items:i,maxColumns:y,minColumns:h,nextTick:x,onBeforeUnmount:B,onMounted:A,rtl:$,scrollContainer:C,ssrColumns:E,vue:g,wall:I,watch:D}){function H(o,l,k,c){const U=m(k);return c+l+U<=o?H(o,l,k+1,c+l+U):k}function m(o){const l=Array.isArray(r.value)?r.value:[r.value];return l[o%l.length]}function u(){const o=H(I.value.getBoundingClientRect().width,V.value,0,-V.value),l=e(_(o));return l>0?l:1}function _(o){const l=y==null?void 0:y.value;return l&&o>l?l:o}function e(o){const l=h==null?void 0:h.value;return l&&o<l?l:o}function t(o){return[...new Array(o)].map(()=>[])}if(E.value>0){const o=t(E.value);i.value.forEach((l,k)=>o[k%E.value].push(k)),a.value=o}async function p(o){if(o>=i.value.length)return;await x();const l=[...I.value.children];$.value&&l.reverse();const k=l.reduce((c,U)=>U.getBoundingClientRect().height<c.getBoundingClientRect().height?U:c);a.value[+k.dataset.index].push(o),await p(o+1)}async function v(o=!1){if(a.value.length===u()&&!o){M(g===2?"redraw-skip":"redrawSkip");return}a.value=t(u());const l=C==null?void 0:C.value,k=l?l.scrollTop:window.scrollY;await p(0),l?l.scrollBy({top:k-l.scrollTop}):window.scrollTo({top:k}),M("redraw")}const s=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>v());return A(()=>{v(),s==null||s.observe(I.value)}),B(()=>s==null?void 0:s.unobserve(I.value)),D([i,$],()=>v(!0)),D([r,V,h,y],()=>v()),{getColumnWidthTarget:m}}const be=["data-index"],xe=J({__name:"masonry-wall",props:te({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ke),emits:["redraw","redrawSkip"],setup(a,{emit:r}){const M=a,{columnWidth:V,items:i,gap:y,rtl:h,ssrColumns:x,scrollContainer:B,minColumns:A,maxColumns:$,keyMapper:C}=oe(M),E=S([]),g=S(),{getColumnWidthTarget:I}=we({columns:E,columnWidth:V,emit:r,gap:y,items:i,keyMapper:C,maxColumns:$,minColumns:A,nextTick:ne,onBeforeUnmount:ae,onMounted:X,rtl:h,scrollContainer:B,ssrColumns:x,vue:3,wall:g,watch:P});return(D,H)=>(f(),T("div",{ref_key:"wall",ref:g,class:"masonry-wall",style:N({display:"flex",gap:`${d(y)}px`})},[(f(!0),T(W,null,Q(E.value,(m,u)=>(f(),T("div",{key:u,class:"masonry-column","data-index":u,style:N({display:"flex","flex-basis":`${d(I)(u)}px`,"flex-direction":"column","flex-grow":1,gap:`${d(y)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(f(!0),T(W,null,Q(m,(_,e)=>(f(),T("div",{key:d(C)(d(i)[_],u,e,_),class:"masonry-item"},[le(D.$slots,"default",{item:d(i)[_],column:u,row:e,index:_},()=>[j(R(d(i)[_]),1)])]))),128))],12,be))),128))],4))}}),Ce=(()=>{const a=xe;return a.install=r=>{r.component("MasonryWall",a)},a})();const Se=["src"],Te={class:"header"},Ve={class:"platform"},Ae={style:{"font-size":"1.6em","font-weight":"bold"}},$e={key:0},Ee={key:1,style:{"font-weight":"bold"}},Me={key:3,style:{height:"32px"}},Be={style:{"font-size":"0.9em","line-height":"1.3em"}},Ie=J({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(a){const r=a,M=ee(),V=de(re(r,"token_meta")),i=S(!1),y=S(0),h=S(),x=S(),B=fe(),A=z(()=>me(r.token_meta.entity.platform)),$=async()=>{const m=await _e(r.token_meta);if(!m){pe("Error getting source file");return}window.open(m,"_blank")},C=z(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),E=()=>{const m=M.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(m.href)},g=()=>{window.open(r.token_meta.entity.public_link,"_blank")},I=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function D(m){if(!h.value){console.log("animateDivHeight - error finding tile container");return}if(m&&y.value==0&&(y.value=h.value.offsetHeight),!x.value){console.log("animateDivHeight - error finding detail container");return}let u;m&&x.value.offsetHeight>y.value?u=x.value.offsetHeight:u=y.value;const _=300,e=10,t=h.value.offsetHeight,p=Math.ceil(u-t),v=Math.ceil(_/e),s=p/v;let o=0;const l=setInterval(()=>{if(o>=v){h.value.style.height=u+"px",clearInterval(l);return}o++;const k=t+s*o;h.value.style.height=k+"px"},e)}const H=()=>{ie.prompt(`Are you sure you want to delete ${r.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:m})=>{if(m)return ve(r.token_meta.id)}).then(()=>{Y({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(m=>{Y({message:`Error deleting artwork - ${m}`,type:"error",showClose:!0,duration:12e3})})};return(m,u)=>{const _=L("el-button"),e=L("el-tooltip");return f(),T("div",{ref_key:"tile_container",ref:h,class:"custom-card",onClick:u[1]||(u[1]=()=>{i.value=!i.value,D(i.value)}),style:N(i.value?"":`height: ${d(C)}px !important`)},[b("img",{class:G(i.value?"absolute":""),src:d(V)},null,10,Se),b("div",{class:G([i.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),b("div",{class:G(["transition absolute",i.value?"hide-blur":"show-blur"])},[b("div",Te,R(`${a.token_meta.entity.name} | ${a.token_meta.entity.artist}`),1),b("div",Ve,R(d(A)),1)],2),b("div",{ref_key:"detail_container",ref:x,class:G(["detail-container transition",i.value?"show-blur":"hide-blur absolute-no-b"])},[b("div",Ae,R(a.token_meta.entity.name),1),a.token_meta.entity.artist_social_link?(f(),T("div",$e,[n(_,{link:"",style:{"font-weight":"bold",display:"block"},onClick:F(I,["stop"])},{default:w(()=>[j(R(a.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(f(),T("div",Ee,R(a.token_meta.entity.artist),1)),i.value?(f(),T(W,{key:2},[n(e,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:w(()=>[n(_,{icon:"Edit",text:"",circle:"",onClick:u[0]||(u[0]=F(t=>d(M).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),n(e,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:w(()=>[n(_,{icon:"Download",text:"",circle:"",onClick:F($,["stop"])},null,8,["onClick"])]),_:1}),n(e,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:w(()=>[n(_,{icon:"Tickets",text:"",circle:"",onClick:F(E,["stop"])},null,8,["onClick"])]),_:1}),a.token_meta.entity.public_link?(f(),O(e,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:w(()=>[n(_,{icon:"Link",text:"",circle:"",onClick:F(g,["stop"])},null,8,["onClick"])]),_:1})):K("",!0),d(B).is_user_admin?(f(),O(e,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:w(()=>[n(_,{icon:"Delete",text:"",circle:"",onClick:F(H,["stop"])},null,8,["onClick"])]),_:1})):K("",!0)],64)):(f(),T("div",Me)),b("div",Be,R(a.token_meta.entity.description),1)],2)],4)}}});var De=Z(Ie,[["__scopeId","data-v-bc2a1e7c"]]);const q=a=>(ce("data-v-23b1ba20"),a=a(),ue(),a),Le={class:"subheader",style:{display:"flex","align-items":"center"}},He=q(()=>b("div",{class:"caption"},"Filter by gallery",-1)),Re=q(()=>b("div",{class:"caption"},"Filter by aspect ratio",-1)),ze=q(()=>b("div",{class:"caption"},"Filter by platform",-1)),Fe=q(()=>b("div",{class:"caption"},"Sort order",-1)),Pe=q(()=>b("div",{style:{"padding-bottom":"40px"}},null,-1)),Ue={key:1,style:{padding:"1em"}},We=J({__name:"ArtworkTileGrid",setup(a){const r=ee(),M=ye(),V=he(),i=S(""),y=S(null),h=30,x=S(h),B=S(localStorage.getItem("artwork_grid_aspect_ratio_filter")||"");P(B,e=>{localStorage.setItem("artwork_grid_aspect_ratio_filter",e)});const A=S(localStorage.getItem("artwork_grid_filter_by_gallery")||"");P(A,e=>{localStorage.setItem("artwork_grid_filter_by_gallery",e)});const $=S(localStorage.getItem("artwork_grid_filter_by_platform")||"");P($,e=>{localStorage.setItem("artwork_grid_filter_by_platform",e)});const C=S(localStorage.getItem("artwork_grid_sort_order")||"name");P(C,e=>{localStorage.setItem("artwork_grid_sort_order",e)}),P(i,e=>{x.value=h});const E=250,g=10,{screen_type:I}=ge(),D=z(()=>{switch(I.value){case"xs":return 340-g*2;case"sm":return 650-g*2;case"md":return 960-g*2;case"lg":return 1200-g*2;case"xl":return 1700-g*2}return 0}),H=z(()=>{let e=Math.floor(D.value/(E+g));return e>5&&(e=5),(D.value-(e-1)*g)/e}),m=z(()=>M.sorted_all_token_metas.filter(e=>Boolean(e.entity.aspect_ratio))),u=z(()=>{let e=m.value.filter(t=>{var p,v,s;if(i.value&&!((p=t.entity.artist)!=null&&p.toLowerCase().includes(i.value.toLowerCase()))&&!((v=t.entity.name)!=null&&v.toLowerCase().includes(i.value.toLowerCase()))||A.value&&!((s=V.gallery_list.find(o=>o.id==A.value))!=null&&s.entity.token_meta_id_list.includes(t.id)))return!1;switch($.value){case"moda_archive":if(t.entity.platform!="archive")return!1;break;case"opensea":if(t.entity.platform!="opensea"&&t.entity.platform!="opensea_archive")return!1;break}switch(B.value){case"portrait":if(!t.entity.aspect_ratio||t.entity.aspect_ratio>.9)return!1;break;case"landscape":if(!t.entity.aspect_ratio||t.entity.aspect_ratio<1.1)return!1;break;case"square":if(!t.entity.aspect_ratio||t.entity.aspect_ratio<.9||t.entity.aspect_ratio>1.1)return!1;break}return!0});return C.value==="name"?e=e.sort((t,p)=>t.entity.name.localeCompare(p.entity.name)):C.value==="created_at"&&(e=e.sort((t,p)=>t.entity.created_at==null&&p.entity.created_at==null?0:t.entity.created_at==null?1:p.entity.created_at==null?-1:p.entity.created_at.seconds-t.entity.created_at.seconds)),e}),_=z(()=>{const e=u.value,t=0,p=t+x.value;return e.slice(t,p)});return X(()=>{const e=document.getElementById("masonry-container");if(!e){console.log("ArtworkTileGrid error, masonary_wall element not found");return}e.addEventListener("scroll",()=>{const t=e.scrollTop,p=e.scrollHeight,v=e.clientHeight;t/(p-v)*100>90&&x.value<u.value.length&&(x.value=x.value+20)})}),(e,t)=>{const p=L("el-input"),v=L("el-button"),s=L("el-option"),o=L("el-select"),l=L("el-popover"),k=L("RouterView");return f(),T(W,null,[b("div",Le,[n(p,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c),"prefix-icon":d(se),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),n(l,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:w(()=>[n(v,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:w(()=>[j("Filters")]),_:1})]),default:w(()=>[He,n(o,{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=c=>A.value=c),placeholder:"Filter by gallery",class:"filter-select"},{default:w(()=>[n(s,{label:"All artwork",value:""}),(f(!0),T(W,null,Q(d(V).gallery_list,c=>(f(),O(s,{key:c.id,label:`${c.entity.name}`,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Re,n(o,{modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=c=>B.value=c),class:"filter-select"},{default:w(()=>[n(s,{label:"All",value:""}),n(s,{label:"Landscape",value:"landscape"}),n(s,{label:"Portrait",value:"portrait"}),n(s,{label:"Square",value:"square"})]),_:1},8,["modelValue"]),ze,n(o,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=c=>$.value=c),class:"filter-select"},{default:w(()=>[n(s,{label:"All",value:""}),n(s,{label:"Moda Archive",value:"moda_archive"}),n(s,{label:"Opensea",value:"opensea"})]),_:1},8,["modelValue"]),Fe,n(o,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=c=>C.value=c),placeholder:"Sort by",class:"filter-select"},{default:w(()=>[n(s,{label:"Sort by name",value:"name"}),n(s,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),n(v,{icon:"Plus",type:"info",onClick:t[5]||(t[5]=c=>d(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:w(()=>[j("Artwork")]),_:1})]),Pe,b("div",{id:"masonry-container",ref_key:"masonryContainer",ref:y,style:{"overflow-y":"auto",height:"100%",padding:"10px"}},[d(_).length>0?(f(),O(d(Ce),{key:0,id:"masonary-wall","scroll-container":y.value,items:d(_),"column-width":E,gap:g,style:N(`width: ${d(D)}px; margin: auto`),"max-columns":5},{default:w(({item:c})=>[n(De,{token_meta:c,column_width:d(H)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(f(),T("div",Ue,"No artwork found"))],512),n(k)],64)}}});var et=Z(We,[["__scopeId","data-v-23b1ba20"]]);export{et as default};
