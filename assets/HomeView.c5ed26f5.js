import{_ as z,a as F,b as j,c as W}from"./search-icon.822e7617.js";import{_ as N,d as R,u as H,a as I,r as T,c as J,b as _,o as r,e as b,w as d,f as o,g as $,h as P,F as D,i as n,j as V,n as U,k as L,t as K,l as Q,p as X,m as Y,q as Z,E as M,s as ee,R as te}from"./index.bcba98de.js";import{u as B}from"./account.e9a53359.js";import{u as ae}from"./breakpoints.5a7a5e90.js";import{s as oe,a as G,o as ne}from"./firebaseConfig.d7a6b5a9.js";import{s as l}from"./util.a7bcf395.js";import{u as se}from"./plaque.562052b1.js";import{u as le}from"./token-meta.6525f8f4.js";import{u as re}from"./gallery.a2be0356.js";import{a as ie}from"./add-plaque.6de0d2c7.js";import"./types.d2ec9214.js";import"./plaque.28daac16.js";import"./token-meta.7f5c0ba8.js";import"./gallery.d53d87c7.js";const O=y=>(X("data-v-5c106a87"),y=y(),Y(),y),ce=O(()=>L("div",{style:{"flex-grow":"1"}},null,-1)),ue=O(()=>L("div",{style:{"flex-grow":"1"}},null,-1)),_e={key:0,style:{"margin-right":"10px",display:"flex","align-items":"center"}},de=R({__name:"Header",setup(y){const i=H(),k=I(),s=B(),c=T(!1),{md_and_up:p,screen_type:x}=ae(),m=(e,a)=>{e.paneName&&typeof e.paneName=="string"&&i.push({name:e.paneName})},q=J(()=>{const e=s.account;if(!e)return"";if(e.entity.ens_name)return e.entity.ens_name;if(e.entity.email)return e.entity.email;const a=e.entity.wallet_address;return a?`${a.substring(0,6)}...${a.substring(a.length-4)}`:""}),A=()=>{c.value=!0,oe(G).then(()=>{}).catch(e=>{l(e)}).finally(()=>{c.value=!1})},C=e=>new URL({"../assets/base.css":z,"../assets/logo.png":F,"../assets/logo.svg":j,"../assets/search-icon.svg":W}[`../assets/${e}`],self.location).href;return(e,a)=>{const g=_("el-image"),u=_("el-button"),f=_("el-tab-pane"),w=_("el-tabs"),v=_("el-header");return r(),b(v,{class:"header",style:Q(o(x)=="xs"?"padding: 0px 8px;":"")},{default:d(()=>[o(p)?(r(),b(g,{key:0,src:C("logo.png"),style:{width:"40px",height:"40px","margin-right":"2em"}},null,8,["src"])):$("",!0),o(i).currentRoute.value.name=="qr-scan"?(r(),P(D,{key:1},[ce,n(u,{icon:"close",color:"#000000",onClick:a[0]||(a[0]=h=>o(i).push("plaque-list"))},{default:d(()=>[V(" Cancel ")]),_:1})],64)):(r(),P(D,{key:2},[n(w,{modelValue:o(k).name,"onUpdate:modelValue":a[1]||(a[1]=h=>o(k).name=h),onTabClick:m,class:U(o(p)?"":"small-tabs")},{default:d(()=>[n(f,{label:"Plaques",name:"plaque-list"}),n(f,{label:"Artwork",name:"artwork-tile-grid"}),n(f,{label:"Galleries",name:"gallery-list"}),n(f,{label:"Account",name:"account-settings"})]),_:1},8,["modelValue","class"]),ue,o(p)?(r(),P("div",_e,[L("div",null,K(o(q)),1),o(s).is_user_admin?(r(),b(u,{key:0,type:"info",round:"",size:"small",style:{"margin-left":"8px"}},{default:d(()=>[V("Admin")]),_:1})):$("",!0)])):$("",!0),n(u,{onClick:A,style:{"margin-left":"1em"},loading:c.value},{default:d(()=>[V("Logout")]),_:1},8,["loading"])],64))]),_:1},8,["style"])}}});var pe=N(de,[["__scopeId","data-v-5c106a87"]]);const me=R({__name:"HomeView",setup(y){const i=B(),k=se(),s=le(),c=re(),p=H(),x=T(!1),m=T(),q=I();let A;Z(async()=>{m.value=M.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),A=ne(G,async e=>{if(console.log("onAuthStateChanged",e),e){m.value=M.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await C(e.uid)}finally{m.value.close()}}e||(i.setAccount(null),m.value.close(),p.push({name:"login",query:{redir:window.location.href}}))})}),ee(()=>{console.log("unsubscribe onAuthStateChanged on unmount"),A()});async function C(e){console.log("LOAD APP DATA"),await i.loadAccount(e),await c.loadGalleryList(e).catch(t=>l(`Error loading galleries - ${t}`));const a=k.loadPlaques(e).catch(t=>l(`Error loading plaques - ${t}`)),g=k.loadGalleryPlaques(c.gallery_list).catch(t=>l(`Error loading gallery plaques - ${t}`)),u=s.loadArchiveTokenMetas(e).catch(t=>l(`Error loading archive token metas - ${t}`)),f=s.loadGalleryTokenMetas(c.gallery_list).catch(t=>l(`Error loading token metas - ${t}`)),w=[a,g,u,g,f],v=i.get_account.entity.wallet_address;if(v){const t=s.loadOpenseaMintedTokenMetas(v).catch(E=>l(`Error loading opensea minted tokens - ${E}`)),S=s.loadOpenseaWalletTokenMetas(v).catch(E=>l(`Error loading opensea wallet tokens - ${E}`));w.push(t),w.push(S)}await Promise.all(w),await s.loadOpenseaConvertedTokens();const h=q.query.plaque_id;if(h&&typeof h=="string"){await ie(e,h);const t=new URLSearchParams(window.location.search);t.delete("plaque_id");const S=`${window.location.origin}${window.location.pathname}${window.location.hash}?${t.toString()}`;p.replace(S)}x.value=!0}return(e,a)=>{const g=_("el-main"),u=_("el-container");return r(),b(u,{style:{height:"100%",position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px"}},{default:d(()=>[n(pe),n(g,{style:{"background-color":"#DAD9D7"},class:U(o(q).fullPath.includes("artwork-tile-grid")?"remove-padding":"")},{default:d(()=>[x.value?(r(),b(o(te),{key:0})):$("",!0)]),_:1},8,["class"])]),_:1})}}});var Ee=N(me,[["__scopeId","data-v-5679c016"]]);export{Ee as default};
