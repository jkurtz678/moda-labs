import{p as h}from"./index.db76b1c1.js";import{B as f,g as c,u as w,a as y,b as E,T as v}from"./account.46d5f1ac.js";import{L as T,e as g,f as M,I as l,M as m,$ as A,c as O,j as b,d,p as I}from"./util.25968482.js";const u=T(M),i=g(u,"token-meta"),q=async e=>{const t=await I(i,{...f.createBaseEntity(),...e}),a=await d(t);return{id:t.id,entity:a.data()}},D=async(e,t)=>{const a=O(u,"token-meta",e);await b(a,t);const s=await d(a);return{id:s.id,entity:s.data()}},L=async e=>{await l(m(i),t=>{const a=[];t.forEach(s=>{a.push({id:s.id,entity:s.data()})}),e(a)})},j=async(e,t)=>{const a=m(i,A("user_id","==",e));await l(a,s=>{const n=[];s.forEach(o=>{n.push({id:o.id,entity:o.data()})}),t(n)})},k="742ea11e1d864fe2b23ac7cfe66a43f7";async function x(e){const t=await fetch(`https://api.opensea.io/api/v1/assets/?owner=${e}`,{headers:{"X-API-KEY":k}}),a=await t.json();return p(t,a),a.assets}const B=async e=>{const t=[];let a="";for(;;){const s=await fetch(`https://api.opensea.io/api/v1/events?account_address=${e}&event_type=created&limit=50${a?"&cursor="+a:""}`,{headers:{"X-API-KEY":k}}),n=await s.json();if(p(s,n),n.asset_events&&t.push(...n.asset_events.map(o=>({...o.asset,creator:o.from_account}))),a=n.next,!a)break}return t},p=(e,t)=>{if(e.status>=400)throw t.detail?t.detail:e.status==429?"Error - opensea rejected request due to rate limiting":"Error loading opensea tokens"},N=h({id:"token-meta",state:()=>({archive_token_meta_list:[],opensea_minted_token_meta_list:[],opensea_wallet_token_meta_list:[]}),getters:{archive_token_meta_map:e=>{const t={};return e.archive_token_meta_list.forEach(a=>{t[a.id]=a}),t},all_token_metas(e){const t={};return[...e.opensea_minted_token_meta_list,...e.opensea_wallet_token_meta_list].forEach(s=>{const n=C(s);t[n.id]=n}),e.archive_token_meta_list.forEach(s=>{t[c(s)]&&delete t[c(s)],t[s.id]=s}),t},sorted_all_token_metas(e){return JSON.parse(JSON.stringify(Object.values(this.all_token_metas))).sort((a,s)=>{var r,_;const n=((r=a.entity.artist)==null?void 0:r.toLowerCase())+a.entity.name.toLowerCase(),o=((_=s.entity.artist)==null?void 0:_.toLowerCase())+s.entity.name.toLowerCase();return n<o?-1:n>o?1:0})}},actions:{async loadArchiveTokenMetas(e){if(w().is_user_id_admin){await L(a=>{this.archive_token_meta_list=a.filter(s=>s.entity.external_media_url||s.entity.media_id)});return}await j(e,a=>{this.archive_token_meta_list=a})},async loadOpenseaMintedTokenMetas(e){await B(e).then(t=>{this.opensea_minted_token_meta_list=t})},async loadOpenseaWalletTokenMetas(e){await x(e).then(t=>{this.opensea_wallet_token_meta_list=t})}}}),C=e=>{var t,a;return{id:y(e),entity:{name:e.name,artist:((a=(t=e.creator)==null?void 0:t.user)==null?void 0:a.username)||"N/A",description:e.description,public_link:e.permalink,blockchain:E.Ethereum,asset_contract_address:e.asset_contract.address,token_id:e.token_id,platform:v.Opensea,external_thumbnail_url:e.image_thumbnail_url,external_media_url:e.animation_url?e.animation_url:e.image_url}}};export{D as a,q as c,N as u};
