import{_ as R,d as j,r as w,c as N,z as Q,b as p,o as _,h,i as e,w as a,k as l,t as A,j as f,f as k,A as de,p as W,l as X,x as T,u as re,e as I,B as se,C as ye,D as ve,g as E,G as ge,H as ke,F as B,I as H,J as ie,K as qe}from"./index.3b1c7f72.js";import{u as U,c as he}from"./plaque.093acf64.js";import{c as we}from"./token-meta.2d60a689.js";import{u as F}from"./plaque.53e52346.js";import{u as _e,g as xe}from"./account.49c55d49.js";import{s as O}from"./util.aa5f0f61.js";import{T as ue}from"./types.6a5ef88e.js";import{u as ce}from"./breakpoints.d033af7c.js";import{u as pe}from"./token-meta.cb613830.js";import{_ as Ce}from"./TokenSelectList.5b90815f.js";import{n as K}from"./firebaseConfig.d7a6b5a9.js";import{_ as $e}from"./PlaqueTokenItem.515033b7.js";import{u as be}from"./gallery.16b35fa2.js";import"./thumbnail-image.bab52032.js";import"./gallery.82c2a091.js";const Ae=u=>(W("data-v-cc2989e6"),u=u(),X(),u),Pe={class:"dialog-container"},Se={class:"dialog-footer"},Ve=Ae(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Ne=j({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(u,{emit:n}){const P=u,r=w([]),g=w(!1),{screen_type:x}=ce(),$=F(),C=pe(),b=_e(),y=N({get(){return P.show_add_token_dialog},set(i){n("update:show_add_token_dialog",i)}});Q(y,i=>{i&&(r.value=JSON.parse(JSON.stringify(c.value.entity.token_meta_id_list)))});const c=N(()=>$.plaque_map[P.plaque_id]),q=N(()=>C.sorted_all_token_metas),S=async()=>{g.value=!0;try{for(let[i,o]of r.value.entries()){const s=C.all_token_metas[o];if(!s)throw"Failed to find store token for token: "+o;if(s.entity.platform!=ue.Opensea)continue;const t=JSON.parse(JSON.stringify(s));t.entity.user_id=b.get_account.id,t.entity.platform=ue.OpenseaArchive;const d=await we(t.entity);r.value[i]=d.id}await U(P.plaque_id,{token_meta_id_list:r.value}),$.plaque_map[P.plaque_id].entity.token_meta_id_list=r.value}catch(i){O(`Error updating plaque tokens - ${i}`)}g.value=!1,y.value=!1},D=()=>{r.value=[]};return(i,o)=>{const s=p("el-button"),t=p("el-dialog");return _(),h("div",Pe,[e(t,{center:"",modelValue:k(y),"onUpdate:modelValue":o[1]||(o[1]=d=>de(y)?y.value=d:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:k(x)=="xs",top:"2vh"},{footer:a(()=>[l("div",Se,[l("div",null,A(`Artwork in playlist: ${r.value.length}`),1),Ve,e(s,{onClick:D},{default:a(()=>[f("Clear")]),_:1}),e(s,{type:"info",onClick:S,loading:g.value},{default:a(()=>[f("Save")]),_:1},8,["loading"])])]),default:a(()=>[e(Ce,{selected_token_meta_id_list:r.value,"onUpdate:selected_token_meta_id_list":o[0]||(o[0]=d=>r.value=d),token_meta_list:k(q)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var ze=R(Ne,[["__scopeId","data-v-cc2989e6"]]);const Ie={class:"controller-buttons"},Te=j({__name:"PlaqueController",props:{plaque:null},setup(u){const n=u,P=F(),r=w(!1),g=w(!1),x=w(!1),$=w(!1),C=N({get:()=>n.plaque.entity.orientation||"landscape",set:y=>{U(n.plaque.id,{orientation:y}).then(()=>{P.plaque_map[n.plaque.id].entity.orientation=y,T({type:"success",message:"Plaque orientation updated"})}).catch(c=>{O(`Error updating plaque orientation - ${c}`)})}}),b=y=>{const c={type:y,time_sent:K.now()};U(n.plaque.id,{command:c}).then(()=>{P.plaque_map[n.plaque.id].entity.command=c,T({type:"success",message:"Command sent to plaque"})}).catch(q=>{O(`Error sending command to plaque - ${q}`)}).finally(()=>{r.value=!1,g.value=!1,x.value=!1,$.value=!1})};return(y,c)=>{const q=p("el-button"),S=p("el-radio"),D=p("el-radio-group");return _(),h("div",null,[l("div",Ie,[e(q,{circle:"",text:"",loading:r.value,icon:"DArrowLeft",onClick:c[0]||(c[0]=i=>{r.value=!0,b("playlist_previous")})},null,8,["loading"]),e(q,{circle:"",text:"",loading:g.value,icon:"VideoPlay",onClick:c[1]||(c[1]=i=>{g.value=!0,b("play")})},null,8,["loading"]),e(q,{circle:"",text:"",icon:"VideoPause",loading:x.value,onClick:c[2]||(c[2]=i=>{x.value=!0,b("pause")})},null,8,["loading"]),e(q,{circle:"",text:"",icon:"DArrowRight",loading:$.value,onClick:c[3]||(c[3]=i=>{$.value=!0,b("playlist_next")})},null,8,["loading"])]),e(D,{modelValue:k(C),"onUpdate:modelValue":c[4]||(c[4]=i=>de(C)?C.value=i:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:a(()=>[e(S,{label:"landscape",size:"small"},{default:a(()=>[f("Landscape")]),_:1}),e(S,{label:"portrait",size:"small"},{default:a(()=>[f("Portrait")]),_:1}),e(S,{label:"landscape_reversed",size:"small"},{default:a(()=>[f("Landscape Reversed")]),_:1}),e(S,{label:"portrait_reversed",size:"small"},{default:a(()=>[f("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var De=R(Te,[["__scopeId","data-v-100e65c8"]]);const z=u=>(W("data-v-657cf7b2"),u=u(),X(),u),Le={style:{display:"flex","align-items":"center",padding:"1em"}},Ee={key:0},Ue=z(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Be={class:"card-simple"},Oe=z(()=>l("hr",null,null,-1)),Re=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),je=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Fe={style:{padding:"0.3em 1em"}},Je={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Me={key:0,class:"card-detail"},Ge={style:{padding:"0 1em"}},He={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},Ke=z(()=>l("hr",null,null,-1)),Qe=z(()=>l("div",{style:{padding:"1em"}},"No artwork added",-1)),We=z(()=>l("hr",null,null,-1)),Xe={style:{display:"flex",padding:"1em"}},Ye=z(()=>l("div",{style:{"flex-grow":"1"}},null,-1)),Ze={key:0,style:{padding:"1em"}},et={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},tt={key:0},lt=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),at={key:0},nt={key:1},ot={style:{"font-size":"var(--el-font-size-extra-small)"}},st={key:1},it=z(()=>l("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),ut={style:{display:"flex","justify-content":"end"}},dt=j({__name:"PlaqueCard",props:{plaque:null},setup(u){const n=u,P=F();re();const r=w("simple"),g=w(!1),x=w(!1),$=w(""),C=w(!1),b=async()=>{C.value=!0,await U(n.plaque.id,{name:n.plaque.entity.name}).catch(s=>{O(`Error updating plaque tokens - ${s}`)}),x.value=!1,C.value=!1},y=pe(),c=N(()=>q.value.length==0?null:q.value[0]),q=N(()=>{const s=y.archive_token_meta_map;return n.plaque.entity.token_meta_id_list.map(d=>s[d])}),S=N(()=>{const s=new Date,t=n.plaque.entity.last_check_in_time.toDate();return(s.getTime()-t.getTime())/(1e3*60*60)<2}),D=()=>{ie.confirm(`Are you sure you want to clear tokens for plaque '${n.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{U(n.plaque.id,{token_meta_id_list:[]}).then(()=>{P.plaque_map[n.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Tokens cleared"})}).catch(s=>{T({message:`Error clearing tokens from plaque - ${s}`,type:"error",showClose:!0,duration:12e3})})})},i=()=>{ie.confirm(`Are you sure you want to forget the plaque named '${n.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{U(n.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{P.plaque_map[n.plaque.id].entity.user_id="",P.plaque_map[n.plaque.id].entity.token_meta_id_list=[],T({type:"success",message:"Plaque forgotten"})}).catch(s=>{T({message:`Error forgetting plaque - ${s}`,type:"error",showClose:!0,duration:12e3})})})};Q(r,s=>{s=="settings"&&n.plaque.entity.user_id&&!$.value&&xe(n.plaque.entity.user_id).then(t=>{$.value=t.entity.email}).catch(t=>{T({message:`Error loading user account - ${t}`,type:"error",showClose:!0,duration:12e3})})});const o=N(()=>{var d,V,L;const s=(L=(V=(d=n==null?void 0:n.plaque)==null?void 0:d.entity)==null?void 0:V.machine_data)==null?void 0:L.updated_at;return s?new Date(s.seconds*1e3+s.nanoseconds/1e6).toLocaleString():"N/A"});return(s,t)=>{const d=p("el-button"),V=p("el-tag"),L=p("el-col"),J=p("el-row"),M=p("ArrowRight"),v=p("el-icon"),G=p("el-collapse-transition"),Y=p("Close"),fe=p("el-card");return _(),I(fe,null,{default:a(()=>[l("div",Le,[x.value?se((_(),h("input",{key:1,"onUpdate:modelValue":t[0]||(t[0]=m=>n.plaque.entity.name=m),class:"edit-name-input"},null,512)),[[ye,n.plaque.entity.name]]):(_(),h("h1",Ee,A(n.plaque.entity.name),1)),x.value?E("",!0):(_(),I(d,{key:2,icon:k(ve),onClick:t[1]||(t[1]=m=>x.value=!0),class:"editIcon",circle:""},null,8,["icon"])),x.value?(_(),I(d,{key:3,icon:k(ge),loading:C.value,onClick:b,class:"editIcon",circle:"",type:C.value?"":"success",text:""},null,8,["icon","loading","type"])):E("",!0),Ue,k(S)?(_(),I(V,{key:4,class:"ml-2",type:"success"},{default:a(()=>[f("online")]),_:1})):(_(),I(V,{key:5,class:"ml-2",type:"danger"},{default:a(()=>[f("offline")]),_:1}))]),e(G,null,{default:a(()=>[se(l("section",Be,[Oe,e(J,{style:{padding:"1em"}},{default:a(()=>[e(L,{span:12},{default:a(()=>{var m;return[Re,l("span",null,A(((m=k(c))==null?void 0:m.entity.name)||"N/A"),1)]}),_:1}),e(L,{span:12},{default:a(()=>{var m;return[je,f(" "+A(((m=k(c))==null?void 0:m.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),l("div",Fe,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),l("div",Je,[e(d,{type:"info",onClick:t[2]||(t[2]=m=>g.value=!0)},{default:a(()=>[f("Add Artwork")]),_:1}),e(d,{onClick:t[3]||(t[3]=m=>r.value="detail")},{default:a(()=>[f(" Details"),e(v,{class:"el-icon--right"},{default:a(()=>[e(M)]),_:1})]),_:1})])],512),[[ke,r.value=="simple"]])]),_:1}),e(G,null,{default:a(()=>[r.value=="detail"?(_(),h("section",Me,[l("p",Ge,A(`Total artworks: ${u.plaque.entity.token_meta_id_list.length}`),1),l("div",He,[e(d,{onClick:t[4]||(t[4]=m=>r.value="settings")},{default:a(()=>[f("Settings")]),_:1}),e(d,{onClick:D},{default:a(()=>[f("Clear Artwork")]),_:1})]),Ke,k(q).length==0?(_(),h(B,{key:0},[Qe,We],64)):E("",!0),(_(!0),h(B,null,H(k(q),m=>(_(),I($e,{token_meta:m},null,8,["token_meta"]))),256)),l("div",Xe,[e(d,{type:"info",onClick:t[5]||(t[5]=m=>g.value=!0)},{default:a(()=>[f("Add Artwork")]),_:1}),Ye,e(d,{onClick:t[6]||(t[6]=m=>r.value="simple")},{default:a(()=>[f("Close"),e(v,{class:"el-icon--right"},{default:a(()=>[e(Y)]),_:1})]),_:1})])])):E("",!0)]),_:1}),e(G,null,{default:a(()=>{var m,Z,ee,te,le,ae,ne,oe;return[r.value=="settings"?(_(),h("section",Ze,[e(De,{plaque:n.plaque},null,8,["plaque"]),l("div",et,[u.plaque.entity.user_id?(_(),h("div",tt,[lt,$.value?(_(),h("div",at,A($.value),1)):(_(),h("div",nt,"Loading...")),l("div",ot,A(u.plaque.entity.user_id),1)])):(_(),h("div",st,"No associated user")),u.plaque.entity.user_id?(_(),I(d,{key:2,type:"danger",plain:"",onClick:i},{default:a(()=>[f("Forget Display")]),_:1})):E("",!0)]),l("div",null,[it,l("div",null,"Machine name: "+A((Z=(m=u.plaque.entity.machine_data)==null?void 0:m.machine_name)!=null?Z:"N/A"),1),l("div",null,"Version: "+A((te=(ee=u.plaque.entity.machine_data)==null?void 0:ee.version)!=null?te:"N/A"),1),l("div",null,"Local IP: "+A((ae=(le=u.plaque.entity.machine_data)==null?void 0:le.local_ip)!=null?ae:"N/A"),1),l("div",null,"Public IP: "+A((oe=(ne=u.plaque.entity.machine_data)==null?void 0:ne.public_ip)!=null?oe:"N/A"),1),l("div",null,"Updated At: "+A(k(o)),1)]),l("div",ut,[e(d,{onClick:t[7]||(t[7]=gt=>r.value="detail")},{default:a(()=>[f("Close"),e(v,{class:"el-icon--right"},{default:a(()=>[e(Y)]),_:1})]),_:1})])])):E("",!0)]}),_:1}),e(ze,{plaque_id:n.plaque.id,show_add_token_dialog:g.value,"onUpdate:show_add_token_dialog":t[8]||(t[8]=m=>g.value=m)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var rt=R(dt,[["__scopeId","data-v-657cf7b2"]]);const me=u=>(W("data-v-0ea15fab"),u=u(),X(),u),_t={class:"subheader",style:{display:"flex","align-items":"center"}},ct=me(()=>l("div",{style:{"padding-bottom":"40px"}},null,-1)),pt={class:"add-button-container"},mt={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},ft=me(()=>l("div",{style:{"font-size":"17px"}},"Add plaque",-1)),yt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},vt=j({__name:"PlaqueList",setup(u){const n=w(!1),{width:P,screen_type:r}=ce(),g=w(!1),x=re(),$=_e(),C=be(),b=w(""),y=w(localStorage.getItem("filter_by_gallery")||"");Q(y,i=>{localStorage.setItem("filter_by_gallery",i)});const c=F(),q=async()=>{n.value=!0,await he({name:"Test Plaque",user_id:$.get_account.id,token_meta_id_list:[],created_at:K.now(),updated_at:K.now()}).catch(i=>T({message:`Error creating test plaque- ${i}`,type:"error",showClose:!0,duration:12e3})),n.value=!1,g.value=!1},S=N(()=>JSON.parse(JSON.stringify(c.all_plaque_list)).sort((o,s)=>{const t=o.entity.name.toLowerCase(),d=s.entity.name.toLowerCase();return t<d?-1:t>d?1:0})),D=N(()=>{let i=[...S.value];return i=i.filter(o=>o.entity.name||o.entity.user_id||o.entity.token_meta_id_list.length>0),y.value&&(i=i.filter(o=>{var s;return(s=C.gallery_list.find(t=>t.id==y.value))==null?void 0:s.entity.plaque_id_list.includes(o.id)})),b?i.filter(o=>o.entity.name.toLowerCase().includes(b.value.toLowerCase())):i});return(i,o)=>{const s=p("el-input"),t=p("el-option"),d=p("el-select"),V=p("el-button"),L=p("Plus"),J=p("el-icon"),M=p("el-dialog");return _(),h(B,null,[l("div",_t,[e(s,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=v=>b.value=v),"prefix-icon":k(qe),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),e(d,{modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=v=>y.value=v),placeholder:"Filter by gallery",style:{"margin-left":"10px",width:"260px"}},{default:a(()=>[e(t,{label:"All plaques",value:""}),(_(!0),h(B,null,H(k(C).gallery_list,v=>(_(),I(t,{key:v.id,label:`Filter by gallery - ${v.entity.name}`,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(V,{icon:"Camera",type:"info",onClick:o[2]||(o[2]=v=>k(x).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:a(()=>[f("Scan")]),_:1})]),ct,(_(!0),h(B,null,H(k(D),v=>(_(),I(rt,{plaque:v,key:v.id},null,8,["plaque"]))),128)),l("div",pt,[l("div",mt,[l("div",{class:"add-button",onClick:o[3]||(o[3]=v=>g.value=!0)},[e(J,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:a(()=>[e(L)]),_:1}),ft])])]),e(M,{modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=v=>g.value=v),title:"Add plaque",width:k(r)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:a(()=>[l("div",yt,[e(V,{onClick:o[4]||(o[4]=v=>{k(x).push("qr-scan"),g.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:a(()=>[f("Scan Plaque QR Code")]),_:1}),e(V,{icon:"plus",onClick:q,loading:n.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:a(()=>[f("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var Tt=R(vt,[["__scopeId","data-v-0ea15fab"]]);export{Tt as default};
