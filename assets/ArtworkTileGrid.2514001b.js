import{d as O,P as te,Q as ne,r as M,o as m,h,F,I as j,M as G,f as i,S as oe,j as N,t as D,T as le,U as ae,m as K,z as Y,_ as X,u as Z,L as se,c as I,b as P,k as w,n as U,i as f,w as A,V as z,e as q,g as Q,J as re,x as J,K as ie,p as ce,l as ue}from"./index.17c7e32d.js";import{a as me}from"./thumbnail-image.7eede646.js";import{c as de,d as _e}from"./types.d2ec9214.js";import{s as pe}from"./util.6acdfab2.js";import{u as fe}from"./account.4b0089a8.js";import{f as ve}from"./token-meta.7f5c0ba8.js";import{u as ee}from"./gallery.66363ddd.js";import{u as ke}from"./token-meta.f22600ac.js";import{u as he}from"./breakpoints.105333d1.js";import{A as ye}from"./ArtworkFilters.6b092d8b.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.d53d87c7.js";const ge={columnWidth:400,gap:0,keyMapper:(o,l,T,y)=>y,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:o,columnWidth:l,emit:T,gap:y,items:s,maxColumns:c,minColumns:d,nextTick:v,onBeforeUnmount:B,onMounted:p,rtl:$,scrollContainer:x,ssrColumns:E,vue:S,wall:C,watch:a}){function u(n,e,k,L){const W=g(k);return L+e+W<=n?u(n,e,k+1,L+e+W):k}function g(n){const e=Array.isArray(l.value)?l.value:[l.value];return e[n%e.length]}function t(){const n=u(C.value.getBoundingClientRect().width,y.value,0,-y.value),e=r(_(n));return e>0?e:1}function _(n){const e=c==null?void 0:c.value;return e&&n>e?e:n}function r(n){const e=d==null?void 0:d.value;return e&&n<e?e:n}function b(n){return[...new Array(n)].map(()=>[])}if(E.value>0){const n=b(E.value);s.value.forEach((e,k)=>n[k%E.value].push(k)),o.value=n}async function R(n){if(n>=s.value.length)return;await v();const e=[...C.value.children];$.value&&e.reverse();const k=e.reduce((L,W)=>W.getBoundingClientRect().height<L.getBoundingClientRect().height?W:L);o.value[+k.dataset.index].push(n),await R(n+1)}async function H(n=!1){if(o.value.length===t()&&!n){T(S===2?"redraw-skip":"redrawSkip");return}o.value=b(t());const e=x==null?void 0:x.value,k=e?e.scrollTop:window.scrollY;await R(0),e?e.scrollBy({top:k-e.scrollTop}):window.scrollTo({top:k}),T("redraw")}const V=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>H());return p(()=>{H(),V==null||V.observe(C.value)}),B(()=>V==null?void 0:V.unobserve(C.value)),a([s,$],()=>H(!0)),a([l,y,d,c],()=>H()),{getColumnWidthTarget:g}}const xe=["data-index"],Ce=O({__name:"masonry-wall",props:te({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ge),emits:["redraw","redrawSkip"],setup(o,{emit:l}){const T=o,{columnWidth:y,items:s,gap:c,rtl:d,ssrColumns:v,scrollContainer:B,minColumns:p,maxColumns:$,keyMapper:x}=ne(T),E=M([]),S=M(),{getColumnWidthTarget:C}=we({columns:E,columnWidth:y,emit:l,gap:c,items:s,keyMapper:x,maxColumns:$,minColumns:p,nextTick:le,onBeforeUnmount:ae,onMounted:K,rtl:d,scrollContainer:B,ssrColumns:v,vue:3,wall:S,watch:Y});return(a,u)=>(m(),h("div",{ref_key:"wall",ref:S,class:"masonry-wall",style:G({display:"flex",gap:`${i(c)}px`})},[(m(!0),h(F,null,j(E.value,(g,t)=>(m(),h("div",{key:t,class:"masonry-column","data-index":t,style:G({display:"flex","flex-basis":`${i(C)(t)}px`,"flex-direction":"column","flex-grow":1,gap:`${i(c)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(m(!0),h(F,null,j(g,(_,r)=>(m(),h("div",{key:i(x)(i(s)[_],t,r,_),class:"masonry-item"},[oe(a.$slots,"default",{item:i(s)[_],column:t,row:r,index:_},()=>[N(D(i(s)[_]),1)])]))),128))],12,xe))),128))],4))}}),be=(()=>{const o=Ce;return o.install=l=>{l.component("MasonryWall",o)},o})();const Te=["src"],Ee={class:"header"},Me={class:"platform"},Ae={style:{"font-size":"1.6em","font-weight":"bold"}},Be={key:0},$e={key:1,style:{"font-weight":"bold"}},Se={key:3,style:{height:"32px"}},De={style:{"font-size":"0.9em","line-height":"1.3em"}},Re={style:{margin:"10px 0px"}},He=O({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(o){const l=o,T=Z(),y=me(se(l,"token_meta")),s=M(!1),c=M(0),d=M(),v=M(),B=fe(),p=ee(),$=I(()=>de(l.token_meta.entity.platform)),x=async()=>{const t=await _e(l.token_meta);if(!t){pe("Error getting source file");return}window.open(t,"_blank")},E=I(()=>l.token_meta.entity.aspect_ratio?l.column_width/l.token_meta.entity.aspect_ratio:l.column_width),S=()=>{const t=T.resolve({name:"preview-plaque",params:{token_meta_id:l.token_meta.id}});window.open(t.href)},C=()=>{window.open(l.token_meta.entity.public_link,"_blank")},a=()=>{window.open(l.token_meta.entity.artist_social_link,"_blank")};function u(){if(!d.value){console.log("animateDivHeight - error finding tile container");return}if(!s.value&&c.value==0&&(c.value=d.value.offsetHeight),s.value=!s.value,!v.value){console.log("animateDivHeight - error finding detail container");return}let t;s.value&&v.value.offsetHeight>c.value?t=v.value.offsetHeight:t=c.value;const _=300,r=10,b=d.value.offsetHeight,R=Math.ceil(t-b),H=Math.ceil(_/r),V=R/H;let n=0;const e=setInterval(()=>{if(n>=H){d.value.style.height=t+"px",clearInterval(e);return}n++;const k=b+V*n;d.value.style.height=k+"px"},r)}const g=()=>{re.prompt(`Are you sure you want to delete ${l.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:t})=>{if(t)return ve(l.token_meta.id)}).then(()=>{J({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(t=>{J({message:`Error deleting artwork - ${t}`,type:"error",showClose:!0,duration:12e3})})};return(t,_)=>{const r=P("el-button"),b=P("el-tooltip");return m(),h("div",{ref_key:"tile_container",ref:d,class:"custom-card",onClick:u,style:G(`height: ${i(E)}px !important`)},[w("img",{class:U(s.value?"absolute":""),src:i(y)},null,10,Te),w("div",{class:U([s.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),w("div",{class:U(["transition absolute",s.value?"hide-blur":"show-blur"])},[w("div",Ee,D(`${o.token_meta.entity.name} | ${o.token_meta.entity.artist}`),1),w("div",Me,D(i($)),1)],2),w("div",{ref_key:"detail_container",ref:v,class:U(["detail-container transition",s.value?"show-blur":"hide-blur"])},[w("div",Ae,D(o.token_meta.entity.name),1),o.token_meta.entity.artist_social_link?(m(),h("div",Be,[f(r,{link:"",style:{"font-weight":"bold",display:"block"},disabled:!s.value,onClick:z(a,["stop"])},{default:A(()=>[N(D(o.token_meta.entity.artist),1)]),_:1},8,["disabled","onClick"])])):(m(),h("div",$e,D(o.token_meta.entity.artist),1)),s.value?(m(),h(F,{key:2},[f(b,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:A(()=>[f(r,{icon:"Edit",text:"",circle:"",onClick:_[0]||(_[0]=z(R=>i(T).push({name:"edit-artwork",params:{token_meta_id:l.token_meta.id}}),["stop"]))})]),_:1}),f(b,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:A(()=>[f(r,{icon:"Download",text:"",circle:"",onClick:z(x,["stop"])},null,8,["onClick"])]),_:1}),f(b,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:A(()=>[f(r,{icon:"Tickets",text:"",circle:"",onClick:z(S,["stop"])},null,8,["onClick"])]),_:1}),o.token_meta.entity.public_link?(m(),q(b,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:A(()=>[f(r,{icon:"Link",text:"",circle:"",onClick:z(C,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0),i(B).is_user_admin?(m(),q(b,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:A(()=>[f(r,{icon:"Delete",text:"",circle:"",onClick:z(g,["stop"])},null,8,["onClick"])]),_:1})):Q("",!0)],64)):(m(),h("div",Se)),w("div",De,D(o.token_meta.entity.description),1),w("div",Re,[(m(!0),h(F,null,j(i(p).token_id_to_gallery_map.get(l.token_meta.id),R=>(m(),q(r,{size:"small",round:"",plain:"",type:"primary",style:{margin:"3px 10px 3px 0px"}},{default:A(()=>[N(D(R.entity.name),1)]),_:2},1024))),256))])],2)],4)}}});var Ve=X(He,[["__scopeId","data-v-17591e03"]]);const ze=o=>(ce("data-v-3bd90dea"),o=o(),ue(),o),Ie={class:"subheader",style:{display:"flex","align-items":"center"}},Le=ze(()=>w("div",{style:{"padding-bottom":"40px"}},null,-1)),We={key:1,style:{padding:"1em"}},Pe=O({__name:"ArtworkTileGrid",setup(o){const l=Z(),T=ke();ee();const y=M(null),s=30,c=M(s),d=M([]),v=M("");Y(v,a=>{c.value=s});const B=250,p=10,{screen_type:$}=he(),x=I(()=>{switch($.value){case"xs":return 340-p*2;case"sm":return 650-p*2;case"md":return 960-p*2;case"lg":return 1200-p*2;case"xl":return 1700-p*2}return 0}),E=I(()=>{let a=Math.floor(x.value/(B+p));return a>5&&(a=5),(x.value-(a-1)*p)/a}),S=I(()=>T.sorted_all_token_metas.filter(a=>Boolean(a.entity.aspect_ratio))),C=I(()=>{const a=d.value,u=0,g=u+c.value;return a.slice(u,g)});return K(()=>{const a=document.getElementById("masonry-container");if(!a){console.log("ArtworkTileGrid error, masonary_wall element not found");return}a.addEventListener("scroll",()=>{const u=a.scrollTop,g=a.scrollHeight,t=a.clientHeight;u/(g-t)*100>90&&c.value<d.value.length&&(c.value=c.value+20)})}),(a,u)=>{const g=P("el-input"),t=P("el-button"),_=P("RouterView");return m(),h(F,null,[w("div",Ie,[f(g,{modelValue:v.value,"onUpdate:modelValue":u[0]||(u[0]=r=>v.value=r),"prefix-icon":i(ie),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),f(ye,{all_tokens:i(S),search_filter:v.value,onUpdateFilteredTokens:u[1]||(u[1]=r=>d.value=r)},null,8,["all_tokens","search_filter"]),f(t,{icon:"Plus",type:"info",onClick:u[2]||(u[2]=r=>i(l).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:A(()=>[N("Artwork")]),_:1})]),Le,w("div",{id:"masonry-container",ref_key:"masonryContainer",ref:y,style:{"overflow-y":"auto",height:"100%",padding:"10px 10px 90px 10px"}},[i(C).length>0?(m(),q(i(be),{key:0,id:"masonary-wall","scroll-container":y.value,items:i(C),"column-width":B,gap:p,style:G(`width: ${i(x)}px; margin: auto`),"max-columns":5},{default:A(({item:r})=>[f(Ve,{token_meta:r,column_width:i(E)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(m(),h("div",We,"No artwork found"))],512),f(_)],64)}}});var Ze=X(Pe,[["__scopeId","data-v-3bd90dea"]]);export{Ze as default};
