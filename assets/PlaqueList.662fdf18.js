import{_ as j,d as F,r as h,c as z,y as Q,b as _,o as r,h as q,i as t,w as n,k as a,t as P,j as m,f as y,z as ie,p as K,l as W,v as N,u as ue,e as T,A as ne,B as me,C as ve,g as L,D as fe,G as ye,F as O,H as G,I as oe,J as ge}from"./index.c1e3ace8.js";import{u as E,c as ke}from"./plaque.093acf64.js";import{c as qe}from"./token-meta.2d60a689.js";import{u as J}from"./plaque.bb97c243.js";import{u as de,g as he}from"./account.d7c506f9.js";import{s as R}from"./util.9ec4e6a2.js";import{T as se}from"./types.6a5ef88e.js";import{u as re}from"./breakpoints.838a3f82.js";import{u as _e}from"./token-meta.14f19639.js";import{_ as we}from"./TokenSelectList.bf24eecf.js";import{n as H}from"./firebaseConfig.d7a6b5a9.js";import{_ as xe}from"./PlaqueTokenItem.baad7586.js";import{u as Ce}from"./gallery.ce30aa32.js";import"./thumbnail-image.1c78c1b7.js";import"./gallery.82c2a091.js";const $e=s=>(K("data-v-cc2989e6"),s=s(),W(),s),be={class:"dialog-container"},Ae={class:"dialog-footer"},Pe=$e(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Se=F({__name:"AddTokenDialog",props:{show_add_token_dialog:{type:Boolean},plaque_id:null},emits:["update:show_add_token_dialog"],setup(s,{emit:o}){const A=s,u=h([]),v=h(!1),{screen_type:w}=re(),C=J(),x=_e(),$=de(),p=z({get(){return A.show_add_token_dialog},set(l){o("update:show_add_token_dialog",l)}});Q(p,l=>{l&&(u.value=JSON.parse(JSON.stringify(d.value.entity.token_meta_id_list)))});const d=z(()=>C.plaque_map[A.plaque_id]),g=z(()=>x.sorted_all_token_metas),S=async()=>{v.value=!0;try{for(let[l,e]of u.value.entries()){const i=x.all_token_metas[e];if(!i)throw"Failed to find store token for token: "+e;if(i.entity.platform!=se.Opensea)continue;const k=JSON.parse(JSON.stringify(i));k.entity.user_id=$.get_account.id,k.entity.platform=se.OpenseaArchive;const b=await qe(k.entity);u.value[l]=b.id}await E(A.plaque_id,{token_meta_id_list:u.value}),C.plaque_map[A.plaque_id].entity.token_meta_id_list=u.value}catch(l){R(`Error updating plaque tokens - ${l}`)}v.value=!1,p.value=!1},I=()=>{u.value=[]};return(l,e)=>{const i=_("el-button"),k=_("el-dialog");return r(),q("div",be,[t(k,{center:"",modelValue:y(p),"onUpdate:modelValue":e[1]||(e[1]=b=>ie(p)?p.value=b:null),title:"Add artwork to plaque","close-on-click-modal":!1,fullscreen:y(w)=="xs",top:"2vh"},{footer:n(()=>[a("div",Ae,[a("div",null,P(`Artwork in playlist: ${u.value.length}`),1),Pe,t(i,{onClick:I},{default:n(()=>[m("Clear")]),_:1}),t(i,{type:"info",onClick:S,loading:v.value},{default:n(()=>[m("Save")]),_:1},8,["loading"])])]),default:n(()=>[t(we,{selected_token_meta_id_list:u.value,"onUpdate:selected_token_meta_id_list":e[0]||(e[0]=b=>u.value=b),token_meta_list:y(g)},null,8,["selected_token_meta_id_list","token_meta_list"])]),_:1},8,["modelValue","fullscreen"])])}}});var Ve=j(Se,[["__scopeId","data-v-cc2989e6"]]);const Ne={class:"controller-buttons"},ze=F({__name:"PlaqueController",props:{plaque:null},setup(s){const o=s,A=J(),u=h(!1),v=h(!1),w=h(!1),C=h(!1),x=z({get:()=>o.plaque.entity.orientation||"landscape",set:p=>{E(o.plaque.id,{orientation:p}).then(()=>{A.plaque_map[o.plaque.id].entity.orientation=p,N({type:"success",message:"Plaque orientation updated"})}).catch(d=>{R(`Error updating plaque orientation - ${d}`)})}}),$=p=>{const d={type:p,time_sent:H.now()};E(o.plaque.id,{command:d}).then(()=>{A.plaque_map[o.plaque.id].entity.command=d,N({type:"success",message:"Command sent to plaque"})}).catch(g=>{R(`Error sending command to plaque - ${g}`)}).finally(()=>{u.value=!1,v.value=!1,w.value=!1,C.value=!1})};return(p,d)=>{const g=_("el-button"),S=_("el-radio"),I=_("el-radio-group");return r(),q("div",null,[a("div",Ne,[t(g,{circle:"",text:"",loading:u.value,icon:"DArrowLeft",onClick:d[0]||(d[0]=l=>{u.value=!0,$("playlist_previous")})},null,8,["loading"]),t(g,{circle:"",text:"",loading:v.value,icon:"VideoPlay",onClick:d[1]||(d[1]=l=>{v.value=!0,$("play")})},null,8,["loading"]),t(g,{circle:"",text:"",icon:"VideoPause",loading:w.value,onClick:d[2]||(d[2]=l=>{w.value=!0,$("pause")})},null,8,["loading"]),t(g,{circle:"",text:"",icon:"DArrowRight",loading:C.value,onClick:d[3]||(d[3]=l=>{C.value=!0,$("playlist_next")})},null,8,["loading"])]),t(I,{modelValue:y(x),"onUpdate:modelValue":d[4]||(d[4]=l=>ie(x)?x.value=l:null),style:{display:"flex","flex-direction":"column","align-items":"start","margin-top":"20px"}},{default:n(()=>[t(S,{label:"landscape",size:"small"},{default:n(()=>[m("Landscape")]),_:1}),t(S,{label:"portrait",size:"small"},{default:n(()=>[m("Portrait")]),_:1}),t(S,{label:"landscape_reversed",size:"small"},{default:n(()=>[m("Landscape Reversed")]),_:1}),t(S,{label:"portrait_reversed",size:"small"},{default:n(()=>[m("Portrait Reversed")]),_:1})]),_:1},8,["modelValue"])])}}});var Ie=j(ze,[["__scopeId","data-v-100e65c8"]]);const V=s=>(K("data-v-f218b46e"),s=s(),W(),s),Te={style:{display:"flex","align-items":"center",padding:"1em"}},Le={key:0},Ee=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),De={class:"card-simple"},Ue=V(()=>a("hr",null,null,-1)),Be=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"title",-1)),Oe=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"artist",-1)),Re={style:{padding:"0.3em 1em"}},je={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-right":"1em",padding:"1em"}},Fe={key:0,class:"card-detail"},Je={style:{padding:"0 1em"}},Me={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0.5em 1em"}},Ge=V(()=>a("hr",null,null,-1)),He=V(()=>a("div",{style:{padding:"1em"}},"No artwork added",-1)),Qe=V(()=>a("hr",null,null,-1)),Ke={style:{display:"flex",padding:"1em"}},We=V(()=>a("div",{style:{"flex-grow":"1"}},null,-1)),Xe={key:0,style:{padding:"1em"}},Ye={style:{padding:"1em 0em",display:"flex","justify-content":"space-between","align-items":"center"}},Ze={key:0},et=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Associated User",-1)),tt={key:0},lt={key:1},at={style:{"font-size":"var(--el-font-size-extra-small)"}},nt={key:1},ot=V(()=>a("div",{style:{"font-size":"var(--el-font-size-extra-small)"}},"Machine Info",-1)),st={style:{display:"flex","justify-content":"end"}},it=F({__name:"PlaqueCard",props:{plaque:null},setup(s){const o=s,A=J();ue();const u=h("simple"),v=h(!1),w=h(!1),C=h(""),x=h(!1),$=async()=>{x.value=!0,await E(o.plaque.id,{name:o.plaque.entity.name}).catch(l=>{R(`Error updating plaque tokens - ${l}`)}),w.value=!1,x.value=!1},p=_e(),d=z(()=>g.value.length==0?null:g.value[0]),g=z(()=>{const l=p.archive_token_meta_map;return o.plaque.entity.token_meta_id_list.map(i=>l[i])}),S=()=>{oe.confirm(`Are you sure you want to clear tokens for plaque '${o.plaque.entity.name}'?`,"Clear tokens",{type:"warning"}).then(()=>{E(o.plaque.id,{token_meta_id_list:[]}).then(()=>{A.plaque_map[o.plaque.id].entity.token_meta_id_list=[],N({type:"success",message:"Tokens cleared"})}).catch(l=>{N({message:`Error clearing tokens from plaque - ${l}`,type:"error",showClose:!0,duration:12e3})})})},I=()=>{oe.confirm(`Are you sure you want to forget the plaque named '${o.plaque.entity.name}'?`,"Forget plaque",{type:"warning"}).then(()=>{E(o.plaque.id,{user_id:"",token_meta_id_list:[]}).then(()=>{A.plaque_map[o.plaque.id].entity.user_id="",A.plaque_map[o.plaque.id].entity.token_meta_id_list=[],N({type:"success",message:"Plaque forgotten"})}).catch(l=>{N({message:`Error forgetting plaque - ${l}`,type:"error",showClose:!0,duration:12e3})})})};return Q(u,l=>{l=="settings"&&o.plaque.entity.user_id&&!C.value&&he(o.plaque.entity.user_id).then(e=>{C.value=e.entity.email}).catch(e=>{N({message:`Error loading user account - ${e}`,type:"error",showClose:!0,duration:12e3})})}),(l,e)=>{const i=_("el-button"),k=_("el-tag"),b=_("el-col"),D=_("el-row"),M=_("ArrowRight"),U=_("el-icon"),B=_("el-collapse-transition"),f=_("Close"),pe=_("el-card");return r(),T(pe,null,{default:n(()=>[a("div",Te,[w.value?ne((r(),q("input",{key:1,"onUpdate:modelValue":e[0]||(e[0]=c=>o.plaque.entity.name=c),class:"edit-name-input"},null,512)),[[me,o.plaque.entity.name]]):(r(),q("h1",Le,P(o.plaque.entity.name),1)),w.value?L("",!0):(r(),T(i,{key:2,icon:y(ve),onClick:e[1]||(e[1]=c=>w.value=!0),class:"editIcon",circle:""},null,8,["icon"])),w.value?(r(),T(i,{key:3,icon:y(fe),loading:x.value,onClick:$,class:"editIcon",circle:"",type:x.value?"":"success",text:""},null,8,["icon","loading","type"])):L("",!0),Ee,t(k,{class:"ml-2",type:"success"},{default:n(()=>[m("online")]),_:1})]),t(B,null,{default:n(()=>[ne(a("section",De,[Ue,t(D,{style:{padding:"1em"}},{default:n(()=>[t(b,{span:12},{default:n(()=>{var c;return[Be,a("span",null,P(((c=y(d))==null?void 0:c.entity.name)||"N/A"),1)]}),_:1}),t(b,{span:12},{default:n(()=>{var c;return[Oe,m(" "+P(((c=y(d))==null?void 0:c.entity.artist)||"N/A"),1)]}),_:1})]),_:1}),a("div",Re,P(`Total artworks: ${s.plaque.entity.token_meta_id_list.length}`),1),a("div",je,[t(i,{type:"info",onClick:e[2]||(e[2]=c=>v.value=!0)},{default:n(()=>[m("Add Artwork")]),_:1}),t(i,{onClick:e[3]||(e[3]=c=>u.value="detail")},{default:n(()=>[m(" Details"),t(U,{class:"el-icon--right"},{default:n(()=>[t(M)]),_:1})]),_:1})])],512),[[ye,u.value=="simple"]])]),_:1}),t(B,null,{default:n(()=>[u.value=="detail"?(r(),q("section",Fe,[a("p",Je,P(`Total artworks: ${s.plaque.entity.token_meta_id_list.length}`),1),a("div",Me,[t(i,{onClick:e[4]||(e[4]=c=>u.value="settings")},{default:n(()=>[m("Settings")]),_:1}),t(i,{onClick:S},{default:n(()=>[m("Clear Artwork")]),_:1})]),Ge,y(g).length==0?(r(),q(O,{key:0},[He,Qe],64)):L("",!0),(r(!0),q(O,null,G(y(g),c=>(r(),T(xe,{token_meta:c},null,8,["token_meta"]))),256)),a("div",Ke,[t(i,{type:"info",onClick:e[5]||(e[5]=c=>v.value=!0)},{default:n(()=>[m("Add Artwork")]),_:1}),We,t(i,{onClick:e[6]||(e[6]=c=>u.value="simple")},{default:n(()=>[m("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(f)]),_:1})]),_:1})])])):L("",!0)]),_:1}),t(B,null,{default:n(()=>{var c,X,Y,Z,ee,te,le,ae;return[u.value=="settings"?(r(),q("section",Xe,[t(Ie,{plaque:o.plaque},null,8,["plaque"]),a("div",Ye,[s.plaque.entity.user_id?(r(),q("div",Ze,[et,C.value?(r(),q("div",tt,P(C.value),1)):(r(),q("div",lt,"Loading...")),a("div",at,P(s.plaque.entity.user_id),1)])):(r(),q("div",nt,"No associated user")),s.plaque.entity.user_id?(r(),T(i,{key:2,type:"danger",plain:"",onClick:I},{default:n(()=>[m("Forget Display")]),_:1})):L("",!0)]),a("div",null,[ot,a("div",null,"Machine name: "+P((X=(c=s.plaque.entity.machine_data)==null?void 0:c.machine_name)!=null?X:"N/A"),1),a("div",null,"Local IP: "+P((Z=(Y=s.plaque.entity.machine_data)==null?void 0:Y.local_ip)!=null?Z:"N/A"),1),a("div",null,"Public IP: "+P((te=(ee=s.plaque.entity.machine_data)==null?void 0:ee.public_ip)!=null?te:"N/A"),1),a("div",null,"Updated At: "+P((ae=(le=s.plaque.entity.machine_data)==null?void 0:le.updated_at)!=null?ae:"N/A"),1)]),a("div",st,[t(i,{onClick:e[7]||(e[7]=ft=>u.value="detail")},{default:n(()=>[m("Close"),t(U,{class:"el-icon--right"},{default:n(()=>[t(f)]),_:1})]),_:1})])])):L("",!0)]}),_:1}),t(Ve,{plaque_id:o.plaque.id,show_add_token_dialog:v.value,"onUpdate:show_add_token_dialog":e[8]||(e[8]=c=>v.value=c)},null,8,["plaque_id","show_add_token_dialog"])]),_:1})}}});var ut=j(it,[["__scopeId","data-v-f218b46e"]]);const ce=s=>(K("data-v-0ea15fab"),s=s(),W(),s),dt={class:"subheader",style:{display:"flex","align-items":"center"}},rt=ce(()=>a("div",{style:{"padding-bottom":"40px"}},null,-1)),_t={class:"add-button-container"},ct={style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},pt=ce(()=>a("div",{style:{"font-size":"17px"}},"Add plaque",-1)),mt={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"}},vt=F({__name:"PlaqueList",setup(s){const o=h(!1),{width:A,screen_type:u}=re(),v=h(!1),w=ue(),C=de(),x=Ce(),$=h(""),p=h(localStorage.getItem("filter_by_gallery")||"");Q(p,l=>{localStorage.setItem("filter_by_gallery",l)});const d=J(),g=async()=>{o.value=!0,await ke({name:"Test Plaque",user_id:C.get_account.id,token_meta_id_list:[],created_at:H.now(),updated_at:H.now()}).catch(l=>N({message:`Error creating test plaque- ${l}`,type:"error",showClose:!0,duration:12e3})),o.value=!1,v.value=!1},S=z(()=>JSON.parse(JSON.stringify(d.all_plaque_list)).sort((e,i)=>{const k=e.entity.name.toLowerCase(),b=i.entity.name.toLowerCase();return k<b?-1:k>b?1:0})),I=z(()=>{let l=[...S.value];return l=l.filter(e=>e.entity.name||e.entity.user_id||e.entity.token_meta_id_list.length>0),p.value&&(l=l.filter(e=>{var i;return(i=x.gallery_list.find(k=>k.id==p.value))==null?void 0:i.entity.plaque_id_list.includes(e.id)})),$?l.filter(e=>e.entity.name.toLowerCase().includes($.value.toLowerCase())):l});return(l,e)=>{const i=_("el-input"),k=_("el-option"),b=_("el-select"),D=_("el-button"),M=_("Plus"),U=_("el-icon"),B=_("el-dialog");return r(),q(O,null,[a("div",dt,[t(i,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=f=>$.value=f),"prefix-icon":y(ge),placeholder:"Search plaques",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),t(b,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=f=>p.value=f),placeholder:"Filter by gallery",style:{"margin-left":"10px",width:"260px"}},{default:n(()=>[t(k,{label:"All plaques",value:""}),(r(!0),q(O,null,G(y(x).gallery_list,f=>(r(),T(k,{key:f.id,label:`Filter by gallery - ${f.entity.name}`,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(D,{icon:"Camera",type:"info",onClick:e[2]||(e[2]=f=>y(w).push("qr-scan")),style:{"margin-left":"10px"},size:"small"},{default:n(()=>[m("Scan")]),_:1})]),rt,(r(!0),q(O,null,G(y(I),f=>(r(),T(ut,{plaque:f,key:f.id},null,8,["plaque"]))),128)),a("div",_t,[a("div",ct,[a("div",{class:"add-button",onClick:e[3]||(e[3]=f=>v.value=!0)},[t(U,{style:{"font-size":"26px","margin-bottom":"6px"}},{default:n(()=>[t(M)]),_:1}),pt])])]),t(B,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=f=>v.value=f),title:"Add plaque",width:y(u)=="xs"?"90%":"50%",style:{"max-width":"500px"}},{default:n(()=>[a("div",mt,[t(D,{onClick:e[4]||(e[4]=f=>{y(w).push("qr-scan"),v.value=!1}),icon:"camera",color:"#000000",style:{margin:"10px 12px 10px 0px"}},{default:n(()=>[m("Scan Plaque QR Code")]),_:1}),t(D,{icon:"plus",onClick:g,loading:o.value,style:{margin:"10px 0px 10px 0px"},color:"#000000"},{default:n(()=>[m("Add test plaque ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","width"])],64)}}});var zt=j(vt,[["__scopeId","data-v-0ea15fab"]]);export{zt as default};
