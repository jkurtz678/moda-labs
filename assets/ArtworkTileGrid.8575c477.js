import{d as Q,P as Z,Q as ee,r as T,o as p,h as k,F as U,I as P,M as G,f as c,S as te,j as N,t as L,T as ne,U as oe,m as Y,z as j,_ as J,u as X,L as le,c as E,b as z,k as h,n as q,i as s,w,V as D,e as O,g as ae,K as ie,p as re,l as se}from"./index.052feb4f.js";import{u as ce}from"./thumbnail-image.8aac7b5c.js";import{c as ue,d as de}from"./types.6a5ef88e.js";import{s as me}from"./util.2bee2d51.js";import{u as _e}from"./token-meta.9680805d.js";import{u as pe}from"./gallery.cf9b89cb.js";import{u as ve}from"./breakpoints.d15e6327.js";import"./firebaseConfig.d7a6b5a9.js";import"./token-meta.2d60a689.js";import"./account.8375cb32.js";import"./gallery.82c2a091.js";const fe={columnWidth:400,gap:0,keyMapper:(l,r,V,g)=>g,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function ye({columns:l,columnWidth:r,emit:V,gap:g,items:a,maxColumns:y,minColumns:u,nextTick:$,onBeforeUnmount:x,onMounted:b,rtl:R,scrollContainer:d,ssrColumns:B,vue:M,wall:A,watch:v}){function m(o,t,S,F){const W=f(S);return F+t+W<=o?m(o,t,S+1,F+t+W):S}function f(o){const t=Array.isArray(r.value)?r.value:[r.value];return t[o%t.length]}function e(){const o=m(A.value.getBoundingClientRect().width,g.value,0,-g.value),t=i(n(o));return t>0?t:1}function n(o){const t=y==null?void 0:y.value;return t&&o>t?t:o}function i(o){const t=u==null?void 0:u.value;return t&&o<t?t:o}function _(o){return[...new Array(o)].map(()=>[])}if(B.value>0){const o=_(B.value);a.value.forEach((t,S)=>o[S%B.value].push(S)),l.value=o}async function I(o){if(o>=a.value.length)return;await $();const t=[...A.value.children];R.value&&t.reverse();const S=t.reduce((F,W)=>W.getBoundingClientRect().height<F.getBoundingClientRect().height?W:F);l.value[+S.dataset.index].push(o),await I(o+1)}async function C(o=!1){if(l.value.length===e()&&!o){V(M===2?"redraw-skip":"redrawSkip");return}l.value=_(e());const t=d==null?void 0:d.value,S=t?t.scrollTop:window.scrollY;await I(0),t?t.scrollBy({top:S-t.scrollTop}):window.scrollTo({top:S}),V("redraw")}const H=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>C());return b(()=>{C(),H==null||H.observe(A.value)}),x(()=>H==null?void 0:H.unobserve(A.value)),v([a,R],()=>C(!0)),v([r,g,u,y],()=>C()),{getColumnWidthTarget:f}}const he=["data-index"],ke=Q({__name:"masonry-wall",props:Z({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},fe),emits:["redraw","redrawSkip"],setup(l,{emit:r}){const V=l,{columnWidth:g,items:a,gap:y,rtl:u,ssrColumns:$,scrollContainer:x,minColumns:b,maxColumns:R,keyMapper:d}=ee(V),B=T([]),M=T(),{getColumnWidthTarget:A}=ye({columns:B,columnWidth:g,emit:r,gap:y,items:a,keyMapper:d,maxColumns:R,minColumns:b,nextTick:ne,onBeforeUnmount:oe,onMounted:Y,rtl:u,scrollContainer:x,ssrColumns:$,vue:3,wall:M,watch:j});return(v,m)=>(p(),k("div",{ref_key:"wall",ref:M,class:"masonry-wall",style:G({display:"flex",gap:`${c(y)}px`})},[(p(!0),k(U,null,P(B.value,(f,e)=>(p(),k("div",{key:e,class:"masonry-column","data-index":e,style:G({display:"flex","flex-basis":`${c(A)(e)}px`,"flex-direction":"column","flex-grow":1,gap:`${c(y)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(p(!0),k(U,null,P(f,(n,i)=>(p(),k("div",{key:c(d)(c(a)[n],e,i,n),class:"masonry-item"},[te(v.$slots,"default",{item:c(a)[n],column:e,row:i,index:n},()=>[N(L(c(a)[n]),1)])]))),128))],12,he))),128))],4))}}),ge=(()=>{const l=ke;return l.install=r=>{r.component("MasonryWall",l)},l})();const we=["src"],xe={class:"header"},be={class:"platform"},Ce={style:{"font-size":"1.6em","font-weight":"bold"}},Se={key:0},Te={key:1,style:{"font-weight":"bold"}},Ve={key:3,style:{height:"32px"}},$e={style:{"font-size":"0.9em","line-height":"1.3em"}},Be=Q({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(l){const r=l,V=X(),g=ce(le(r,"token_meta")),a=T(!1),y=T(0),u=T(),$=T(),x=E(()=>ue(r.token_meta.entity.platform)),b=async()=>{const v=await de(r.token_meta);if(!v){me("Error getting source file");return}window.open(v,"_blank")},R=E(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),d=()=>{const v=V.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(v.href)},B=()=>{window.open(r.token_meta.entity.public_link,"_blank")},M=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function A(v){if(!u.value){console.log("animateDivHeight - error finding tile container");return}if(v&&y.value==0&&(y.value=u.value.offsetHeight),!$.value){console.log("animateDivHeight - error finding detail container");return}let m;v?m=$.value.offsetHeight:m=y.value;const f=300,e=10,n=u.value.offsetHeight,i=Math.ceil(m-n),_=Math.ceil(f/e),I=i/_;let C=0;const H=setInterval(()=>{if(C>=_){u.value.style.height=m+"px",clearInterval(H);return}C++;const o=n+I*C;u.value.style.height=o+"px"},e)}return(v,m)=>{const f=z("el-button"),e=z("el-tooltip");return p(),k("div",{ref_key:"tile_container",ref:u,class:"custom-card",onClick:m[1]||(m[1]=()=>{a.value=!a.value,A(a.value)}),style:G(a.value?"":`height: ${c(R)}px !important`)},[h("img",{class:q(a.value?"absolute":""),src:c(g)},null,10,we),h("div",{class:q([a.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),h("div",{class:q(["transition absolute",a.value?"hide-blur":"show-blur"])},[h("div",xe,L(`${l.token_meta.entity.name} | ${l.token_meta.entity.artist}`),1),h("div",be,L(c(x)),1)],2),h("div",{ref_key:"detail_container",ref:$,class:q(["detail-container transition",a.value?"show-blur":"hide-blur absolute-no-b"])},[h("div",Ce,L(l.token_meta.entity.name),1),l.token_meta.entity.artist_social_link?(p(),k("div",Se,[s(f,{link:"",style:{"font-weight":"bold",display:"block"},onClick:D(M,["stop"])},{default:w(()=>[N(L(l.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(p(),k("div",Te,L(l.token_meta.entity.artist),1)),a.value?(p(),k(U,{key:2},[s(e,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:w(()=>[s(f,{icon:"Edit",text:"",circle:"",onClick:m[0]||(m[0]=D(n=>c(V).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),s(e,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:w(()=>[s(f,{icon:"Download",text:"",circle:"",onClick:D(b,["stop"])},null,8,["onClick"])]),_:1}),s(e,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:w(()=>[s(f,{icon:"Tickets",text:"",circle:"",onClick:D(d,["stop"])},null,8,["onClick"])]),_:1}),l.token_meta.entity.public_link?(p(),O(e,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:w(()=>[s(f,{icon:"Link",text:"",circle:"",onClick:D(B,["stop"])},null,8,["onClick"])]),_:1})):ae("",!0)],64)):(p(),k("div",Ve)),h("div",$e,L(l.token_meta.entity.description),1)],2)],4)}}});var Me=J(Be,[["__scopeId","data-v-41c23726"]]);const K=l=>(re("data-v-015952ec"),l=l(),se(),l),Ae={class:"subheader",style:{display:"flex","align-items":"center"}},Ie=K(()=>h("div",{class:"caption"},"Filter by gallery",-1)),Re=K(()=>h("div",{class:"caption"},"Sort order",-1)),He=K(()=>h("div",{style:{"padding-bottom":"40px"}},null,-1)),ze={key:1,style:{padding:"1em"}},Le=Q({__name:"ArtworkTileGrid",setup(l){const r=X(),V=_e(),g=pe(),a=T(""),y=T(null),u=T(localStorage.getItem("token_list_sort_order")||"name"),$=30,x=T($),b=T(localStorage.getItem("artwork_grid_filter_by_gallery")||"");j(b,e=>{localStorage.setItem("artwork_grid_filter_by_gallery",e)}),j(a,e=>{x.value=$});const R=250,d=10,{screen_type:B}=ve(),M=E(()=>{switch(B.value){case"xs":return 340-d*2;case"sm":return 650-d*2;case"md":return 960-d*2;case"lg":return 1200-d*2;case"xl":return 1700-d*2}return 0}),A=E(()=>{const e=Math.floor(M.value/(R+d));return(M.value-(e+1)*d)/e}),v=E(()=>V.sorted_all_token_metas.filter(e=>Boolean(e.entity.aspect_ratio))),m=E(()=>{let e=v.value.filter(n=>{var i,_;return((i=n.entity.artist)==null?void 0:i.toLowerCase().includes(a.value.toLowerCase()))||((_=n.entity.name)==null?void 0:_.toLowerCase().includes(a.value.toLowerCase()))});return b.value&&(e=e.filter(n=>{var i;return(i=g.gallery_list.find(_=>_.id==b.value))==null?void 0:i.entity.token_meta_id_list.includes(n.id)})),u.value==="name"?e=e.sort((n,i)=>n.entity.name.localeCompare(i.entity.name)):u.value==="created_at"&&(e=e.sort((n,i)=>n.entity.created_at==null&&i.entity.created_at==null?0:n.entity.created_at==null?1:i.entity.created_at==null?-1:i.entity.created_at.seconds-n.entity.created_at.seconds)),e}),f=E(()=>{const e=m.value,n=0,i=n+x.value;return e.slice(n,i)});return Y(()=>{const e=document.getElementById("masonry-container");if(!e){console.log("ArtworkTileGrid error, masonary_wall element not found");return}e.addEventListener("scroll",()=>{const n=e.scrollTop,i=e.scrollHeight,_=e.clientHeight;n/(i-_)*100>85&&x.value<m.value.length&&(x.value=x.value+20)})}),(e,n)=>{const i=z("el-input"),_=z("el-button"),I=z("el-option"),C=z("el-select"),H=z("el-popover"),o=z("RouterView");return p(),k(U,null,[h("div",Ae,[s(i,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=t=>a.value=t),"prefix-icon":c(ie),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),s(H,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:w(()=>[s(_,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:w(()=>[N("Filters")]),_:1})]),default:w(()=>[Ie,s(C,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=t=>b.value=t),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:w(()=>[s(I,{label:"All plaques",value:""}),(p(!0),k(U,null,P(c(g).gallery_list,t=>(p(),O(I,{key:t.id,label:`${t.entity.name}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Re,s(C,{modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=t=>u.value=t),placeholder:"Sort by"},{default:w(()=>[s(I,{label:"Sort by name",value:"name"}),s(I,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),s(_,{icon:"Plus",type:"info",onClick:n[3]||(n[3]=t=>c(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:w(()=>[N("Artwork")]),_:1})]),He,h("div",{id:"masonry-container",ref_key:"masonryContainer",ref:y,style:{"overflow-y":"auto",height:"100%",padding:"10px"}},[c(f).length>0?(p(),O(c(ge),{key:0,id:"masonary-wall","scroll-container":y.value,items:c(f),"column-width":R,gap:d,style:G(`width: ${c(M)}px; margin: auto`),"max-columns":5},{default:w(({item:t})=>[s(Me,{token_meta:t,column_width:c(A)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(p(),k("div",ze,"No artwork found"))],512),s(o)],64)}}});var Qe=J(Le,[["__scopeId","data-v-015952ec"]]);export{Qe as default};
