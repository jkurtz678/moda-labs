import{b as D}from"./token-meta.8015aff1.js";import{s as x}from"./util.6c19ab9d.js";import{b as T}from"./thumbnail-image.3e43f47a.js";import{p as z}from"./types.4ea69ea7.js";import{r as m,p as G,d as E,J as M,m as I,h as i,i as l,u as v,g as w,t as g,e as B,b as N,o as s,_ as R,c as p,E as F,F as $,H as b,a as S}from"./index.fced87bf.js";import{e as V,f as H}from"./gallery-token.c4aa5fe8.js";import"./firebaseConfig.4d01e9b5.js";function J(f="0px"){const n=m(!1),r=new IntersectionObserver(o=>{o.forEach(u=>{u.isIntersecting&&(n.value=!0,r.disconnect())})},{rootMargin:f}),_=o=>{o&&r.observe(o)};return G(()=>{r.disconnect()}),{isIntersecting:n,observe:_}}const O={style:{display:"flex","border-radius":"18px","flex-grow":"1"}},U=["src"],j={style:{"font-weight":"bold","overflow-wrap":"break-word"}},q={style:{"min-height":"24px"}},K=E({__name:"CatalogArtTile",props:{token_meta:{}},setup(f){B();const n=N(),r=f,_=T(M(r,"token_meta")),{isIntersecting:o,observe:u}=J("600px"),c=m(null);return I(()=>{c.value&&u(c.value)}),(h,d)=>(s(),i("div",{class:"tile-container",style:{margin:"12px",width:"340px"},onClick:d[0]||(d[0]=C=>v(n).push({name:"actions",params:{token_meta_id:r.token_meta.id}}))},[l("div",{style:{display:"flex","flex-direction":"column",height:"100%"},ref_key:"tile",ref:c},[l("div",O,[v(o)?(s(),i("img",{key:0,src:v(_)},null,8,U)):w("",!0)]),l("h2",j,g(r.token_meta.entity.name),1),l("div",q,g(v(z)(r.token_meta)),1)],512)]))}});var P=R(K,[["__scopeId","data-v-54973e29"]]);const Q={key:0},W={style:{"font-weight":"bold","font-size":"2.8em","padding-top":"1.5em"}},X={key:0,style:{"white-space":"pre-wrap"}},Y={key:1},Z={style:{"font-weight":"bold","font-size":"2.8em",padding:"48px 0px 24px 0px"}},ee={style:{display:"flex",margin:"-12px","flex-wrap":"wrap"}},le=E({__name:"CatalogGalleryDetail",setup(f){const n=B();n.params.gallery_id;const r=m([]),_=m([]),o=m(),u=m(),c={},h=p(()=>{if(!n.params.gallery_id||typeof n.params.gallery_id!="string"){console.log("failed to get gallery id from params");return}return c[n.params.gallery_id]});p(()=>r.value.map(e=>({name:e.entity.name,artist:e.entity.artist,price:e.entity.price,price_unit:e.entity.price_unit})).sort((e,t)=>!(e!=null&&e.artist)||!(t!=null&&t.artist)?0:e.artist.localeCompare(t.artist)));const d=p(()=>Array.from(new Set(r.value.map(e=>e.entity.artist||""))).sort((e,t)=>e.localeCompare(t))),C=p(()=>r.value.reduce((e,t)=>(t.entity.artist&&(e[t.entity.artist]||(e[t.entity.artist]=[]),e[t.entity.artist].push(t)),e),{})),L=p(()=>r.value.reduce((e,t)=>(e[t.id]=t,e),{}));return p(()=>_.value.map(e=>{var a,y;const t=L.value[e.entity.token_meta_id];return{bidding_name:e.entity.bidding_name,email:e.entity.email,phone_number:e.entity.phone_number,amount:e.entity.amount,amount_unit:e.entity.amount_unit,artist_name:(a=t==null?void 0:t.entity)==null?void 0:a.artist,artwork_name:(y=t==null?void 0:t.entity)==null?void 0:y.name}}).sort((e,t)=>!(e!=null&&e.artwork_name)||!(t!=null&&t.artwork_name)?0:e.artwork_name.localeCompare(t.artwork_name))),I(async()=>{if(!n.params.gallery_id||typeof n.params.gallery_id!="string"){console.log("failed to get gallery id from params");return}u.value=F.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),V(n.params.gallery_id).then(e=>{const t=e.map(a=>a.entity.token_meta_id);return D(t).then(a=>{console.log("token_metas",r),r.value=a}).catch(a=>{x(`Error fetching token metas: ${a}`)}).finally(()=>{u.value.close()})}).catch(e=>{x(`Error fetching token metas: ${e}`)}),H(n.params.gallery_id).then(e=>{console.log("gallery",e),o.value=e}).catch(e=>{x(`Error fetching gallery: ${e}`)})}),(e,t)=>{var a,y;return(a=u.value)!=null&&a.visible?w("",!0):(s(),i("div",Q,[l("h1",W,g((y=o.value)==null?void 0:y.entity.name),1),h.value?(s(),i("div",X,g(h.value),1)):w("",!0),d.value.length==0?(s(),i("div",Y,t[0]||(t[0]=[l("h1",{style:{"font-weight":"bold","font-size":"2.8em",padding:"48px 0px 24px 0px"}},"No Artworks",-1)]))):(s(!0),i($,{key:2},b(d.value,k=>(s(),i("div",{key:k,style:{margin:"20px 0px"}},[l("h1",Z,g(k),1),l("div",ee,[(s(!0),i($,null,b(C.value[k],A=>(s(),S(P,{token_meta:A},null,8,["token_meta"]))),256))])]))),128))]))}}});export{le as default};
