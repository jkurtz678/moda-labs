import{d as J,P as te,Q as oe,r as E,o as f,h as b,F as q,I as Q,M as G,f as _,S as ne,j as N,t as H,T as le,U as ae,m as X,z as W,_ as Z,u as ee,L as re,c as R,b as D,k as h,n as U,i as s,w as g,V as z,e as j,g as K,J as ie,x as Y,K as se,p as ce,l as ue}from"./index.4a1ead13.js";import{u as de}from"./thumbnail-image.b0a0a161.js";import{c as me,d as _e}from"./types.6a5ef88e.js";import{s as pe}from"./util.5e270e81.js";import{u as fe}from"./account.fcb97c6b.js";import{f as ve}from"./token-meta.e73e8480.js";import{u as ye}from"./token-meta.9ef54635.js";import{u as ke}from"./gallery.b2386824.js";import{u as he}from"./breakpoints.3575f38c.js";import"./firebaseConfig.d7a6b5a9.js";import"./gallery.82c2a091.js";const ge={columnWidth:400,gap:0,keyMapper:(a,r,A,x)=>x,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function we({columns:a,columnWidth:r,emit:A,gap:x,items:i,maxColumns:v,minColumns:y,nextTick:k,onBeforeUnmount:V,onMounted:$,rtl:C,scrollContainer:M,ssrColumns:p,vue:B,wall:T,watch:I}){function L(n,o,l,F){const P=d(l);return F+o+P<=n?L(n,o,l+1,F+o+P):l}function d(n){const o=Array.isArray(r.value)?r.value:[r.value];return o[n%o.length]}function c(){const n=L(T.value.getBoundingClientRect().width,x.value,0,-x.value),o=e(t(n));return o>0?o:1}function t(n){const o=v==null?void 0:v.value;return o&&n>o?o:n}function e(n){const o=y==null?void 0:y.value;return o&&n<o?o:n}function u(n){return[...new Array(n)].map(()=>[])}if(p.value>0){const n=u(p.value);i.value.forEach((o,l)=>n[l%p.value].push(l)),a.value=n}async function w(n){if(n>=i.value.length)return;await k();const o=[...T.value.children];C.value&&o.reverse();const l=o.reduce((F,P)=>P.getBoundingClientRect().height<F.getBoundingClientRect().height?P:F);a.value[+l.dataset.index].push(n),await w(n+1)}async function m(n=!1){if(a.value.length===c()&&!n){A(B===2?"redraw-skip":"redrawSkip");return}a.value=u(c());const o=M==null?void 0:M.value,l=o?o.scrollTop:window.scrollY;await w(0),o?o.scrollBy({top:l-o.scrollTop}):window.scrollTo({top:l}),A("redraw")}const S=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>m());return $(()=>{m(),S==null||S.observe(T.value)}),V(()=>S==null?void 0:S.unobserve(T.value)),I([i,C],()=>m(!0)),I([r,x,y,v],()=>m()),{getColumnWidthTarget:d}}const be=["data-index"],xe=J({__name:"masonry-wall",props:te({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ge),emits:["redraw","redrawSkip"],setup(a,{emit:r}){const A=a,{columnWidth:x,items:i,gap:v,rtl:y,ssrColumns:k,scrollContainer:V,minColumns:$,maxColumns:C,keyMapper:M}=oe(A),p=E([]),B=E(),{getColumnWidthTarget:T}=we({columns:p,columnWidth:x,emit:r,gap:v,items:i,keyMapper:M,maxColumns:C,minColumns:$,nextTick:le,onBeforeUnmount:ae,onMounted:X,rtl:y,scrollContainer:V,ssrColumns:k,vue:3,wall:B,watch:W});return(I,L)=>(f(),b("div",{ref_key:"wall",ref:B,class:"masonry-wall",style:G({display:"flex",gap:`${_(v)}px`})},[(f(!0),b(q,null,Q(p.value,(d,c)=>(f(),b("div",{key:c,class:"masonry-column","data-index":c,style:G({display:"flex","flex-basis":`${_(T)(c)}px`,"flex-direction":"column","flex-grow":1,gap:`${_(v)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(f(!0),b(q,null,Q(d,(t,e)=>(f(),b("div",{key:_(M)(_(i)[t],c,e,t),class:"masonry-item"},[ne(I.$slots,"default",{item:_(i)[t],column:c,row:e,index:t},()=>[N(H(_(i)[t]),1)])]))),128))],12,be))),128))],4))}}),Ce=(()=>{const a=xe;return a.install=r=>{r.component("MasonryWall",a)},a})();const Te=["src"],Se={class:"header"},Ee={class:"platform"},$e={style:{"font-size":"1.6em","font-weight":"bold"}},Ae={key:0},Ve={key:1,style:{"font-weight":"bold"}},Me={key:3,style:{height:"32px"}},Be={style:{"font-size":"0.9em","line-height":"1.3em"}},Ie=J({__name:"ArtworkTile",props:{token_meta:null,column_width:null},setup(a){const r=a,A=ee(),x=de(re(r,"token_meta")),i=E(!1),v=E(0),y=E(),k=E(),V=fe(),$=R(()=>me(r.token_meta.entity.platform)),C=async()=>{const d=await _e(r.token_meta);if(!d){pe("Error getting source file");return}window.open(d,"_blank")},M=R(()=>r.token_meta.entity.aspect_ratio?r.column_width/r.token_meta.entity.aspect_ratio:r.column_width),p=()=>{const d=A.resolve({name:"preview-plaque",params:{token_meta_id:r.token_meta.id}});window.open(d.href)},B=()=>{window.open(r.token_meta.entity.public_link,"_blank")},T=()=>{window.open(r.token_meta.entity.artist_social_link,"_blank")};function I(d){if(!y.value){console.log("animateDivHeight - error finding tile container");return}if(d&&v.value==0&&(v.value=y.value.offsetHeight),!k.value){console.log("animateDivHeight - error finding detail container");return}let c;d&&k.value.offsetHeight>v.value?c=k.value.offsetHeight:c=v.value;const t=300,e=10,u=y.value.offsetHeight,w=Math.ceil(c-u),m=Math.ceil(t/e),S=w/m;let n=0;const o=setInterval(()=>{if(n>=m){y.value.style.height=c+"px",clearInterval(o);return}n++;const l=u+S*n;y.value.style.height=l+"px"},e)}const L=()=>{ie.prompt(`Are you sure you want to delete ${r.token_meta.entity.name}? Please type the word 'DELETE' to proceed.`,"Delete Artwork",{confirmButtonText:"Delete",cancelButtonText:"Cancel",inputPattern:/^DELETE$/i,inputErrorMessage:"Please enter the word DELETE to confirm."}).then(({value:d})=>{if(d)return ve(r.token_meta.id)}).then(()=>{Y({message:"Artwork deleted",type:"success",showClose:!0,duration:12e3})}).catch(d=>{Y({message:`Error deleting artwork - ${d}`,type:"error",showClose:!0,duration:12e3})})};return(d,c)=>{const t=D("el-button"),e=D("el-tooltip");return f(),b("div",{ref_key:"tile_container",ref:y,class:"custom-card",onClick:c[1]||(c[1]=()=>{i.value=!i.value,I(i.value)}),style:G(i.value?"":`height: ${_(M)}px !important`)},[h("img",{class:U(i.value?"absolute":""),src:_(x)},null,10,Te),h("div",{class:U([i.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),h("div",{class:U(["transition absolute",i.value?"hide-blur":"show-blur"])},[h("div",Se,H(`${a.token_meta.entity.name} | ${a.token_meta.entity.artist}`),1),h("div",Ee,H(_($)),1)],2),h("div",{ref_key:"detail_container",ref:k,class:U(["detail-container transition",i.value?"show-blur":"hide-blur absolute-no-b"])},[h("div",$e,H(a.token_meta.entity.name),1),a.token_meta.entity.artist_social_link?(f(),b("div",Ae,[s(t,{link:"",style:{"font-weight":"bold",display:"block"},onClick:z(T,["stop"])},{default:g(()=>[N(H(a.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(f(),b("div",Ve,H(a.token_meta.entity.artist),1)),i.value?(f(),b(q,{key:2},[s(e,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:g(()=>[s(t,{icon:"Edit",text:"",circle:"",onClick:c[0]||(c[0]=z(u=>_(A).push({name:"edit-artwork",params:{token_meta_id:r.token_meta.id}}),["stop"]))})]),_:1}),s(e,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:g(()=>[s(t,{icon:"Download",text:"",circle:"",onClick:z(C,["stop"])},null,8,["onClick"])]),_:1}),s(e,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:g(()=>[s(t,{icon:"Tickets",text:"",circle:"",onClick:z(p,["stop"])},null,8,["onClick"])]),_:1}),a.token_meta.entity.public_link?(f(),j(e,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:g(()=>[s(t,{icon:"Link",text:"",circle:"",onClick:z(B,["stop"])},null,8,["onClick"])]),_:1})):K("",!0),_(V).is_user_admin?(f(),j(e,{key:1,class:"box-item",effect:"dark",content:"Delete Artwork",placement:"top"},{default:g(()=>[s(t,{icon:"Delete",text:"",circle:"",onClick:z(L,["stop"])},null,8,["onClick"])]),_:1})):K("",!0)],64)):(f(),b("div",Me)),h("div",Be,H(a.token_meta.entity.description),1)],2)],4)}}});var De=Z(Ie,[["__scopeId","data-v-bc2a1e7c"]]);const O=a=>(ce("data-v-3f06fecd"),a=a(),ue(),a),Le={class:"subheader",style:{display:"flex","align-items":"center"}},He=O(()=>h("div",{class:"caption"},"Filter by gallery",-1)),Re=O(()=>h("div",{class:"caption"},"Filter by aspect ratio",-1)),ze=O(()=>h("div",{class:"caption"},"Sort order",-1)),Fe=O(()=>h("div",{style:{"padding-bottom":"40px"}},null,-1)),Pe={key:1,style:{padding:"1em"}},We=J({__name:"ArtworkTileGrid",setup(a){const r=ee(),A=ye(),x=ke(),i=E(""),v=E(null),y=30,k=E(y),V=E(localStorage.getItem("artwork_grid_aspect_ratio_filter")||"");W(V,t=>{localStorage.setItem("artwork_grid_aspect_ratio_filter",t)});const $=E(localStorage.getItem("artwork_grid_filter_by_gallery")||"");W($,t=>{localStorage.setItem("artwork_grid_filter_by_gallery",t)});const C=E(localStorage.getItem("artwork_grid_sort_order")||"name");W(C,t=>{localStorage.setItem("artwork_grid_sort_order",t)}),W(i,t=>{k.value=y});const M=250,p=10,{screen_type:B}=he(),T=R(()=>{switch(B.value){case"xs":return 340-p*2;case"sm":return 650-p*2;case"md":return 960-p*2;case"lg":return 1200-p*2;case"xl":return 1700-p*2}return 0}),I=R(()=>{let t=Math.floor(T.value/(M+p));return t>5&&(t=5),(T.value-(t-1)*p)/t}),L=R(()=>A.sorted_all_token_metas.filter(t=>Boolean(t.entity.aspect_ratio))),d=R(()=>{let t=L.value.filter(e=>{var u,w,m;if(i.value&&!((u=e.entity.artist)!=null&&u.toLowerCase().includes(i.value.toLowerCase()))&&!((w=e.entity.name)!=null&&w.toLowerCase().includes(i.value.toLowerCase()))||$.value&&!((m=x.gallery_list.find(S=>S.id==$.value))!=null&&m.entity.token_meta_id_list.includes(e.id)))return!1;switch(V.value){case"portrait":if(!e.entity.aspect_ratio||e.entity.aspect_ratio>.9)return!1;break;case"landscape":if(!e.entity.aspect_ratio||e.entity.aspect_ratio<1.1)return!1;break;case"square":if(!e.entity.aspect_ratio||e.entity.aspect_ratio<.9||e.entity.aspect_ratio>1.1)return!1;break}return!0});return C.value==="name"?t=t.sort((e,u)=>e.entity.name.localeCompare(u.entity.name)):C.value==="created_at"&&(t=t.sort((e,u)=>e.entity.created_at==null&&u.entity.created_at==null?0:e.entity.created_at==null?1:u.entity.created_at==null?-1:u.entity.created_at.seconds-e.entity.created_at.seconds)),t}),c=R(()=>{const t=d.value,e=0,u=e+k.value;return t.slice(e,u)});return X(()=>{const t=document.getElementById("masonry-container");if(!t){console.log("ArtworkTileGrid error, masonary_wall element not found");return}t.addEventListener("scroll",()=>{const e=t.scrollTop,u=t.scrollHeight,w=t.clientHeight;e/(u-w)*100>90&&k.value<d.value.length&&(k.value=k.value+20)})}),(t,e)=>{const u=D("el-input"),w=D("el-button"),m=D("el-option"),S=D("el-select"),n=D("el-popover"),o=D("RouterView");return f(),b(q,null,[h("div",Le,[s(u,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l),"prefix-icon":_(se),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),s(n,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:g(()=>[s(w,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:g(()=>[N("Filters")]),_:1})]),default:g(()=>[He,s(S,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=l=>$.value=l),placeholder:"Filter by gallery",class:"filter-select"},{default:g(()=>[s(m,{label:"All artwork",value:""}),(f(!0),b(q,null,Q(_(x).gallery_list,l=>(f(),j(m,{key:l.id,label:`${l.entity.name}`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Re,s(S,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=l=>V.value=l),class:"filter-select"},{default:g(()=>[s(m,{label:"All",value:""}),s(m,{label:"Landscape",value:"landscape"}),s(m,{label:"Portrait",value:"portrait"}),s(m,{label:"Square",value:"square"})]),_:1},8,["modelValue"]),ze,s(S,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),placeholder:"Sort by",class:"filter-select"},{default:g(()=>[s(m,{label:"Sort by name",value:"name"}),s(m,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),s(w,{icon:"Plus",type:"info",onClick:e[4]||(e[4]=l=>_(r).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:g(()=>[N("Artwork")]),_:1})]),Fe,h("div",{id:"masonry-container",ref_key:"masonryContainer",ref:v,style:{"overflow-y":"auto",height:"100%",padding:"10px"}},[_(c).length>0?(f(),j(_(Ce),{key:0,id:"masonary-wall","scroll-container":v.value,items:_(c),"column-width":M,gap:p,style:G(`width: ${_(T)}px; margin: auto`),"max-columns":5},{default:g(({item:l})=>[s(De,{token_meta:l,column_width:_(I)},null,8,["token_meta","column_width"])]),_:1},8,["scroll-container","items","style"])):(f(),b("div",Pe,"No artwork found"))],512),s(o)],64)}}});var Ze=Z(We,[["__scopeId","data-v-3f06fecd"]]);export{Ze as default};
