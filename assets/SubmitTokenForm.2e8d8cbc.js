import{b as K,c as X}from"./gallery-token.f19a7c70.js";import{d as Y,u as Z,e as ee}from"./token-meta.9b03395e.js";import{h as le,r as ae,u as te,i as R}from"./firebaseConfig.4d01e9b5.js";import{z as T,d as oe,r as f,Q as ne,q as re,c as ue,a as k,w as o,f as d,o as v,i as t,g as h,l as x,u as q,h as se,J as ie,F as de,j as F,t as D,_ as me,A as ce,p as pe,m as _e}from"./index.bb66a239.js";import{a as S,T as fe,P as U}from"./types.67d14e22.js";import{u as ve}from"./account.03d67460.js";import{u as ke}from"./token-meta.7a0b8f54.js";import{s as g}from"./util.28150ffc.js";const ge=le(),be=async(p,_,w,l)=>{console.log("uploadFile - starting file upload for ",p);const c=ae(ge,p);te(c,_).on("state_changed",r=>{console.log("snapshot",r.bytesTransferred,r.totalBytes),w(r.bytesTransferred/r.totalBytes)},r=>{console.log("uploadFile error - ",r),T({message:`Error uploading file to moda archive - ${r}`,type:"error",showClose:!0,duration:12e3})},l)};const ye=p=>(pe("data-v-59a35d27"),p=p(),_e(),p),Ve={style:{display:"flex","align-items":"center"}},he=ye(()=>x("div",{class:"el-upload__text"},[F(" Drop file here or "),x("em",null,"click to upload")],-1)),we=oe({__name:"SubmitTokenForm",props:{token_meta_id:{}},setup(p){const _=p,w=f();f();const l=f({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:R.now(),updated_at:R.now(),media_id:"",media_type:"",user_id:"",blockchain:S.OffChain,asset_contract_address:"",token_id:"",platform:fe.Archive,price:void 0,price_unit:U.USD}),c=f([]),E=ne({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),r=f(!1),$=f("0%"),V=f([]),M=ve(),A=ke(),C=f([]);re(()=>{_.token_meta_id?(l.value={...A.all_token_metas[_.token_meta_id].entity},l.value.price_unit||(l.value.price_unit=U.USD)):K().then(s=>{C.value=s})});const L=(s,e)=>ce.confirm(`Cancel the upload of ${s.name} ?`).then(()=>!0,()=>!1),b=ue({get:()=>l.value.blockchain===S.Ethereum,set:s=>{l.value.blockchain=s?S.Ethereum:S.OffChain}}),P=()=>{},I=async s=>{var u;if(!s){g("Error finding form element");return}if(!!await s.validate(n=>n)){if(l.value.user_id=M.get_account.id,l.value.blockchain!="ethereum"&&(l.value.asset_contract_address="",l.value.token_id=""),_.token_meta_id){O(_.token_meta_id);return}if(((u=c==null?void 0:c.value)==null?void 0:u.length)!==1){g("Please add a file to upload");return}await N(s)}},N=async s=>{const e=c.value[0];r.value=!0;const u=await Y().catch(i=>{console.error(i),r.value=!1,g(`Error getting moda archive token meta document - ${i}`)});if(!u)return;const n=i=>{$.value=`${Math.round(i*100)}%`},y=()=>{G(s,e,u)},m=`${u.id}.${e.name.split(".").pop()}`;return be(m,e.raw,n,y).catch(i=>{console.error(i),r.value=!1,g(`Error uploading file to moda archive - ${i}`)})},G=async(s,e,u)=>{var y;l.value.media_id=`${u.id}`,l.value.media_type=`.${e.name.split(".").pop()}`;let n;try{n=await ee(u,l.value)}catch(m){g(`Error uploading metadata to moda archive - ${m}`),r.value=!1;return}if((y=V.value)!=null&&y.length){const m=V.value.map(i=>({gallery_id:i,token_meta_id:n.id}));await X(m).catch(i=>{g(`Error adding token to gallery - ${i}`),r.value=!1})}s.resetFields(),c.value=[],V.value=[],T({type:"success",message:"Successfully submitted artwork. Please wait a few moments for your artwork to appear."}),r.value=!1},O=s=>{r.value=!0,Z(s,l.value).then(()=>{T({type:"success",message:"Successfully updated artwork"})}).catch(e=>{g(`Error updating token metadata - ${e}`)}).finally(()=>r.value=!1)};return(s,e)=>{const u=d("el-input"),n=d("el-form-item"),y=d("el-switch"),m=d("el-option"),i=d("el-select"),H=d("el-input-number"),Q=d("upload-filled"),B=d("el-icon"),j=d("el-upload"),z=d("Loading"),J=d("el-button"),W=d("el-form");return v(),k(W,{ref_key:"formRef",ref:w,model:l.value,rules:E,"label-position":"left","label-width":"180px",style:{margin:"0 auto"}},{default:o(()=>[t(n,{label:"Artwork Title",prop:"name"},{default:o(()=>[t(u,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.name=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Artist Name",prop:"artist"},{default:o(()=>[t(u,{modelValue:l.value.artist,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.artist=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Plaque Description",prop:"description"},{default:o(()=>[t(u,{modelValue:l.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.description=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(n,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[t(u,{modelValue:l.value.public_link,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.public_link=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Artist Social Media Link",prop:"artist_social_link"},{default:o(()=>[t(u,{modelValue:l.value.artist_social_link,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.artist_social_link=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Link to Blockchain"},{default:o(()=>[t(y,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a),"active-text":b.value?"Enabled":"Disabled"},null,8,["modelValue","active-text"])]),_:1}),b.value?(v(),k(n,{key:0,label:"Blockchain",prop:"blockchain"},{default:o(()=>[t(i,{modelValue:l.value.blockchain,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.blockchain=a)},{default:o(()=>[t(m,{label:"Ethereum",value:"ethereum"})]),_:1},8,["modelValue"])]),_:1})):h("",!0),b.value?(v(),k(n,{key:1,label:"Contract Address",prop:"asset_contract_address"},{default:o(()=>[t(u,{modelValue:l.value.asset_contract_address,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.asset_contract_address=a)},null,8,["modelValue"])]),_:1})):h("",!0),b.value?(v(),k(n,{key:2,label:"Token ID",prop:"token_id"},{default:o(()=>[t(u,{modelValue:l.value.token_id,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.token_id=a)},null,8,["modelValue"])]),_:1})):h("",!0),t(n,{label:"Price",prop:"price"},{default:o(()=>[x("div",Ve,[t(H,{modelValue:l.value.price,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.price=a),controls:!1,placeholder:"no price",style:{"max-width":"133px"}},null,8,["modelValue"]),t(i,{modelValue:l.value.price_unit,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.price_unit=a),style:{"margin-left":"12px","max-width":"90px"}},{default:o(()=>[t(m,{label:"USD",value:q(U).USD},null,8,["value"]),t(m,{label:"ETH",value:q(U).ETH},null,8,["value"])]),_:1},8,["modelValue"])])]),_:1}),_.token_meta_id?h("",!0):(v(),k(n,{key:3,label:"Share to Gallery(s)"},{default:o(()=>[t(i,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=a=>V.value=a),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(v(!0),se(de,null,ie(C.value,a=>(v(),k(m,{key:a.id,label:`${a.entity.name}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),_.token_meta_id?h("",!0):(v(),k(n,{key:4},{default:o(()=>[t(j,{class:"upload-demo","auto-upload":!1,action:"","on-remove":P,"before-remove":L,limit:1,drag:"","file-list":c.value,"onUpdate:fileList":e[12]||(e[12]=a=>c.value=a)},{default:o(()=>[t(B,{class:"el-icon--upload"},{default:o(()=>[t(Q)]),_:1}),he]),_:1},8,["file-list"])]),_:1})),t(n,null,{default:o(()=>[t(J,{onClick:e[13]||(e[13]=a=>I(w.value)),loading:r.value,color:"#000000"},{loading:o(()=>[t(B,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[t(z)]),_:1}),F(" "+D($.value),1)]),default:o(()=>[x("div",null,D(r.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});var Re=me(we,[["__scopeId","data-v-59a35d27"]]);export{Re as S};
