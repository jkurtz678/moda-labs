import{d as O,P as Z,Q as ee,r as T,o as p,h as k,F as D,I as N,M as K,f as _,S as te,j as G,t as R,T as ne,U as oe,m as Y,z as P,_ as J,u as X,L as le,c as q,b as I,k as y,n as U,i as c,w as h,V as W,e as j,g as ae,K as ie,p as re,l as se}from"./index.831b25a0.js";import{u as ce}from"./thumbnail-image.44208806.js";import{c as ue,d as de}from"./types.6a5ef88e.js";import{s as me}from"./util.ffd4ce15.js";import{u as _e}from"./token-meta.3d1f5885.js";import{u as pe}from"./gallery.62764c82.js";import"./firebaseConfig.d7a6b5a9.js";import"./token-meta.2d60a689.js";import"./account.72092b89.js";import"./gallery.82c2a091.js";const ve={columnWidth:400,gap:0,keyMapper:(o,s,V,g)=>g,minColumns:1,maxColumns:void 0,rtl:!1,scrollContainer:null,ssrColumns:0};function fe({columns:o,columnWidth:s,emit:V,gap:g,items:a,maxColumns:f,minColumns:d,nextTick:$,onBeforeUnmount:w,onMounted:b,rtl:A,scrollContainer:M,ssrColumns:x,vue:l,wall:e,watch:t}){function r(i,n,S,E){const F=u(S);return E+n+F<=i?r(i,n,S+1,E+n+F):S}function u(i){const n=Array.isArray(s.value)?s.value:[s.value];return n[i%n.length]}function v(){const i=r(e.value.getBoundingClientRect().width,g.value,0,-g.value),n=B(C(i));return n>0?n:1}function C(i){const n=f==null?void 0:f.value;return n&&i>n?n:i}function B(i){const n=d==null?void 0:d.value;return n&&i<n?n:i}function m(i){return[...new Array(i)].map(()=>[])}if(x.value>0){const i=m(x.value);a.value.forEach((n,S)=>i[S%x.value].push(S)),o.value=i}async function H(i){if(i>=a.value.length)return;await $();const n=[...e.value.children];A.value&&n.reverse();const S=n.reduce((E,F)=>F.getBoundingClientRect().height<E.getBoundingClientRect().height?F:E);o.value[+S.dataset.index].push(i),await H(i+1)}async function z(i=!1){if(o.value.length===v()&&!i){V(l===2?"redraw-skip":"redrawSkip");return}o.value=m(v());const n=M==null?void 0:M.value,S=n?n.scrollTop:window.scrollY;await H(0),n?n.scrollBy({top:S-n.scrollTop}):window.scrollTo({top:S}),V("redraw")}const L=typeof ResizeObserver>"u"?void 0:new ResizeObserver(()=>z());return b(()=>{z(),L==null||L.observe(e.value)}),w(()=>L==null?void 0:L.unobserve(e.value)),t([a,A],()=>z(!0)),t([s,g,d,f],()=>z()),{getColumnWidthTarget:u}}const ye=["data-index"],ke=O({__name:"masonry-wall",props:Z({columnWidth:{},items:{},gap:{},rtl:{type:Boolean},ssrColumns:{},scrollContainer:{},minColumns:{},maxColumns:{},keyMapper:{type:Function}},ve),emits:["redraw","redrawSkip"],setup(o,{emit:s}){const V=o,{columnWidth:g,items:a,gap:f,rtl:d,ssrColumns:$,scrollContainer:w,minColumns:b,maxColumns:A,keyMapper:M}=ee(V),x=T([]),l=T(),{getColumnWidthTarget:e}=fe({columns:x,columnWidth:g,emit:s,gap:f,items:a,keyMapper:M,maxColumns:A,minColumns:b,nextTick:ne,onBeforeUnmount:oe,onMounted:Y,rtl:d,scrollContainer:w,ssrColumns:$,vue:3,wall:l,watch:P});return(t,r)=>(p(),k("div",{ref_key:"wall",ref:l,class:"masonry-wall",style:K({display:"flex",gap:`${_(f)}px`})},[(p(!0),k(D,null,N(x.value,(u,v)=>(p(),k("div",{key:v,class:"masonry-column","data-index":v,style:K({display:"flex","flex-basis":`${_(e)(v)}px`,"flex-direction":"column","flex-grow":1,gap:`${_(f)}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(p(!0),k(D,null,N(u,(C,B)=>(p(),k("div",{key:_(M)(_(a)[C],v,B,C),class:"masonry-item"},[te(t.$slots,"default",{item:_(a)[C],column:v,row:B,index:C},()=>[G(R(_(a)[C]),1)])]))),128))],12,ye))),128))],4))}}),ge=(()=>{const o=ke;return o.install=s=>{s.component("MasonryWall",o)},o})();const he=["src"],we={class:"header"},be={class:"platform"},xe={style:{"font-size":"1.6em","font-weight":"bold"}},Ce={key:0},Se={key:1,style:{"font-weight":"bold"}},Te={key:3,style:{height:"32px"}},Ve={style:{"font-size":"0.9em","line-height":"1.3em"}},$e=O({__name:"ArtworkTile",props:{token_meta:null},setup(o){const s=o,V=X(),g=ce(le(s,"token_meta")),a=T(!1),f=T(0),d=T(),$=T(),w=q(()=>ue(s.token_meta.entity.platform)),b=async()=>{const e=await de(s.token_meta);if(!e){me("Error getting source file");return}window.open(e,"_blank")},A=()=>{const e=V.resolve({name:"preview-plaque",params:{token_meta_id:s.token_meta.id}});window.open(e.href)},M=()=>{window.open(s.token_meta.entity.public_link,"_blank")},x=()=>{window.open(s.token_meta.entity.artist_social_link,"_blank")};function l(e){if(!d.value){console.log("animateDivHeight - error finding tile container");return}if(e&&f.value==0&&(f.value=d.value.offsetHeight),!$.value){console.log("animateDivHeight - error finding detail container");return}let t;e?t=$.value.offsetHeight:t=f.value;const r=300,u=10,v=d.value.offsetHeight,C=Math.ceil(t-v),B=Math.ceil(r/u),m=C/B;let H=0;const z=setInterval(()=>{if(H>=B){d.value.style.height=t+"px",clearInterval(z);return}H++;const L=v+m*H;d.value.style.height=L+"px"},u)}return(e,t)=>{const r=I("el-button"),u=I("el-tooltip");return p(),k("div",{ref_key:"tile_container",ref:d,class:"custom-card",onClick:t[1]||(t[1]=()=>{a.value=!a.value,l(a.value)})},[y("img",{class:U(a.value?"absolute":""),src:_(g)},null,10,he),y("div",{class:U([a.value?"show-blur":"hide-blur","absolute overlay transition"])},null,2),y("div",{class:U(["transition absolute",a.value?"hide-blur":"show-blur"])},[y("div",we,R(`${o.token_meta.entity.name} | ${o.token_meta.entity.artist}`),1),y("div",be,R(_(w)),1)],2),y("div",{ref_key:"detail_container",ref:$,class:U(["detail-container transition",a.value?"show-blur":"hide-blur absolute-no-b"])},[y("div",xe,R(o.token_meta.entity.name),1),o.token_meta.entity.artist_social_link?(p(),k("div",Ce,[c(r,{link:"",style:{"font-weight":"bold",display:"block"},onClick:W(x,["stop"])},{default:h(()=>[G(R(o.token_meta.entity.artist),1)]),_:1},8,["onClick"])])):(p(),k("div",Se,R(o.token_meta.entity.artist),1)),a.value?(p(),k(D,{key:2},[c(u,{class:"box-item",effect:"dark",content:"Download art",placement:"top"},{default:h(()=>[c(r,{icon:"Download",text:"",circle:"",onClick:W(b,["stop"])},null,8,["onClick"])]),_:1}),c(u,{class:"box-item",effect:"dark",content:"Preview plaque",placement:"top"},{default:h(()=>[c(r,{icon:"Tickets",text:"",circle:"",onClick:W(A,["stop"])},null,8,["onClick"])]),_:1}),o.token_meta.entity.public_link?(p(),j(u,{key:0,class:"box-item",effect:"dark",content:"QR Code Link",placement:"top"},{default:h(()=>[c(r,{icon:"Link",text:"",circle:"",onClick:W(M,["stop"])},null,8,["onClick"])]),_:1})):ae("",!0),c(u,{class:"box-item",effect:"dark",content:"Edit art data",placement:"top"},{default:h(()=>[c(r,{icon:"Edit",text:"",circle:"",onClick:t[0]||(t[0]=W(v=>_(V).push({name:"edit-artwork",params:{token_meta_id:s.token_meta.id}}),["stop"]))})]),_:1})],64)):(p(),k("div",Te)),y("div",Ve,R(o.token_meta.entity.description),1)],2)],512)}}});var Ae=J($e,[["__scopeId","data-v-4c7c2f92"]]);const Q=o=>(re("data-v-32181984"),o=o(),se(),o),Me={class:"subheader",style:{display:"flex","align-items":"center"}},Be=Q(()=>y("div",{class:"caption"},"Filter by gallery",-1)),Ie=Q(()=>y("div",{class:"caption"},"Sort order",-1)),Re=Q(()=>y("div",{style:{"padding-bottom":"40px"}},null,-1)),He={key:1,style:{padding:"1em"}},ze=O({__name:"ArtworkTileGrid",setup(o){const s=X(),V=_e(),g=pe(),a=T(""),f=T(null),d=T(localStorage.getItem("token_list_sort_order")||"name"),$=40,w=T($),b=T(localStorage.getItem("artwork_grid_filter_by_gallery")||"");P(b,l=>{localStorage.setItem("artwork_grid_filter_by_gallery",l)}),P(a,l=>{w.value=$});const A=q(()=>V.sorted_all_token_metas),M=q(()=>{let l=A.value.filter(e=>{var t,r;return((t=e.entity.artist)==null?void 0:t.toLowerCase().includes(a.value.toLowerCase()))||((r=e.entity.name)==null?void 0:r.toLowerCase().includes(a.value.toLowerCase()))});return b.value&&(l=l.filter(e=>{var t;return(t=g.gallery_list.find(r=>r.id==b.value))==null?void 0:t.entity.token_meta_id_list.includes(e.id)})),d.value==="name"?l=l.sort((e,t)=>e.entity.name.localeCompare(t.entity.name)):d.value==="created_at"&&(l=l.sort((e,t)=>e.entity.created_at==null&&t.entity.created_at==null?0:e.entity.created_at==null?1:t.entity.created_at==null?-1:t.entity.created_at.seconds-e.entity.created_at.seconds)),l}),x=q(()=>{const l=M.value,e=0,t=e+w.value;return l.slice(e,t)});return Y(()=>{const l=document.getElementById("masonry-container");if(!l){console.log("ArtworkTileGrid error, masonary_wall element not found");return}l.addEventListener("scroll",()=>{const e=l.scrollTop,t=l.scrollHeight,r=l.clientHeight;e/(t-r)*100>85&&w.value<A.value.length&&(w.value=w.value+40)})}),(l,e)=>{const t=I("el-input"),r=I("el-button"),u=I("el-option"),v=I("el-select"),C=I("el-popover"),B=I("RouterView");return p(),k(D,null,[y("div",Me,[c(t,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=m=>a.value=m),"prefix-icon":_(ie),placeholder:"Search artwork or artist",style:{"max-width":"350px"},clearable:""},null,8,["modelValue","prefix-icon"]),c(C,{placement:"bottom",title:"Artwork Filters",width:300,trigger:"click"},{reference:h(()=>[c(r,{icon:"Filter",style:{"margin-left":"10px"},type:"info",size:"small"},{default:h(()=>[G("Filters")]),_:1})]),default:h(()=>[Be,c(v,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=m=>b.value=m),placeholder:"Filter by gallery",style:{width:"260px","margin-bottom":"12px"}},{default:h(()=>[c(u,{label:"All plaques",value:""}),(p(!0),k(D,null,N(_(g).gallery_list,m=>(p(),j(u,{key:m.id,label:`${m.entity.name}`,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ie,c(v,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=m=>d.value=m),placeholder:"Sort by"},{default:h(()=>[c(u,{label:"Sort by name",value:"name"}),c(u,{label:"Sort by newest",value:"created_at"})]),_:1},8,["modelValue"])]),_:1}),c(r,{icon:"Plus",type:"info",onClick:e[3]||(e[3]=m=>_(s).push({name:"new-artwork"})),style:{"margin-left":"10px"},size:"small"},{default:h(()=>[G("Artwork")]),_:1})]),Re,y("div",{id:"masonry-container",ref_key:"masonryContainer",ref:f,style:{"overflow-y":"auto",height:"100%",padding:"10px"}},[_(x).length>0?(p(),j(_(ge),{key:0,id:"masonary-wall","scroll-container":f.value,items:_(x),"column-width":250,gap:14},{default:h(({item:m})=>[c(Ae,{token_meta:m},null,8,["token_meta"])]),_:1},8,["scroll-container","items"])):(p(),k("div",He,"No artwork found"))],512),c(B)],64)}}});var je=J(ze,[["__scopeId","data-v-32181984"]]);export{je as default};
