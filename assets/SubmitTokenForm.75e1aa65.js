import{b as K,c as X}from"./gallery-token.f19a7c70.js";import{d as Z,u as ee,e as le}from"./token-meta.9b03395e.js";import{h as ae,r as te,u as oe,i as A}from"./firebaseConfig.4d01e9b5.js";import{z as T,d as ne,r as v,Q as se,q as ue,c as re,a as k,w as o,f as d,o as p,i as t,g as V,l as h,u as B,h as ie,J as de,F as me,j as q,t as M,_ as ce,A as pe,p as _e,m as fe}from"./index.a0d92ef2.js";import{a as x,T as ve,P as U}from"./types.67d14e22.js";import{u as ke}from"./account.b9d4d84f.js";import{u as ge}from"./token-meta.76db3871.js";import{s as b}from"./util.4177647f.js";const be=ae(),ye=async(_,f,S,e)=>{console.log("uploadFile - starting file upload for ",_);const c=te(be,_);oe(c,f).on("state_changed",s=>{console.log("snapshot",s.bytesTransferred,s.totalBytes),S(s.bytesTransferred/s.totalBytes)},s=>{console.log("uploadFile error - ",s),T({message:`Error uploading file to moda archive - ${s}`,type:"error",showClose:!0,duration:12e3})},e)};const D=_=>(_e("data-v-3d41feb7"),_=_(),fe(),_),Ve={style:{display:"flex","align-items":"center"}},he=D(()=>h("div",{style:{"font-size":"11px"}},"GALLERY COMISSION RATE IS 33%",-1)),we=D(()=>h("div",{class:"el-upload__text"},[q(" Drop file here or "),h("em",null,"click to upload")],-1)),Se=ne({__name:"SubmitTokenForm",props:{token_meta_id:{}},setup(_){const f=_,S=v();v();const e=v({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:A.now(),updated_at:A.now(),media_id:"",media_type:"",user_id:"",blockchain:x.OffChain,asset_contract_address:"",token_id:"",platform:ve.Archive,permission_to_sell:!1,price:0,price_unit:U.USD}),c=v([]),E=se({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),s=v(!1),$=v("0%"),w=v([]),F=ke(),L=ge(),C=v([]);ue(()=>{f.token_meta_id?(e.value={...L.all_token_metas[f.token_meta_id].entity},e.value.price_unit||(e.value.price_unit=U.USD)):K().then(r=>{C.value=r})});const P=(r,l)=>pe.confirm(`Cancel the upload of ${r.name} ?`).then(()=>!0,()=>!1),y=re({get:()=>e.value.blockchain===x.Ethereum,set:r=>{e.value.blockchain=r?x.Ethereum:x.OffChain}}),I=()=>{},N=async r=>{var u;if(!r){b("Error finding form element");return}if(!!await r.validate(n=>n)){if(e.value.user_id=F.get_account.id,e.value.blockchain!="ethereum"&&(e.value.asset_contract_address="",e.value.token_id=""),f.token_meta_id){Y(f.token_meta_id);return}if(((u=c==null?void 0:c.value)==null?void 0:u.length)!==1){b("Please add a file to upload");return}await G(r)}},G=async r=>{const l=c.value[0];s.value=!0;const u=await Z().catch(i=>{console.error(i),s.value=!1,b(`Error getting moda archive token meta document - ${i}`)});if(!u)return;const n=i=>{$.value=`${Math.round(i*100)}%`},g=()=>{O(r,l,u)},m=`${u.id}.${l.name.split(".").pop()}`;return ye(m,l.raw,n,g).catch(i=>{console.error(i),s.value=!1,b(`Error uploading file to moda archive - ${i}`)})},O=async(r,l,u)=>{var g;e.value.media_id=`${u.id}`,e.value.media_type=`.${l.name.split(".").pop()}`;let n;try{n=await le(u,e.value)}catch(m){b(`Error uploading metadata to moda archive - ${m}`),s.value=!1;return}if((g=w.value)!=null&&g.length){const m=w.value.map(i=>({gallery_id:i,token_meta_id:n.id}));await X(m).catch(i=>{b(`Error adding token to gallery - ${i}`),s.value=!1})}r.resetFields(),c.value=[],w.value=[],T({type:"success",message:"Successfully submitted artwork. Please wait a few moments for your artwork to appear."}),s.value=!1},Y=r=>{s.value=!0,ee(r,e.value).then(()=>{T({type:"success",message:"Successfully updated artwork"})}).catch(l=>{b(`Error updating token metadata - ${l}`)}).finally(()=>s.value=!1)};return(r,l)=>{const u=d("el-input"),n=d("el-form-item"),g=d("el-switch"),m=d("el-option"),i=d("el-select"),z=d("el-input-number"),H=d("upload-filled"),R=d("el-icon"),Q=d("el-upload"),W=d("Loading"),j=d("el-button"),J=d("el-form");return p(),k(J,{ref_key:"formRef",ref:S,model:e.value,rules:E,"label-position":"left","label-width":"180px",style:{margin:"0 auto"}},{default:o(()=>[t(n,{label:"Artwork Title",prop:"name"},{default:o(()=>[t(u,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.name=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Artist Name",prop:"artist"},{default:o(()=>[t(u,{modelValue:e.value.artist,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.artist=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Plaque Description",prop:"description"},{default:o(()=>[t(u,{modelValue:e.value.description,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.description=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(n,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[t(u,{modelValue:e.value.public_link,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.public_link=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Artist Social Media Link",prop:"artist_social_link"},{default:o(()=>[t(u,{modelValue:e.value.artist_social_link,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.artist_social_link=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Link to Blockchain"},{default:o(()=>[t(g,{modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=a=>y.value=a),"active-text":y.value?"Enabled":"Disabled"},null,8,["modelValue","active-text"])]),_:1}),y.value?(p(),k(n,{key:0,label:"Blockchain",prop:"blockchain"},{default:o(()=>[t(i,{modelValue:e.value.blockchain,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.blockchain=a)},{default:o(()=>[t(m,{label:"Ethereum",value:"ethereum"})]),_:1},8,["modelValue"])]),_:1})):V("",!0),y.value?(p(),k(n,{key:1,label:"Contract Address",prop:"asset_contract_address"},{default:o(()=>[t(u,{modelValue:e.value.asset_contract_address,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.asset_contract_address=a)},null,8,["modelValue"])]),_:1})):V("",!0),y.value?(p(),k(n,{key:2,label:"Token ID",prop:"token_id"},{default:o(()=>[t(u,{modelValue:e.value.token_id,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.token_id=a)},null,8,["modelValue"])]),_:1})):V("",!0),t(n,{label:"Are You Willing to Sell This Piece?",class:"sell-piece"},{default:o(()=>[t(g,{modelValue:e.value.permission_to_sell,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.permission_to_sell=a),"active-text":e.value.permission_to_sell?"Yes":"No"},null,8,["modelValue","active-text"])]),_:1}),e.value.permission_to_sell?(p(),k(n,{key:3,label:"Price",prop:"price"},{default:o(()=>[h("div",null,[h("div",Ve,[t(z,{modelValue:e.value.price,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.price=a),controls:!1,placeholder:"No Price",style:{"max-width":"133px"}},null,8,["modelValue"]),t(i,{modelValue:e.value.price_unit,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.price_unit=a),style:{"margin-left":"12px","max-width":"90px"}},{default:o(()=>[t(m,{label:"USD",value:B(U).USD},null,8,["value"]),t(m,{label:"ETH",value:B(U).ETH},null,8,["value"])]),_:1},8,["modelValue"])]),he])]),_:1})):V("",!0),f.token_meta_id?V("",!0):(p(),k(n,{key:4,label:"Share to Gallery(s)"},{default:o(()=>[t(i,{modelValue:w.value,"onUpdate:modelValue":l[12]||(l[12]=a=>w.value=a),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(p(!0),ie(me,null,de(C.value,a=>(p(),k(m,{key:a.id,label:`${a.entity.name}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),f.token_meta_id?V("",!0):(p(),k(n,{key:5},{default:o(()=>[t(Q,{class:"upload-demo","auto-upload":!1,action:"","on-remove":I,"before-remove":P,limit:1,drag:"","file-list":c.value,"onUpdate:fileList":l[13]||(l[13]=a=>c.value=a)},{default:o(()=>[t(R,{class:"el-icon--upload"},{default:o(()=>[t(H)]),_:1}),we]),_:1},8,["file-list"])]),_:1})),t(n,null,{default:o(()=>[t(j,{onClick:l[14]||(l[14]=a=>N(S.value)),loading:s.value,color:"#000000"},{loading:o(()=>[t(R,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[t(W)]),_:1}),q(" "+M($.value),1)]),default:o(()=>[h("div",null,M(s.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});var Be=ce(Se,[["__scopeId","data-v-3d41feb7"]]);export{Be as S};
