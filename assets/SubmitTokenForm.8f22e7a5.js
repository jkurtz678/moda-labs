import{u as Q,c as z}from"./token-meta.2d60a689.js";import{a as J,b as K}from"./gallery.82c2a091.js";import{g as W,d as X,u as Y,n as q}from"./firebaseConfig.d7a6b5a9.js";import{q as x,d as Z,r as _,N as ee,l as le,b as i,o as f,g as v,w as o,i as t,j as h,h as V,e as ae,F as te,H as oe,t as A,k as w,I as ne}from"./index.1b8b03fc.js";import{b as re,T as se}from"./types.6a5ef88e.js";import{u as ue}from"./account.ac2769b1.js";import{u as ie}from"./token-meta.2e36ed0c.js";import{s as k}from"./util.ea930586.js";const de=W(),me=async(b,c,y,l)=>{console.log("uploadFile - starting file upload for ",b);const m=X(de,b);Y(m,c).on("state_changed",r=>{console.log("snapshot",r.bytesTransferred,r.totalBytes),y(r.bytesTransferred/r.totalBytes)},r=>{console.log("uploadFile error - ",r),x({message:`Error uploading file to moda archive - ${r}`,type:"error",showClose:!0,duration:12e3})},l)};const ce=w("div",{class:"el-upload__text"},[h(" Drop file here or "),w("em",null,"click to upload")],-1),Ve=Z({__name:"SubmitTokenForm",props:{token_meta_id:null},setup(b){const c=b,y=_();_();const l=_({name:"",artist:"",artist_social_link:"",description:"",public_link:"",created_at:q.now(),updated_at:q.now(),media_id:"",media_type:"",user_id:"",blockchain:re.OffChain,asset_contract_address:"",token_id:"",platform:se.Archive}),m=_([]),T=ee({name:[{required:!0,message:"Required",trigger:"blur"}],artist:[{required:!0,message:"Required",trigger:"blur"}],asset_contract_address:[{required:!0,message:"Required",trigger:"blur"}],token_id:[{required:!0,message:"Required",trigger:"blur"}]}),r=_(!1),$=_("0%"),g=_([]),B=ue(),S=ie(),U=_([]);le(()=>{c.token_meta_id?l.value={...S.all_token_metas[c.token_meta_id].entity}:J().then(u=>{U.value=u})});const E=(u,e)=>ne.confirm(`Cancel the upload of ${u.name} ?`).then(()=>!0,()=>!1),F=()=>{},R=async u=>{var s;if(!u){k("Error finding form element");return}if(!!await u.validate(n=>n)){if(l.value.user_id=B.get_account.id,l.value.blockchain!="ethereum"&&(l.value.asset_contract_address="",l.value.token_id=""),c.token_meta_id){N(c.token_meta_id);return}if(((s=m==null?void 0:m.value)==null?void 0:s.length)!==1){k("Please add a file to upload");return}M(u)}},M=u=>{const e=m.value[0],s=p=>{$.value=`${Math.round(p*100)}%`},n=()=>{L(u,e)};r.value=!0;const d=`${e.uid}.${e.name.split(".").pop()}`;me(d,e.raw,s,n).catch(p=>{console.error(p),r.value=!1,k(`Error uploading file to moda archive - ${p}`)})},L=async(u,e)=>{var n;l.value.media_id=`${e.uid}`,l.value.media_type=`.${e.name.split(".").pop()}`;let s;try{s=await z(l.value)}catch(d){k(`Error uploading metadata to moda archive - ${d}`),r.value=!1;return}if((n=g.value)!=null&&n.length)try{const d=[];g.value.forEach(async p=>{d.push(K(p,s.id))}),await Promise.all(d)}catch(d){k(`Error adding token to gallery - ${d}`),r.value=!1;return}u.resetFields(),m.value=[],g.value=[],x({type:"success",message:"Successfully submitted token"}),r.value=!1},N=u=>{r.value=!0,Q(u,l.value).then(()=>{x({type:"success",message:"Successfully updated token"})}).catch(e=>{k(`Error updating token metadata - ${e}`)}).finally(()=>r.value=!1)};return(u,e)=>{const s=i("el-input"),n=i("el-form-item"),d=i("el-radio"),p=i("el-radio-group"),P=i("el-option"),D=i("el-select"),G=i("upload-filled"),C=i("el-icon"),I=i("el-upload"),O=i("Loading"),j=i("el-button"),H=i("el-form");return f(),v(H,{ref_key:"formRef",ref:y,model:l.value,rules:T,"label-position":"left","label-width":"180px",style:{"max-width":"750px"}},{default:o(()=>[t(n,{label:"Artwork Title",style:{"max-width":"550px"},prop:"name"},{default:o(()=>[t(s,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.name=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Artist Name",style:{"max-width":"550px"},prop:"artist"},{default:o(()=>[t(s,{modelValue:l.value.artist,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.artist=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Artist Social Media Link",style:{"max-width":"550px"},prop:"artist_social_link"},{default:o(()=>[t(s,{modelValue:l.value.artist_social_link,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.artist_social_link=a)},null,8,["modelValue"])]),_:1}),t(n,{label:"Link to Blockchain"},{default:o(()=>[t(p,{modelValue:l.value.blockchain,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.blockchain=a)},{default:o(()=>[t(d,{label:"off_chain"},{default:o(()=>[h("Off-chain")]),_:1}),t(d,{label:"ethereum"},{default:o(()=>[h("Ethereum")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l.value.blockchain=="ethereum"?(f(),v(n,{key:0,label:"Asset Contract Address",style:{"max-width":"550px"},prop:"asset_contract_address"},{default:o(()=>[t(s,{modelValue:l.value.asset_contract_address,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.asset_contract_address=a)},null,8,["modelValue"])]),_:1})):V("",!0),l.value.blockchain=="ethereum"?(f(),v(n,{key:1,label:"Token ID",style:{"max-width":"550px"},prop:"token_id"},{default:o(()=>[t(s,{modelValue:l.value.token_id,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.token_id=a)},null,8,["modelValue"])]),_:1})):V("",!0),t(n,{label:"Plaque Description",prop:"description"},{default:o(()=>[t(s,{modelValue:l.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.description=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),t(n,{label:"Plaque QR Code Link",prop:"public_link"},{default:o(()=>[t(s,{modelValue:l.value.public_link,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.public_link=a)},null,8,["modelValue"])]),_:1}),c.token_meta_id?V("",!0):(f(),v(n,{key:2,label:"Add to Gallery",prop:"galleries"},{default:o(()=>[t(D,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=a=>g.value=a),multiple:"",placeholder:"N/A",filterable:""},{default:o(()=>[(f(!0),ae(te,null,oe(U.value,a=>(f(),v(P,{key:a.id,label:`${a.entity.name}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),c.token_meta_id?V("",!0):(f(),v(n,{key:3},{default:o(()=>[t(I,{class:"upload-demo","auto-upload":!1,action:"","on-remove":F,"before-remove":E,limit:1,drag:"","file-list":m.value,"onUpdate:fileList":e[9]||(e[9]=a=>m.value=a)},{default:o(()=>[t(C,{class:"el-icon--upload"},{default:o(()=>[t(G)]),_:1}),ce]),_:1},8,["file-list"])]),_:1})),t(n,null,{default:o(()=>[t(j,{onClick:e[10]||(e[10]=a=>R(y.value)),loading:r.value,color:"#000000"},{loading:o(()=>[t(C,{class:"is-loading",style:{"margin-right":"4px"}},{default:o(()=>[t(O)]),_:1}),h(" "+A($.value),1)]),default:o(()=>[w("div",null,A(r.value?"UPLOADING":"SUBMIT"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});export{Ve as _};
